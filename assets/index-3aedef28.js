var e=Object.defineProperty,t=(t,n,o)=>(((t,n,o)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o})(t,"symbol"!=typeof n?n+"":n,o),o);import{c9 as n,bE as o,cp as r,cq as i,cr as a,cs as s,c8 as c,cb as d,bz as l,ct as u,cu as p,cv as m,cw as f,cx as h,cy as v,bO as y,cz as g,cA as b,cB as k,cC as w,by as C,bY as S,bZ as T,cD as x,bH as P,bN as R,bL as O,cE as L,cF as E,cG as _,cH as M,cI as D,ch as I,b$ as A,bQ as N,bR as B,cJ as V,c2 as j,bT as U,cK as F,cL as z,cM as q,bS as G,cl as W,cN as H,cO as $,cP as J,bG as K,cQ as Y,cR as Q,co as X,cS as Z,cT as ee,bU as te,cU as ne,cV as oe,cW as re,bP as ie}from"./vendor-7c63fa3e.js";import{P as ae,N as se,Q as ce,a as de,b as le,c as ue,d as pe,e as me,f as fe,g as he,h as ve,R as ye,i as ge,j as be,k as ke,l as we,u as Ce,m as Se,n as Te,o as xe,C as Pe,p as Re,q as Oe,r as Le,s as Ee,t as _e,v as Me,w as De,x as Ie,y as Ae,z as Ne,A as Be,B as Ve,D as je,E as Ue,F as Fe,G as ze,H as qe,I as Ge,J as We,K as He,L as $e,M as Je,O as Ke}from"./vendor-quasar-cda12e26.js";import{m as Ye,f as Qe,u as Xe,a as Ze,V as et,b as tt,c as nt,d as ot,e as rt,g as it,h as at,i as st,j as ct,k as dt,l as lt,n as ut,o as pt,p as mt,q as ft,r as ht,s as vt,t as yt,v as gt,w as bt,x as kt,y as wt,z as Ct,A as St,B as Tt,C as xt,D as Pt}from"./vendor-vue-cesium-1ce6e7f4.js";import{d as Rt,s as Ot,c as Lt}from"./vendor-pinia-0ca71286.js";import{A as Et,a as _t}from"./vendor-axios-7b230b2c.js";import{l as Mt}from"./vendor-lodash-eaa7a8ae.js";import{L as Dt,l as It}from"./vendor-lowdb-b2521bcc.js";import{i as At}from"./vendor-interactjs-0637477a.js";import"./vendor-echarts-8d208272.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const Nt="VueCesiumDemo";function Bt(e="default",t=""){ae.set(`${Nt}-0.0.1-${e}`,t)}function Vt(e="default"){return ae.getItem(`${Nt}-0.0.1-${e}`)}function jt(e="default"){ae.remove(`${Nt}-0.0.1-${e}`)}const Ut={},Ft=function(e,t,n){if(!t||0===t.length)return e();const o=document.getElementsByTagName("link");return Promise.all(t.map((e=>{if(e=function(e,t){return new URL(e,t).href}(e,n),e in Ut)return;Ut[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(!!n)for(let n=o.length-1;n>=0;n--){const r=o[n];if(r.href===e&&(!t||"stylesheet"===r.rel))return}else if(document.querySelector(`link[href="${e}"]${r}`))return;const i=document.createElement("link");return i.rel=t?"stylesheet":"modulepreload",t||(i.as="script",i.crossOrigin=""),i.href=e,document.head.appendChild(i),t?new Promise(((t,n)=>{i.addEventListener("load",t),i.addEventListener("error",(()=>n(new Error(`Unable to preload CSS for ${e}`))))})):void 0}))).then((()=>e())).catch((e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}))},zt=[{path:"/",name:"layout",component:()=>Ft((()=>Promise.resolve().then((()=>qr))),void 0,import.meta.url),redirect:{path:"/home"},children:[{name:"login",path:"/login",component:()=>Ft((()=>Promise.resolve().then((()=>Zo))),void 0,import.meta.url)}]}],qt=[{path:"/:catchAll(.*)*",name:"404",component:()=>Ft((()=>Promise.resolve().then((()=>Wo))),void 0,import.meta.url)}],Gt=[{name:"test-on-demand",path:"/test-on-demand",meta:{title:"ttt"},component:()=>Ft((()=>Promise.resolve().then((()=>tr))),void 0,import.meta.url)}],Wt=zt,Ht=[...zt,...Gt,...qt],$t="VueCesiumDemo",Jt=((e="")=>function(...t){e&&(n(t[0])?t[0]=e.trim()+" "+t[0]:t=[e.trim(),...t]);const o=t.shift(),r=new Error(o);hi.system.useLogStore(fi).push({message:"业务逻辑警告",type:"warning",meta:{error:r}}),se.create({message:o,timeout:3e3,type:"warning"})})(`[${$t}] WARN `),Kt=((e="")=>function(...t){e&&(n(t[0])?t[0]=e.trim()+" "+t[0]:t=[e.trim(),...t]);const o=t.shift(),r=new Error(o);hi.system.useLogStore(fi).push({message:"业务逻辑异常",type:"danger",meta:{error:r}}),se.create({message:o,timeout:3e3,type:"negative"})})(`[${$t}] ERR `),Yt=((e="")=>function(...t){e&&(n(t[0])?t[0]=e.trim()+" "+t[0]:t=[e.trim(),...t])})(`[${$t}] Debug `);function Qt(e,t,n){return tn(e,t.geometry.coordinates,n,t)}function Xt(e,t,n){const o=[],r=t.geometry.coordinates;for(let i=0;i<r.length;i++)o.push(tn(e,r[i],n,t));return o}function Zt(e,t,n){return nn(e,t.geometry.coordinates,n,t)}function en(e,t,n,r){var i;const a=!Cesium.defined(r.properties.checked)||o(r.properties,"checked");r.properties.actualRenderingType=n;const s={id:Cesium.createGuid(),position:t,show:a,feature:Mt.cloneDeep(r)};if(s[n]={...e[n]},"model"===n){const e=JSON.parse((null==(i=r.properties)?void 0:i.hpr)||"{}");if(Array.isArray(e)){const n=Ye(t),o=new Cesium.HeadingPitchRoll(...e);s.orientation=Cesium.Transforms.headingPitchRollQuaternion(n,o)}}return s}function tn(e,t,n,s){const c=o(s.properties,"checked");if(s.properties.actualRenderingType=n,"polygon"===n){return Zt(e,r(s),n)}if("billboard"===n||"point"===n||"label"===n){const t={show:c,position:("MultiPolygon"===s.geometry.type?i(s):a(s)).geometry.coordinates,feature:Mt.cloneDeep(s)};switch(n){case"billboard":t.billboard={...e.billboard};break;case"point":t.point={...e.point};break;case"label":t.label={text:s.properties.text||s.properties.name,...e.label}}return t}return{show:c,polyline:{positions:t,...e.polyline},feature:Mt.cloneDeep(s)}}function nn(e,t,n,r){const c=o(r.properties,"checked");if(r.properties.actualRenderingType=n,"polyline"===n){if("MultiPolygon"===r.geometry.type){const t=s(r),o=[];return t.features.forEach((t=>{"LineString"===t.geometry.type?o.push(Qt(e,t,n)):o.push(...Xt(e,t,n))})),o}if("Polygon"===r.geometry.type){const t=s(r);return Qt(e,t,n)}}else{if("polygon"===n){const n=[];for(let e=1;e<t.length;e++)n.push({positions:t[e]});return{show:c,polygon:{height:0,hierarchy:{positions:t[0],holes:n},...e.polygon},feature:Mt.cloneDeep(r)}}if("billboard"===n||"point"===n||"label"===n){const t={show:c,position:("MultiPolygon"===r.geometry.type?i(r):a(r)).geometry.coordinates,feature:Mt.cloneDeep(r)};switch(n){case"billboard":t.billboard={...e.billboard};break;case"point":t.point={...e.point};break;case"label":t.label={text:r.properties.text||r.properties.name,...e.label}}return t}}}const on={LineString:Qt,MultiLineString:Xt,MultiPoint:function(e,t,n){const o=[],r=t.geometry.coordinates;for(let i=0;i<r.length;i++)o.push(en(e,r[i],n,t));return o},MultiPolygon:function(e,t,n){const o=[],r=t.geometry.coordinates;for(let i=0;i<r.length;i++){const a=nn(e,r[i],n,t),s=Array.isArray(a)?a:[a];o.push(...s)}return o},Point:function(e,t,n){return en(e,t.geometry.coordinates,n,t)},Polygon:Zt};function rn(e){hi.viewer.useRenderStore(fi).addRenderDatas(e)}function an(e){hi.viewer.useRenderStore(fi).removeRenderDataById(e)}function sn(e){return hi.viewer.useRenderStore(fi).getRenderDataByDatasetId(e)}function cn(e,t){hi.viewer.useRenderStore(fi).setSelectedRenderData(e,t)}function dn(){var e;const t=hi.viewer.useRenderStore(fi).selectedRenderData;t.model&&(null==(e=null==t?void 0:t.restoreHandlers)?void 0:e.length)&&t.restoreHandlers.forEach((e=>{e()})),cn({model:void 0,renderingType:void 0,restoreHandlers:[],feature:void 0,featureInfoListItems:[]},!0)}function ln(e,t,n,o=[],r){dn();const i=e.trim().split(",");i&&i.length||Jt("高亮渲染模型失败，原因：未知的显示类型。","要素ID：",n.properties.id),i.forEach((e=>{var i;const a=un(e,sn(t),n.properties.id);if(!a)return void cn({model:null,renderingType:e,restoreHandlers:[()=>{}],feature:n,featureInfoListItems:o});const s=null==(i=a.feature.properties)?void 0:i.selectedProps,d=s&&c(s)?s:s?JSON.parse(s):{},l="primitive"===r?a:a[e],u=null==d?void 0:d[e];if(u){let t={};Object.keys(u).forEach((e=>{t[e]=l[e],l[e]=u[e]})),cn({model:l,renderingType:e,restoreHandlers:[()=>{Object.keys(t).forEach((e=>{l[e]=t[e]})),t=void 0}],feature:a.feature,featureInfoListItems:o})}else Jt("设置对象选中风格失败，原因：没有设置默认选中样式。请通过数据集或者要素的 selectedProps 字段设置。")}))}function un(e,t,n,o){let r,i,a;if(r=c(t)?t:sn(t),!r)return;switch(e){case"label":case"point":case"billboard":case"model":i="primitive"===o?"VcCollectionBillboard":"VcDatasourceCustom",a="primitive"===o?"billboards":"entities";break;case"polyline":i="primitive"===o?"VcCollectionPolyline":"VcDatasourceCustom",a="primitive"===o?"polylines":"entities";break;case"polygon":i="primitive"===o?"VcCollectionPrimitive":"VcDatasourceCustom",a="primitive"===o?"polygons":"entities";break;case"geojson":i="VcDatasourceGeojson",a="data";break;case"tileset":i="VcPrimitiveTileset";break;case"imagery":i="VcLayerImagery"}const s=Mt.find(r.datasets,(e=>e.cmpName===i));if("geojson"===e)return s;if(Cesium.defined(s)){if("geojson"===e)return s;return Mt.find(s.props[a],(t=>t.feature.properties.id===n&&t.feature.properties.actualRenderingType===e))}}function pn(e,t){const n=[];if(!Cesium.defined(e.geometry))return Jt("feature.geometry is required.","要素：",e),"添加渲染模型失败，原因：该要素没有 geometry 属性";const o=Object.keys(t);if(!o||!o.length)return Jt("添加渲染模型失败，原因：未知的显示类型。","要素：",e),"添加渲染模型失败，原因：未知的显示类型。";const r=e.geometry.type,i=on[r];return Cesium.defined(i)?(o.forEach((o=>{const r=i(t,e,o),a=Array.isArray(r)?r:[r];n.push(...a)})),n):(Jt(`添加渲染模型失败，原因：该几何类型${r}没有找到处理方法。`,"要素：",e),`添加渲染模型失败，原因：该几何类型${r}没有找到处理方法。`)}async function mn(e,t,n,o,r,i,a,s){const c={id:r,page:i,type:a,datasets:[]},d=await async function(e,t,n,o,r){"string"==typeof e&&(e=await Cesium.Resource.fetchJson({url:e}));if(!Cesium.defined(e))return void Kt("添加数据源失败，原因：GeoJSON 数据格式不正确。",e);const i=[],a=e.type,s=e=>{e.properties.renderingType=e.properties.renderingType||t,Cesium.defined(e.properties.id)||(e.properties.id=Cesium.createGuid()),e.properties.datasetId=r,e.properties.selectedProps=e.properties.selectedProps||o||{}};switch(a){case"FeatureCollection":e.features.forEach((e=>{s(e);const t=pn(e,n);t.length&&i.push(...t)}));break;case"Feature":{const t=e;s(t);const o=pn(t,n);o.length&&i.push(...o)}}return i}(e,t,n,o,r);return d.length&&c.datasets.push({cmpName:"VcDatasourceCustom",props:{entities:d,...s,onReady:e=>{var t;const{cesiumObject:n}=e,o=`VcDatasourceCustom_${c.id}`;n.datasetId=o,null==(t=null==s?void 0:s.onReady)||t.call(s,e)}}}),rn(c),Promise.resolve(c)}function fn(e,t){let n=[];return t().then((t=>{var o,r;if(0!==t.code)return Kt(`添加渲染数据集失败，原因：数据请求失败。数据集id: ${e.id}，数据集名称: ${e.name}`),!1;if(!t.data)return Kt(`添加渲染数据集失败，原因：未知的 GeoJSON 类型。数据集id: ${e.id}，数据集名称: ${e.name}`),!1;if(null==(o=t.data)?void 0:o.type){switch(null==(r=t.data)?void 0:r.type){case"Feature":n=[t.data];break;case"FeatureCollection":n=t.data.features,n.forEach((t=>{Cesium.defined(t.properties.renderingType)||(t.properties.renderingType=e.renderingType||"billboard"),Cesium.defined(t.properties.id)||(t.properties.id=Cesium.createGuid()),Cesium.defined(t.properties.checked)||(t.properties.checked=!1)}));break;default:return Kt(`添加渲染数据集失败，原因：未知的 GeoJSON 类型。数据集id: ${e.id}，数据集名称: ${e.name}`),!1}}return n.length?n:(Kt(`添加渲染数据集失败，原因：请求数据成功，但结果为空。数据集id: ${e.id}，数据集名称: ${e.name}`),!1)})).catch((e=>(Kt("添加渲染数据集失败，原因：数据请求异常。",e),!1)))}function hn(e,t,n,o,r){var i;if(null==(i=e.children)?void 0:i.length)return Promise.resolve(vn(e,n,o,r));try{return fn(e,t).then((t=>{if(Array.isArray(t))return e.children=t,vn(e,n,o,r)}))}catch(a){return void Kt(`添加渲染数据集失败，原因：数据请求发生错误。数据集id: ${e.id}，数据集名称: ${e.name}`,"数据模型：",e)}}const vn=(e,t,n,r)=>new Promise(((i,a)=>{var s,u,p,m,f,h,v,y,g,b,k,w;e.cesiumObjects=e.cesiumObjects||[];const C={id:e.id,name:e.name,page:t,type:n,datasets:[]};let S=[];for(let l=0;l<(null==(s=null==e?void 0:e.children)?void 0:s.length);l++){const a=e.children[l];if(d(a,"type")&&d(a,"properties")){const t=a,n=t.properties;n.datasetId=t.properties.datasetId||e.id,n.datasetName=t.properties.datasetName||e.name,n.selectedProps=t.properties.selectedProps||e.selectedProps||{};const r=e.props&&c(null==e?void 0:e.props)?null==e?void 0:e.props:e.props?JSON.parse(null==e?void 0:e.props):{},s=(null==(u=t.properties)?void 0:u.props)&&c(null==(p=t.properties)?void 0:p.props)?null==(m=t.properties)?void 0:m.props:t.properties.props?JSON.parse(null==(f=t.properties)?void 0:f.props):{},d=Object.assign({},r,s);if("geojson"===e.renderingType){const n=Object.assign({},d[e.renderingType],null==(v=null==(h=t.properties)?void 0:h.props)?void 0:v[e.renderingType]);t.properties.actualRenderingType=e.renderingType,C.datasets.push({cmpName:"VcDatasourceGeojson",props:{...n,show:o(t.properties,"checked"),onReady:e=>{i(e)}},feature:t})}else if("tileset"===e.renderingType){const n=Object.assign({},d[e.renderingType],null==(g=null==(y=t.properties)?void 0:y.props)?void 0:g[e.renderingType]);t.properties.actualRenderingType=e.renderingType,C.datasets.push({cmpName:"VcPrimitiveTileset",props:{...n,show:o(t.properties,"checked"),onReady:e=>{i(e)}},feature:t})}else if("imagery"===e.renderingType){const n=Object.assign({},d[e.renderingType],null==(k=null==(b=t.properties)?void 0:b.props)?void 0:k[e.renderingType]);t.properties.actualRenderingType=e.renderingType;const r=n.children;delete n.children,C.datasets.push({cmpName:"VcLayerImagery",props:{...n,show:o(t.properties,"checked"),onReady:e=>{i(e)}},feature:t,children:[{cmpName:r[0].cmpName,props:{...r[0].props}}]})}else{const e=pn(t,d);if("string"==typeof e)continue;const n=Mt.intersectionWith(e,S,((e,t)=>e.feature.properties.id===t.feature.properties.id&&e.feature.geometry.type===t.feature.geometry.type));S.push(...e),n.length&&(n.forEach((e=>{Jt(`已添加相同id和类型的渲染数据集，可能有重复数据，请核实。对象 id: ${e.feature.properties.id}，对象类型: ${e.feature.geometry.type}`,"数据模型：",e)})),S=Mt.uniqWith(S,((e,t)=>e.feature.properties.id===t.feature.properties.id&&e.feature.geometry.type===t.feature.geometry.type)))}}else{const e=a;(null==(w=null==e?void 0:e.children)?void 0:w.length)?i(vn(e,t,n,r)):i(!1)}}S.length&&C.datasets.push({cmpName:"VcDatasourceCustom",props:{...r,entities:S,onReady:t=>{var n;const{cesiumObject:o}=t,a=`VcDatasourceCustom_${e.id}`;o.datasetId=a;!Mt.find(e.cesiumObjects,(e=>e.datasetId===a))&&e.cesiumObjects.push(l(o)),null==(n=null==r?void 0:r.onReady)||n.call(r,t),i(t)}}}),rn(C)}));function yn(e,t){const{toggleGlobalLayout:n}=hi.system.useLayoutStore(fi);"摄像头"===e.properties.datasetName&&n({videoPlayer:!0}),n({featureInfo:!0});const o=Object.keys(e.properties).map((t=>({label:t,value:e.properties[t]})));if(t)cn({...t,restoreHandlers:[],featureInfoListItems:o});else{if(!un(e.properties.renderingType,e.properties.datasetId,e.properties.id))return void cn({...t,restoreHandlers:[],featureInfoListItems:o});ln(e.properties.renderingType,e.properties.datasetId,e,o)}}function gn(e){return e.map((e=>({...e,path:e.path||Mt.uniqueId("vc-menu-empty-"),...e.children?{children:gn(e.children)}:{}})))}function bn(e={},t="",n=0){return[200,{code:n,msg:t,data:e}]}function kn(e){hi.system.useLogStore(fi).push({message:"数据请求异常",type:"danger",meta:{error:e}}),se.create({message:e.message,type:"negative",timeout:3e3})}function wn(e){const t=new Error(e);throw kn(t),t}const Cn=Object.freeze(Object.defineProperty({__proto__:null,errorCreate:wn,errorLog:kn,parse:function(e="{}",t={}){let n=t;try{n=JSON.parse(e)}catch(o){Kt(o)}return n},response:bn,responseError:function(e={},t="请求失败",n=500){return bn(e,t,n)},responseSuccess:function(e={},t="成功"){return bn(e,t)}},Symbol.toStringTag,{value:"Module"})),Sn=()=>{const e=_t.create({});return e.interceptors.request.use((e=>e),(e=>(kn(e),Promise.reject(e)))),e.interceptors.response.use((e=>{const t=e.data,{code:n}=t;if(void 0===n)return t;switch(n){case 0:case 200:return t;case"xxx":wn(`[ code: xxx ] ${t.msg}: ${e.config.url}`);break;default:return wn(`${t.msg}: ${e.config.url}`),Promise.reject(t)}}),(e=>{switch(Mt.get(e,"response.status")){case 400:e.message="请求错误";break;case 401:e.message="未授权，请登录",jt("token"),jt("uuid"),jn.push("/login");break;case 403:e.message="拒绝访问";break;case 404:e.message=`请求地址出错: ${e.response.config.url}`;break;case 408:e.message="请求超时";break;case 500:e.message="服务器内部错误";break;case 501:e.message="服务未实现";break;case 502:e.message="网关错误";break;case 503:e.message="服务不可用";break;case 504:e.message="网关超时";break;case 505:e.message="HTTP版本不受支持"}return kn(e),Promise.reject(e)})),e};function Tn(e){return function(t){const n=Vt("token"),o={headers:{Authorization:n,"Content-Type":Mt.get(t,"headers.Content-Type","application/json")},timeout:2e4,baseURL:e.baseURL||"/",data:{}};return n&&(o.headers.Authorization="Bearer "+n),e(Object.assign(o,t))}}const xn=Sn(),Pn=Tn(xn),Rn=Sn(),On=Tn(Rn),Ln=new Et(Rn),En=[{username:"admin",password:"admin",id:"admin-uuid",name:"Admin"},{username:"editor",password:"editor",id:"editor-uuid",name:"Editor"},{username:"henry",password:"henry",id:"henry-uuid",name:"Henry"},{username:"sam",password:"sam",id:"sam-uuid",name:"Sam"},{username:"mark",password:"mark",id:"mark-uuid",name:"Mark"}],_n=[{id:u(),component:"MainLayout",icon:"cog",islock:!1,hidden:!1,name:"layout",path:"/",sort:1e3,title:"GlobalVillage",type:10,children:[{id:u(),component:"/home",icon:"cog",islock:!1,hidden:!1,name:"home",path:"/home",sort:1e3,caption:"Home",title:"message.header.index",type:10,children:[{id:u(),component:"",icon:"eye",islock:!1,hidden:!1,name:"left-panel",path:"",sort:100101,title:"查看左侧面板",type:20}]},{id:u(),component:"/create",icon:"cog",islock:!1,hidden:!1,name:"create",path:"/create",sort:1e3,caption:"Create",title:"message.header.create",type:10,redirect:"/create/tbd",children:[{id:u(),component:"/create/tbd",icon:"holiday_village",islock:!1,hidden:!1,name:"tbd",path:"/create/tbd",sort:1e3,caption:"ComingSoon",title:"message.sideBar.create.tbd",type:10}]},{id:u(),component:"/happiness",icon:"cog",islock:!1,hidden:!1,name:"happiness",path:"/happiness",sort:1e3,caption:"Happiness",title:"message.header.happiness",type:10,redirect:"/happiness/hsa",children:[{id:u(),component:"/happiness/hsa",icon:"sentiment_very_satisfied",islock:!1,hidden:!1,name:"hsa",path:"/happiness/hsa",href:"https://www.happinessstudies.academy",target:"_blank",sort:1e3,caption:"HappinessStudiesAcademy",title:"message.sideBar.happiness.hsa",type:10}]}]}],Mn=[{id:u(),name:"DataSource",label:"数据源",icon:"",children:[{id:u(),name:"机场",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/机场.json",renderingType:"billboard",lazy:!0,props:{billboard:{image:"./images/飞机场.svg",color:"#ffc10",scale:.25,verticalOrigin:1,scaleByDistance:[100,2,15e4,.5],distanceDisplayCondition:[0,3e7]}},selectedProps:{billboard:{color:"red",scale:1}}},{id:u(),name:"摄像头",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/视频点.json",renderingType:"billboard",lazy:!0,props:{billboard:{image:"./images/video.svg",color:"#ffc10",scale:.25,verticalOrigin:1,scaleByDistance:[100,2,15e4,.5],distanceDisplayCondition:[0,3e7]}},selectedProps:{billboard:{color:"red",scale:1}},children:[{type:"Feature",geometry:{type:"MultiPoint",coordinates:[[108.253394,29.730675]]},properties:{name:"摄像头点位1",pyname:"hstxgjjc",kind:"8100",id:u(),checked:!0}}]},{id:u(),name:"水系",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/水系.json",renderingType:"polyline",lazy:!0,props:{polyline:{width:1}},selectedProps:{polyline:{width:2,material:"#ffc107"}}},{id:u(),name:"岛屿",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/岛屿.json",renderingType:"polygon,polyline,billboard",lazy:!0,props:{billboard:{image:"./images/岛屿.svg",scale:.2,verticalOrigin:1,scaleByDistance:[100,2,15e4,.5],distanceDisplayCondition:[0,3e6]},polygon:{material:"rgba(137,207,240,0.5)"},polyline:{width:4,material:"#0033ff"}},selectedProps:{billboard:{scale:.5},polygon:{material:"#ffc107"},polyline:{width:8,material:"red"}}},{id:u(),name:"模型",icon:"",checked:!1,expanded:!1,renderingType:"model",children:[{id:u(),name:"Tileset 模型",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/Tileset模型.json",lazy:!0,renderingType:"tileset",props:{tileset:{}}},{id:u(),name:"GLTF 模型",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/GLTF模型.json",lazy:!0,renderingType:"model",props:{model:{scale:1}},selectedProps:{model:{color:"red"}}},{id:u(),name:"模型嵌套",icon:"",checked:!1,expanded:!1,renderingType:"model",children:[{id:u(),name:"GLTF 模型",icon:"",checked:!1,expanded:!1,lazy:!0,fetchStr:"/datas/work-bench/GLTF模型.json",renderingType:"model",props:{model:{scale:1}}},{type:"Feature",properties:{id:u(),name:"飞机",hpr:"[135, 0, 0]",renderingType:"model",checked:!0,props:{model:{uri:"../datas/gltf/Cesium_Air.glb"}},selectedProps:{model:{color:"red"}}},geometry:{coordinates:[121.25202608700887,32.14045397527647],type:"Point"}}]}]},{id:u(),name:"图层",icon:"",checked:!1,expanded:!1,renderingType:"imagery",children:[{id:u(),name:"图层嵌套",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/图层.json",lazy:!0,renderingType:"imagery",props:{imagery:{}}},{type:"Feature",properties:{id:u(),checked:!1,name:"WMS",props:{imagery:{alpha:1,brightness:1,contrast:1,sortOrder:60,children:[{cmpName:"VcImageryProviderWms",props:{url:"https://nationalmap.gov.au/proxy/http://geoserver.nationalmap.nicta.com.au/geotopo_250k/ows",layers:"Hydrography:bores",parameters:{format:"image/png",transparent:!0},rectangle:[112,-43,154,-10]}}]}}},geometry:{coordinates:[108.965836,34.225607],type:"Point"}}]},{id:u(),name:"GeoJSON",icon:"",checked:!1,expanded:!1,renderingType:"geojson",children:[{type:"Feature",properties:{id:u(),checked:!1,name:"水系",props:{geojson:{strokeWidth:5,stroke:"#ffc107",fill:"transparent",show:!1,data:"./datas/work-bench/水系.json"}}},geometry:{coordinates:[108.965836,34.225607],type:"Point"}}]}]}],Dn={service:xn,request:Pn,serviceForMock:Rn,requestForMock:On,mock:Ln,tools:Cn},In=(({service:e,request:t,serviceForMock:n,requestForMock:o,mock:r,tools:i})=>({login:e=>(r.onAny("/auth/login").reply((e=>{const t=i.parse(e.data),n=Mt.find(En,{username:t.username,password:t.password});return n?i.responseSuccess(Mt.assign({},n,{token:"f5befe1a-962c-4cdd-bf45-77ce306dbbce"})):i.responseError({},"Wrong Account or Password!")})),o({url:"/auth/login",method:"post",data:e})),getUserInfo:()=>(r.onAny("/user/info").reply((e=>{const t=Vt("uuid"),n=Mt.find(En,{id:t});return n?i.responseSuccess(Mt.assign({},n)):(jt("token"),jt("uuid"),jn.push("/login"),i.responseError({},"Please Login!"))})),o({url:"/user/info",method:"post"})),getAccessibleMenus:(e={})=>(r.onAny("/api/menu/accessible").reply((e=>i.responseSuccess(_n))),o({url:"/api/menu/accessible",method:"post",data:e}))}))(Dn),An=(({service:e,request:t,serviceForMock:n,requestForMock:o,mock:r,tools:i})=>({getStaticData:(e,n)=>t({baseURL:n=n||"./",url:e,method:"get"}).then((e=>({code:0,data:e,msg:"success"}))),inverseGeocode:e=>t({baseURL:"./",url:"/reverse_geocoding/v3",method:"get",params:e}),getLocationList:e=>t({baseURL:"./",url:"/v3/place/text",method:"get",params:e})}))(Dn),Nn=(({service:e,request:t,serviceForMock:n,requestForMock:o,mock:r,tools:i})=>({getTreeData:()=>(r.onAny("/dynamic-render/recursive-list/datatree").reply((e=>i.responseSuccess(Mn))),o({url:"/dynamic-render/recursive-list/datatree",method:"post"})),inverseGeocode:e=>t({baseURL:"./",url:"/reverse_geocoding/v3",method:"get",params:e})}))(Dn),Bn={"zh-CN":{message:{header:{index:"家园",dynamicRender:"创造",happiness:"幸福",create:"创造"},sideBar:{dynamicRender:{recursiveList:"递归列表",stack:"堆叠展示",historicalTrack:"历史轨迹"},expansion:{typhoon:"台风"},other:{tsx:"TSX",issue:"问题反馈"}},panel:{layerManager:"图层管理",videoPlayer:"视频播放"},baseLayer:"底图图层",overlayLayer:"叠加图层",terrainLayer:"地形图层"}},"en-US":{message:{header:{index:"Home",dynamicRender:"Create",happiness:"Happiness",create:"Create"},sideBar:{dynamicRender:{recursiveList:"RecursiveList",stack:"StackView",historicalTrack:"HistoricalTrack"},happiness:{hsa:"HappinessStudiesAcademy"},create:{tbd:"ComingSoon"},other:{tsx:"TSX",issue:"BugReport"}},panel:{layerManager:"LayerManager",videoPlayer:"VideoPlayer"},baseLayer:"BaseLayer",overlayLayer:"OverlayLayer",terrainLayer:"TerrainLayer"}}},Vn=p({legacy:!1,locale:Vt("locale")||"en-US",fallbackLocale:"en-US",globalInjection:!0,messages:Bn}),jn=m({scrollBehavior:()=>({left:0,top:0}),routes:Ht,history:({}.SERVER?h:v)("/")}),Un=["/login","/404"];jn.beforeEach((async(e,t,n)=>{f.start(),hi.system.useSearchStore(fi).set(!1);const o=Vt("token");if("/login"!==e.path&&In.getUserInfo(),o)try{if(!hi.system.usePermissionStore(fi).inited){const t=[...(await In.getAccessibleMenus()).data];return await hi.system.usePermissionStore(fi).generateRoutes({menuTree:t}),void n(e.path)}"/login"===e.path?n({path:"/home"}):n()}catch(r){-1!==Un.indexOf(e.path)?n():n("/login")}else-1!==Un.indexOf(e.path)?n():n("/login")})),jn.afterEach((e=>{var t;f.done(),t=Vn.global.t(e.meta.title),window.document.title="Global Village"+(t?` | ${t}`:"")}));const Fn=It(new Dt("VueCesiumDemo-0.0.1"));function zn({dbName:e="database",path:t="",user:n=!0,validator:o=e=>!0,defaultValue:r=""}){const i=Vt("uuid")||"ghost-uuid",a=`${e}.${n?`user.${i}`:"public"}${t?`.${t}`:""}`,s=Fn.get(a).value();return void 0!==s&&o(s)||Fn.set(a,r).write(),a}function qn({dbName:e="database",path:t="",user:n=!1,validator:o=()=>!0,defaultValue:r=""}={}){return Fn.get(zn({dbName:e,path:t,user:n,validator:o,defaultValue:r}))}Fn.defaults({sys:{},database:{}}).write();const Gn=Rt("db",{state:()=>({}),getters:{},actions:{set({dbName:e="database",path:t="",value:n="",user:o=!1}){!function({dbName:e="database",path:t="",value:n="",user:o=!1}){Fn.set(zn({dbName:e,path:t,user:o}),n).write()}({dbName:e,path:t,value:n,user:o})},get:({dbName:e="database",path:t="",defaultValue:n="",user:o=!1})=>function({dbName:e="database",path:t="",defaultValue:n="",user:o=!1}){return Mt.cloneDeep(Fn.get(zn({dbName:e,path:t,user:o,defaultValue:n})).value())}({dbName:e,path:t,defaultValue:n,user:o}),database:({user:e=!1}={})=>qn({user:e,defaultValue:""}),databaseClear:({user:e=!1}={})=>qn({user:e,validator:()=>!0,defaultValue:""})}}),Wn=Rt("user",{state:()=>({info:{}}),getters:{},actions:{async set(e){this.info=e;Gn().set({dbName:"sys",path:"user.info",value:e,user:!0})},async load(){const e=Gn().get({dbName:"sys",path:"user.info",defaultValue:"",user:!0});this.set(e)}}}),Hn=y({name:"VcDemoPageExpansion",__name:"Index",setup:e=>(e,t)=>{const n=g("router-view");return b(),k(n)}}),$n=Object.freeze(Object.defineProperty({__proto__:null,default:Hn},Symbol.toStringTag,{value:"Module"})),Jn=(e,t)=>{const n=e.__vccOpts||e;for(const[o,r]of t)n[o]=r;return n};const Kn=Jn({},[["render",function(e,t){return b(),w("div")}]]),Yn=Object.freeze(Object.defineProperty({__proto__:null,default:Kn},Symbol.toStringTag,{value:"Module"})),Qn=y({name:"VcDemoPageDynamicRender",__name:"Index",setup:e=>(e,t)=>{const n=g("router-view");return b(),k(n)}}),Xn=Object.freeze(Object.defineProperty({__proto__:null,default:Qn},Symbol.toStringTag,{value:"Module"})),Zn={class:"page-demo-dynamic-overlay absolute z-fab"},eo=y({__name:"Index",setup(e){const{loadDefaultLayers:t}=hi.viewer.useLayerStore(),n=C(null),r=C(!1),i=C(null),a=C(null),s=C(null);S((()=>{t(!0),An.getStaticData("/datas/dynamic-overlay.json").then((e=>{c([e.data])}))})),T((()=>{var e;e="/dynamic-render/historical-track",hi.viewer.useRenderStore(fi).removeRenderDataByPage(e)}));const c=async e=>{if(await sn("DynamicOverlay"));else{const t={id:"DynamicOverlay",name:"历史轨迹",page:"/dynamic-render/historical-track",datasets:[]},{overlays:o,stops:c}=d(e),u={show:!0,dynamicOverlays:o};t.datasets.push({cmpName:"VcOverlayDynamic",props:{shouldAnimate:r,"onUpdate:shouldAnimate":e=>{r.value=e},currentTime:i,startTime:a,stopTime:s,multiplier:1e3,onReady:e=>{n.value=e.vm,l(202106)},...u}}),t.datasets.push({cmpName:"VcCollectionPoint",props:{points:c}}),rn(t)}},d=e=>{const t=[],n=[];return e.forEach((e=>{const r=[],i=[],a=o(e,"checked");e.stops.forEach((e=>{r.push({position:[e.lon,e.lat],time:e.DATE_TIME,id:u()}),i.push([e.lon,e.lat]),n.push({id:u(),position:[e.lon,e.lat],color:"rgb(255,229,0)",show:a,...e,distanceDisplayCondition:[0,5e6],scaleByDistance:[100,2,25e5,.5],onMouseover:e=>{},onMouseout:e=>{}})})),t.push({id:String(e.TYPHOON_ID),show:a,maxCacheSize:e.stops.length,polyline:{positions:i,width:3,material:e.TYPHOON_CODE?"#2d8cf0":"#69B273",depthFailMaterial:e.TYPHOON_CODE?"#2d8cf0":"#69B273",clampToGround:!0},sampledPositions:r})})),{overlays:t,stops:n}},l=e=>{const t=sn("DynamicOverlay");if(t){t.datasets[0].cmpRef.zoomToOverlay(String(e))}else Kt("定位到该对象失败，原因：还未添加。")};return(e,t)=>(b(),w("div",Zn))}}),to=Object.freeze(Object.defineProperty({__proto__:null,default:eo},Symbol.toStringTag,{value:"Module"}));function no(){const e=x(),t=Xe(),{toggleGlobalLayout:n,toggleDynamicRenderPageLayout:o}=hi.system.useLayoutStore(),r=P({selectedId:"",datasourceCategories:[],loading:!1,hasLoadingError:!1,filterText:"",selectedKey:""}),i=hi.system.useLayoutStore().dynamicRender,a=R((()=>{let e=[];try{null==r||r.datasourceCategories.forEach((t=>{if(t.id===r.selectedId)throw e=t.children,new Error("endForEach")}))}catch(t){if("endForEach"!==t.message)throw t}return e}));t.vm.vcMitt.on("pickEvt",(e=>{r.selectedKey=e}));const s=()=>{r.datasourceCategories.forEach((e=>{var t;null==(t=null==e?void 0:e.children)||t.forEach((e=>{const t=e;(null==t?void 0:t.children)&&c(!0,t)}))}))},c=(t,n,o,r)=>{var i;const a={onReady:e=>{}};if(d(n,"type")&&d(n,"properties")){const r=n;!0===t&&(Cesium.defined(r.properties.datasetId)||an(null==o?void 0:o.id),O((()=>{if(sn(r.properties.datasetId));else{if(!o)return void Kt("添加渲染数据集失败，原因：要素节点不能作为顶节点，请将其放到数据集节点下。","数据模型：",n);if(null==o?void 0:o.renderingType){const t=()=>An.getStaticData(o.fetchStr);o.loading=!0,hn(o,t,e.path,"recursive-list",a).finally((()=>{o.loading=!1}))}else""!==o.renderingType&&Kt("添加渲染数据集失败，原因：未知的显示类型。","数据模型：",o)}})))}else{const o=n;if(!0===t){if(sn(o.id));else if(o.renderingType){const t=()=>An.getStaticData(o.fetchStr);o.loading=!0,hn(o,t,e.path,"recursive-list",a).finally((()=>{o.loading=!1}))}else""!==o.renderingType&&Kt("添加渲染数据集失败，原因：未知的显示类型。","数据模型：",o)}else an(o.id),null==(i=null==o?void 0:o.children)||i.forEach((e=>{c(t,e,o)}))}};return{workBenchModel:r,dynamicRenderLayout:i,selectedDatasetCategories:a,init:()=>{r.loading=!0,(async()=>(r.hasLoadingError=!1,Nn.getTreeData().then((e=>{if(e.code)return;const t=e.data;return r.selectedId=t[0].id,r.datasourceCategories=t,s(),!0})).catch((e=>{r.hasLoadingError=!0}))))().then((()=>{r.loading=!1,n({navigation:!0}),o({datasource:{workBench:!0}})}))},showFeatureInfo:(e,t)=>{yn(t)},flyToFeature:(e,n,o)=>{t.vm.vcMitt.emit("pickEvt",n.properties.id),async function(e,t,n={isHighlightRenderData:!0,showBillboardOverlayMenu:!0,duration:1.5}){var o,r,i,a,s;const c=(null==(o=null==t?void 0:t.properties)?void 0:o.actualRenderingType)||(null==(r=null==t?void 0:t.properties)?void 0:r.renderingType);if(!c)return void Kt("定位到要素失败，原因：未知的显示类型。","要素模型：",t);const d=t.properties.datasetId,l=await sn(d);if(!l)return void Kt("定位到要素失败，原因：未找到该要素所在的渲染数据。","要素模型：",t);const u=t.properties.id;if(n.isHighlightRenderData&&ln(c,d,t),t.properties.vcCamera)return void Qe(e,t.properties.vcCamera);const{toggleGlobalLayout:p}=hi.system.useLayoutStore(fi);switch(c){case"billboard":case"point":case"label":case"polyline":case"polygon":case"model":if(p({featureInfo:!1}),null==(i=null==l?void 0:l.datasets)?void 0:i.length){const t=(null==(a=l.datasets[0].cmpRef)?void 0:a.cesiumObject).entities.values.find((e=>e.feature.properties.id===u));e.flyTo(t,{...n}).then((()=>{}))}break;default:if(p({featureInfo:!1}),null==(s=null==l?void 0:l.datasets)?void 0:s.length){const o=l.datasets.find((e=>e.feature.properties.id===t.properties.id)).cmpRef.cesiumObject;e.flyTo(o,{...n}).then((()=>{}))}}}(t.viewer,n)},onLazyLoad:e=>{const t=e.dataset;if(e.key.indexOf("Lazy load empty")>-1)return void e.done([]);t.loading=!0,fn(t,(()=>An.getStaticData(t.fetchStr))).then((async n=>{var o;n?e.done(n):e.fail();if(!(await sn(t.id))){const e=null==(o=t.children)?void 0:o.filter((e=>e.properties.checked));e&&e.length>0&&c(!0,t)}t.loading=!1}))},addOrRemoveDataset:c,toggleDynamicRenderPageLayout:o}}const oo={class:"loading-ios flex column justify-center items-center z-top"},ro={key:2},ao={key:0,class:"q-pt-md"},so=y({__name:"Ios",props:{size:{type:String,default:"3em"},dense:{type:Boolean,default:!1},hasError:{type:Boolean,default:!1},errorMsg:{type:String,default:""},errorTip:{type:String,default:"数据加载失败，点我重试"},tipText:{type:String,default:"加载中..."}},emits:["retry"],setup(e,{emit:t}){const n=t,o=()=>{n("retry")};return(t,n)=>(b(),w("div",oo,[e.hasError?(b(),k(le,{key:1,icon:"error",size:e.size,color:"red",round:"",flat:"",dense:""},{default:L((()=>[E(de,null,{default:L((()=>[_("加载失败，原因："+M(e.errorMsg),1)])),_:1})])),_:1},8,["size"])):(b(),k(ce,{key:0,size:e.size},null,8,["size"])),e.dense?I("",!0):(b(),w("div",ro,[e.hasError?(b(),k(ue,{key:1,clickable:"",color:"red","text-color":"white",icon:"error",onClick:o},{default:L((()=>[_(M(e.errorTip),1)])),_:1})):(b(),w("div",ao,[D("span",null,M(e.tipText),1)]))]))]))}}),co=y({name:"VcDataTreeGeojson",props:{dense:Boolean,nodes:{type:Array,default:()=>[]},filter:String,tickStrategy:{type:String,default:"leaf-filtered"},selectedColor:String,selected:String},emits:{checked:(e,t,n,o)=>!0,"lazy-load":e=>!0,"update:selected":(e,t,n)=>!0,zoomIconClicked:(e,t,n)=>!0},setup(e,t){const n=C({});let o={};A((()=>{o={}}));const r=R((()=>void 0!==e.selected)),i=R((()=>(e,t)=>{const n=t.toLowerCase();return(e.name||e.properties.name).toLowerCase().indexOf(n)>-1})),a=R((()=>{const t={},o=(a,s,c)=>{const l=c?c.tickStrategy:e.tickStrategy;let u,p,m,f,h,v,y,g,b,k,w;if(d(a,"type")&&d(a,"properties")){const e=a;u=e.properties.id,p=!1,m=!1,f=e.properties.name,h=c?c.level+1:1,y=e.properties.checked,v=!1,g=e.properties.disabled,b=e.properties.noTick,k=void 0,w=!0!==e.properties.disabled&&!1!==e.properties.tickable}else{const e=a;u=e.id,p=(null==e?void 0:e.children)&&(null==e?void 0:e.children.length)>0,m=e.lazy,f=e.name,!0===m&&void 0!==n.value[u]&&!0===Array.isArray(e.children)&&(m=n.value[u]),h=c?c.level+1:1,y=e.checked,v=e.expanded,g=e.disabled,b=e.noTick,k=e.indeterminate,w=!0!==e.disabled&&!1!==e.tickable||!e.children}const C=!0!==p,S=!0!==g&&!0===r.value,T="none"!==l,x="strict"===l,P="leaf-filtered"===l,R="leaf"===l||"leaf-filtered"===l;!0===R&&!0===w&&c&&!0!==c.tickable&&(w=!1);const O={index:s,name:f,key:u,parent:c,isParent:p,isLeaf:C,lazy:m,disabled:g,level:h,children:[],matchesFilter:!e.filter||i.value(a,e.filter),selected:u===e.selected&&!0===S,selectable:S,expanded:v,expandable:!0,noTick:!0===b||!0!==x&&m&&"loaded"!==m,tickable:w,tickStrategy:l,hasTicking:T,strictTicking:x,leafFilteredTicking:P,leafTicking:R,indeterminate:k,indeterminateNextState:void 0,ticked:y};if(t[u]=O,!0===p){const t=a;if(O.children=t.children.map(((e,t)=>o(e,t,O))),e.filter&&(!0!==O.matchesFilter?O.matchesFilter=O.children.some((e=>e.matchesFilter)):!0!==O.noTick&&!0!==O.disabled&&!0===O.tickable&&!0===P&&!0===O.children.every((e=>!0!==e.matchesFilter||!0===e.noTick||!0!==e.tickable))&&(O.tickable=!1)),!0===O.matchesFilter&&(!0!==O.noTick&&!0!==x&&!0===O.children.every((e=>e.noTick))&&(O.noTick=!0),R)){if(O.ticked=!1,O.indeterminate=O.children.some((e=>{if(d(e,"type")&&d(e,"properties")){return!0===e.properties.indeterminate}return!0===e.indeterminate})),O.tickable=!0===O.tickable&&O.children.some((e=>e.tickable)),!0!==O.indeterminate){const e=O.children.reduce(((e,t)=>!0===t.ticked?e+1:e),0);e===O.children.length?O.ticked=!0:e>0&&(O.indeterminate=!0)}!0===O.indeterminate&&(O.indeterminateNextState=O.children.every((e=>(!0!==e.tickable||!0!==e.ticked)&&!1!==e.indeterminateNextState)))}}return O};return e.nodes.forEach(((e,t)=>o(e,t,null))),t})),s=(e,o,r,i=a.value[e])=>{if(i.lazy&&"loaded"!==i.lazy){if("loading"===i.lazy)return;n.value[e]="loading",!0!==Array.isArray(r.children)&&(r.children=[]),t.emit("lazy-load",{dataset:r,key:e,done:t=>{n.value[e]="loaded",r.children=!0===Array.isArray(t)?[...null==r?void 0:r.children,...t]:[...null==r?void 0:r.children],O((()=>{const t=a.value[e];t&&t.isParent}))},fail:()=>{delete n.value[e],0===r.children.length&&delete r.children}})}else!0===i.isParent&&i.expandable},c=(n,o,r,a)=>{if(!0===r.indeterminate&&(n=r.indeterminateNextState),r.strictTicking);else if(r.leafTicking){void 0===n&&(n=!1);const t=(o,r)=>{var a;if(d(o,"type")&&"Feature"===o.type){const t=o;if(e.filter){i.value(o,e.filter)&&(t.properties.checked=n)}else t.properties.checked=n}else{const e=o;e.checked=n,e.indeterminate=void 0,null==(a=null==e?void 0:e.children)||a.forEach((e=>t(e)))}};t(o)}t.emit("checked",n,o,a,r.index)};function l(e){const t=o[e];t&&t.focus()}const u=(n,o)=>{if(d(n,"type")&&"Feature"===n.type){const e=n,i=e.properties.id,s=a.value[i],d=[];for(let t=0;t<s.level-1;t++)d.push(N(me,{side:!0}));return d.push(N(me,{side:!0},(()=>N(fe,{modelValue:s.ticked,dense:!0,disable:!0!==s.tickable,"onUpdate:modelValue":t=>c(t,e,s,o)})))),d.push(N(me,{side:!0},(()=>N(he,{size:"16px",name:e.properties.icon||"circle",style:"color: #00e472"})))),d.push(N(me,{},(()=>N(ve,{},(()=>e.properties.name))))),"loading"!==s.lazy&&!0!==e.properties.loading||d.push(N(me,{side:!0},(()=>N(so,{size:"1.5em",dense:!0})))),e.properties.checked&&d.push(N(me,{side:!0},(()=>N(he,{size:"20px",name:"room",onClick:n=>{((e,n,o,r)=>{!0!==r&&l(n.key),t.emit("zoomIconClicked",n.key,e,n.index),o.stopPropagation()})(e,s,n)}})))),B(N(ge,{clickable:!0,activeClass:"text-amber-6",dark:!0,active:s.selected,onClick:n=>{((e,n,o,i)=>{!0!==i&&l(n.key),r.value&&n.selectable&&t.emit("update:selected",n.key,e,n.index),"function"==typeof e.properties.handler&&e.properties.handler(e)})(e,s)}},(()=>d)),[[ye]])}{const t=n,r=t.id,i=a.value[r],d=!0===i.isParent?p(t.children,t):[];if(d.length>0||i.lazy&&"loaded"!==i.lazy){const n=[];for(let e=0;e<i.level-1;e++)n.push(N(me,{side:!0}));n.push(N(me,{side:!0},(()=>N(fe,{modelValue:!0===i.indeterminate?null:i.ticked,disable:!0!==i.tickable||!(null==t?void 0:t.children),dense:!0,"onUpdate:modelValue":e=>c(e,t,i,o)})))),n.push(N(me,{side:!0},(()=>N(he,{size:"16px",name:"home",style:"color: #00e472"})))),n.push(N(me,{},(()=>N(ve,{},(()=>t.name)))));const r=(e=>{let t=0;const n=e=>{e.forEach((e=>{e.children?n(null==e?void 0:e.children):t++}))};return n((null==e?void 0:e.children)||[]),t})(t);return 0!==r&&n.push(N(me,{side:!0},(()=>N(ue,{dense:!0,dark:!0},(()=>`${r}条`))))),"loading"!==i.lazy&&!0!==t.loading||n.push(N(me,{side:!0},(()=>N(so,{size:"1.5em",dense:!0})))),N(be,{modelValue:i.expanded,expandIcon:"arrow_circle_down",expandSeparator:!0,clickable:!0,dark:!0,dense:e.dense,"onUpdate:modelValue":e=>((e,t,n)=>{t.expanded=e,s(n.key,!n.expanded,t,n)})(e,t,i)},{header:()=>n,default:()=>d})}}},p=(t,n)=>{const o=(e.filter?t.filter((e=>a.value[e.id||e.properties.id].matchesFilter)):t).map((e=>u(e,n)));return o.length?[N(pe,{dense:e.dense},(()=>o))]:[]};return()=>{const t=p(e.nodes);return N("div",{class:"vc-data-tree "+(0===t.length?"text-center":"")},0===t.length?e.filter?"找不到匹配的数据":"没有可用数据":t)}}});function lo(){const e=C(null),t=C(null);return{scrollAreaRef:e,verticalPositionRef:t,contentStyle:{backgroundColor:"rgba(0,0,0,0.02)",color:"#555"},contentActiveStyle:{backgroundColor:"rgba(0,0,0,0.02)",color:"#555"},thumbStyle:{right:"2px",borderRadius:"3px",backgroundColor:"#EBB107",width:"3px",opacity:.6},onScrollHandler:e=>{t.value=e.verticalPosition},setScrollPosition:(t,n,o)=>{e.value.setScrollPosition("vertical",0,300)}}}const uo={class:"work-bench"},po={class:"dataset-category"},mo={class:"dataset-category-header"},fo={class:"q-ml-md q-mr-md"},ho=Jn(y({__name:"Index",setup(e){V((e=>({ecf08828:g.value.commonPanel.themeCommonPanelListBorderColor,"144028e9":g.value.commonPanel.themeCommonPanelContentBackgroundColor})));const t=Ot(hi.system.useLayoutStore()).global,{contentStyle:n,contentActiveStyle:o,thumbStyle:r,scrollAreaRef:i,verticalPositionRef:a,setScrollPosition:s,onScrollHandler:c}=lo(),{workBenchModel:d,dynamicRenderLayout:l,selectedDatasetCategories:u,init:p,showFeatureInfo:m,flyToFeature:f,addOrRemoveDataset:h,onLazyLoad:v,toggleDynamicRenderPageLayout:y}=no(),g=R((()=>{const e=hi.system.useThemeStore();return e.themeConfig[e.activeName]}));return S((()=>{p()})),T((()=>{d.datasourceCategories.forEach((e=>{e.children.forEach((e=>{var t;h(!1,e),e.checked=!1,e.expanded=!1,(null==(t=null==e?void 0:e.children)?void 0:t.length)&&(e.children.length=0)}))}))})),(e,r)=>(b(),w("div",uo,[B(D("div",{class:F(["datasources-container animate__animated animate__fadeInLeft",{"full-width-drawer":!U(t).leftDrawerMini}])},[D("div",po,[D("div",mo,[E(le,{dense:"",flat:"",round:"",class:"close text-white",icon:"close",size:"sm",onClick:r[0]||(r[0]=e=>U(y)({datasource:{workBench:!1}}))}),D("div",fo,[E(ke,{modelValue:U(d).filterText,"onUpdate:modelValue":r[1]||(r[1]=e=>U(d).filterText=e),disable:U(d).loading,label:"搜索",dark:"",dense:"",clearable:""},{prepend:L((()=>[E(he,{color:"white",name:"search"})])),_:1},8,["modelValue","disable"])])]),U(a)>600?(b(),k(le,{key:0,dense:"",fab:"",round:"",glossy:"","fab-mini":"",ripple:"",icon:"expand_less",padding:"2px",class:"absolute-bottom-right non-selectable z-top scroll-top",onClick:r[2]||(r[2]=e=>U(s)("vertical",0,300))},{default:L((()=>[E(de,null,{default:L((()=>[_("回到顶部")])),_:1})])),_:1})):I("",!0),E(we,{ref_key:"scrollAreaRef",ref:i,class:"dataset-category-area","content-style":U(n),"content-active-style":U(o),onScroll:U(c)},{default:L((()=>[U(d).loading?(b(),k(so,{key:0,class:"absolute-center","has-error":U(d).hasLoadingError},null,8,["has-error"])):I("",!0),E(U(co),{selected:U(d).selectedKey,"onUpdate:selected":[r[3]||(r[3]=e=>U(d).selectedKey=e),U(m)],nodes:U(u),filter:U(d).filterText,onZoomIconClicked:U(f),onLazyLoad:U(v),onChecked:U(h)},null,8,["selected","nodes","filter","onUpdate:selected","onZoomIconClicked","onLazyLoad","onChecked"])])),_:1},8,["content-style","content-active-style","onScroll"])])],2),[[j,U(l).datasource.workBench]]),U(l).datasource.workBench?I("",!0):(b(),k(le,{key:0,class:"toggle-btn",round:"",loading:U(d).loading,flat:"",color:"white",onClick:r[4]||(r[4]=e=>U(y)({datasource:{workBench:!0}}))},{default:L((()=>[E(he,{size:"50px",name:"keyboard_double_arrow_right"})])),_:1},8,["loading"]))]))}}),[["__scopeId","data-v-f2c7614f"]]),vo=Object.freeze(Object.defineProperty({__proto__:null,default:ho},Symbol.toStringTag,{value:"Module"})),yo={class:"page-dynamic-render-recursive-list absolute z-fab"},go=y({name:"VcDemoDynamicRenderRecursiveList",__name:"Index",setup(e){const{loadDefaultLayers:t}=hi.viewer.useLayerStore();return S((()=>{t(!0)})),(e,t)=>(b(),w("div",yo,[E(ho)]))}}),bo=Object.freeze(Object.defineProperty({__proto__:null,default:go},Symbol.toStringTag,{value:"Module"}));const ko={class:"page-dynamic-render-stack"},wo={key:0,class:"stack-buttons-wrapper"},Co={class:"stack-buttons-container"},So=["onClick"],To={style:{"margin-top":"5px"}},xo=Jn(y({name:"VcDemoDynamicRenderStack",__name:"Index",setup(e){const t=x(),{loadDefaultLayers:n}=hi.viewer.useLayerStore(),{stackDatas:o}={stackDatas:P([{id:u(),label:"农用地",checked:!1,data:"/datas/work-bench/TDLY农用地.json",renderingType:"polygon",entityProps:{polygon:{material:"rgba(127,194,105,0.8)"}},entitySelectedProps:{polygon:{material:"rgba(137,207,240,0.8)"}}},{id:u(),label:"住宅用地",checked:!1,data:"/datas/work-bench/TDLY住宅用地.json",renderingType:"polygon",entityProps:{polygon:{material:"rgba(238,241,160,0.8)"}},entitySelectedProps:{polygon:{material:"rgba(137,207,240,0.8)"}}},{id:u(),label:"集体建设用地",checked:!1,data:"/datas/work-bench/TDLY集体建设.json",renderingType:"polygon",entityProps:{polygon:{material:"rgba(227,108,9,0.8)"}},entitySelectedProps:{polygon:{material:"rgba(137,207,240,0.8)"}}},{id:u(),label:"工业用地",checked:!1,data:"/datas/work-bench/TDLY工业用地.json",renderingType:"polygon",entityProps:{polygon:{material:"rgba(216,216,216,0.8)"}},entitySelectedProps:{polygon:{material:"rgba(137,207,240,0.8)"}}}])},r=Xe(),i=C(!1);C([]),T((()=>{an(t.path)})),S((()=>{n(!0),Qe(r.viewer,{position:{x:-2324661.042454219,y:5396877.953175202,z:2474170.1591741517},heading:6.283185307179586,pitch:-.5001412827126326,roll:6.283185307179586},{duration:1,complete:()=>{i.value=!0}})}));return(e,n)=>(b(),w("div",ko,[i.value?(b(),w("div",wo,[D("div",Co,[(b(!0),w(z,null,q(U(o),((e,n)=>(b(),w("div",{key:n,class:F(["stack-button",{active:e.checked}]),onClick:n=>{return(o=e).checked?an(o.id):mn(o.data,o.renderingType,o.entityProps,o.entitySelectedProps,o.id,t.path),void(o.checked=!o.checked);var o}},[D("div",To,M(e.label),1)],10,So)))),128))])])):I("",!0)]))}}),[["__scopeId","data-v-89f0c1d2"]]),Po=Object.freeze(Object.defineProperty({__proto__:null,default:xo},Symbol.toStringTag,{value:"Module"})),Ro=y({name:"VcDemoPageExpansion",__name:"Index",setup:e=>(e,t)=>{const n=g("router-view");return b(),k(n)}}),Oo=Object.freeze(Object.defineProperty({__proto__:null,default:Ro},Symbol.toStringTag,{value:"Module"})),Lo=y({name:"VcTyphoon",props:{typhoonDatas:Array,clampToGround:{type:Boolean,default:!1},interval:{type:Number,default:100},radius7Color:{type:String,default:"#00bab2"},radius10Color:{type:String,default:"#ffff00"},radius12Color:{type:String,default:"#da7341"}},emits:{mouseover:e=>!0,mouseout:e=>!0,click:e=>!0,clickout:e=>!0},setup(e,t){const n=G(),o=C(null);Ze();const r=Xe(),i=P([]),a=e=>{let t="";switch(e){case"STS":t="#0F8000";break;case"TY":t="#FE9C45";break;case"STY":t="#FE00FE";break;case"Super TY":t="#FE0000";break;case"TD":t="#EED139";break;case"TS":t="#0000FF";break;default:t="#409eff"}return t},s=(e,n)=>{n.playIndex=e;const o=n.typhoonData.points[e];o.type="live",o.index=e,o.tfbh=n.name;const r=[o.lng,o.lat];n.positions.push(r),n.points.push({id:o.id||Cesium.createGuid(),position:r,color:a(o.strong),pixelSize:8,outlineColor:"rgba(0,0,0,0.6)",outlineWidth:1,disableDepthTestDistance:Number.POSITIVE_INFINITY,onMouseover(e){t.emit("mouseover",e)},onMouseout(e){t.emit("mouseout",e)},onClick(e){d(o,n),n.playIndex=o.index,t.emit("click",e)},onClickout(e){t.emit("clickout",e)},...o}),e===n.typhoonData.points.length-1&&d(o,n)},c=(t,n)=>{const o=i.findIndex((e=>e.name===t));if(o>=0){let t=0;const r=i[o];r.points.length=0,r.positions.length=0;const a=r.typhoonData;s(t,r),clearInterval(r.playInterval),r.playInterval=setInterval((()=>{t++,t>=a.points.length?clearInterval(r.playInterval):s(t,r)}),n||e.interval)}else Jt("播放台风失败，原因：未找到对应编号的台风数据。")},d=(e,n)=>{n.children.length=0;const o=e.forecast;if(o&&!(o.length<=0))for(let r=0;r<o.length;r++){const i=o[r],s=[],c=[],d={name:n.name+"_"+i.sets,typhoonData:i,show:!0,positions:c,points:s,type:"forc"};n.children.push(d),i.points.forEach(((n,o)=>{const r=[n.lng,n.lat];d.positions.push(r),0===o&&d.positions.push([e.lng,e.lat]),n.sets=i.sets,n.type="forc",n.index=o,d.points.push({id:n.id||Cesium.createGuid(),position:r,color:a(n.strong),pixelSize:8,outlineColor:"rgba(0,0,0,0.6)",outlineWidth:1,disableDepthTestDistance:Number.POSITIVE_INFINITY,onMouseover(e){t.emit("mouseover",e)},onMouseout(e){t.emit("mouseout",e)},onClick(e){t.emit("click",e)},...n})}))}},l=e=>{const t={name:e.tfbh,typhoonData:e,show:!0,positions:[],points:[],children:[],type:"live"};return i.push(t),c(e.tfbh),t},u=(e,t)=>{let n=[];if("number"==typeof t)n=W(e,1e3*t,{units:"meters"}).geometry.coordinates;else if(t.ne){const o=6,r=360/(4*o),i={0:"ne",1:"nw",2:"sw",3:"se"};for(let a=0;a<4;a++){let s=1e3*parseFloat(t[i[a]]);s||(s=0);for(let t=a*r;t<=(a+1)*r;t++){const r=o*t,i=e[0]+s*Math.cos(r*Math.PI/180)/111e3,a=e[1]+s*Math.sin(r*Math.PI/180)/111e3;n.push([i,a])}}}return n},p=n=>{const o=[];return n.forEach((n=>{if(n.positions.length>1&&o.push(N(e.clampToGround?it:at,{show:!0,enableMouseEvent:!0,asynchronous:!1,classificationType:2,appearance:{type:"PolylineMaterialAppearance",options:{material:{fabric:{type:"live"===n.type?"Color":"PolylineDash",uniforms:{color:"rgba(0,0,0,0.5)"}}},translucent:!0}},onMouseover(e){t.emit("mouseover",e)},onMouseout(e){t.emit("mouseout",e)},onClick(e){t.emit("click",e)},onClickout(e){t.emit("clickout",e)}},(()=>N(nt,{id:n.name||Cesium.createGuid()},(()=>N(e.clampToGround?ot:rt,{positions:tt(n.positions),width:2,arcType:Cesium.ArcType.RHUMB,show:!0})))))),o.push(N(st,{points:n.points,onReady:e=>{const{cesiumObject:t}=e,n=t.update;t.update=function(e){const t=e.commandList.length;n.call(this,e);const o=e.commandList.length;for(let n=t;n<o;++n)e.commandList[n].pass=Cesium.Pass.TRANSLUCENT,e.commandList[n].renderState=Cesium.RenderState.fromCache({depthTest:{enabled:!1},depthMask:!1})}}})),"live"===n.type){const t=n.points[n.playIndex];(null==t?void 0:t.radius7)>0&&o.push(N(ct,{positions:u(t.position,t.radius7_quad),clampToGround:e.clampToGround,asynchronous:!1,classificationType:2,appearance:{type:"MaterialAppearance",options:{material:{fabric:{type:"Color",uniforms:{color:e.radius7Color}}},faceForward:!0,renderState:{cull:{enabled:!1},depthTest:{enabled:!1}}}}})),(null==t?void 0:t.radius10)>0&&o.push(N(ct,{positions:u(t.position,t.radius10_quad),clampToGround:e.clampToGround,asynchronous:!1,classificationType:2,appearance:{type:"MaterialAppearance",options:{material:{fabric:{type:"Color",uniforms:{color:e.radius10Color}}},faceForward:!0,renderState:{cull:{enabled:!1},depthTest:{enabled:!1}}}}})),(null==t?void 0:t.radius12)>0&&o.push(N(ct,{positions:u(t.position,t.radius12_quad),clampToGround:e.clampToGround,asynchronous:!1,classificationType:2,appearance:{type:"MaterialAppearance",options:{material:{fabric:{type:"Color",uniforms:{color:e.radius12Color}}},faceForward:!0,renderState:{cull:{enabled:!1},depthTest:{enabled:!1}}}}}))}n.children&&o.push(...p(n.children))})),o};return Object.assign(n.proxy,{addTyphoonData:l,addTyphoonByInterval:c,flyToTyphoonData:(e,t)=>{const n=[];"string"==typeof e?n.push(e):n.push(...e);let o=null;n.forEach((e=>{const t=[],n=i.find((t=>t.name===e));n&&n.typhoonData.points&&n.typhoonData.points.forEach((e=>{t.push([e.lng,e.lat])}));const r=tt(t),a=Cesium.BoundingSphere.fromPoints(r);o=null===o?a:Cesium.BoundingSphere.union(o,a)})),r.viewer.camera.flyToBoundingSphere(o,{...t})},removeTyphoonData:e=>{const t=i.indexOf(e);t>=0&&(clearInterval(e.playInterval),i.splice(t,1))},removeAllTyphoonData:()=>{i.forEach((e=>{clearInterval(e.playInterval)})),i.length=0},getTyphoonDatasources:()=>i}),e.typhoonDatas.forEach((e=>{l(e)})),()=>{const e=p(i);return N(et,{ref:o,show:!0},(()=>e))}}}),Eo={class:"page-dynamic-render-typhoon"},_o=Jn(y({name:"VcDemoPageDynamicRenderTyphoon",__name:"Index",setup(e){const t=C([]),n=C(null),o=[{position:[127,34],polyline:{width:1,positions:[[127,34],[127,22],[119,18],[119,11],[113,4.5],[105,0]],material:"rgba(255, 0, 0, 0.8)"}},{polyline:{width:1,positions:[[105,0],[120,0],[132,15],[132,34]],material:{fabric:{type:"PolylineDash",uniforms:{color:"rgba(255, 165, 0, 0.8)",dashLength:10,dashPattern:5}}}}}];S((()=>{r()}));const r=()=>{t.value.length=0;const e=[An.getStaticData("/datas/typhoon/202209.json"),An.getStaticData("/datas/typhoon/202210.json")];Promise.all(e).then((([e,n])=>{t.value=[...e.data,...n.data]}))};return(e,r)=>{const i=g("vc-datasource-custom");return b(),w("div",Eo,[E(i,{name:"vc_warnLine",entities:o}),t.value.length?(b(),k(U(Lo),{key:0,ref_key:"typhoonRef",ref:n,"typhoon-datas":t.value},null,8,["typhoon-datas"])):I("",!0)])}}}),[["__scopeId","data-v-73ea91e7"]]),Mo=Object.freeze(Object.defineProperty({__proto__:null,default:_o},Symbol.toStringTag,{value:"Module"})),Do=y({name:"VcDemoPageExpansion",__name:"Index",setup:e=>(e,t)=>{const n=g("router-view");return b(),k(n)}}),Io=Object.freeze(Object.defineProperty({__proto__:null,default:Do},Symbol.toStringTag,{value:"Module"}));const Ao=Jn({},[["render",function(e,t){return b(),w("div")}]]),No=Object.freeze(Object.defineProperty({__proto__:null,default:Ao},Symbol.toStringTag,{value:"Module"})),Bo={class:"z-top absolute-center page-index"},Vo=y({name:"VcDemoPageIndex",__name:"Index",setup(e){Xe();const t=C({position:[108,32],point:{pixelSize:28,color:"red"},label:{text:"Hello World",pixelOffset:[0,150]}}),{loadDefaultLayers:n,toggle:o}=hi.viewer.useLayerStore();S((()=>{n(!0)})),T((()=>{o({names:"admin",show:!1})}));const r=e=>{};return(e,n)=>{const o=g("vc-graphics-billboard"),i=g("vc-graphics-rectangle"),a=g("vc-entity");return b(),w("div",Bo,[E(a,{ref_key:"entity",ref:t,position:t.value.position,point:t.value.point,label:t.value.label,onClick:r},{default:L((()=>[E(o,{ref:"billboard",image:"https://zouyaoji.top/vue-cesium/favicon.png",scale:.5},null,512),E(i,{coordinates:[130,20,80,25],material:"green"})])),_:1},8,["position","point","label"])])}}}),jo=Object.freeze(Object.defineProperty({__proto__:null,default:Vo},Symbol.toStringTag,{value:"Module"})),Uo=y({name:"Error404",setup:(e,t)=>({defaultPagePath:"/home"})}),Fo={class:"fullscreen bg-blue text-white text-center q-pa-md flex flex-center"},zo=D("div",{style:{"font-size":"30vh"}},"404",-1),qo=D("div",{class:"text-h2",style:{opacity:"0.4"}},"噢. 这儿什么也没有...",-1);const Go=Jn(Uo,[["render",function(e,t,n,o,r,i){return b(),w("div",Fo,[D("div",null,[zo,qo,E(le,{class:"q-mt-xl",color:"white","text-color":"blue",unelevated:"",to:e.defaultPagePath,label:"返回主页","no-caps":""},null,8,["to"])])])}]]),Wo=Object.freeze(Object.defineProperty({__proto__:null,default:Go},Symbol.toStringTag,{value:"Module"})),Ho=e=>($("data-v-3aaf0e08"),e=e(),J(),e),$o={class:"q-pa-md page-login z-top"},Jo={class:"login-container col row"},Ko=Ho((()=>D("div",{class:"text-h4 q-my-sm"},"Login",-1))),Yo=Ho((()=>D("div",{class:"oath flex"},[D("div",{class:"title full-width text-center q-pt-md"},"Social Network LogIn"),D("div",{class:"q-gutter-md full-width text-center q-pt-sm flex justify-center"},[D("svg",{t:"1615200042776",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5886",width:"200",height:"200"},[D("path",{d:"M579.867 511.932c-11.67 0-23.344 10.837-23.344 24.178 0 10.839 11.668 21.678 23.344 21.678 17.514 0 30.020-10.839 30.020-21.678 0-13.34-12.505-24.178-30.020-24.178v0zM503.154 399.36c18.345 0 30.020-11.67 30.020-29.185 0-18.345-11.675-29.183-30.020-29.183-17.51 0-34.188 10.839-34.188 29.183-0.001 17.517 16.678 29.185 34.188 29.185v0zM512.326 0.56c-282.655 0-511.788 229.133-511.788 511.788 0 282.653 229.133 511.786 511.788 511.786 282.653 0 511.786-229.133 511.786-511.786 0.001-282.655-229.132-511.788-511.786-511.788v0zM415.602 642.009c-30.855 0-53.369-4.999-82.553-13.341l-84.218 42.53 24.186-71.715c-59.204-41.689-94.228-94.221-94.228-158.428 0-113.403 106.733-200.123 236.814-200.123 115.069 0 217.633 68.377 237.644 165.106-8.338-1.671-15.844-2.502-22.514-2.502-113.403 0-200.954 85.049-200.954 187.613 0 17.508 2.502 33.351 6.671 50.030-6.671 0.829-14.178 0.829-20.849 0.829v0zM763.314 723.724l16.674 60.041-63.371-35.854c-24.18 4.999-47.529 12.505-71.709 12.505-111.737 0-200.123-76.711-200.123-171.769 0-95.058 88.388-171.771 200.123-171.771 105.895 0 200.954 76.713 200.954 171.771 0 53.362-35.854 100.891-82.548 135.078v0zM338.053 340.992c-17.51 0-35.854 10.839-35.854 29.183 0 17.516 18.343 29.19 35.854 29.19 16.679 0 30.020-11.675 30.020-29.19 0-18.343-13.341-29.183-30.020-29.183v0zM710.783 511.932c-12.51 0-23.349 10.837-23.349 24.178 0 10.839 10.839 21.678 23.349 21.678 16.674 0 29.183-10.839 29.183-21.678 0-13.34-12.509-24.178-29.183-24.178v0zM710.783 511.932z","p-id":"5887","data-spm-anchor-id":"a313x.7781069.0.i22",class:"",fill:"#2dc100"})]),D("svg",{t:"1615199447339",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2522",width:"200",height:"200"},[D("path",{d:"M512 0C229.003636 0 0 229.003636 0 512s229.003636 512 512 512 512-229.003636 512-512S794.996364 0 512 0z m210.385455 641.396364c-7.447273 9.309091-26.996364-1.861818-41.89091-32.581819-3.723636 13.963636-13.032727 36.305455-34.443636 64.232728 35.374545 8.378182 44.683636 42.821818 33.512727 61.44-8.378182 13.032727-26.996364 24.203636-59.578181 24.203636-58.647273 0-83.781818-15.825455-95.883637-26.996364-1.861818-2.792727-5.585455-3.723636-10.24-3.723636-4.654545 0-7.447273 0.930909-10.24 3.723636-11.170909 11.170909-37.236364 26.996364-95.883636 26.996364-32.581818 0-52.130909-11.170909-59.578182-24.203636-12.101818-18.618182-1.861818-53.061818 33.512727-61.44-20.48-27.927273-29.789091-50.269091-34.443636-64.232728-13.963636 30.72-34.443636 42.821818-41.890909 32.581819-5.585455-8.378182-8.378182-26.065455-7.447273-38.167273 3.723636-46.545455 34.443636-85.643636 53.061818-106.123636-2.792727-5.585455-8.378182-40.029091 14.894546-63.301819v-1.861818c0-92.16 65.163636-158.254545 148.014545-158.254545 81.92 0 148.014545 66.094545 148.014546 158.254545v1.861818c23.272727 23.272727 17.687273 57.716364 14.894545 63.301819 17.687273 20.48 49.338182 59.578182 53.061818 106.123636 0.930909 12.101818-0.930909 29.789091-7.447272 38.167273z",fill:"#30A5DD","p-id":"2523"})]),D("svg",{t:"1615199464855",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3380",width:"200",height:"200"},[D("path",{d:"M448.698182 482.210909c-96.814545 4.654545-175.010909 56.785455-175.010909 121.949091s78.196364 114.501818 175.010909 109.847273S623.709091 647.912727 623.709091 582.749091c-0.930909-64.232727-79.127273-105.192727-175.010909-100.538182z m65.163636 164.770909c-29.789091 39.098182-88.436364 57.716364-145.221818 26.065455-26.996364-14.894545-26.065455-43.752727-26.065455-43.752728s-11.170909-92.16 85.643637-103.330909c97.745455-12.101818 115.432727 81.92 85.643636 121.018182z",fill:"#EA5D5C","p-id":"3381"}),D("path",{d:"M448.698182 584.610909c-6.516364 4.654545-7.447273 13.032727-3.723637 18.618182 2.792727 5.585455 11.170909 6.516364 16.756364 1.861818 5.585455-4.654545 8.378182-13.032727 4.654546-18.618182-2.792727-5.585455-10.24-6.516364-17.687273-1.861818zM403.083636 597.643636c-18.618182 1.861818-30.72 17.687273-30.72 33.512728 0 14.894545 14.894545 26.065455 32.581819 24.203636 17.687273-1.861818 32.581818-15.825455 32.581818-31.650909s-13.963636-27.927273-34.443637-26.065455z",fill:"#EA5D5C","p-id":"3382"}),D("path",{d:"M512 0C229.003636 0 0 229.003636 0 512s229.003636 512 512 512 512-229.003636 512-512S794.996364 0 512 0z m197.352727 626.501818C669.323636 712.145455 538.065455 754.036364 441.250909 746.589091c-92.16-7.447273-211.316364-38.167273-223.418182-151.738182 0 0-6.516364-51.2 42.821818-117.294545 0 0 70.749091-99.607273 152.669091-128.465455 82.850909-27.927273 92.16 19.549091 92.16 48.407273-4.654545 24.203636-12.101818 38.167273 18.618182 28.858182 0 0 80.989091-38.167273 114.501818-4.654546 26.996364 26.996364 4.654545 65.163636 4.654546 65.163637s-11.170909 12.101818 12.101818 16.756363c21.410909 3.723636 94.021818 37.236364 53.992727 122.88z m-80.058182-236.450909c-8.378182 0-15.825455-7.447273-15.825454-15.825454 0-9.309091 7.447273-15.825455 15.825454-15.825455 0 0 99.607273-18.618182 87.505455 89.367273v1.861818c-0.930909 7.447273-7.447273 13.963636-15.825455 13.963636-9.309091 0-15.825455-7.447273-15.825454-15.825454 0-1.861818 15.825455-73.541818-55.854546-57.716364zM797.789091 493.381818c-2.792727 18.618182-12.101818 11.170909-22.341818 11.170909-13.032727 0-23.272727-16.756364-23.272728-29.789091 0-11.170909 4.654545-22.341818 4.654546-22.341818 0.930909-4.654545 12.101818-34.443636-7.447273-78.196363-35.374545-60.509091-106.123636-60.509091-114.501818-57.716364-8.378182 3.723636-21.410909 5.585455-21.410909 5.585454-13.032727 0-23.272727-10.24-23.272727-23.272727 0-11.170909 7.447273-19.549091 16.756363-22.341818 0 0 0 0.930909 0.930909 0.930909s1.861818 0.930909 1.861819 0.930909c10.24-1.861818 45.614545-4.654545 79.127272 3.723637 62.370909 14.894545 146.152727 83.781818 108.916364 211.316363z",fill:"#EA5D5C","p-id":"3383"})])])],-1))),Qo=Ho((()=>D("div",{class:"row justify-between q-pt-md text-grey-8"},[D("span",null,"Forget Password?"),D("span",{class:"sign-up text-center cursor-pointer"}," Don't Have Account？Register Now！ ")],-1))),Xo=Jn(y({__name:"Login",setup(e){V((e=>({"315472c4":r.value.pageLogin.themePageLoginBackground,"66c497f3":r.value.pageLogin.themePageLoginColor,"1ea0ecf8":r.value.global.themeColorAlpha,b0beb80c:r.value.global.themeColor}))),Ce();const t=H(),n=C({username:"admin",password:"admin"}),o={username:[e=>e&&e.length>0||"Please Input Username"],password:[e=>e&&e.length>0||"Please Input Password"],rememberMe:[e=>!!e||"You need to accept the license and terms first"]},r=R((()=>{const e=hi.system.useThemeStore();return e.themeConfig[e.activeName]})),i=async()=>{hi.system.useAccountStore().login(n.value).then((()=>{t.replace(t.currentRoute.value.query.redirect||"/home")}))},a=()=>{n.value={username:"",password:""}};return(e,t)=>(b(),w("div",$o,[D("div",Jo,[E(Se,{greedy:"",class:"form-login",onSubmit:i,onReset:a},{default:L((()=>[Ko,E(ke,{modelValue:n.value.username,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value.username=e),outlined:"",label:"Name","lazy-rules":"",rules:o.username},{prepend:L((()=>[E(he,{class:"icon",name:"perm_identity"})])),_:1},8,["modelValue","rules"]),E(ke,{modelValue:n.value.password,"onUpdate:modelValue":t[1]||(t[1]=e=>n.value.password=e),outlined:"",label:"Password","lazy-rules":"",type:"password",rules:o.password},{prepend:L((()=>[E(he,{class:"icon",name:"lock"})])),_:1},8,["modelValue","rules"]),D("div",null,[E(le,{class:"btn-submit full-width no-outline text-h6",color:"primary",label:"Login",type:"submit"})]),Yo,Qo])),_:1})])]))}}),[["__scopeId","data-v-3aaf0e08"]]),Zo=Object.freeze(Object.defineProperty({__proto__:null,default:Xo},Symbol.toStringTag,{value:"Module"})),er=y({__name:"Index",setup(e){const t=P({cesiumPath:"https://unpkg.com/cesium@latest/Build/Cesium/Cesium.js"});return(e,n)=>(b(),k(U(dt),{"cesium-path":t.cesiumPath},{default:L((()=>[E(U(lt))])),_:1},8,["cesium-path"]))}}),tr=Object.freeze(Object.defineProperty({__proto__:null,default:er},Symbol.toStringTag,{value:"Module"})),nr=y({__name:"Index",setup(e){const t=Ce();K((()=>t.fullscreen.isActive),(e=>{}));const n=()=>{t.fullscreen.toggle()};return(e,o)=>(b(),k(le,{icon:U(t).fullscreen.isActive?"fullscreen_exit":"fullscreen",size:"md",flat:"",round:"",onClick:n},{default:L((()=>[E(de,null,{default:L((()=>[_(M(U(t).fullscreen.isActive?"退出全屏":"全屏"),1)])),_:1})])),_:1},8,["icon"]))}}),or=y({__name:"Index",setup(e){const{toggleGlobalLayout:t}=hi.system.useLayoutStore(),{loadDefaultLayers:n}=hi.viewer.useLayerStore(),o=hi.system.useUserStore(),r=Xe(),i=()=>{hi.system.useAccountStore().logout({confirm:!0}).then((e=>{if(e){n(!1),t({featureInfo:!1,layerManager:!1}),hi.viewer.useRenderStore(fi).removeAllRenderData();const e={position:[105,30,21634101],heading:360,pitch:-90,roll:0};(null==r?void 0:r.viewer)&&Qe(null==r?void 0:r.viewer,e,{duration:3})}}))};return(e,t)=>{var n;return"login"!==e.$route.name?(b(),k(ue,{key:0,dense:"",rounded:"","no-caps":"",size:"md",class:"q-mr-sm cursor-pointer","auto-close":"",icon:"person",label:null==(n=U(o).info)?void 0:n.username},{default:L((()=>[E(xe,null,{default:L((()=>[E(pe,{dense:""},{default:L((()=>[B((b(),k(ge,{clickable:"",dense:"",onClick:i},{default:L((()=>[E(me,{avatar:""},{default:L((()=>[E(Te,{icon:"logout"})])),_:1}),E(me,null,{default:L((()=>[E(ve,null,{default:L((()=>[_("LogOut")])),_:1})])),_:1})])),_:1})),[[Pe]])])),_:1})])),_:1})])),_:1},8,["label"])):I("",!0)}}}),rr=y({__name:"Index",setup(e){const{locale:t}=Y(),n=C(!1),o=e=>{t.value=e,Bt("locale",e)};return(e,t)=>(b(),k(Re,{modelValue:n.value,"onUpdate:modelValue":t[2]||(t[2]=e=>n.value=e),dense:"",color:"#fff","fab-mini":"",size:"md","dropdown-icon":"language",flat:""},{default:L((()=>[E(pe,null,{default:L((()=>[B((b(),k(ge,{clickable:"",onClick:t[0]||(t[0]=e=>o("en-US"))},{default:L((()=>[E(me,null,{default:L((()=>[E(ve,null,{default:L((()=>[_("English")])),_:1})])),_:1})])),_:1})),[[Pe]]),B((b(),k(ge,{clickable:"",onClick:t[1]||(t[1]=e=>o("zh-CN"))},{default:L((()=>[E(me,null,{default:L((()=>[E(ve,null,{default:L((()=>[_("简体中文")])),_:1})])),_:1})])),_:1})),[[Pe]])])),_:1})])),_:1},8,["modelValue"]))}}),ir={class:"vc-geocoder row"},ar=Jn(y({__name:"Index",setup(e){const t=Xe(),n=C(null),o=C([]),r=C(null),i=C([]),a=async(e,t,r)=>{const i={keywords:e=""===e?n.value:e,citylimit:!0,output:"json",key:"3d933b21d4d5e130a155b4cf2560c610"},a=await An.getLocationList(i);let s=[];if("1"===a.status){const e=a.pois,t=[];e.forEach((e=>{t.push({value:e.id,label:e.name,pname:e.pname,cityname:e.cityname,adname:e.adname,address:e.address,location:e.location,type:e.type})})),s=[...new Set(t)]}t((()=>{const t=null==e?void 0:e.toLocaleLowerCase();o.value=s.filter((e=>e.label.toLocaleLowerCase().indexOf(t)>-1))}))},s=e=>{n.value=e},c=()=>{n.value=null,i.value.length=0},d=e=>{if(e){const t=ut(Number(e.location.trim().split(",")[0]),Number(e.location.trim().split(",")[1])),n={lng:t[0],lat:t[1],address:e.address};l(n,e)}else i.value.length=0},l=(e,n)=>{const o=e.lng,r=e.lat,a=e.address,{Rectangle:s,sampleTerrain:c}=Cesium,{viewer:d}=t;i.value.length=0,i.value.push({position:[o,r],point:{color:"#08ABD5",pixelSize:12,outlineWidth:3,outlineColor:"#fff"},properties:{...n},description:u({"经度":o,"纬度":r,"地址":a})}),new Cesium.HeadingPitchRange(0,0,3e3);const l=.01,p=s.fromDegrees(o-l,r-l,o+l,r+l),m=d.scene.camera,f=m.getRectangleCameraCoordinates(p),h=d.scene.globe.ellipsoid.cartesianToCartographic(f);c(d.scene.globe.terrainProvider,6,[s.center(p)]).then((function(e){const t={longitude:h.longitude,latitude:h.latitude,height:h.height+e[0].height},n=d.scene.globe.ellipsoid.cartographicToCartesian(t);m.flyTo({duration:3,destination:n})}))},u=(e,t)=>{let n="";e instanceof Cesium.PropertyBag&&(e=e.getValue(Cesium.JulianDate.now()));for(let o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(o===t)continue;let r=e[o];"object"==typeof r&&(r=u(r)),o=o.replace(/_/g," "),Cesium.defined(r)&&(n+="<tr><th>"+o+"</th><td>"+r+"</td></tr>")}return n.length>0&&(n='<table class="cesium-infoBox-defaultTable"><tbody>'+n+"</tbody></table>"),n};return(e,t)=>{const l=g("vc-datasource-custom");return b(),w(z,null,[D("div",ir,[E(Oe,{outlined:"","model-value":n.value,"use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",options:o.value,label:"Search",style:{width:"250px"},dense:"","hide-dropdown-icon":"",onFilter:a,onInputValue:s,"onUpdate:modelValue":d},{prepend:L((()=>[E(he,{name:"place",color:"white"})])),"no-option":L((()=>[E(ge,null,{default:L((()=>[E(me,{class:"text-grey"},{default:L((()=>[_(" Not Found ")])),_:1})])),_:1})])),append:L((()=>[null!==n.value?(b(),k(he,{key:0,name:"cancel",class:"cursor-pointer",onClick:Q(c,["stop"])})):I("",!0),E(he,{name:"search",color:"orange"})])),_:1},8,["model-value","options"])]),E(l,{ref_key:"datasoureceRef",ref:r,entities:i.value},null,8,["entities"])],64)}}}),[["__scopeId","data-v-9d0d028c"]]),sr=(e=>($("data-v-ba6cc136"),e=e(),J(),e))((()=>D("img",{src:"https://zouyaoji.top/vue-cesium/favicon.png"},null,-1))),cr={class:"menu-container"},dr={key:0,class:"right-btn"},lr=Jn(y({name:"MainHeader",__name:"Index",setup(e){const t=x();C(!1);const n=C(""),{registerTimeout:o}=Le(),r=C(100),i=hi.system.useMenuStore(),a=hi.system.useLayoutStore(),{global:s}=Ot(a),c=R((()=>"Global Village")),d=R((()=>{const e=i.header;return e.length?e[0].children:[]}));R((()=>!1)),R((()=>i.aside)),R((()=>{const e=hi.system.useThemeStore();return e.themeConfig[e.activeName]})),K((()=>t.matched),(e=>{o((()=>{if(e.length>1){const t=e[1].path.substring(1,e[1].path.length);t&&(n.value=t)}else n.value="index"}),r.value)}),{immediate:!0}),S((()=>{r.value=5}));const l=()=>{a.toggleGlobalLayout({leftDrawerMini:!s.value.leftDrawerMini})},u=e=>{null===e&&t.matched.length>1?n.value=t.matched[1].path.substring(1,t.matched[1].path.length):n.value=e};return(e,t)=>(b(),k(De,{class:"main-header"},{default:L((()=>[E(Te,{class:"cursor-pointer",onClick:l},{default:L((()=>[sr])),_:1}),E(Ee,{shrink:!0,style:{width:"280px","font-weight":"bold","text-align":"left"}},{default:L((()=>[_(M(c.value),1)])),_:1}),D("div",cr,[E(_e,{"model-value":n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),align:"left","indicator-color":"cyan-13","onUpdate:modelValueOnce":u},{default:L((()=>[(b(!0),w(z,null,q(d.value,((t,n)=>(b(),k(Ie,{key:n,name:t.name,to:t.path,exact:"",label:e.$t(t.title),"content-class":"menu-tab","active-class":"menu-active"},null,8,["name","to","label"])))),128))])),_:1},8,["model-value"])]),E(Me),d.value.length?(b(),w("div",dr,[E(ar),E(nr),E(rr),E(or)])):I("",!0)])),_:1}))}}),[["__scopeId","data-v-ba6cc136"]]),ur={key:0,class:"text-weight-bold"},pr={class:"content"},mr=Jn(y({__name:"Index",props:{title:{type:String,default:""},titleClass:{type:String,default:""},closeTip:{type:String,default:"关闭"},showCloseBtn:{type:Boolean,default:!0},separatorOpts:{type:Object,default:()=>({show:!0,dark:!0,color:"white",size:"1px"})}},emits:["close"],setup(e,{emit:t}){V((e=>({c6e3f058:r.value.commonPanel.themeCommonPanelHeaderColor,a83893f4:r.value.commonPanel.themeCommonPanelHeaderBackgroundColor,"6d7599a8":r.value.commonPanel.themeCommonPanelContentColor,"387e935e":r.value.commonPanel.themeCommonPanelContentBackgroundColor,"452a03e3":r.value.commonPanel.themeCommonPanelListColor,"5d46fb17":r.value.commonPanel.themeCommonPanelListBorderColor,"84b34094":r.value.global.themeColorAlpha,"21f592f0":r.value.global.themeColor})));const n=t,o=e=>{n("close",e)},r=R((()=>{const e=hi.system.useThemeStore();return e.themeConfig[e.activeName]}));return(t,n)=>(b(),k(Be,{class:"common-panel"},{default:L((()=>[E(Ae,{class:F(["header",e.titleClass])},{default:L((()=>[""!==e.title?(b(),w("div",ur,M(e.title),1)):I("",!0),X(t.$slots,"header-left",{},void 0,!0),E(Me),X(t.$slots,"header-right",{},void 0,!0),e.showCloseBtn?B((b(),k(le,{key:1,dense:"",flat:"",icon:"close",onClick:o},{default:L((()=>[E(de,null,{default:L((()=>[_(M(e.closeTip),1)])),_:1})])),_:1})),[[Pe]]):I("",!0)])),_:3},8,["class"]),e.separatorOpts.show?(b(),k(Ne,Z(ee({key:0},e.separatorOpts)),null,16)):I("",!0),D("div",pr,[X(t.$slots,"default",{},void 0,!0)])])),_:3}))}}),[["__scopeId","data-v-70da5cdb"]]),fr=y({name:"DragWrapper",props:{restriction:{type:[String,Object,Function],default:"parent"}},setup(e,t){const n=C(null),o=G(),r=e=>{const t=e.target,n=(parseFloat(t.getAttribute("data-x"))||0)+e.dx,o=(parseFloat(t.getAttribute("data-y"))||0)+e.dy;t.style.webkitTransform=t.style.transform="translate("+n+"px, "+o+"px)",t.setAttribute("data-x",n),t.setAttribute("data-y",o)},i=()=>{const e=n.value;At(e).reflow({name:"drag",axis:"xy"})};return S((()=>{const t=n.value;At(t).draggable({ignoreFrom:"button, .ignore-drag",allowFrom:".drag-handle",inertia:!0,onmove:r,modifiers:[At.modifiers.restrict({restriction:e.restriction,endOnly:!0,elementRect:{left:0,right:1,top:0,bottom:1}})]}),addEventListener("resize",i,!1)})),te((()=>{const e=n.value;At.isSet(e)&&At(e).unset(),removeEventListener("resize",i,!1)})),Object.assign(null==o?void 0:o.proxy,{resizeListener:i}),()=>N("div",{ref:n,class:"drag-wrapper absolute"},pt(t.slots.default))}}),hr={class:"text-subtitle2"},vr={class:"q-gutter-sm"},yr={class:"text-subtitle2"},gr={class:"q-gutter-sm"},br={class:"text-subtitle2"},kr={class:"q-gutter-sm"},wr=Jn(y({__name:"Index",setup(e){const t=C(null),n=hi.system.useLayoutStore(),{global:o,dynamicRender:r}=Ot(n),{overlayLayers:i,baseLayers:a,terrainLayers:s,toggle:c}=hi.viewer.useLayerStore();K(r,(e=>{O((()=>{var e,n;t.value&&(null==(n=(e=t.value).resizeListener)||n.call(e))}))}),{deep:!0});const d=R((()=>({overlayLayers:i,baseLayers:a,terrainLayers:s}))),l=R({get(){var e,t;return null==(t=null==(e=d.value.baseLayers.filter((e=>e.props.show)))?void 0:e[0])?void 0:t.name},set(e){}}),u=R({get(){var e,t;return null==(t=null==(e=d.value.terrainLayers.filter((e=>e.props.show)))?void 0:e[0])?void 0:t.name},set(e){}}),p=(e,t)=>{d.value.baseLayers.forEach((t=>{t.name===e?c({names:t.name,show:!0}):c({names:t.name,show:!1})}))},m=(e,t)=>{d.value.terrainLayers.forEach((t=>{t.name===e?c({names:t.name,show:!0}):c({names:t.name,show:!1})}))},f=()=>{n.toggleGlobalLayout({layerManager:!o.value.layerManager})};return(e,n)=>(b(),w("div",{class:F(["layer-manager",U(r).datasource.workBench?"":"full-srceen"])},[E(U(fr),{ref_key:"dragWrapperRef",ref:t},{default:L((()=>[B(E(mr,{class:"layer-manager-panel",title:e.$t("message.panel.layerManager"),"title-class":"drag-handle",onClose:f},{default:L((()=>[E(Ve,{class:"q-pt-sm"},{default:L((()=>[D("div",hr,M(e.$t("message.baseLayer")),1),D("div",vr,[(b(!0),w(z,null,q(d.value.baseLayers,((e,t)=>(b(),k(je,{key:t,modelValue:l.value,"onUpdate:modelValue":[n[0]||(n[0]=e=>l.value=e),p],val:e.name,label:e.text},null,8,["modelValue","val","label"])))),128))])])),_:1}),E(Ne,{inset:""}),E(Ve,{class:"q-pt-sm"},{default:L((()=>[D("div",yr,M(e.$t("message.overlayLayer")),1),D("div",gr,[(b(!0),w(z,null,q(d.value.overlayLayers,((e,t)=>(b(),k(fe,{key:t,modelValue:e.props.show,"onUpdate:modelValue":[t=>e.props.show=t,t=>((e,t)=>{const n=e.name;c({names:n,show:t})})(e,t)],val:e.name,label:e.text},null,8,["modelValue","onUpdate:modelValue","val","label"])))),128))])])),_:1}),E(Ne,{inset:""}),E(Ve,{class:"q-pt-sm"},{default:L((()=>[D("div",br,M(e.$t("message.terrainLayer")),1),D("div",kr,[(b(!0),w(z,null,q(d.value.terrainLayers,((e,t)=>(b(),k(je,{key:t,modelValue:u.value,"onUpdate:modelValue":[n[1]||(n[1]=e=>u.value=e),m],val:e.name,label:e.text},null,8,["modelValue","val","label"])))),128))])])),_:1})])),_:1},8,["title"]),[[j,U(o).layerManager]])])),_:1},512)],2))}}),[["__scopeId","data-v-179cd74a"]]),Cr=Jn(y({__name:"Index",setup(e){const t=C(null),{contentStyle:n,contentActiveStyle:o,thumbStyle:r,scrollAreaRef:i,verticalPositionRef:a,setScrollPosition:s,onScrollHandler:c}=lo(),d=hi.system.useLayoutStore(),{global:l,dynamicRender:u}=Ot(d),{toggleGlobalLayout:p}=d,m=hi.viewer.useRenderStore().selectedRenderData,f=C(null),h=C("450px");S((()=>{})),K(l,(e=>{O((()=>{var e,n;null==(n=null==(e=t.value)?void 0:e.resizeListener)||n.call(e)}))}),{deep:!0}),K(m,(e=>{O((()=>{var t;if(null==(t=null==e?void 0:e.featureInfoListItems)?void 0:t.length){const e=f.value.$el,t=getComputedStyle(e).height,n=parseInt(t);h.value=n<680?t:"680px"}}))}));const v=R((()=>({height:h.value}))),y=()=>{p({featureInfo:!1})};return(e,r)=>(b(),w("div",{class:F(["feature-info",U(u).datasource.workBench?"":"full-srceen"])},[E(U(fr),{ref_key:"dragWrapperRef",ref:t},{default:L((()=>[B(E(mr,{class:"feature-info-panel animated fadeIn q-ma-xs",title:"要素信息","title-class":"drag-handle",onClose:y},{default:L((()=>{var e;return[0===(null==(e=U(m))?void 0:e.featureInfoListItems.length)?(b(),k(so,{key:0,class:"absolute-center","show-tip":""})):I("",!0),U(a)>600?(b(),k(le,{key:1,dense:"",fab:"",round:"",glossy:"","fab-mini":"",ripple:"",icon:"expand_less",padding:"2px",class:"absolute-bottom-right non-selectable scroll-top z-top",onClick:r[0]||(r[0]=e=>U(s)("vertical",0,300))},{default:L((()=>[E(de,null,{default:L((()=>[_("回到顶部")])),_:1})])),_:1})):I("",!0),E(we,{ref_key:"scrollAreaRef",ref:i,class:"feature-info-panel-content",style:ne(v.value),"content-style":U(n),"content-active-style":U(o),onScroll:U(c)},{default:L((()=>[E(pe,{ref_key:"featureInfoListRef",ref:f,dark:"",bordered:"",separator:"",class:"feature-info-list"},{default:L((()=>{var e;return[(b(!0),w(z,null,q(null==(e=U(m))?void 0:e.featureInfoListItems,((e,t)=>B((b(),k(ge,{key:t,clickable:""},{default:L((()=>[E(me,{avatar:""},{default:L((()=>[E(he,{class:"feature-info-field-icon",name:"article"})])),_:1}),E(me,null,{default:L((()=>[E(ve,null,{default:L((()=>[_(M(e.label),1)])),_:2},1024),E(ve,{caption:""},{default:L((()=>[_(M(e.value),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)),[[ye]]))),128))]})),_:1},512)])),_:1},8,["style","content-style","content-active-style","onScroll"])]})),_:1},512),[[j,U(l).featureInfo]])])),_:1},512)],2))}}),[["__scopeId","data-v-6bce411c"]]),Sr={class:"buttons-box-left"},Tr={class:"buttons-box-right"},xr={class:"jessibuca-btn"},Pr=Jn(y({name:"VcDemoJessibucaPlayer",__name:"Index",props:{url:String,error:String,hasAudio:{type:Boolean,default:!0}},setup(e){const t=e,n=x(),o=C(!1),r=C(!0),i=C(!1),a=C(!1),s=C(!1);C(0);const c=C(""),d=C(0);C(null),C(1),C(0),C(!0);const l=C(""),u=C(!1),p=C(null),m=C(null);let f={};const h=G();S((()=>{let e=t.url;const o=decodeURIComponent(n.params.url);O((()=>{v(),window.onresize=()=>{v()},void 0===e&&(e=o),y(e)}))})),T((()=>{f[h.uid]&&f[h.uid].destroy(),o.value=!1,s.value=!1,c.value=""})),K((()=>t.url),(e=>{y(e)}));const v=()=>{let e=p.value,t=e.parentNode.clientWidth,n=9/16*t;const o=Math.min(document.body.clientHeight,document.documentElement.clientHeight);n>o&&(n=o,t=16/9*n),e.style.width=t+"px",e.style.height=n+"px"},y=e=>{Yt(`开始播放视频流：${e}`),f[h.uid]&&E(),g(),f[h.uid].on("play",(()=>{o.value=!0,s.value=!0,i.value=f[h.uid].quieting})),f[h.uid].hasLoaded()?f[h.uid].play(e):f[h.uid].on("load",(()=>{f[h.uid].play(e)}))},g=()=>{Yt(`hasAudio: ${t.hasAudio}`),f[h.uid]=new Jessibuca({container:p.value,videoBuffer:.2,isResize:!0,decoder:"./libs/jessibuca/decoder.js",useMSE:!0,useWCS:!0,showBandwidth:!1,isFlv:!1,loadingText:"加载中",hasAudio:t.hasAudio,debug:!1,supportDblclickFullscreen:!1,operateBtns:{fullscreen:!1,screenshot:!1,play:!1,audio:!1},forceNoOffscreen:u.value,isNotMute:r.value});let e=f[h.uid];e.on("load",(function(){})),e.on("log",(function(e){})),e.on("record",(function(e){})),e.on("pause",(function(){o.value=!1})),e.on("play",(function(){o.value=!0})),e.on("fullscreen",(function(e){a.value=e})),e.on("mute",(function(e){r.value=!e})),e.on("audioInfo",(function(e){})),e.on("videoInfo",(function(e){})),e.on("bps",(function(e){})),e.on("timeUpdate",(function(e){})),e.on("videoInfo",(function(e){})),e.on("error",(function(e){})),e.on("timeout",(function(){})),e.on("start",(function(){})),e.on("performance",(function(e){let t="卡顿";2===e?t="非常流畅":1===e&&(t="流畅"),c.value=t})),e.on("buffer",(function(e){})),e.on("stats",(function(e){})),e.on("kBps",(function(e){d.value=Math.round(e)})),e.on("videoFrame",(function(){})),e.on("metadata",(function(){}))},k=()=>{let e=P();f[h.uid].setFullscreen(!e),a.value=!e},P=()=>document.fullscreenElement||document.msFullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||!1,R=()=>{y(t.url)},L=()=>{f[h.uid]&&f[h.uid].pause(),o.value=!1,l.value="",c.value=""},E=()=>{f[h.uid]&&f[h.uid].destroy(),null==m.value&&p.value.appendChild(m.value),f[h.uid]=null,o.value=!1,c.value=""},_=()=>{f[h.uid]&&f[h.uid].screenshot("截图","png",.5)};return(e,t)=>(b(),w("div",{ref_key:"palyerContainerRef",ref:p,class:"jessibuca-player",onDblclick:k},[D("div",{id:"buttonsBox",ref_key:"buttonsBoxRef",ref:m,class:"buttons-box"},[D("div",Sr,[o.value?I("",!0):(b(),w("i",{key:0,class:"iconfont icon-play jessibuca-btn",onClick:R})),o.value?(b(),w("i",{key:1,class:"iconfont icon-pause jessibuca-btn",onClick:L})):I("",!0),D("i",{class:"iconfont icon-stop jessibuca-btn",onClick:E}),r.value?(b(),w("i",{key:2,class:"iconfont icon-audio-high jessibuca-btn",onClick:t[0]||(t[0]=e=>{f[h.uid]&&f[h.uid].mute()})})):I("",!0),r.value?I("",!0):(b(),w("i",{key:3,class:"iconfont icon-audio-mute jessibuca-btn",onClick:t[1]||(t[1]=e=>{f[h.uid]&&f[h.uid].cancelMute()})}))]),D("div",Tr,[D("span",xr,M(d.value)+" kb/s",1),D("i",{class:"iconfont icon-camera1196054easyiconnet jessibuca-btn",style:{"font-size":"1rem !important"},onClick:_}),D("i",{class:"iconfont icon-shuaxin11 jessibuca-btn",onClick:R}),a.value?I("",!0):(b(),w("i",{key:0,class:"iconfont icon-weibiaoti10 jessibuca-btn",onClick:k})),a.value?(b(),w("i",{key:1,class:"iconfont icon-weibiaoti11 jessibuca-btn",onClick:k})):I("",!0)])],512)],544))}}),[["__scopeId","data-v-4750c349"]]),Rr={class:"video-player-container"},Or=Jn(y({name:"VcDemoDevicePlayerPanel",__name:"Index",setup(e){const t=C(null),n=hi.system.useLayoutStore(),{global:o,dynamicRender:r}=Ot(n);K(r,(e=>{O((()=>{var e,n;t.value&&(null==(n=(e=t.value).resizeListener)||n.call(e))}))}),{deep:!0});const i=()=>{n.toggleGlobalLayout({videoPlayer:!o.value.videoPlayer})};return(e,n)=>U(o).videoPlayer?(b(),w("div",{key:0,class:F(["device-player",U(r).datasource.workBench?"":"full-srceen"])},[E(U(fr),{ref_key:"dragWrapperRef",ref:t},{default:L((()=>[E(mr,{class:"device-player-panel",title:e.$t("message.panel.videoPlayer"),"title-class":"drag-handle",onClose:i},{default:L((()=>[E(Ve,null,{default:L((()=>[D("div",Rr,[E(Pr,{url:"https://sf1-hscdn-tos.pstatp.com/obj/media-fe/xgplayer_doc_video/flv/xgplayer-demo-720p.flv"})])])),_:1})])),_:1},8,["title"])])),_:1},512)],2)):I("",!0)}}),[["__scopeId","data-v-2aaa4040"]]),Lr={class:"main-interaction"},Er={class:"panel-wrapper"},_r=Jn(y({name:"VcDemoInteraction",__name:"Index",setup:e=>(R((()=>{const e=hi.system.useThemeStore();return e.themeConfig[e.activeName]})),(e,t)=>(b(),w("div",Lr,[D("div",Er,[E(wr),E(Cr),E(Or)])])))}),[["__scopeId","data-v-4bf69a58"]]),Mr={VcCollectionPrimitive:et,VcCollectionBillboard:ft,VcCollectionPoint:st,VcCollectionPolyline:ht,VcDatasourceGeojson:vt,VcDatasourceCustom:yt,VcOverlayDynamic:gt,VcOverlayHeatmap:bt,VcPrimitiveTileset:kt,VcLayerImagery:wt,VcImageryProviderWms:Ct,VcImageryProviderTencent:St},Dr=y({name:"RenderData",setup(e,t){const n=Xe(),o=hi.viewer.useRenderStore().renderDatas,r=hi.viewer.useRenderStore().selectedRenderData,i=C(null);let a=!1;const{registerTimeout:s,removeTimeout:c}=Ze(),{toggleGlobalLayout:d}=hi.system.useLayoutStore(),{setMouseOverlayLabel:l,clearMouseOverlayLabel:u}=hi.viewer.useOverlayStore();let p=!1;K((()=>Mt.cloneDeep(r)),((e,t)=>{var n,o,r;if(e.model){const d=e.feature,l=t.feature;if(!a&&d.properties.id!==(null==(n=null==l?void 0:l.properties)?void 0:n.id)){const t=e.model.position||[Number(null==(o=d.properties)?void 0:o.longitude),Number(null==(r=d.properties)?void 0:r.latitude)];e.model&&t&&!isNaN(t[0])&&(c(),s((()=>{i.value.position.value=Cesium.Cartesian3.fromDegrees(t[0],t[1]),i.value.animateAppear(),p=!0}),1500))}a=!1}else(p&&!a||!a&&i.value.selectedFeature.value)&&i.value.animateDepart(),p=!1}),{deep:!0});const m=e=>{var t,o,r,i;const{viewer:a}=n;a.canvas.setAttribute("style","cursor: pointer");const{defined:s,JulianDate:c,BoundingSphere:d,PointPrimitiveCollection:u,BillboardCollection:p,PolylineCollection:m,PrimitiveCollection:f,GeoJsonDataSource:h,CustomDataSource:v}=Cesium;let y,g="",b=[0,0];if(e.cesiumObject instanceof p||e.cesiumObject instanceof u){const n=e.pickedFeature.primitive,o=null==n?void 0:n.feature;s(o)&&(g=null==(t=o.properties)?void 0:t.name,y=n.position||e.surfacePosition,b=[16,16])}else if(e.cesiumObject instanceof m){const t=e.pickedFeature.primitive,n=null==t?void 0:t.feature;if(s(n)){g=null==(o=n.properties)?void 0:o.name;const e=t.positions;y=d.fromPoints(e).center,b=[16,16]}}else if(e.cesiumObject instanceof f){const t=null==(r=e.pickedFeature.primitive)?void 0:r._vcParent,n=null==t?void 0:t.feature;if(s(n)){g=null==(i=n.properties)?void 0:i.name;const e=t.positions.length?t.positions:t.polygonHierarchy.positions;y=d.fromPoints(e).center,b=[16,16]}}else if(e.cesiumObject instanceof v||e.cesiumObject instanceof h){const t=e.pickedFeature.id,n=null==t?void 0:t.feature;if(s(n)){const e=n.properties;g=null==e?void 0:e.name;let o,r;switch(null==e?void 0:e.actualRenderingType){case"label":case"point":case"billboard":case"model":y=t.position.getValue(c.now());break;case"polyline":r=t.polyline.positions.getValue(),o=d.fromPoints(r),y=o.center;break;case"polygon":r=t.polygon.hierarchy.getValue().positions,o=d.fromPoints(r),y=o.center;break;case"geojson":g=t.properties.dValue.getValue(),o=new Cesium.BoundingSphere,a.dataSourceDisplay.getBoundingSphere(t,!0,o),y=o.center}b=[16,16]}}g&&""!==g&&l({position:y,show:!0,text:g,pixelOffset:b})},f=e=>{const{viewer:t}=n;t.canvas.setAttribute("style","cursor: auto"),u()},h=e=>{const{viewer:t,vm:o}=n;e?"__Vc__Pick__Location__"!==e.id&&(a=!0,d({featureInfo:!1}),setTimeout((()=>{var n,r,i;const{defined:a,JulianDate:s,BoundingSphere:c}=Cesium,l=(null==(n=e.cesiumObject)?void 0:n.feature)||(null==(i=null==(r=e.cesiumObject)?void 0:r._vcParent)?void 0:i.feature);a(l)?O((()=>{var n,r;const{renderingType:i,actualRenderingType:a,datasetId:d,id:u,renderingApi:p}=l.properties;let m,f;ln(a,d,l);const h=e.cesiumObject;switch(a){case"label":case"point":case"billboard":case"model":"primitive"===p?h.position:h.position.getValue(s.now());break;case"polyline":f="primitive"===p?h.positions:h.polyline.positions.getValue(),m=c.fromPoints(f),m.center;break;case"polygon":f="primitive"===p?null==(n=h._vcParent)?void 0:n.polygonHierarchy.positions:h.polygon.hierarchy.getValue().positions,m=c.fromPoints(f),m.center;break;case"geojson":m=new Cesium.BoundingSphere,t.dataSourceDisplay.getBoundingSphere(h,!0,m),m.center}o.vcMitt.emit("pickEvt",l.properties.id);(!Cesium.defined(null==(r=null==l?void 0:l.properties)?void 0:r.showBillboardMenu)||l.properties.showBillboardMenu)&&v()})):(dn(),d({featureInfo:!1,videoPlayer:!1}),o.vcMitt.emit("pickEvt",""))}),100)):(dn(),d({featureInfo:!1,videoPlayer:!1}),o.vcMitt.emit("pickEvt",""))},v=()=>{const e=r.feature;Cesium.defined(e)&&yn(e,r)};function y(e){this.cmpRef=e}const g=e=>{const t=[];return null==e||e.forEach((e=>{const n=Mr[e.cmpName];n?t.push(N(n,{...e.props,ref:y.bind(e),onMouseover:m,onMouseout:f},(()=>g(null==e?void 0:e.children)))):Kt(`添加渲染数据集失败，原因：没要找到渲染组件名【${e.cmpName}】。`,"渲染集合数据模型：",e)})),t};return()=>{const e=[];return e.push(N(mt,{ref:i,onPickEvt:h})),o.forEach((t=>{null==t||t.datasets.forEach((t=>{const n=Mr[t.cmpName];n?e.push(N(n,{...t.props,ref:y.bind(t),onMouseover:m,onMouseout:f},(()=>g(null==t?void 0:t.children)))):Kt(`添加渲染数据集失败，原因：没要找到渲染组件名【${t.cmpName}】。`,"渲染集合数据模型：",t)}))})),e}}});var Ir=function(e,t){var n;function o(e,t){function n(e){return!e.audio&&!e.video&&!e.screen&&e.data}var o="";o+="?userid="+e.userid,o+="&sessionid="+e.sessionid,o+="&msgEvent="+e.socketMessageEvent,o+="&socketCustomEvent="+e.socketCustomEvent,o+="&autoCloseEntireSession="+!!e.autoCloseEntireSession,!0===e.session.broadcast&&(o+="&oneToMany=true"),o+="&maxParticipantsAllowed="+e.maxParticipantsAllowed,e.enableScalableBroadcast&&(o+="&enableScalableBroadcast=true",o+="&maxRelayLimitPerUser="+(e.maxRelayLimitPerUser||2)),o+="&extra="+JSON.stringify(e.extra||{}),e.socketCustomParameters&&(o+=e.socketCustomParameters);try{io.sockets={}}catch(s){}if(e.socketURL||(e.socketURL="/"),"/"!=e.socketURL.substr(e.socketURL.length-1,1))throw'"socketURL" MUST end with a slash.';e.enableLogs&&e.socketURL;try{e.socket=io(e.socketURL+o)}catch(s){e.socket=io.connect(e.socketURL+o,e.socketOptions)}var r=e.multiPeersHandler;function i(t,n){e.peersBackup[t]||(e.peersBackup[t]={userid:t,extra:{}}),e.peersBackup[t].extra=n}e.socket.on("extra-data-updated",(function(t,n){e.peers[t]&&(e.peers[t].extra=n,e.onExtraDataUpdated({userid:t,extra:n}),i(t,n))})),e.socket.on(e.socketMessageEvent,(function t(o){if(o.remoteUserId==e.userid)if(e.peers[o.sender]&&e.peers[o.sender].extra!=o.message.extra&&(e.peers[o.sender].extra=o.extra,e.onExtraDataUpdated({userid:o.sender,extra:o.extra}),i(o.sender,o.extra)),o.message.streamSyncNeeded&&e.peers[o.sender]){var a=e.streamEvents[o.message.streamid];if(!a||!a.stream)return;var s=o.message.action;if("ended"===s||"inactive"===s||"stream-removed"===s)return e.peersBackup[a.userid]&&(a.extra=e.peersBackup[a.userid].extra),void e.onstreamended(a);var c="both"!=o.message.type?o.message.type:null;"function"==typeof a.stream[s]&&a.stream[s](c)}else if("dropPeerConnection"!==o.message){if(o.message.allParticipants)return-1===o.message.allParticipants.indexOf(o.sender)&&o.message.allParticipants.push(o.sender),void o.message.allParticipants.forEach((function(t){r[e.peers[t]?"renegotiatePeer":"createNewPeer"](t,{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:n(e.session)})}));if(o.message.newParticipant){if(o.message.newParticipant==e.userid)return;if(e.peers[o.message.newParticipant])return;r.createNewPeer(o.message.newParticipant,o.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:n(e.session)})}else if(o.message.readyForOffer&&(e.attachStreams.length&&(e.waitingForLocalMedia=!1),e.waitingForLocalMedia))setTimeout((function(){t(o)}),1);else if(o.message.newParticipationRequest&&o.sender!==e.userid){e.peers[o.sender]&&e.deletePeer(o.sender);var d={extra:o.extra||{},localPeerSdpConstraints:o.message.remotePeerSdpConstraints||{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:o.message.localPeerSdpConstraints||{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:void 0!==o.message.isOneWay?o.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:void 0!==o.message.isDataOnly?o.message.isDataOnly:n(e.session),dontGetRemoteStream:void 0!==o.message.isOneWay?o.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,dontAttachLocalStream:!!o.message.dontGetRemoteStream,connectionDescription:o,successCallback:function(){}};e.onNewParticipant(o.sender,d)}else{if(o.message.changedUUID&&e.peers[o.message.oldUUID]&&(e.peers[o.message.newUUID]=e.peers[o.message.oldUUID],delete e.peers[o.message.oldUUID]),o.message.userLeft)return r.onUserLeft(o.sender),void(o.message.autoCloseEntireSession&&e.leave());r.addNegotiatedMessage(o.message,o.sender)}}else e.deletePeer(o.sender)}));var a=!1;e.socket.resetProps=function(){a=!1},e.socket.on("connect",(function(){a||(a=!0,e.enableLogs,setTimeout((function(){e.socket.emit("extra-data-updated",e.extra)}),1e3),t&&t(e.socket))})),e.socket.on("disconnect",(function(t){e.onSocketDisconnect(t)})),e.socket.on("error",(function(t){e.onSocketError(t)})),e.socket.on("user-disconnected",(function(t){t!==e.userid&&(e.onUserStatusChanged({userid:t,status:"offline",extra:e.peers[t]&&e.peers[t].extra||{}}),e.deletePeer(t))})),e.socket.on("user-connected",(function(t){t!==e.userid&&e.onUserStatusChanged({userid:t,status:"online",extra:e.peers[t]&&e.peers[t].extra||{}})})),e.socket.on("closed-entire-session",(function(t,n){e.leave(),e.onEntireSessionClosed({sessionid:t,userid:t,extra:n})})),e.socket.on("userid-already-taken",(function(t,n){e.onUserIdAlreadyTaken(t,n)})),e.socket.on("logs",(function(t){e.enableLogs})),e.socket.on("number-of-broadcast-viewers-updated",(function(t){e.onNumberOfBroadcastViewersUpdated(t)})),e.socket.on("set-isInitiator-true",(function(t){t==e.sessionid&&(e.isInitiator=!0)}))}function r(e){var t=this,n=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];function o(){e.fbr=new FileBufferReader,e.fbr.onProgress=function(t){e.onFileProgress(t)},e.fbr.onBegin=function(t){e.onFileStart(t)},e.fbr.onEnd=function(t){e.onFileEnd(t)}}e.peers={getLength:function(){var e=0;for(var t in this)-1==n.indexOf(t)&&e++;return e},selectFirst:function(){var e;for(var t in this)-1==n.indexOf(t)&&(e=this[t]);return e},getAllParticipants:function(e){var t=[];for(var o in this)-1==n.indexOf(o)&&o!=e&&t.push(o);return t},forEach:function(t){this.getAllParticipants().forEach((function(n){t(e.peers[n])}))},send:function(n,o){var r=this;if(!p(n.size)&&!p(n.type)){if(e.enableFileSharing)return void t.shareFile(n,o);"string"!=typeof n&&(n=JSON.stringify(n))}if("text"===n.type||n instanceof ArrayBuffer||n instanceof DataView){if("text"===n.type&&(n=JSON.stringify(n)),o){var i=e.peers[o];if(i)return i.channels.length?void i.channels.forEach((function(e){e.send(n)})):(e.peers[o].createDataChannel(),e.renegotiate(o),void setTimeout((function(){r.send(n,o)}),3e3))}this.getAllParticipants().forEach((function(t){if(!r[t].channels.length)return e.peers[t].createDataChannel(),e.renegotiate(t),void setTimeout((function(){r[t].channels.forEach((function(e){e.send(n)}))}),3e3);r[t].channels.forEach((function(e){e.send(n)}))}))}else _.send({text:n,channel:this,connection:e,remoteUserId:o})}},this.uuid=e.userid,this.getLocalConfig=function(n,r,i){return i||(i={}),{streamsToShare:i.streamsToShare||{},rtcMultiConnection:e,connectionDescription:i.connectionDescription,userid:r,localPeerSdpConstraints:i.localPeerSdpConstraints,remotePeerSdpConstraints:i.remotePeerSdpConstraints,dontGetRemoteStream:!!i.dontGetRemoteStream,dontAttachLocalStream:!!i.dontAttachLocalStream,renegotiatingPeer:!!i.renegotiatingPeer,peerRef:i.peerRef,channels:i.channels||[],onLocalSdp:function(e){t.onNegotiationNeeded(e,r)},onLocalCandidate:function(n){(n=P.processCandidates(e,n))&&t.onNegotiationNeeded(n,r)},remoteSdp:n,onDataChannelMessage:function(n){if(!e.fbr&&e.enableFileSharing&&o(),"string"!=typeof n&&e.enableFileSharing){var i=this;n instanceof ArrayBuffer||n instanceof DataView?e.fbr.convertToObject(n,(function(e){i.onDataChannelMessage(e)})):n.readyForNextChunk?e.fbr.getNextChunk(n,(function(t,n){e.peers[r].channels.forEach((function(e){e.send(t)}))}),r):n.chunkMissing?e.fbr.chunkMissing(n):e.fbr.addChunk(n,(function(t){e.peers[r].peer.channel.send(t)}))}else t.onDataChannelMessage(n,r)},onDataChannelError:function(e){t.onDataChannelError(e,r)},onDataChannelOpened:function(e){t.onDataChannelOpened(e,r)},onDataChannelClosed:function(e){t.onDataChannelClosed(e,r)},onRemoteStream:function(n){e.peers[r]&&e.peers[r].streams.push(n),t.onGettingRemoteMedia(n,r)},onRemoteStreamRemoved:function(e){t.onRemovingRemoteMedia(e,r)},onPeerStateChanged:function(e){t.onPeerStateChanged(e),"new"===e.iceConnectionState&&t.onNegotiationStarted(r,e),"connected"===e.iceConnectionState&&t.onNegotiationCompleted(r,e),-1!==e.iceConnectionState.search(/closed|failed/gi)&&(t.onUserLeft(r),t.disconnectWith(r))}}},this.createNewPeer=function(t,n){if(!(e.maxParticipantsAllowed<=e.getAllParticipants().length)){if(n=n||{},e.isInitiator&&e.session.audio&&"two-way"===e.session.audio&&!n.streamsToShare&&(n.isOneWay=!1,n.isDataOnly=!1,n.session=e.session),!n.isOneWay&&!n.isDataOnly)return n.isOneWay=!0,void this.onNegotiationNeeded({enableMedia:!0,userPreferences:n},t);n=e.setUserPreferences(n,t);var o=this.getLocalConfig(null,t,n);e.peers[t]=new T(o)}},this.createAnsweringPeer=function(t,n,o){o=e.setUserPreferences(o||{},n);var r=this.getLocalConfig(t,n,o);e.peers[n]=new T(r)},this.renegotiatePeer=function(t,n,o){if(e.peers[t]){n||(n={}),n.renegotiatingPeer=!0,n.peerRef=e.peers[t].peer,n.channels=e.peers[t].channels;var r=this.getLocalConfig(o,t,n);e.peers[t]=new T(r)}else e.enableLogs},this.replaceTrack=function(t,n,o){if(!e.peers[n])throw"This peer ("+n+") does not exist.";var r=e.peers[n].peer;r.getSenders&&"function"==typeof r.getSenders&&r.getSenders().length?r.getSenders().forEach((function(r){o&&"video"===r.track.kind&&(e.peers[n].peer.lastVideoTrack=r.track,r.replaceTrack(t)),o||"audio"!==r.track.kind||(e.peers[n].peer.lastAudioTrack=r.track,r.replaceTrack(t))})):this.renegotiatePeer(n)},this.onNegotiationNeeded=function(e,t){},this.addNegotiatedMessage=function(n,o){if(n.type&&n.sdp)return"answer"==n.type&&e.peers[o]&&e.peers[o].addRemoteSdp(n),"offer"==n.type&&(n.renegotiatingPeer?this.renegotiatePeer(o,null,n):this.createAnsweringPeer(n,o)),void e.enableLogs;if(n.candidate)return e.peers[o]&&e.peers[o].addRemoteCandidate(n),void e.enableLogs;if(n.enableMedia){e.session=n.userPreferences.session||e.session,e.session.oneway&&e.attachStreams.length&&(e.attachStreams=[]),n.userPreferences.isDataOnly&&e.attachStreams.length&&(e.attachStreams.length=[]);var r={};e.attachStreams.forEach((function(e){r[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}})),n.userPreferences.streamsToShare=r,t.onNegotiationNeeded({readyForOffer:!0,userPreferences:n.userPreferences},o)}n.readyForOffer&&e.onReadyForOffer(o,n.userPreferences)},this.onGettingRemoteMedia=function(e,t){},this.onRemovingRemoteMedia=function(e,t){},this.onGettingLocalMedia=function(e){},this.onLocalMediaError=function(t,n){e.onMediaError(t,n)},this.shareFile=function(t,n){o(),e.fbr.readAsArrayBuffer(t,(function(t){var o=e.getAllParticipants();n&&(o=[n]),o.forEach((function(n){e.fbr.getNextChunk(t,(function(t){e.peers[n].channels.forEach((function(e){e.send(t)}))}),n)}))}),{userid:e.userid,chunkSize:"Firefox"===DetectRTC.browser.name?15e3:e.chunkSize||0})};var r=new E(e);this.onDataChannelMessage=function(t,n){r.receive(JSON.parse(t),n,e.peers[n]?e.peers[n].extra:{})},this.onDataChannelClosed=function(t,n){t.userid=n,t.extra=e.peers[n]?e.peers[n].extra:{},e.onclose(t)},this.onDataChannelError=function(t,n){t.userid=n,event.extra=e.peers[n]?e.peers[n].extra:{},e.onerror(t)},this.onDataChannelOpened=function(t,n){e.peers[n].channels.length?e.peers[n].channels=[t]:(e.peers[n].channels.push(t),e.onopen({userid:n,extra:e.peers[n]?e.peers[n].extra:{},channel:t}))},this.onPeerStateChanged=function(t){e.onPeerStateChanged(t)},this.onNegotiationStarted=function(e,t){},this.onNegotiationCompleted=function(e,t){},this.getRemoteStreams=function(t){return t=t||e.peers.getAllParticipants()[0],e.peers[t]?e.peers[t].streams:[]}}function i(e,t,n){if("undefined"!=typeof CustomEvent){var o=new CustomEvent(t,{arguments:n,__exposedProps__:n});e.dispatchEvent(o)}}function a(e,t){t.stream&&t.stream&&t.stream.addEventListener&&(t.stream.addEventListener("mute",(function(n){(n=e.streamEvents[t.streamid]).session={audio:"audio"===n.muteType,video:"video"===n.muteType},e.onmute(n)}),!1),t.stream.addEventListener("unmute",(function(n){(n=e.streamEvents[t.streamid]).session={audio:"audio"===n.unmuteType,video:"video"===n.unmuteType},e.onunmute(n)}),!1))}function s(){if(window.crypto&&window.crypto.getRandomValues&&-1===navigator.userAgent.indexOf("Safari")){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),t="",n=0,o=e.length;n<o;n++)t+=e[n].toString(36);return t}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function c(e,t,n){if(n.autoCreateMediaElement){var o=!1;h(e,"video").length||e.isVideo||e.isScreen||(o=!0),"Firefox"===DetectRTC.browser.name&&(n.session.video||n.session.screen)&&(o=!1);var r=document.createElement(o?"audio":"video");if(r.srcObject=e,r.setAttribute("autoplay",!0),r.setAttribute("playsinline",!0),r.setAttribute("controls",!0),r.setAttribute("muted",!1),r.setAttribute("volume",1),"Firefox"===DetectRTC.browser.name){var i="ended";"oninactive"in r&&(i="inactive"),r.addEventListener(i,(function(){if(currentUserMediaRequest.remove(e.idInstance),"local"===e.type){i="ended","oninactive"in e&&(i="inactive"),L.onSyncNeeded(e.streamid,i),n.attachStreams.forEach((function(t,o){e.streamid===t.streamid&&delete n.attachStreams[o]}));var t=[];n.attachStreams.forEach((function(e){e&&t.push(e)})),n.attachStreams=t;var o=n.streamEvents[e.streamid];if(o)return void n.onstreamended(o);this.parentNode&&this.parentNode.removeChild(this)}}),!1)}var a=r.play();if(void 0!==a){var s=!1;setTimeout((function(){s||(s=!0,t(r))}),1e3),a.then((function(){s||(s=!0,t(r))})).catch((function(e){s||(s=!0,t(r))}))}else t(r)}else t({})}function d(e,t){window.removeEventListener(e,t),window.addEventListener(e,t,!1)}function l(e){var t=[];return e.forEach((function(e){e&&t.push(e)})),t}function u(e){return!e.audio&&!e.video&&!e.screen&&e.data}function p(e){return void 0===e}(n="undefined"!=typeof global?global:null)&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},global.console||(global.console={}),void 0===global.console.debug&&(global.console.debug=global.console.info=global.console.error=global.console.log=global.console.log||function(){}),"undefined"==typeof document&&(n.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},document.addEventListener=document.removeEventListener=n.addEventListener=n.removeEventListener=function(){},n.HTMLVideoElement=n.HTMLMediaElement=function(){}),"undefined"==typeof io&&(n.io=function(){return{on:function(e,t){t=t||function(){},"connect"===e&&t()},emit:function(e,t,n){n=n||function(){},"open-room"!==e&&"join-room"!==e||n(!0,t.sessionid,null)}}}),"undefined"==typeof location&&(n.location={protocol:"file:",href:"",hash:"",origin:"self"}),"undefined"==typeof screen&&(n.screen={width:0,height:0}),"undefined"==typeof URL&&(n.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),n.window=global),function(){var e="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";if(y="object"==typeof process&&"object"==typeof process.versions&&process.versions.node&&!process.browser){var t=process.versions.node.toString().replace("v","");e="Nodejs/"+t+" (NodeOS) AppleWebKit/"+t+" (KHTML, like Gecko) Nodejs/"+t+" Nodejs/"+t}!function(t){"undefined"==typeof window&&("undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:e,getUserMedia:function(){}},t.window=global),"undefined"==typeof location&&(t.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(t.screen={width:0,height:0}))}("undefined"!=typeof global?global:window);var n=window.navigator;void 0!==n?(void 0!==n.webkitGetUserMedia&&(n.getUserMedia=n.webkitGetUserMedia),void 0!==n.mozGetUserMedia&&(n.getUserMedia=n.mozGetUserMedia)):n={getUserMedia:function(){},userAgent:e};var o=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(n.userAgent||""),r=!(-1===n.userAgent.indexOf("Edge")||!n.msSaveOrOpenBlob&&!n.msSaveBlob),i=!!window.opera||n.userAgent.indexOf(" OPR/")>=0,a=void 0!==window.InstallTrigger,s=/^((?!chrome|android).)*safari/i.test(n.userAgent),c=!!window.chrome&&!i,d="undefined"!=typeof document&&!!document.documentMode&&!r;function l(e,t){var n=0,o=!1,r=window.setInterval((function(){e()&&(window.clearInterval(r),t(o)),n++>50&&(window.clearInterval(r),t(o=!0))}),10)}var u={Android:function(){return n.userAgent.match(/Android/i)},BlackBerry:function(){return n.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return n.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return n.userAgent.match(/Opera Mini/i)},Windows:function(){return n.userAgent.match(/IEMobile/i)},any:function(){return u.Android()||u.BlackBerry()||u.iOS()||u.Opera()||u.Windows()},getOsName:function(){var e="Unknown OS";return u.Android()&&(e="Android"),u.BlackBerry()&&(e="BlackBerry"),u.iOS()&&(e="iOS"),u.Opera()&&(e="Opera Mini"),u.Windows()&&(e="Windows"),e}};var p="Unknown OS",m="Unknown OS Version";var f,h,v=function(){for(var e,t=n.appVersion,o=n.userAgent,r="-",i=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],a=0;e=i[a];a++)if(e.r.test(o)){r=e.s;break}var s="-";switch(/Windows/.test(r)&&(/Windows (.*)/.test(r)&&(s=/Windows (.*)/.exec(r)[1]),r="Windows"),r){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(o)&&(s=/Mac OS X (10[\.\_\d]+)/.exec(o)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(o)&&(s=/Android ([\.\_\d]+)/.exec(o)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(o)&&(s=(s=/OS (\d+)_(\d+)_?(\d+)?/.exec(t))[1]+"."+s[2]+"."+(0|s[3]))}return{osName:r,osVersion:s}}();v&&v.osName&&"-"!=v.osName?(p=v.osName,m=v.osVersion):u.any()&&"Android"==(p=u.getOsName())&&(m=!!(h=(f=(f||n.userAgent).toLowerCase()).match(/android\s([0-9\.]*)/))&&h[1]);var y="object"==typeof process&&"object"==typeof process.versions&&process.versions.node;"Unknown OS"===p&&y&&(p="Nodejs",m=process.versions.node.toString().replace("v",""));var g=!1,b=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach((function(e){"undefined"!=typeof document&&"function"==typeof document.createElement&&(!g&&e in document.createElement("canvas")&&(g=!0),!b&&e in document.createElement("video")&&(b=!0))}));var k=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,w=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,C=/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/;var T=[],x=[],P=[],R=[];n.mediaDevices&&n.mediaDevices.enumerateDevices&&(n.enumerateDevices=function(e){var t=n.mediaDevices.enumerateDevices();t&&t.then?n.mediaDevices.enumerateDevices().then(e).catch((function(){e([])})):e([])});var O=!1;(void 0!==S&&"getSources"in S||n.mediaDevices&&n.mediaDevices.enumerateDevices)&&(O=!0);var L=!1,E=!1,_=!1,M=!1,D=!1;var I=window.DetectRTC||{};I.browser=function(){n.appVersion;var e,t,o,l=n.userAgent,u=n.appName,p=""+parseFloat(n.appVersion),m=parseInt(n.appVersion,10);if(s&&!c&&-1!==l.indexOf("CriOS")&&(s=!1,c=!0),i){u="Opera";try{m=(p=n.userAgent.split("OPR/")[1].split(" ")[0]).split(".")[0]}catch(f){p="0.0.0.0",m=0}}else d?((t=l.indexOf("rv:"))>0?p=l.substring(t+3):(t=l.indexOf("MSIE"),p=l.substring(t+5)),u="IE"):c?(t=l.indexOf("Chrome"),u="Chrome",p=l.substring(t+7)):s?(t=l.indexOf("Safari"),u="Safari",p=l.substring(t+7),-1!==(t=l.indexOf("Version"))&&(p=l.substring(t+8)),-1!==n.userAgent.indexOf("Version/")&&(p=n.userAgent.split("Version/")[1].split(" ")[0])):a?(t=l.indexOf("Firefox"),u="Firefox",p=l.substring(t+8)):(e=l.lastIndexOf(" ")+1)<(t=l.lastIndexOf("/"))&&(u=l.substring(e,t),p=l.substring(t+1),u.toLowerCase()===u.toUpperCase()&&(u=n.appName));return r&&(u="Edge",p=n.userAgent.split("Edge/")[1]),-1!==(o=p.search(/[; \)]/))&&(p=p.substring(0,o)),m=parseInt(""+p,10),isNaN(m)&&(p=""+parseFloat(n.appVersion),m=parseInt(n.appVersion,10)),{fullVersion:p,version:m,name:u,isPrivateBrowsing:!1}}(),function(e){var t;try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,(function(){t=!1}),(function(e){t=!0}));else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var n;try{(n=window.indexedDB.open("test")).onerror=function(){return!0}}catch(o){t=!0}void 0===t&&l((function(){return"done"===n.readyState}),(function(e){e||(t=!n.result)}))}else if(function(e){var t=e.toLowerCase();if(0===t.indexOf("msie")&&0===t.indexOf("trident"))return!1;var n=/(?:msie|rv:)\s?([\d\.]+)/.exec(t);return!!(n&&parseInt(n[1],10)>=10)}(window.navigator.userAgent)){t=!1;try{window.indexedDB||(t=!0)}catch(o){t=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(o){t=!0}void 0===t&&(t=!1,window.localStorage.removeItem("test"))}}catch(o){t=!1}l((function(){return void 0!==t}),(function(n){e(t)}))}((function(e){I.browser.isPrivateBrowsing=!!e})),I.browser["is"+I.browser.name]=!0,I.osName=p,I.osVersion=m,"object"==typeof process&&"object"==typeof process.versions&&process.versions["node-webkit"];var A=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach((function(e){A||e in window&&(A=!0)})),I.isWebRTCSupported=A,I.isORTCSupported="undefined"!=typeof RTCIceGatherer;var N=!1;((I.browser.isChrome&&I.browser.version>=35||I.browser.isFirefox&&I.browser.version>=34||I.browser.isEdge&&I.browser.version>=17||"Android"===I.osName&&I.browser.isChrome)&&(N=!0),/^(https:|chrome-extension:)$/g.test(location.protocol||""))||("undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(I.browser.isChrome||I.browser.isEdge||I.browser.isOpera)||I.browser.isFirefox)&&(N=!1);I.isScreenCapturingSupported=N;var B={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach((function(e){B.isSupported||e in window&&(B.isSupported=!0,window[e]&&"createMediaStreamSource"in window[e].prototype&&(B.isCreateMediaStreamSourceSupported=!0))})),I.isAudioContextSupported=B.isSupported,I.isCreateMediaStreamSourceSupported=B.isCreateMediaStreamSourceSupported;var V=!1;I.browser.isChrome&&I.browser.version>31&&(V=!0),I.isRtpDataChannelsSupported=V;var j=!1;(I.browser.isFirefox&&I.browser.version>28||I.browser.isChrome&&I.browser.version>25||I.browser.isOpera&&I.browser.version>=11)&&(j=!0),I.isSctpDataChannelsSupported=j,I.isMobileDevice=o;var U=!1;(n.getUserMedia||n.mediaDevices&&n.mediaDevices.getUserMedia)&&(U=!0),I.browser.isChrome&&I.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(U="Requires HTTPs"),"Nodejs"===I.osName&&(U=!1),I.isGetUserMediaSupported=U;var F,z,q,G="";screen.width&&(G+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:""));I.displayResolution=G,I.displayAspectRatio=(F=screen.width,z=screen.height,q=function e(t,n){return 0==n?t:e(n,t%n)}(F,z),F/q/(z/q)).toFixed(2),I.isCanvasSupportsStreamCapturing=g,I.isVideoSupportsStreamCapturing=b,"Chrome"==I.browser.name&&I.browser.version>=53&&(I.isCanvasSupportsStreamCapturing||(I.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),I.isVideoSupportsStreamCapturing||(I.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),I.DetectLocalIPAddress=function(e,t){if(I.isWebRTCSupported){var n=!0,o=!0;!function(e,t){if("undefined"==typeof document||"function"!=typeof document.getElementById)return;var n={},o=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!o){var r=document.getElementById("iframe");if(!r)return;var i=r.contentWindow;o=i.RTCPeerConnection||i.mozRTCPeerConnection||i.webkitRTCPeerConnection}if(!o)return;var a=null;"Chrome"===I.browser&&I.browser.version<58&&(a={optional:[{RtpDataChannels:!0}]});var s=new o({iceServers:[{urls:"stun:stun.l.google.com:19302"}]},a);t&&(s.addStream?s.addStream(t):s.addTrack&&t.getTracks()[0]&&s.addTrack(t.getTracks()[0],t));function c(t){if(t){var o=w.exec(t);if(o){var r=o[1],i=t.match(k),a=!0;void 0===n[r]&&e(r,i,a),n[r]=!0}}else e()}if(s.onicecandidate=function(e){e.candidate&&e.candidate.candidate?c(e.candidate.candidate):c()},!t)try{s.createDataChannel("sctp",{})}catch(l){}I.isPromisesSupported?s.createOffer().then((function(e){s.setLocalDescription(e).then(d)})):s.createOffer((function(e){s.setLocalDescription(e,d,(function(){}))}),(function(){}));function d(){s.localDescription.sdp.split("\n").forEach((function(e){e&&0===e.indexOf("a=candidate:")&&c(e)}))}}((function(t){t?t.match(k)?e("Local: "+t,n=!1,o):t.match(C)?e("Public: "+t,n,o=!1):e("Public: "+t,n,o):e()}),t)}},I.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,I.isWebSocketsBlocked=!I.isWebSocketsSupported,"Nodejs"===I.osName&&(I.isWebSocketsSupported=!0,I.isWebSocketsBlocked=!1),I.checkWebSocketsSupport=function(e){e=e||function(){};try{var t,n=new WebSocket("wss://echo.websocket.org:443/");n.onopen=function(){I.isWebSocketsBlocked=!1,t=(new Date).getTime(),n.send("ping")},n.onmessage=function(){I.WebsocketLatency=(new Date).getTime()-t+"ms",e(),n.close(),n=null},n.onerror=function(){I.isWebSocketsBlocked=!0,e()}}catch(o){I.isWebSocketsBlocked=!0,e()}},I.load=function(e){!function(e){if(O)if(!n.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(n.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!n.enumerateDevices&&n.enumerateDevices&&(n.enumerateDevices=n.enumerateDevices.bind(n)),n.enumerateDevices){T=[],x=[],P=[],R=[],L=!1,E=!1,_=!1,M=!1,D=!1;var t={};n.enumerateDevices((function(n){n.forEach((function(e){var n={};for(var o in e)try{"function"!=typeof e[o]&&(n[o]=e[o])}catch(r){}t[n.deviceId+n.label+n.kind]||("audio"===n.kind&&(n.kind="audioinput"),"video"===n.kind&&(n.kind="videoinput"),n.deviceId||(n.deviceId=n.id),n.id||(n.id=n.deviceId),n.label?("videoinput"!==n.kind||D||(D=!0),"audioinput"!==n.kind||M||(M=!0)):(n.isCustomLabel=!0,"videoinput"===n.kind?n.label="Camera "+(R.length+1):"audioinput"===n.kind?n.label="Microphone "+(x.length+1):"audiooutput"===n.kind?n.label="Speaker "+(P.length+1):n.label="Please invoke getUserMedia once.",void 0!==I&&I.browser.isChrome&&I.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(n.label="HTTPs is required to get label of this "+n.kind+" device.")),"audioinput"===n.kind&&(L=!0,-1===x.indexOf(n)&&x.push(n)),"audiooutput"===n.kind&&(E=!0,-1===P.indexOf(n)&&P.push(n)),"videoinput"===n.kind&&(_=!0,-1===R.indexOf(n)&&R.push(n)),T.push(n),t[n.deviceId+n.label+n.kind]=n)})),void 0!==I&&(I.MediaDevices=T,I.hasMicrophone=L,I.hasSpeakers=E,I.hasWebcam=_,I.isWebsiteHasWebcamPermissions=D,I.isWebsiteHasMicrophonePermissions=M,I.audioInputDevices=x,I.audioOutputDevices=P,I.videoInputDevices=R),e&&e()}))}else e&&e();else e&&e()}(e=e||function(){})},I.MediaDevices=void 0!==T?T:[],I.hasMicrophone=L,I.hasSpeakers=E,I.hasWebcam=_,I.isWebsiteHasWebcamPermissions=D,I.isWebsiteHasMicrophonePermissions=M,I.audioInputDevices=x,I.audioOutputDevices=P,I.videoInputDevices=R;var W=!1;"undefined"!=typeof document&&"function"==typeof document.createElement&&"setSinkId"in document.createElement("video")&&(W=!0),I.isSetSinkIdSupported=W;var H=!1;I.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(H=!0):I.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(H=!0),I.isRTPSenderReplaceTracksSupported=H;var $=!1;I.browser.isFirefox&&I.browser.version>38&&($=!0),I.isRemoteStreamProcessingSupported=$;var J=!1;void 0!==S&&"applyConstraints"in S.prototype&&(J=!0),I.isApplyConstraintsSupported=J;var K=!1;I.browser.isFirefox&&I.browser.version>=43&&(K=!0),I.isMultiMonitorScreenCapturingSupported=K,I.isPromisesSupported=!!("Promise"in window),I.version="1.3.9",void 0===I&&(window.DetectRTC={});var Y=window.MediaStream;void 0===Y&&"undefined"!=typeof webkitMediaStream&&(Y=webkitMediaStream),I.MediaStream=void 0!==Y&&"function"==typeof Y&&Object.keys(Y.prototype),I.MediaStreamTrack=void 0!==S&&Object.keys(S.prototype);var Q=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;I.RTCPeerConnection=void 0!==Q&&Object.keys(Q.prototype),window.DetectRTC=I,"undefined"!=typeof module&&(module.exports=I),"function"==typeof define&&define.amd&&define("DetectRTC",[],(function(){return I}))}(),"undefined"!=typeof cordova&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Crosswalk")&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),window.addEventListener||(window.addEventListener=function(e,t,n){e.attachEvent&&e.attachEvent("on"+t,n)}),window.attachEventListener=function(e,t,n,o){e.addEventListener(t,n,o)};var m=window.MediaStream;function f(e,t){return(!e.session.audio||"two-way"!==e.session.audio)&&("Firefox"===DetectRTC.browser.name&&!1!==t||!("Chrome"!==DetectRTC.browser.name||DetectRTC.browser.version<50)&&(!0===typeof t||!(void 0!==t||!e.session.audio||!e.session.screen||e.session.video)&&(t=!0,!0)))}function h(e,t){return e&&e.getTracks?e.getTracks().filter((function(e){return e.kind===(t||"audio")})):[]}function v(){var e=!1;try{if("undefined"==typeof RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var t=new g;try{t.addTransceiver("audio"),e=!0}catch(n){}t.close()}catch(n){e=!1}return e&&function(){var e=!1;try{var t=new g({sdpSemantics:"unified-plan"});try{var o=t.getConfiguration();e="unified-plan"==o.sdpSemantics||(o.sdpSemantics,!1)}catch(n){e=!1}}catch(n){e=!1}return e}()}function y(){if("undefined"!=typeof cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc){var e=cordova.plugins.iosrtc;window.webkitRTCPeerConnection=e.RTCPeerConnection,window.RTCSessionDescription=e.RTCSessionDescription,window.RTCIceCandidate=e.RTCIceCandidate,window.MediaStream=e.MediaStream,window.MediaStreamTrack=e.MediaStreamTrack,navigator.getUserMedia=navigator.webkitGetUserMedia=e.getUserMedia,e.debug.enable("iosrtc*"),"function"==typeof e.selectAudioOutput&&e.selectAudioOutput(window.iOSDefaultAudioOutputDevice||"speaker"),e.registerGlobals()}}void 0===m&&"undefined"!=typeof webkitMediaStream&&(m=webkitMediaStream),void 0!==m&&("stop"in m.prototype||(m.prototype.stop=function(){this.getTracks().forEach((function(e){e.stop()}))})),window.iOSDefaultAudioOutputDevice=window.iOSDefaultAudioOutputDevice||"speaker",document.addEventListener("deviceready",y,!1),y();var g,b={};function k(e){return{OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo}}void 0!==window.RTCPeerConnection?g=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?g=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(g=webkitRTCPeerConnection);var w=window.RTCSessionDescription||window.mozRTCSessionDescription,C=window.RTCIceCandidate||window.mozRTCIceCandidate,S=window.MediaStreamTrack;function T(e){if(void 0!==window.RTCPeerConnection?g=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?g=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(g=webkitRTCPeerConnection),w=window.RTCSessionDescription||window.mozRTCSessionDescription,C=window.RTCIceCandidate||window.mozRTCIceCandidate,S=window.MediaStreamTrack,!g)throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser.";var t=e.rtcMultiConnection;this.extra=e.remoteSdp?e.remoteSdp.extra:t.extra,this.userid=e.userid,this.streams=[],this.channels=e.channels||[],this.connectionDescription=e.connectionDescription,this.addStream=function(e){t.addStream(e,n.userid)},this.removeStream=function(e){t.removeStream(e,n.userid)};var n=this;e.remoteSdp&&(this.connectionDescription=e.remoteSdp.connectionDescription);var o,r={};b.sdpConstraints=k({OfferToReceiveAudio:!0,OfferToReceiveVideo:!0});var i=!!e.renegotiatingPeer;e.remoteSdp&&(i=!!e.remoteSdp.renegotiatingPeer);var a=[];if(t.attachStreams.forEach((function(e){e&&a.push(e)})),i)o=e.peerRef;else{var s="all";(t.candidates.turn||t.candidates.relay)&&(t.candidates.stun||t.candidates.reflexive||t.candidates.host||(s="relay"));try{var c={iceServers:t.iceServers,iceTransportPolicy:t.iceTransportPolicy||s};void 0!==t.iceCandidatePoolSize&&(c.iceCandidatePoolSize=t.iceCandidatePoolSize),void 0!==t.bundlePolicy&&(c.bundlePolicy=t.bundlePolicy),void 0!==t.rtcpMuxPolicy&&(c.rtcpMuxPolicy=t.rtcpMuxPolicy),t.sdpSemantics&&(c.sdpSemantics=t.sdpSemantics||"unified-plan"),t.iceServers&&t.iceServers.length||(c=null,t.optionalArgument=null),o=new g(c,t.optionalArgument)}catch(y){try{c={iceServers:t.iceServers};o=new g(c)}catch(T){o=new g}}}!o.getRemoteStreams&&o.getReceivers&&(o.getRemoteStreams=function(){var e=new m;return o.getReceivers().forEach((function(t){e.addTrack(t.track)})),[e]}),!o.getLocalStreams&&o.getSenders&&(o.getLocalStreams=function(){var e=new m;return o.getSenders().forEach((function(t){e.addTrack(t.track)})),[e]}),o.onicecandidate=function(r){if(r.candidate)t.trickleIce&&e.onLocalCandidate({candidate:r.candidate.candidate,sdpMid:r.candidate.sdpMid,sdpMLineIndex:r.candidate.sdpMLineIndex});else if(!t.trickleIce){var i=o.localDescription;e.onLocalSdp({type:i.type,sdp:i.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:n.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:t?t.extra:{},streamsToShare:f})}},a.forEach((function(r){e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream||e.dontAttachLocalStream||(r=t.beforeAddingStream(r,n))&&(o.getLocalStreams().forEach((function(e){r&&e.id==r.id&&(r=null)})),r&&r.getTracks&&r.getTracks().forEach((function(e){try{o.addTrack(e,r)}catch(y){}})))})),o.oniceconnectionstatechange=o.onsignalingstatechange=function(){var r=n.extra;t.peers[n.userid]&&(r=t.peers[n.userid].extra||r),o&&(e.onPeerStateChanged({iceConnectionState:o.iceConnectionState,iceGatheringState:o.iceGatheringState,signalingState:o.signalingState,extra:r,userid:n.userid}),o&&o.iceConnectionState&&-1!==o.iceConnectionState.search(/closed|failed/gi)&&n.streams instanceof Array&&n.streams.forEach((function(e){var n=t.streamEvents[e.id]||{streamid:e.id,stream:e,type:"remote"};t.onstreamended(n)})))};var d={OfferToReceiveAudio:!!a.length,OfferToReceiveVideo:!!a.length};e.localPeerSdpConstraints&&(d=e.localPeerSdpConstraints),b.sdpConstraints=k(d);var l={};o.ontrack=function(t){if(t&&"track"===t.type)if(t.stream=t.streams[t.streams.length-1],t.stream.id||(t.stream.id=t.track.id),l[t.stream.id]&&"Safari"!==DetectRTC.browser.name)t.track&&(t.track.onended=function(){o&&o.onremovestream(t)});else{l[t.stream.id]=t.stream.id;var n={};e.remoteSdp&&e.remoteSdp.streamsToShare?n=e.remoteSdp.streamsToShare:e.streamsToShare&&(n=e.streamsToShare);var i=n[t.stream.id];i?(t.stream.isAudio=i.isAudio,t.stream.isVideo=i.isVideo,t.stream.isScreen=i.isScreen):(t.stream.isVideo=!!h(t.stream,"video").length,t.stream.isAudio=!t.stream.isVideo,t.stream.isScreen=!1),t.stream.streamid=t.stream.id,r[t.stream.id]=t.stream,e.onRemoteStream(t.stream),t.stream.getTracks().forEach((function(e){e.onended=function(){o&&o.onremovestream(t)}})),t.stream.onremovetrack=function(){o&&o.onremovestream(t)}}},o.onremovestream=function(t){t.stream.streamid=t.stream.id,r[t.stream.id]&&delete r[t.stream.id],e.onRemoteStreamRemoved(t.stream)},"function"!=typeof o.removeStream&&(o.removeStream=function(e){e.getTracks().forEach((function(t){o.removeTrack(t,e)}))}),this.addRemoteCandidate=function(e){o.addIceCandidate(new C(e))},this.addRemoteSdp=function(e,n){n=n||function(){},"Safari"!==DetectRTC.browser.name&&(e.sdp=t.processSdp(e.sdp)),o.setRemoteDescription(new w(e)).then(n,(function(e){t.enableLogs,n()})).catch((function(e){t.enableLogs,n()}))};var u=!0;function p(t){t.binaryType="arraybuffer",t.onmessage=function(t){e.onDataChannelMessage(t.data)},t.onopen=function(){e.onDataChannelOpened(t)},t.onerror=function(t){e.onDataChannelError(t)},t.onclose=function(t){e.onDataChannelClosed(t)},t.internalSend=t.send,t.send=function(e){"open"===t.readyState&&t.internalSend(e)},o.channel=t}e.remoteSdp&&(u=!1),this.createDataChannel=function(){p(o.createDataChannel("sctp",{}))},!0!==t.session.data||i||(u?this.createDataChannel():o.ondatachannel=function(e){p(e.channel)}),this.enableDisableVideoEncoding=function(e){var t;if(o.getSenders().forEach((function(e){t||"video"!==e.track.kind||(t=e)})),t&&t.getParameters){var n=t.getParameters();n.encodings[1]&&(n.encodings[1].active=!!e),n.encodings[2]&&(n.encodings[2].active=!!e),t.setParameters(n)}},e.remoteSdp&&(e.remoteSdp.remotePeerSdpConstraints&&(d=e.remoteSdp.remotePeerSdpConstraints),b.sdpConstraints=k(d),this.addRemoteSdp(e.remoteSdp,(function(){v("createAnswer")}))),"two-way"!=t.session.audio&&"two-way"!=t.session.video&&"two-way"!=t.session.screen||(b.sdpConstraints=k({OfferToReceiveAudio:"two-way"==t.session.audio||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio,OfferToReceiveVideo:"two-way"==t.session.video||"two-way"==t.session.screen||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio}));var f={};function v(r){o[r](b.sdpConstraints).then((function(r){"Safari"!==DetectRTC.browser.name&&(r.sdp=t.processSdp(r.sdp)),o.setLocalDescription(r).then((function(){t.trickleIce&&(e.onLocalSdp({type:r.type,sdp:r.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:n.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:t?t.extra:{},streamsToShare:f}),t.onSettingLocalDescription(n))}),(function(e){t.enableLogs}))}),(function(e){t.enableLogs}))}o.getLocalStreams().forEach((function(e){f[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}})),u&&v("createOffer"),o.nativeClose=o.close,o.close=function(){if(o){try{o.nativeClose!==o.close&&o.nativeClose()}catch(y){}o=null,n.peer=null}},this.peer=o}var x=function(){function e(e,o){var r=n(e);return r.videoCodecNumbers?"vp8"===o&&r.vp8LineNumber===r.videoCodecNumbers[0]||"vp9"===o&&r.vp9LineNumber===r.videoCodecNumbers[0]||"h264"===o&&r.h264LineNumber===r.videoCodecNumbers[0]?e:e=t(e,o,r):e}function t(e,t,n,o){var r="";if("vp8"===t){if(!n.vp8LineNumber)return e;r=n.vp8LineNumber}if("vp9"===t){if(!n.vp9LineNumber)return e;r=n.vp9LineNumber}if("h264"===t){if(!n.h264LineNumber)return e;r=n.h264LineNumber}var i=n.videoCodecNumbersOriginal.split("SAVPF")[0]+"SAVPF ",a=[r];return o&&(a=[]),n.videoCodecNumbers.forEach((function(e){e!==r&&a.push(e)})),i+=a.join(" "),e=e.replace(n.videoCodecNumbersOriginal,i)}function n(e){var t={};return e.split("\n").forEach((function(e){0===e.indexOf("m=video")&&(t.videoCodecNumbers=[],e.split("SAVPF")[1].split(" ").forEach((function(n){(n=n.trim())&&n.length&&(t.videoCodecNumbers.push(n),t.videoCodecNumbersOriginal=e)}))),-1===e.indexOf("VP8/90000")||t.vp8LineNumber||(t.vp8LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("VP9/90000")||t.vp9LineNumber||(t.vp9LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("H264/90000")||t.h264LineNumber||(t.h264LineNumber=e.replace("a=rtpmap:","").split(" ")[0])})),t}function o(e,t,n){return function(e,t,n,o,r){for(var i=-1!==n?n:e.length,a=t;a<i;++a)if(0===e[a].indexOf(o)&&(!r||-1!==e[a].toLowerCase().indexOf(r.toLowerCase())))return a;return null}(e,0,-1,t,n)}function r(e){var t=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),n=e.match(t);return n&&2===n.length?n[1]:null}return{removeVPX:function(e){var o=n(e);return e=t(e,"vp9",o,!0),e=t(e,"vp8",o,!0)},disableNACK:function(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return e=(e=(e=(e=e.replace("a=rtcp-fb:126 nack\r\n","")).replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n")).replace("a=rtcp-fb:97 nack\r\n","")).replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n")},prioritize:function(e,t){if(t&&t.getSenders&&t.getSenders().length){if(!e||"string"!=typeof e)throw"Invalid arguments.";t.getSenders().forEach((function(t){for(var n=t.getParameters(),o=0;o<n.codecs.length;o++)if(n.codecs[o].mimeType==e){n.codecs.unshift(n.codecs.splice(o,1));break}t.setParameters(n)}))}},removeNonG722:function(e){return e.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")},setApplicationSpecificBandwidth:function(e,t,n){return function(e,t,n){return t?("undefined"!=typeof isFirefox&&isFirefox||(n&&t.screen&&t.screen,t.screen&&n&&(e=(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")).replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.screen+"\r\n")),(t.audio||t.video)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),t.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+t.audio+"\r\n")),t.screen?e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.screen+"\r\n"):t.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.video+"\r\n"))),e):e}(e,t,n)},setVideoBitrates:function(e,t){return function(e,t){var n,i=(t=t||{}).min,a=t.max,s=e.split("\r\n"),c=o(s,"a=rtpmap","VP8/90000");if(c&&(n=r(s[c])),!n)return e;var d,l=o(s,"a=rtpmap","rtx/90000");if(l&&(d=r(s[l])),!l)return e;var u=o(s,"a=fmtp:"+d.toString());if(null!==u){var p="\r\n";p+="a=fmtp:"+n+" x-google-min-bitrate="+(i||"228")+"; x-google-max-bitrate="+(a||"228"),s[u]=s[u].concat(p),e=s.join("\r\n")}return e}(e,t)},setOpusAttributes:function(e,t){return function(e,t){t=t||{};var n,i=e.split("\r\n"),a=o(i,"a=rtpmap","opus/48000");if(a&&(n=r(i[a])),!n)return e;var s=o(i,"a=fmtp:"+n.toString());if(null===s)return e;var c="";return c+="; stereo="+(void 0!==t.stereo?t.stereo:"1"),c+="; sprop-stereo="+(void 0!==t["sprop-stereo"]?t["sprop-stereo"]:"1"),void 0!==t.maxaveragebitrate&&(c+="; maxaveragebitrate="+(t.maxaveragebitrate||1048576)),void 0!==t.maxplaybackrate&&(c+="; maxplaybackrate="+(t.maxplaybackrate||1048576)),void 0!==t.cbr&&(c+="; cbr="+(void 0!==t.cbr?t.cbr:"1")),void 0!==t.useinbandfec&&(c+="; useinbandfec="+t.useinbandfec),void 0!==t.usedtx&&(c+="; usedtx="+t.usedtx),void 0!==t.maxptime&&(c+="\r\na=maxptime:"+t.maxptime),i[s]=i[s].concat(c),i.join("\r\n")}(e,t)},preferVP9:function(t){return e(t,"vp9")},preferCodec:e,forceStereoAudio:function(e){for(var t=e.split("\r\n"),n=null,o=0;o<t.length;o++)if(-1!==t[o].search("opus/48000")){var r=extractSdp(t[o],/:(\d+) opus\/48000/i);break}for(o=0;o<t.length;o++){if(-1!==t[o].search("a=fmtp"))if(extractSdp(t[o],/a=fmtp:(\d+)/)===r){n=o;break}}return null===n?e:(t[n]=t[n].concat("; stereo=1; sprop-stereo=1"),e=t.join("\r\n"))}}}();window.BandwidthHandler=x;var P={processCandidates:function(e,t){var n=t.candidate,o=e.candidates,r=o.stun,i=o.turn;if(p(o.reflexive)||(r=o.reflexive),p(o.relay)||(i=o.relay),(o.host||!n.match(/typ host/g))&&(i||!n.match(/typ relay/g))&&(r||!n.match(/typ srflx/g))){var a=e.iceProtocols;if((a.udp||!n.match(/ udp /g))&&(a.tcp||!n.match(/ tcp /g)))return e.enableLogs,{candidate:n,sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex}}}},R={getIceServers:function(e){return[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun.l.google.com:19302?transport=udp"]}]}};function O(e){if(!0!==currentUserMediaRequest.mutex){currentUserMediaRequest.mutex=!0;var t=JSON.stringify(e.localMediaConstraints);if(currentUserMediaRequest.streams[t])i(currentUserMediaRequest.streams[t].stream,!0);else{if(!!/BB10|BlackBerry/i.test(navigator.userAgent||"")||void 0===navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia)return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,void navigator.getUserMedia(e.localMediaConstraints,(function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=t,i(e)}),(function(t){e.onLocalMediaError(t,e.localMediaConstraints)}));if(void 0===navigator.mediaDevices){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var n,o,r=function(){};navigator.mediaDevices={getUserMedia:function(e){return navigator.getUserMedia(e,(function(e){e(stream),n=stream}),(function(e){r(e),o=e})),{then:function(e){if(!n)return{then:function(e){o?e(o):r=e}};e(n)}}}}}if(!0===e.localMediaConstraints.isScreen){if(navigator.mediaDevices.getDisplayMedia)navigator.mediaDevices.getDisplayMedia(e.localMediaConstraints).then((function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=t,i(e)})).catch((function(t){e.onLocalMediaError(t,e.localMediaConstraints)}));else{if(!navigator.getDisplayMedia)throw new Error("getDisplayMedia API is not availabe in this browser.");navigator.getDisplayMedia(e.localMediaConstraints).then((function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=t,i(e)})).catch((function(t){e.onLocalMediaError(t,e.localMediaConstraints)}))}return}navigator.mediaDevices.getUserMedia(e.localMediaConstraints).then((function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=t,i(e)})).catch((function(t){e.onLocalMediaError(t,e.localMediaConstraints)}))}}else currentUserMediaRequest.queueRequests.push(e);function i(n,o){!function(e,t){e.mandatory&&e.mandatory.chromeMediaSource||e.mozMediaSource||e.mediaSource?t.isScreen=!0:e.video?t.isVideo=!0:e.audio&&(t.isAudio=!0)}(e.localMediaConstraints,n);var r="ended";"oninactive"in n&&(r="inactive"),n.addEventListener(r,(function(){delete currentUserMediaRequest.streams[t],currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.indexOf(e)&&(delete currentUserMediaRequest.queueRequests[currentUserMediaRequest.queueRequests.indexOf(e)],currentUserMediaRequest.queueRequests=l(currentUserMediaRequest.queueRequests))}),!1),currentUserMediaRequest.streams[t]={stream:n},currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.length&&O(currentUserMediaRequest.queueRequests.shift()),e.onGettingLocalMedia(n,o)}}window.currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[],remove:function(e){this.mutex=!1;var t=this.streams[e];if(t){var n=(t=t.stream).currentUserMediaRequestOptions;this.queueRequests.indexOf(n)&&(delete this.queueRequests[this.queueRequests.indexOf(n)],this.queueRequests=l(this.queueRequests)),this.streams[e].stream=null,delete this.streams[e]}}};var L=function(){function e(e){if(e)return"string"==typeof e||void 0===e?e:e.audio&&e.video?null:e.audio?"audio":e.video?"video":void 0}function t(e,n,o,r){(r=(r||0)+1)>=n||setTimeout((function(){o(),t(e,n,o,r)}),e)}return{setHandlers:function(n,o,r){if(n&&n.addEventListener){if(void 0===o||1==o){var a="ended";"oninactive"in n&&(a="inactive"),n.addEventListener(a,(function(){L.onSyncNeeded(this.streamid,a)}),!1)}n.mute=function(t,a){t=e(t),void 0!==a&&(o=a),void 0!==t&&"audio"!=t||h(n,"audio").forEach((function(e){e.enabled=!1,r.streamEvents[n.streamid].isAudioMuted=!0})),void 0!==t&&"video"!=t||h(n,"video").forEach((function(e){e.enabled=!1})),void 0!==o&&1!=o||L.onSyncNeeded(n.streamid,"mute",t),r.streamEvents[n.streamid].muteType=t||"both",i(n,"mute",t)},n.unmute=function(a,s){a=e(a),void 0!==s&&(o=s),function(){if(!r.streamEvents[n.streamid].mediaElement)return;var e=r.streamEvents[n.streamid].mediaElement;e.volume=0,t(200,5,(function(){try{e.volume+=.2}catch(t){e.volume=1}}))}(),void 0!==a&&"audio"!=a||h(n,"audio").forEach((function(e){e.enabled=!0,r.streamEvents[n.streamid].isAudioMuted=!1})),void 0!==a&&"video"!=a||(h(n,"video").forEach((function(e){e.enabled=!0})),void 0!==a&&"video"==a&&r.streamEvents[n.streamid].isAudioMuted&&function e(t){t||(t=0),++t<100&&r.streamEvents[n.streamid].isAudioMuted&&(n.mute("audio"),setTimeout((function(){e(t)}),50))}()),void 0!==o&&1!=o||L.onSyncNeeded(n.streamid,"unmute",a),r.streamEvents[n.streamid].unmuteType=a||"both",i(n,"unmute",a)}}},onSyncNeeded:function(e,t,n){}}}();function E(e){var t={};return{receive:function(n,o,r){var i=n.uuid;if(t[i]||(t[i]=[]),t[i].push(n.message),n.last){var a=t[i].join("");n.isobject&&(a=JSON.parse(a));var s={data:a,userid:o,extra:r,latency:(new Date).getTime()-n.sendingTime};e.autoTranslateText?(s.original=s.data,e.Translator.TranslateText(s.data,(function(t){s.data=t,e.onmessage(s)}))):e.onmessage(s),delete t[i]}}}}var _={send:function(e){var t=e.connection,n=e.channel,o=e.remoteUserId,r=e.text,i=t.chunkSize||1e3,a="",c=!1;"string"!=typeof r&&(c=!0,r=JSON.stringify(r));var d=s(),l=(new Date).getTime();!function e(r,s){var u={type:"text",uuid:d,sendingTime:l};r&&(s=r,u.packets=parseInt(s.length/i));s.length>i?u.message=s.slice(0,i):(u.message=s,u.last=!0,u.isobject=c);n.send(u,o),(a=s.slice(u.message.length)).length&&setTimeout((function(){e(null,a)}),t.chunkInterval||100)}(r)}},M={handle:function(e){var t={};e.onFileStart=function(n){var o=document.createElement("div");if(o.title=n.name,o.innerHTML="<label>0%</label> <progress></progress>",n.remoteUserId&&(o.innerHTML+=" (Sharing with:"+n.remoteUserId+")"),e.filesContainer||(e.filesContainer=document.body||document.documentElement),e.filesContainer.insertBefore(o,e.filesContainer.firstChild),!n.remoteUserId)return t[n.uuid]={div:o,progress:o.querySelector("progress"),label:o.querySelector("label")},void(t[n.uuid].progress.max=n.maxChunks);t[n.uuid]||(t[n.uuid]={}),t[n.uuid][n.remoteUserId]={div:o,progress:o.querySelector("progress"),label:o.querySelector("label")},t[n.uuid][n.remoteUserId].progress.max=n.maxChunks},e.onFileProgress=function(e){var n=t[e.uuid];n&&(e.remoteUserId&&!(n=t[e.uuid][e.remoteUserId])||(n.progress.value=e.currentPosition||e.maxChunks||n.progress.max,function(e,t){if(-1!==e.position){var n=+e.position.toFixed(2).split(".")[1]||100;t.innerHTML=n+"%"}}(n.progress,n.label)))},e.onFileEnd=function(e){var n=t[e.uuid];if(n&&(!e.remoteUserId||(n=t[e.uuid][e.remoteUserId]))){var o=n.div;-1!=e.type.indexOf("image")?o.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><img src="'+e.url+'" title="'+e.name+'" style="max-width: 80%;">':o.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><iframe src="'+e.url+'" title="'+e.name+'" style="width: 80%;border: 0;height: inherit;margin-top:1em;"></iframe>'}}}},D={handle:function(e){e.autoTranslateText=!1,e.language="en",e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.Translator={TranslateText:function(t,n){var o=document.createElement("script");o.type="text/javascript";var r=encodeURIComponent(t),i="method"+e.token();window[i]=function(e){e.data&&e.data.translations[0]&&n?n(e.data.translations[0].translatedText):e.error&&"Daily Limit Exceeded"===e.error.message||e.error};var a="https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+i+"&q="+r;o.src=a,document.getElementsByTagName("head")[0].appendChild(o)},getListOfLanguages:function(t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE){var e=JSON.parse(n.responseText);if(e&&e.data&&e.data.languages)return void t(e.data.languages);if(e.error&&"Daily Limit Exceeded"===e.error.message)return;if(e.error)return}};var o="https://www.googleapis.com/language/translate/v2/languages?key="+e.googKey+"&target=en";n.open("GET",o,!0),n.send(null)}}}};!function(n){t=t||{useDefaultDevices:!0},n.channel=n.sessionid=(e||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""))+"";var i=new r(n),l={};function p(e){if(n.socketAutoReConnect=!0,n.socket)e&&e(n.socket);else{if(void 0===o)if("undefined"!=typeof FirebaseConnection)window.SocketConnection=FirebaseConnection;else{if("undefined"==typeof PubNubConnection)throw"SocketConnection.js seems missed.";window.SocketConnection=PubNubConnection}new o(n,(function(t){e&&e(n.socket)}))}}function y(e,t){n.socket.emit("join-room",{sessionid:n.sessionid,session:n.session,mediaConstraints:n.mediaConstraints,sdpConstraints:n.sdpConstraints,streams:k(),extra:n.extra,password:void 0!==n.password&&"object"!=typeof n.password?n.password:""},(function(o,r){if(!0===o){if(n.enableLogs,n.peers[n.sessionid])return;i.onNegotiationNeeded(e)}!1===o&&n.enableLogs,t(o,n.sessionid,r)}))}function b(e){n.enableLogs,n.waitingForLocalMedia=!1,n.socket.emit("open-room",{sessionid:n.sessionid,session:n.session,mediaConstraints:n.mediaConstraints,sdpConstraints:n.sdpConstraints,streams:k(),extra:n.extra,identifier:n.publicRoomIdentifier,password:void 0!==n.password&&"object"!=typeof n.password?n.password:""},(function(t,o){!0===t&&(n.enableLogs,e(t,n.sessionid)),!1===t&&(n.enableLogs,e(t,n.sessionid,o))}))}function k(){try{return n.streamEvents.selectAll("local").map((function(e){return{streamid:e.streamid,tracks:e.stream.getTracks().length}}))}catch(e){return[]}}function w(e,t){if(n.dontCaptureUserMedia||e.isDataOnly)t();else{e.localPeerSdpConstraints.OfferToReceiveAudio&&n.mediaConstraints.audio,e.localPeerSdpConstraints.OfferToReceiveVideo&&n.mediaConstraints.video;var o=e.session||n.session;o.oneway&&"two-way"!==o.audio&&"two-way"!==o.video&&"two-way"!==o.screen?t():(o.oneway&&o.audio&&"two-way"===o.audio&&(o={audio:!0}),(o.audio||o.video||o.screen)&&(o.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:f(n)}).then((function(e){e.isScreen=!0,i.onGettingLocalMedia(e),!o.audio&&!o.video||f(n)?t(e):n.invokeGetUserMedia(null,t)}),(function(e){})):n.invokeGetUserMedia({audio:f(n),video:!0,isScreen:!0},!o.audio&&!o.video||f(n)?t:n.invokeGetUserMedia(null,t)):(o.audio||o.video)&&n.invokeGetUserMedia(null,t,o)))}}function C(e,t){e?(t.audio&&h(e,"audio").forEach((function(e){e.applyConstraints(t.audio)})),t.video&&h(e,"video").forEach((function(e){e.applyConstraints(t.video)}))):n.enableLogs}function T(e,t,o){t?i.replaceTrack(e,t,o):n.peers.getAllParticipants().forEach((function(t){i.replaceTrack(e,t,o)}))}i.onGettingLocalMedia=function(e,t){if(t=t||function(){},l[e.streamid])t();else{l[e.streamid]=!0;try{e.type="local"}catch(o){}n.setStreamEndHandler(e),c(e,(function(r){r.id=e.streamid,r.muted=!0,r.volume=0,-1===n.attachStreams.indexOf(e)&&n.attachStreams.push(e),void 0!==L&&L.setHandlers(e,!0,n);var i=0===e.getAudioTracks().filter((function(e){return e.enabled})).length;n.streamEvents[e.streamid]={stream:e,type:"local",mediaElement:r,userid:n.userid,extra:n.extra,streamid:e.streamid,isAudioMuted:i};try{!function(e,t){if(t.stream&&h(t.stream,"audio").length){if(!e||!t)throw"Both arguments are required.";if(e.onspeaking&&e.onsilence){if("undefined"==typeof hark)throw"hark.js not found.";hark(t.stream,{onspeaking:function(){e.onspeaking(t)},onsilence:function(){e.onsilence(t)},onvolumechange:function(n,o){e.onvolumechange&&e.onvolumechange(merge({volume:n,threshold:o},t))}})}}}(n,n.streamEvents[e.streamid]),a(n,n.streamEvents[e.streamid]),n.onstream(n.streamEvents[e.streamid])}catch(o){}t()}),n)}},i.onGettingRemoteMedia=function(e,t){try{e.type="remote"}catch(o){}n.setStreamEndHandler(e,"remote-stream"),c(e,(function(o){o.id=e.streamid,void 0!==L&&L.setHandlers(e,!1,n),n.streamEvents[e.streamid]={stream:e,type:"remote",userid:t,extra:n.peers[t]?n.peers[t].extra:{},mediaElement:o,streamid:e.streamid},a(n,n.streamEvents[e.streamid]),n.onstream(n.streamEvents[e.streamid])}),n)},i.onRemovingRemoteMedia=function(e,t){var o=n.streamEvents[e.streamid];o||(o={stream:e,type:"remote",userid:t,extra:n.peers[t]?n.peers[t].extra:{},streamid:e.streamid,mediaElement:n.streamEvents[e.streamid]?n.streamEvents[e.streamid].mediaElement:null}),n.peersBackup[o.userid]&&(o.extra=n.peersBackup[o.userid].extra),n.onstreamended(o),delete n.streamEvents[e.streamid]},i.onNegotiationNeeded=function(e,t,o){o=o||function(){};var r={remoteUserId:t=t||e.remoteUserId,message:e=e||"",sender:n.userid};e.remoteUserId&&e.message&&e.sender&&(r=e),p((function(){n.socket.emit(n.socketMessageEvent,r,o)}))},i.onUserLeft=function(e){n.deletePeer(e)},i.disconnectWith=function(e,t){n.socket&&n.socket.emit("disconnect-with",e,t||function(){}),n.deletePeer(e)},n.socketOptions={transport:"polling"},n.openOrJoin=function(e,t){t=t||function(){},n.checkPresence(e,(function(e,o){if(e){n.sessionid=o;var r,i,a=!!n.session.oneway,s=u(n.session);i={OfferToReceiveAudio:n.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:n.sdpConstraints.mandatory.OfferToReceiveVideo},r={OfferToReceiveAudio:a?!!n.session.audio:n.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:a?!!n.session.video||!!n.session.screen:n.sdpConstraints.mandatory.OfferToReceiveVideo};var c={remoteUserId:n.sessionid,message:{newParticipationRequest:!0,isOneWay:a,isDataOnly:s,localPeerSdpConstraints:r,remotePeerSdpConstraints:i},sender:n.userid};w(c.message,(function(){y(c,t)}))}else n.waitingForLocalMedia=!0,n.isInitiator=!0,n.sessionid=o||n.sessionid,u(n.session)?b(t):n.captureUserMedia((function(){b(t)}))}))},n.waitingForLocalMedia=!1,n.open=function(e,t){t=t||function(){},n.waitingForLocalMedia=!0,n.isInitiator=!0,n.sessionid=e||n.sessionid,p((function(){u(n.session)?b(t):n.captureUserMedia((function(){b(t)}))}))},n.peersBackup={},n.deletePeer=function(e){if(e&&n.peers[e]){var t={userid:e,extra:n.peers[e]?n.peers[e].extra:{}};if(n.peersBackup[t.userid]&&(t.extra=n.peersBackup[t.userid].extra),n.onleave(t),n.peers[e]){n.peers[e].streams.forEach((function(e){e.stop()}));var o=n.peers[e].peer;if(o&&"closed"!==o.iceConnectionState)try{o.close()}catch(r){}n.peers[e]&&(n.peers[e].peer=null,delete n.peers[e])}}},n.rejoin=function(e){if(!n.isInitiator&&e&&Object.keys(e).length){var t={};n.peers[e.remoteUserId]&&(t=n.peers[e.remoteUserId].extra,n.deletePeer(e.remoteUserId)),e&&e.remoteUserId&&(n.join(e.remoteUserId),n.onReConnecting({userid:e.remoteUserId,extra:t}))}},n.join=function(e,t){n.sessionid=!!e&&(e.sessionid||e.remoteUserId||e)||n.sessionid,n.sessionid+="";var o=!1,r=!1,i=!1,a=!1;if(e&&e.session||!e||"string"==typeof e){var s=e&&e.session||n.session;i=!!s.oneway,a=u(s),r={OfferToReceiveAudio:n.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:n.sdpConstraints.mandatory.OfferToReceiveVideo},o={OfferToReceiveAudio:i?!!n.session.audio:n.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:i?!!n.session.video||!!n.session.screen:n.sdpConstraints.mandatory.OfferToReceiveVideo}}var c=function(){};"function"==typeof(t=t||{})&&(c=t,t={}),void 0!==t.localPeerSdpConstraints&&(o=t.localPeerSdpConstraints),void 0!==t.remotePeerSdpConstraints&&(r=t.remotePeerSdpConstraints),void 0!==t.isOneWay&&(i=t.isOneWay),void 0!==t.isDataOnly&&(a=t.isDataOnly);var d={remoteUserId:n.sessionid,message:{newParticipationRequest:!0,isOneWay:i,isDataOnly:a,localPeerSdpConstraints:o,remotePeerSdpConstraints:r},sender:n.userid};return w(d.message,(function(){p((function(){y(d,c)}))})),d},n.publicRoomIdentifier="",n.getUserMedia=n.captureUserMedia=function(e,t){e=e||function(){};var o=t||n.session;n.dontCaptureUserMedia||u(o)?e():(o.audio||o.video||o.screen)&&(o.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:f(n)}).then((function(r){if(r.isScreen=!0,i.onGettingLocalMedia(r),!o.audio&&!o.video||f(n))e(r);else{var a={};for(var s in o)"screen"!==s&&(a[s]=o[s]);n.invokeGetUserMedia(t,e,a)}}),(function(e){})):n.invokeGetUserMedia({audio:f(n),video:!0,isScreen:!0},(function(r){if(!o.audio&&!o.video||f(n))e(r);else{var i={};for(var a in o)"screen"!==a&&(i[a]=o[a]);n.invokeGetUserMedia(t,e,i)}})):(o.audio||o.video)&&n.invokeGetUserMedia(t,e,o))},n.onbeforeunload=function(e,t){n.closeBeforeUnload&&(n.peers.getAllParticipants().forEach((function(e){i.onNegotiationNeeded({userLeft:!0},e),n.peers[e]&&n.peers[e].peer&&n.peers[e].peer.close(),delete n.peers[e]})),t||n.closeSocket(),n.isInitiator=!1)},window.ignoreBeforeUnload?n.closeBeforeUnload=!1:(n.closeBeforeUnload=!0,window.addEventListener("beforeunload",n.onbeforeunload,!1)),n.userid=s(),n.changeUserId=function(e,t){t=t||function(){},n.userid=e||s(),n.socket.emit("changed-uuid",n.userid,t)},n.extra={},n.attachStreams=[],n.session={audio:!0,video:!0},n.enableFileSharing=!1,n.bandwidth={screen:!1,audio:!1,video:!1},n.codecs={audio:"opus",video:"VP9"},n.processSdp=function(e){return v()||"Safari"===DetectRTC.browser.name?e:("VP8"===n.codecs.video.toUpperCase()&&(e=x.preferCodec(e,"vp8")),"VP9"===n.codecs.video.toUpperCase()&&(e=x.preferCodec(e,"vp9")),"H264"===n.codecs.video.toUpperCase()&&(e=x.preferCodec(e,"h264")),"G722"===n.codecs.audio&&(e=x.removeNonG722(e)),"Firefox"===DetectRTC.browser.name||((n.bandwidth.video||n.bandwidth.screen)&&(e=x.setApplicationSpecificBandwidth(e,n.bandwidth,!!n.session.screen)),n.bandwidth.video&&(e=x.setVideoBitrates(e,{min:8*n.bandwidth.video*1024,max:8*n.bandwidth.video*1024})),n.bandwidth.audio&&(e=x.setOpusAttributes(e,{maxaveragebitrate:8*n.bandwidth.audio*1024,maxplaybackrate:8*n.bandwidth.audio*1024,stereo:1,maxptime:3}))),e)},void 0!==x&&(n.BandwidthHandler=n.CodecsHandler=x),n.mediaConstraints={audio:{mandatory:{},optional:n.bandwidth.audio?[{bandwidth:8*n.bandwidth.audio*1024||1048576}]:[]},video:{mandatory:{},optional:n.bandwidth.video?[{bandwidth:8*n.bandwidth.video*1024||1048576},{facingMode:"user"}]:[{facingMode:"user"}]}},"Firefox"===DetectRTC.browser.name&&(n.mediaConstraints={audio:!0,video:!0}),t.useDefaultDevices||DetectRTC.isMobileDevice||DetectRTC.load((function(){var e,t;if(DetectRTC.MediaDevices.forEach((function(o){"audioinput"===o.kind&&!1!==n.mediaConstraints.audio&&(e=o),"videoinput"===o.kind&&!1!==n.mediaConstraints.video&&(t=o)})),e){if("Firefox"===DetectRTC.browser.name)return void(!0!==n.mediaConstraints.audio?n.mediaConstraints.audio.deviceId=e.id:n.mediaConstraints.audio={deviceId:e.id});1==n.mediaConstraints.audio&&(n.mediaConstraints.audio={mandatory:{},optional:[]}),n.mediaConstraints.audio.optional||(n.mediaConstraints.audio.optional=[]);var o=[{sourceId:e.id}];n.mediaConstraints.audio.optional=o.concat(n.mediaConstraints.audio.optional)}if(t){if("Firefox"===DetectRTC.browser.name)return void(!0!==n.mediaConstraints.video?n.mediaConstraints.video.deviceId=t.id:n.mediaConstraints.video={deviceId:t.id});1==n.mediaConstraints.video&&(n.mediaConstraints.video={mandatory:{},optional:[]}),n.mediaConstraints.video.optional||(n.mediaConstraints.video.optional=[]);o=[{sourceId:t.id}];n.mediaConstraints.video.optional=o.concat(n.mediaConstraints.video.optional)}})),n.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{VoiceActivityDetection:!1}]},n.sdpSemantics=null,n.iceCandidatePoolSize=null,n.bundlePolicy=null,n.rtcpMuxPolicy=null,n.iceTransportPolicy=null,n.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},n.iceServers=R.getIceServers(n),n.candidates={host:!0,stun:!0,turn:!0},n.iceProtocols={tcp:!0,udp:!0},n.onopen=function(e){n.enableLogs},n.onclose=function(e){n.enableLogs},n.onerror=function(e){n.enableLogs},n.onmessage=function(e){n.enableLogs},n.send=function(e,t){n.peers.send(e,t)},n.close=n.disconnect=n.leave=function(){n.onbeforeunload(!1,!0)},n.closeEntireSession=function(e){e=e||function(){},n.socket.emit("close-entire-session",(function t(){n.getAllParticipants().length?setTimeout(t,100):(n.onEntireSessionClosed({sessionid:n.sessionid,userid:n.userid,extra:n.extra}),n.changeUserId(null,(function(){n.close(),e()})))}))},n.onEntireSessionClosed=function(e){n.enableLogs},n.onstream=function(e){var t=n.videosContainer;t.insertBefore(e.mediaElement,t.firstChild);var o=e.mediaElement.play();void 0===o?setTimeout((function(){e.mediaElement.play()}),2e3):o.catch((function(){})).then((function(){setTimeout((function(){e.mediaElement.play()}),2e3)}))},n.onstreamended=function(e){e.mediaElement||(e.mediaElement=document.getElementById(e.streamid)),e.mediaElement&&e.mediaElement.parentNode&&e.mediaElement.parentNode.removeChild(e.mediaElement)},n.direction="many-to-many",n.removeStream=function(e,t){var o;n.attachStreams.forEach((function(t){t.id===e&&(o=t)})),o&&(n.peers.getAllParticipants().forEach((function(e){if(!t||e===t){var r=n.peers[e];try{r.peer.removeStream(o)}catch(i){}}})),n.renegotiate())},n.addStream=function(e,t){if(e.getTracks)return-1===n.attachStreams.indexOf(e)&&(e.streamid||(e.streamid=e.id),n.attachStreams.push(e)),void n.renegotiate(t);function o(o){e.streamCallback&&e.streamCallback(o),n.renegotiate(t)}u(e)?n.renegotiate(t):(e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:f(n)}).then((function(t){t.isScreen=!0,i.onGettingLocalMedia(t),!e.audio&&!e.video||f(n)?o(t):n.invokeGetUserMedia(null,(function(e){o(e)}))}),(function(e){})):n.invokeGetUserMedia({audio:f(n),video:!0,isScreen:!0},(function(t){!e.audio&&!e.video||f(n)?o(t):n.invokeGetUserMedia(null,(function(e){o(e)}))})):(e.audio||e.video)&&n.invokeGetUserMedia(null,o))},n.invokeGetUserMedia=function(e,t,o){o||(o=n.session),e||(e=n.mediaConstraints),O({onGettingLocalMedia:function(n){var o=e.video;o&&(o.mediaSource||o.mozMediaSource||o.mandatory&&o.mandatory.chromeMediaSource)&&(n.isScreen=!0),n.isScreen||(n.isVideo=!!h(n,"video").length,n.isAudio=!n.isVideo&&h(n,"audio").length),i.onGettingLocalMedia(n,(function(){"function"==typeof t&&t(n)}))},onLocalMediaError:function(e,t){i.onLocalMediaError(e,t)},localMediaConstraints:e||{audio:!!o.audio&&e.audio,video:!!o.video&&e.video}})},n.applyConstraints=function(e,t){if(S&&S.prototype.applyConstraints){var o;if(t)return n.streamEvents[t]&&(o=n.streamEvents[t].stream),void C(o,e);n.attachStreams.forEach((function(t){C(t,e)}))}else alert("track.applyConstraints is NOT supported in your browser.")},n.replaceTrack=function(e,t,o){if(e=e||{},g.prototype.getSenders)if(e instanceof S)T(e,t,o);else{if(e instanceof m)return h(e,"video").length&&T(h(e,"video")[0],t,!0),void(h(e,"audio").length&&T(h(e,"audio")[0],t,!1));if(u(e))throw"connection.replaceTrack requires audio and/or video and/or screen.";(e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:f(n)}).then((function(t){t.isScreen=!0,i.onGettingLocalMedia(t),!e.audio&&!e.video||f(n)?r(t):n.invokeGetUserMedia(null,r)}),(function(e){})):n.invokeGetUserMedia({audio:f(n),video:!0,isScreen:!0},!e.audio&&!e.video||f(n)?r:n.invokeGetUserMedia(null,r)):(e.audio||e.video)&&n.invokeGetUserMedia(null,r))}else n.addStream(e);function r(r){n.replaceTrack(r,t,o||e.video||e.screen)}},n.resetTrack=function(e,t){e||(e=n.getAllParticipants()),"string"==typeof e&&(e=[e]),e.forEach((function(e){var o=n.peers[e].peer;void 0!==t&&!0!==t||!o.lastVideoTrack||n.replaceTrack(o.lastVideoTrack,e,!0),void 0!==t&&!1!==t||!o.lastAudioTrack||n.replaceTrack(o.lastAudioTrack,e,!1)}))},n.renegotiate=function(e){e?i.renegotiatePeer(e):n.peers.getAllParticipants().forEach((function(e){i.renegotiatePeer(e)}))},n.setStreamEndHandler=function(e,t){if(e&&e.addEventListener&&(t=!!t,!e.alreadySetEndHandler)){e.alreadySetEndHandler=!0;var o="ended";"oninactive"in e&&(o="inactive"),e.addEventListener(o,(function(){if(e.idInstance&&currentUserMediaRequest.remove(e.idInstance),!t){var o=[];n.attachStreams.forEach((function(t){t.id!=e.id&&o.push(t)})),n.attachStreams=o}var r=n.streamEvents[e.streamid];if(r||(r={stream:e,streamid:e.streamid,type:t?"remote":"local",userid:n.userid,extra:n.extra,mediaElement:n.streamEvents[e.streamid]?n.streamEvents[e.streamid].mediaElement:null}),t&&n.peers[r.userid]){var i=n.peers[r.userid].peer;o=[];i.getRemoteStreams().forEach((function(t){t.id!=e.id&&o.push(t)})),n.peers[r.userid].streams=o}r.userid===n.userid&&"remote"===r.type||(n.peersBackup[r.userid]&&(r.extra=n.peersBackup[r.userid].extra),n.onstreamended(r),delete n.streamEvents[e.streamid])}),!1)}},n.onMediaError=function(e,t){n.enableLogs},n.autoCloseEntireSession=!1,n.filesContainer=n.videosContainer=document.body||document.documentElement,n.isInitiator=!1,n.shareFile=i.shareFile,void 0!==M&&M.handle(n),void 0!==D&&D.handle(n),n.token=s,n.onNewParticipant=function(e,t){n.acceptParticipationRequest(e,t)},n.acceptParticipationRequest=function(e,t){t.successCallback&&(t.successCallback(),delete t.successCallback),i.createNewPeer(e,t)},void 0!==L&&(n.StreamsHandler=L),n.onleave=function(e){},n.invokeSelectFileDialog=function(e){var t=new FileSelector;t.accept="*.*",t.selectSingleFile(e)},n.onmute=function(e){if(e&&e.mediaElement)if("both"===e.muteType||"video"===e.muteType){e.mediaElement.src=null;var t=e.mediaElement.pause();void 0!==t?t.then((function(){e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"})):e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"}else"audio"===e.muteType&&(e.mediaElement.muted=!0)},n.onunmute=function(e){e&&e.mediaElement&&e.stream&&("both"===e.unmuteType||"video"===e.unmuteType?(e.mediaElement.poster=null,e.mediaElement.srcObject=e.stream,e.mediaElement.play()):"audio"===e.unmuteType&&(e.mediaElement.muted=!1))},n.onExtraDataUpdated=function(e){e.status="online",n.onUserStatusChanged(e,!0)},n.getAllParticipants=function(e){return n.peers.getAllParticipants(e)},void 0!==L&&(L.onSyncNeeded=function(e,t,o){n.peers.getAllParticipants().forEach((function(n){i.onNegotiationNeeded({streamid:e,action:t,streamSyncNeeded:!0,type:o||"both"},n)}))}),n.connectSocket=function(e){p(e)},n.closeSocket=function(){try{io.sockets={}}catch(e){}n.socket&&("function"==typeof n.socket.disconnect&&n.socket.disconnect(),"function"==typeof n.socket.resetProps&&n.socket.resetProps(),n.socket=null)},n.getSocket=function(e){return!e&&n.enableLogs,e=e||function(){},n.socket?e(n.socket):p((function(){e(n.socket)})),n.socket},n.getRemoteStreams=i.getRemoteStreams;var P=["selectFirst","selectAll","forEach"];if(n.streamEvents={selectFirst:function(e){return n.streamEvents.selectAll(e)[0]},selectAll:function(e){e||(e={local:!0,remote:!0,isScreen:!0,isAudio:!0,isVideo:!0}),"local"==e&&(e={local:!0}),"remote"==e&&(e={remote:!0}),"screen"==e&&(e={isScreen:!0}),"audio"==e&&(e={isAudio:!0}),"video"==e&&(e={isVideo:!0});var t=[];return Object.keys(n.streamEvents).forEach((function(o){var r=n.streamEvents[o];if(-1===P.indexOf(o)){var i=!0;e.local&&"local"===r.type&&(i=!1),e.remote&&"remote"===r.type&&(i=!1),e.isScreen&&r.stream.isScreen&&(i=!1),e.isVideo&&r.stream.isVideo&&(i=!1),e.isAudio&&r.stream.isAudio&&(i=!1),e.userid&&r.userid===e.userid&&(i=!1),!1===i&&t.push(r)}})),t}},n.socketURL="/",n.socketMessageEvent="RTCMultiConnection-Message",n.socketCustomEvent="RTCMultiConnection-Custom-Message",n.DetectRTC=DetectRTC,n.setCustomSocketEvent=function(e){e&&(n.socketCustomEvent=e),n.socket&&n.socket.emit("set-custom-socket-event-listener",n.socketCustomEvent)},n.getNumberOfBroadcastViewers=function(e,t){n.socket&&e&&t&&n.socket.emit("get-number-of-users-in-specific-broadcast",e,t)},n.onNumberOfBroadcastViewersUpdated=function(e){n.enableLogs&&n.isInitiator},n.onUserStatusChanged=function(e,t){n.enableLogs},n.getUserMediaHandler=O,n.multiPeersHandler=i,n.enableLogs=!0,n.setCustomSocketHandler=function(e){void 0!==o&&(o=e)},n.chunkSize=4e4,n.maxParticipantsAllowed=1e3,n.disconnectWith=i.disconnectWith,n.checkPresence=function(e,t){e=e||n.sessionid,"SSEConnection"!==o.name?n.socket?n.socket.emit("check-presence",e+"",(function(e,o,r){n.enableLogs,t(e,o,r)})):n.connectSocket((function(){n.checkPresence(e,t)})):SSEConnection.checkPresence(e,(function(e,o,r){if(!n.socket)return e||(n.userid=o),void n.connectSocket((function(){t(e,o,r)}));t(e,o)}))},n.onReadyForOffer=function(e,t){n.multiPeersHandler.createNewPeer(e,t)},n.setUserPreferences=function(e){return n.dontAttachStream&&(e.dontAttachLocalStream=!0),n.dontGetRemoteStream&&(e.dontGetRemoteStream=!0),e},n.updateExtraData=function(){n.socket.emit("extra-data-updated",n.extra)},n.enableScalableBroadcast=!1,n.maxRelayLimitPerUser=3,n.dontCaptureUserMedia=!1,n.dontAttachStream=!1,n.dontGetRemoteStream=!1,n.onReConnecting=function(e){n.enableLogs},n.beforeAddingStream=function(e){return e},n.beforeRemovingStream=function(e){return e},"undefined"!=typeof isChromeExtensionAvailable&&(n.checkIfChromeExtensionAvailable=isChromeExtensionAvailable),"undefined"!=typeof isFirefoxExtensionAvailable&&(n.checkIfChromeExtensionAvailable=isFirefoxExtensionAvailable),"undefined"!=typeof getChromeExtensionStatus&&(n.getChromeExtensionStatus=getChromeExtensionStatus),n.modifyScreenConstraints=function(e){return e},n.onPeerStateChanged=function(e){n.enableLogs&&e.iceConnectionState.search(/closed|failed/gi)},n.isOnline=!0,d("online",(function(){n.isOnline=!0})),d("offline",(function(){n.isOnline=!1})),n.isLowBandwidth=!1,navigator&&navigator.connection&&navigator.connection.type&&(n.isLowBandwidth=-1!==navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g),n.isLowBandwidth)){if(n.bandwidth={audio:!1,video:!1,screen:!1},n.mediaConstraints.audio&&n.mediaConstraints.audio.optional&&n.mediaConstraints.audio.optional.length){var E=[];n.mediaConstraints.audio.optional.forEach((function(e){void 0===e.bandwidth&&E.push(e)})),n.mediaConstraints.audio.optional=E}if(n.mediaConstraints.video&&n.mediaConstraints.video.optional&&n.mediaConstraints.video.optional.length){E=[];n.mediaConstraints.video.optional.forEach((function(e){void 0===e.bandwidth&&E.push(e)})),n.mediaConstraints.video.optional=E}}n.getExtraData=function(e,t){if(!e)throw"remoteUserId is required.";if("function"!=typeof t)return n.peers[e]?n.peers[e].extra:n.peersBackup[e]?n.peersBackup[e].extra:{};n.socket.emit("get-remote-user-extra-data",e,(function(e,n,o){t(e,n,o)}))},t.autoOpenOrJoin&&n.openOrJoin(n.sessionid),n.onUserIdAlreadyTaken=function(e,t){n.close(),n.closeSocket(),n.isInitiator=!1,n.userid=n.token(),n.join(n.sessionid),n.enableLogs},n.trickleIce=!0,n.version="3.7.0",n.onSettingLocalDescription=function(e){n.enableLogs},n.resetScreen=function(){sourceId=null,DetectRTC&&DetectRTC.screen&&delete DetectRTC.screen.sourceId,currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[]}},n.autoCreateMediaElement=!0,n.password=null,n.setPassword=function(e,t){t=t||function(){},n.socket?n.socket.emit("set-password",e,t):(n.password=e,t(!0,n.sessionid,null))},n.onSocketDisconnect=function(e){n.enableLogs},n.onSocketError=function(e){n.enableLogs},n.errors={ROOM_NOT_AVAILABLE:"Room not available",INVALID_PASSWORD:"Invalid password",USERID_NOT_AVAILABLE:"User ID does not exist",ROOM_PERMISSION_DENIED:"Room permission denied",ROOM_FULL:"Room full",DID_NOT_JOIN_ANY_ROOM:"Did not join any room yet",INVALID_SOCKET:"Invalid socket",PUBLIC_IDENTIFIER_MISSING:"publicRoomIdentifier is required",INVALID_ADMIN_CREDENTIAL:"Invalid username or password attempted"}}(this)};
/*!
 * Socket.IO v4.4.1
 * (c) 2014-2022 Guillermo Rauch
 * Released under the MIT License.
 */
function Ar(){var e,t;e=this,t=function(){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function o(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},r.apply(this,arguments)}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=a(e);if(t){var r=a(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return c(e)}(this,n)}}function l(e,t,n){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}},l(e,t,n||e)}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function p(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}var m=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,f=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],h=function(e){var t,n,o,r=e,i=e.indexOf("["),a=e.indexOf("]");-1!=i&&-1!=a&&(e=e.substring(0,i)+e.substring(i,a).replace(/:/g,";")+e.substring(a,e.length));for(var s,c,d=m.exec(e||""),l={},u=14;u--;)l[f[u]]=d[u]||"";return-1!=i&&-1!=a&&(l.source=r,l.host=l.host.substring(1,l.host.length-1).replace(/;/g,":"),l.authority=l.authority.replace("[","").replace("]","").replace(/;/g,":"),l.ipv6uri=!0),l.pathNames=(t=l.path,n=/\/{2,9}/g,o=t.replace(n,"/").split("/"),"/"!=t.substr(0,1)&&0!==t.length||o.splice(0,1),"/"==t.substr(t.length-1,1)&&o.splice(o.length-1,1),o),l.queryKey=(s=l.query,c={},s.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(c[t]=n)})),c),l},v={exports:{}};try{v.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Ie){v.exports=!1}var y=v.exports,g="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function b(e){var t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||y))return new XMLHttpRequest}catch(n){}if(!t)try{return new(g[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(n){}}function k(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return n.reduce((function(t,n){return e.hasOwnProperty(n)&&(t[n]=e[n]),t}),{})}var w=setTimeout,C=clearTimeout;function S(e,t){t.useNativeTimers?(e.setTimeoutFn=w.bind(g),e.clearTimeoutFn=C.bind(g)):(e.setTimeoutFn=setTimeout.bind(g),e.clearTimeoutFn=clearTimeout.bind(g))}var T=x;function x(e){if(e)return function(e){for(var t in x.prototype)e[t]=x.prototype[t];return e}(e)}x.prototype.on=x.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},x.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},x.prototype.off=x.prototype.removeListener=x.prototype.removeAllListeners=x.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,o=this._callbacks["$"+e];if(!o)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r=0;r<o.length;r++)if((n=o[r])===t||n.fn===t){o.splice(r,1);break}return 0===o.length&&delete this._callbacks["$"+e],this},x.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],o=1;o<arguments.length;o++)t[o-1]=arguments[o];if(n){o=0;for(var r=(n=n.slice(0)).length;o<r;++o)n[o].apply(this,t)}return this},x.prototype.emitReserved=x.prototype.emit,x.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},x.prototype.hasListeners=function(e){return!!this.listeners(e).length};var P=Object.create(null);P.open="0",P.close="1",P.ping="2",P.pong="3",P.message="4",P.upgrade="5",P.noop="6";var R=Object.create(null);Object.keys(P).forEach((function(e){R[P[e]]=e}));for(var O={type:"error",data:"parser error"},L="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),E="function"==typeof ArrayBuffer,_=function(e,t,n){var o,r=e.type,i=e.data;return L&&i instanceof Blob?t?n(i):M(i,n):E&&(i instanceof ArrayBuffer||(o=i,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(o):o&&o.buffer instanceof ArrayBuffer))?t?n(i):M(new Blob([i]),n):n(P[r]+(i||""))},M=function(e,t){var n=new FileReader;return n.onload=function(){var e=n.result.split(",")[1];t("b"+e)},n.readAsDataURL(e)},D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",I="undefined"==typeof Uint8Array?[]:new Uint8Array(256),A=0;A<64;A++)I[D.charCodeAt(A)]=A;var N,B="function"==typeof ArrayBuffer,V=function(e,t){if("string"!=typeof e)return{type:"message",data:U(e,t)};var n=e.charAt(0);return"b"===n?{type:"message",data:j(e.substring(1),t)}:R[n]?e.length>1?{type:R[n],data:e.substring(1)}:{type:R[n]}:O},j=function(e,t){if(B){var n=function(e){var t,n,o,r,i,a=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var d=new ArrayBuffer(a),l=new Uint8Array(d);for(t=0;t<s;t+=4)n=I[e.charCodeAt(t)],o=I[e.charCodeAt(t+1)],r=I[e.charCodeAt(t+2)],i=I[e.charCodeAt(t+3)],l[c++]=n<<2|o>>4,l[c++]=(15&o)<<4|r>>2,l[c++]=(3&r)<<6|63&i;return d}(e);return U(n,t)}return{base64:!0,data:e}},U=function(e,t){return"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e},F=String.fromCharCode(30),z=function(e){i(r,e);var n=d(r);function r(e){var o;return t(this,r),(o=n.call(this)).writable=!1,S(c(o),e),o.opts=e,o.query=e.query,o.readyState="",o.socket=e.socket,o}return o(r,[{key:"onError",value:function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,l(a(r.prototype),"emit",this).call(this,"error",n),this}},{key:"open",value:function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}},{key:"close",value:function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}},{key:"send",value:function(e){"open"===this.readyState&&this.write(e)}},{key:"onOpen",value:function(){this.readyState="open",this.writable=!0,l(a(r.prototype),"emit",this).call(this,"open")}},{key:"onData",value:function(e){var t=V(e,this.socket.binaryType);this.onPacket(t)}},{key:"onPacket",value:function(e){l(a(r.prototype),"emit",this).call(this,"packet",e)}},{key:"onClose",value:function(){this.readyState="closed",l(a(r.prototype),"emit",this).call(this,"close")}}]),r}(T),q="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),G=64,W={},H=0,$=0;function J(e){var t="";do{t=q[e%G]+t,e=Math.floor(e/G)}while(e>0);return t}function K(){var e=J(+new Date);return e!==N?(H=0,N=e):e+"."+J(H++)}for(;$<G;$++)W[q[$]]=$;K.encode=J,K.decode=function(e){var t=0;for($=0;$<e.length;$++)t=t*G+W[e.charAt($)];return t};var Y=K,Q={encode:function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},decode:function(e){for(var t={},n=e.split("&"),o=0,r=n.length;o<r;o++){var i=n[o].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},X=function(e){i(r,e);var n=d(r);function r(){var e;return t(this,r),(e=n.apply(this,arguments)).polling=!1,e}return o(r,[{key:"name",get:function(){return"polling"}},{key:"doOpen",value:function(){this.poll()}},{key:"pause",value:function(e){var t=this;this.readyState="pausing";var n=function(){t.readyState="paused",e()};if(this.polling||!this.writable){var o=0;this.polling&&(o++,this.once("pollComplete",(function(){--o||n()}))),this.writable||(o++,this.once("drain",(function(){--o||n()})))}else n()}},{key:"poll",value:function(){this.polling=!0,this.doPoll(),this.emit("poll")}},{key:"onData",value:function(e){var t=this;(function(e,t){for(var n=e.split(F),o=[],r=0;r<n.length;r++){var i=V(n[r],t);if(o.push(i),"error"===i.type)break}return o})(e,this.socket.binaryType).forEach((function(e){if("opening"===t.readyState&&"open"===e.type&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState&&this.poll())}},{key:"doClose",value:function(){var e=this,t=function(){e.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}},{key:"write",value:function(e){var t=this;this.writable=!1,function(e,t){var n=e.length,o=new Array(n),r=0;e.forEach((function(e,i){_(e,!1,(function(e){o[i]=e,++r===n&&t(o.join(F))}))}))}(e,(function(e){t.doWrite(e,(function(){t.writable=!0,t.emit("drain")}))}))}},{key:"uri",value:function(){var e=this.query||{},t=this.opts.secure?"https":"http",n="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=Y()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port);var o=Q.encode(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(o.length?"?"+o:"")}}]),r}(z);function Z(){}var ee=null!=new b({xdomain:!1}).responseType,te=function(e){i(a,e);var n=d(a);function a(e){var o;if(t(this,a),o=n.call(this,e),"undefined"!=typeof location){var r="https:"===location.protocol,i=location.port;i||(i=r?"443":"80"),o.xd="undefined"!=typeof location&&e.hostname!==location.hostname||i!==e.port,o.xs=e.secure!==r}var s=e&&e.forceBase64;return o.supportsBinary=ee&&!s,o}return o(a,[{key:"request",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(e,{xd:this.xd,xs:this.xs},this.opts),new ne(this.uri(),e)}},{key:"doWrite",value:function(e,t){var n=this,o=this.request({method:"POST",data:e});o.on("success",t),o.on("error",(function(e){n.onError("xhr post error",e)}))}},{key:"doPoll",value:function(){var e=this,t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(function(t){e.onError("xhr poll error",t)})),this.pollXhr=t}}]),a}(X),ne=function(e){i(r,e);var n=d(r);function r(e,o){var i;return t(this,r),S(c(i=n.call(this)),o),i.opts=o,i.method=o.method||"GET",i.uri=e,i.async=!1!==o.async,i.data=void 0!==o.data?o.data:null,i.create(),i}return o(r,[{key:"create",value:function(){var e=this,t=k(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;var n=this.xhr=new b(t);try{n.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders)for(var o in n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(o)&&n.setRequestHeader(o,this.opts.extraHeaders[o])}catch(i){}if("POST"===this.method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(i){}try{n.setRequestHeader("Accept","*/*")}catch(i){}"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=function(){4===n.readyState&&(200===n.status||1223===n.status?e.onLoad():e.setTimeoutFn((function(){e.onError("number"==typeof n.status?n.status:0)}),0))},n.send(this.data)}catch(i){return void this.setTimeoutFn((function(){e.onError(i)}),0)}"undefined"!=typeof document&&(this.index=r.requestsCount++,r.requests[this.index]=this)}},{key:"onSuccess",value:function(){this.emit("success"),this.cleanup()}},{key:"onData",value:function(e){this.emit("data",e),this.onSuccess()}},{key:"onError",value:function(e){this.emit("error",e),this.cleanup(!0)}},{key:"cleanup",value:function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=Z,e)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete r.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function(){var e=this.xhr.responseText;null!==e&&this.onData(e)}},{key:"abort",value:function(){this.cleanup()}}]),r}(T);function oe(){for(var e in ne.requests)ne.requests.hasOwnProperty(e)&&ne.requests[e].abort()}ne.requestsCount=0,ne.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",oe):"function"==typeof addEventListener&&addEventListener("onpagehide"in g?"pagehide":"unload",oe,!1));var re="function"==typeof Promise&&"function"==typeof Promise.resolve?function(e){return Promise.resolve().then(e)}:function(e,t){return t(e,0)},ie=g.WebSocket||g.MozWebSocket,ae="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),se={websocket:function(e){i(r,e);var n=d(r);function r(e){var o;return t(this,r),(o=n.call(this,e)).supportsBinary=!e.forceBase64,o}return o(r,[{key:"name",get:function(){return"websocket"}},{key:"doOpen",value:function(){if(this.check()){var e=this.uri(),t=this.opts.protocols,n=ae?{}:k(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=ae?new ie(e,t,n):t?new ie(e,t):new ie(e)}catch(Ie){return this.emit("error",Ie)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}}},{key:"addEventListeners",value:function(){var e=this;this.ws.onopen=function(){e.opts.autoUnref&&e.ws._socket.unref(),e.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=function(t){return e.onData(t.data)},this.ws.onerror=function(t){return e.onError("websocket error",t)}}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var n=function(n){var o=e[n],r=n===e.length-1;_(o,t.supportsBinary,(function(e){try{t.ws.send(e)}catch(n){}r&&re((function(){t.writable=!0,t.emit("drain")}),t.setTimeoutFn)}))},o=0;o<e.length;o++)n(o)}},{key:"doClose",value:function(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function(){var e=this.query||{},t=this.opts.secure?"wss":"ws",n="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=Y()),this.supportsBinary||(e.b64=1);var o=Q.encode(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(o.length?"?"+o:"")}},{key:"check",value:function(){return!(!ie||"__initialize"in ie&&this.name===r.prototype.name)}}]),r}(z),polling:te},ce=function(n){i(s,n);var a=d(s);function s(n){var o,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t(this,s),o=a.call(this),n&&"object"===e(n)&&(i=n,n=null),n?(n=h(n),i.hostname=n.host,i.secure="https"===n.protocol||"wss"===n.protocol,i.port=n.port,n.query&&(i.query=n.query)):i.host&&(i.hostname=h(i.host).host),S(c(o),i),o.secure=null!=i.secure?i.secure:"undefined"!=typeof location&&"https:"===location.protocol,i.hostname&&!i.port&&(i.port=o.secure?"443":"80"),o.hostname=i.hostname||("undefined"!=typeof location?location.hostname:"localhost"),o.port=i.port||("undefined"!=typeof location&&location.port?location.port:o.secure?"443":"80"),o.transports=i.transports||["polling","websocket"],o.readyState="",o.writeBuffer=[],o.prevBufferLen=0,o.opts=r({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},i),o.opts.path=o.opts.path.replace(/\/$/,"")+"/","string"==typeof o.opts.query&&(o.opts.query=Q.decode(o.opts.query)),o.id=null,o.upgrades=null,o.pingInterval=null,o.pingTimeout=null,o.pingTimeoutTimer=null,"function"==typeof addEventListener&&(o.opts.closeOnBeforeunload&&addEventListener("beforeunload",(function(){o.transport&&(o.transport.removeAllListeners(),o.transport.close())}),!1),"localhost"!==o.hostname&&(o.offlineEventListener=function(){o.onClose("transport close")},addEventListener("offline",o.offlineEventListener,!1))),o.open(),o}return o(s,[{key:"createTransport",value:function(e){var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);var n=r({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new se[e](n)}},{key:"open",value:function(){var e,t=this;if(this.opts.rememberUpgrade&&s.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((function(){t.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(n){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}},{key:"setTransport",value:function(e){var t=this;this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(function(){t.onClose("transport close")}))}},{key:"probe",value:function(e){var t=this,n=this.createTransport(e),o=!1;s.priorWebsocketSuccess=!1;var r=function(){o||(n.send([{type:"ping",data:"probe"}]),n.once("packet",(function(e){if(!o)if("pong"===e.type&&"probe"===e.data){if(t.upgrading=!0,t.emitReserved("upgrading",n),!n)return;s.priorWebsocketSuccess="websocket"===n.name,t.transport.pause((function(){o||"closed"!==t.readyState&&(u(),t.setTransport(n),n.send([{type:"upgrade"}]),t.emitReserved("upgrade",n),n=null,t.upgrading=!1,t.flush())}))}else{var r=new Error("probe error");r.transport=n.name,t.emitReserved("upgradeError",r)}})))};function i(){o||(o=!0,u(),n.close(),n=null)}var a=function(e){var o=new Error("probe error: "+e);o.transport=n.name,i(),t.emitReserved("upgradeError",o)};function c(){a("transport closed")}function d(){a("socket closed")}function l(e){n&&e.name!==n.name&&i()}var u=function(){n.removeListener("open",r),n.removeListener("error",a),n.removeListener("close",c),t.off("close",d),t.off("upgrading",l)};n.once("open",r),n.once("error",a),n.once("close",c),this.once("close",d),this.once("upgrading",l),n.open()}},{key:"onOpen",value:function(){if(this.readyState="open",s.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause)for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},{key:"onPacket",value:function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}},{key:"onHandshake",value:function(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function(){var e=this;this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((function(){e.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}},{key:"onDrain",value:function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}},{key:"flush",value:function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emitReserved("flush"))}},{key:"write",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"send",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"sendPacket",value:function(e,t,n,o){if("function"==typeof t&&(o=t,t=void 0),"function"==typeof n&&(o=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var r={type:e,data:t,options:n};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),o&&this.once("flush",o),this.flush()}}},{key:"close",value:function(){var e=this,t=function(){e.onClose("forced close"),e.transport.close()},n=function n(){e.off("upgrade",n),e.off("upgradeError",n),t()},o=function(){e.once("upgrade",n),e.once("upgradeError",n)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(function(){e.upgrading?o():t()})):this.upgrading?o():t()),this}},{key:"onError",value:function(e){s.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}},{key:"onClose",value:function(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}},{key:"filterUpgrades",value:function(e){for(var t=[],n=0,o=e.length;n<o;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}]),s}(T);ce.protocol=4;var de,le,ue="function"==typeof ArrayBuffer,pe=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer},me=Object.prototype.toString,fe="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===me.call(Blob),he="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===me.call(File);function ve(e){return ue&&(e instanceof ArrayBuffer||pe(e))||fe&&e instanceof Blob||he&&e instanceof File}function ye(t,n){if(!t||"object"!==e(t))return!1;if(Array.isArray(t)){for(var o=0,r=t.length;o<r;o++)if(ye(t[o]))return!0;return!1}if(ve(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return ye(t.toJSON(),!0);for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&ye(t[i]))return!0;return!1}function ge(e){var t=[],n=e.data,o=e;return o.data=be(n,t),o.attachments=t.length,{packet:o,buffers:t}}function be(t,n){if(!t)return t;if(ve(t)){var o={_placeholder:!0,num:n.length};return n.push(t),o}if(Array.isArray(t)){for(var r=new Array(t.length),i=0;i<t.length;i++)r[i]=be(t[i],n);return r}if("object"===e(t)&&!(t instanceof Date)){var a={};for(var s in t)t.hasOwnProperty(s)&&(a[s]=be(t[s],n));return a}return t}function ke(e,t){return e.data=we(e.data,t),e.attachments=void 0,e}function we(t,n){if(!t)return t;if(t&&t._placeholder)return n[t.num];if(Array.isArray(t))for(var o=0;o<t.length;o++)t[o]=we(t[o],n);else if("object"===e(t))for(var r in t)t.hasOwnProperty(r)&&(t[r]=we(t[r],n));return t}(le=de||(de={}))[le.CONNECT=0]="CONNECT",le[le.DISCONNECT=1]="DISCONNECT",le[le.EVENT=2]="EVENT",le[le.ACK=3]="ACK",le[le.CONNECT_ERROR=4]="CONNECT_ERROR",le[le.BINARY_EVENT=5]="BINARY_EVENT",le[le.BINARY_ACK=6]="BINARY_ACK";var Ce=function(){function e(){t(this,e)}return o(e,[{key:"encode",value:function(e){return e.type!==de.EVENT&&e.type!==de.ACK||!ye(e)?[this.encodeAsString(e)]:(e.type=e.type===de.EVENT?de.BINARY_EVENT:de.BINARY_ACK,this.encodeAsBinary(e))}},{key:"encodeAsString",value:function(e){var t=""+e.type;return e.type!==de.BINARY_EVENT&&e.type!==de.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data)),t}},{key:"encodeAsBinary",value:function(e){var t=ge(e),n=this.encodeAsString(t.packet),o=t.buffers;return o.unshift(n),o}}]),e}(),Se=function(n){i(s,n);var r=d(s);function s(){return t(this,s),r.call(this)}return o(s,[{key:"add",value:function(e){var t;if("string"==typeof e)(t=this.decodeString(e)).type===de.BINARY_EVENT||t.type===de.BINARY_ACK?(this.reconstructor=new Te(t),0===t.attachments&&l(a(s.prototype),"emitReserved",this).call(this,"decoded",t)):l(a(s.prototype),"emitReserved",this).call(this,"decoded",t);else{if(!ve(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,l(a(s.prototype),"emitReserved",this).call(this,"decoded",t))}}},{key:"decodeString",value:function(e){var t=0,n={type:Number(e.charAt(0))};if(void 0===de[n.type])throw new Error("unknown packet type "+n.type);if(n.type===de.BINARY_EVENT||n.type===de.BINARY_ACK){for(var o=t+1;"-"!==e.charAt(++t)&&t!=e.length;);var r=e.substring(o,t);if(r!=Number(r)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(r)}if("/"===e.charAt(t+1)){for(var i=t+1;++t&&","!==e.charAt(t)&&t!==e.length;);n.nsp=e.substring(i,t)}else n.nsp="/";var a=e.charAt(t+1);if(""!==a&&Number(a)==a){for(var c=t+1;++t;){var d=e.charAt(t);if(null==d||Number(d)!=d){--t;break}if(t===e.length)break}n.id=Number(e.substring(c,t+1))}if(e.charAt(++t)){var l=function(e){try{return JSON.parse(e)}catch(t){return!1}}(e.substr(t));if(!s.isPayloadValid(n.type,l))throw new Error("invalid payload");n.data=l}return n}},{key:"destroy",value:function(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}],[{key:"isPayloadValid",value:function(t,n){switch(t){case de.CONNECT:return"object"===e(n);case de.DISCONNECT:return void 0===n;case de.CONNECT_ERROR:return"string"==typeof n||"object"===e(n);case de.EVENT:case de.BINARY_EVENT:return Array.isArray(n)&&n.length>0;case de.ACK:case de.BINARY_ACK:return Array.isArray(n)}}}]),s}(T),Te=function(){function e(n){t(this,e),this.packet=n,this.buffers=[],this.reconPack=n}return o(e,[{key:"takeBinaryData",value:function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=ke(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}},{key:"finishedReconstruction",value:function(){this.reconPack=null,this.buffers=[]}}]),e}(),xe=Object.freeze({__proto__:null,protocol:5,get PacketType(){return de},Encoder:Ce,Decoder:Se});function Pe(e,t,n){return e.on(t,n),function(){e.off(t,n)}}var Re=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Oe=function(e){i(r,e);var n=d(r);function r(e,o,i){var a;return t(this,r),(a=n.call(this)).connected=!1,a.disconnected=!0,a.receiveBuffer=[],a.sendBuffer=[],a.ids=0,a.acks={},a.flags={},a.io=e,a.nsp=o,i&&i.auth&&(a.auth=i.auth),a.io._autoConnect&&a.open(),a}return o(r,[{key:"subEvents",value:function(){if(!this.subs){var e=this.io;this.subs=[Pe(e,"open",this.onopen.bind(this)),Pe(e,"packet",this.onpacket.bind(this)),Pe(e,"error",this.onerror.bind(this)),Pe(e,"close",this.onclose.bind(this))]}}},{key:"active",get:function(){return!!this.subs}},{key:"connect",value:function(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}},{key:"open",value:function(){return this.connect()}},{key:"send",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift("message"),this.emit.apply(this,t),this}},{key:"emit",value:function(e){if(Re.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];n.unshift(e);var r={type:de.EVENT,data:n,options:{}};if(r.options.compress=!1!==this.flags.compress,"function"==typeof n[n.length-1]){var i=this.ids++,a=n.pop();this._registerAckCallback(i,a),r.id=i}var s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!s||!this.connected)||(this.connected?this.packet(r):this.sendBuffer.push(r)),this.flags={},this}},{key:"_registerAckCallback",value:function(e,t){var n=this,o=this.flags.timeout;if(void 0!==o){var r=this.io.setTimeoutFn((function(){delete n.acks[e];for(var o=0;o<n.sendBuffer.length;o++)n.sendBuffer[o].id===e&&n.sendBuffer.splice(o,1);t.call(n,new Error("operation has timed out"))}),o);this.acks[e]=function(){n.io.clearTimeoutFn(r);for(var e=arguments.length,o=new Array(e),i=0;i<e;i++)o[i]=arguments[i];t.apply(n,[null].concat(o))}}else this.acks[e]=t}},{key:"packet",value:function(e){e.nsp=this.nsp,this.io._packet(e)}},{key:"onopen",value:function(){var e=this;"function"==typeof this.auth?this.auth((function(t){e.packet({type:de.CONNECT,data:t})})):this.packet({type:de.CONNECT,data:this.auth})}},{key:"onerror",value:function(e){this.connected||this.emitReserved("connect_error",e)}},{key:"onclose",value:function(e){this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",e)}},{key:"onpacket",value:function(e){if(e.nsp===this.nsp)switch(e.type){case de.CONNECT:if(e.data&&e.data.sid){var t=e.data.sid;this.onconnect(t)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case de.EVENT:case de.BINARY_EVENT:this.onevent(e);break;case de.ACK:case de.BINARY_ACK:this.onack(e);break;case de.DISCONNECT:this.ondisconnect();break;case de.CONNECT_ERROR:this.destroy();var n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n)}}},{key:"onevent",value:function(e){var t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}},{key:"emitEvent",value:function(e){if(this._anyListeners&&this._anyListeners.length){var t,n=p(this._anyListeners.slice());try{for(n.s();!(t=n.n()).done;)t.value.apply(this,e)}catch(Ie){n.e(Ie)}finally{n.f()}}l(a(r.prototype),"emit",this).apply(this,e)}},{key:"ack",value:function(e){var t=this,n=!1;return function(){if(!n){n=!0;for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];t.packet({type:de.ACK,id:e,data:r})}}}},{key:"onack",value:function(e){var t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}},{key:"onconnect",value:function(e){this.id=e,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}},{key:"emitBuffered",value:function(){var e=this;this.receiveBuffer.forEach((function(t){return e.emitEvent(t)})),this.receiveBuffer=[],this.sendBuffer.forEach((function(t){return e.packet(t)})),this.sendBuffer=[]}},{key:"ondisconnect",value:function(){this.destroy(),this.onclose("io server disconnect")}},{key:"destroy",value:function(){this.subs&&(this.subs.forEach((function(e){return e()})),this.subs=void 0),this.io._destroy(this)}},{key:"disconnect",value:function(){return this.connected&&this.packet({type:de.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{key:"close",value:function(){return this.disconnect()}},{key:"compress",value:function(e){return this.flags.compress=e,this}},{key:"volatile",get:function(){return this.flags.volatile=!0,this}},{key:"timeout",value:function(e){return this.flags.timeout=e,this}},{key:"onAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}},{key:"prependAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}},{key:"offAny",value:function(e){if(!this._anyListeners)return this;if(e){for(var t=this._anyListeners,n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}},{key:"listenersAny",value:function(){return this._anyListeners||[]}}]),r}(T),Le=Ee;function Ee(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Ee.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+n:e-n}return 0|Math.min(e,this.max)},Ee.prototype.reset=function(){this.attempts=0},Ee.prototype.setMin=function(e){this.ms=e},Ee.prototype.setMax=function(e){this.max=e},Ee.prototype.setJitter=function(e){this.jitter=e};var _e=function(n){i(a,n);var r=d(a);function a(n,o){var i,s;t(this,a),(i=r.call(this)).nsps={},i.subs=[],n&&"object"===e(n)&&(o=n,n=void 0),(o=o||{}).path=o.path||"/socket.io",i.opts=o,S(c(i),o),i.reconnection(!1!==o.reconnection),i.reconnectionAttempts(o.reconnectionAttempts||1/0),i.reconnectionDelay(o.reconnectionDelay||1e3),i.reconnectionDelayMax(o.reconnectionDelayMax||5e3),i.randomizationFactor(null!==(s=o.randomizationFactor)&&void 0!==s?s:.5),i.backoff=new Le({min:i.reconnectionDelay(),max:i.reconnectionDelayMax(),jitter:i.randomizationFactor()}),i.timeout(null==o.timeout?2e4:o.timeout),i._readyState="closed",i.uri=n;var d=o.parser||xe;return i.encoder=new d.Encoder,i.decoder=new d.Decoder,i._autoConnect=!1!==o.autoConnect,i._autoConnect&&i.open(),i}return o(a,[{key:"reconnection",value:function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}},{key:"reconnectionAttempts",value:function(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}},{key:"reconnectionDelay",value:function(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}},{key:"randomizationFactor",value:function(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}},{key:"reconnectionDelayMax",value:function(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}},{key:"timeout",value:function(e){return arguments.length?(this._timeout=e,this):this._timeout}},{key:"maybeReconnectOnOpen",value:function(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}},{key:"open",value:function(e){var t=this;if(~this._readyState.indexOf("open"))return this;this.engine=new ce(this.uri,this.opts);var n=this.engine,o=this;this._readyState="opening",this.skipReconnect=!1;var r=Pe(n,"open",(function(){o.onopen(),e&&e()})),i=Pe(n,"error",(function(n){o.cleanup(),o._readyState="closed",t.emitReserved("error",n),e?e(n):o.maybeReconnectOnOpen()}));if(!1!==this._timeout){var a=this._timeout;0===a&&r();var s=this.setTimeoutFn((function(){r(),n.close(),n.emit("error",new Error("timeout"))}),a);this.opts.autoUnref&&s.unref(),this.subs.push((function(){clearTimeout(s)}))}return this.subs.push(r),this.subs.push(i),this}},{key:"connect",value:function(e){return this.open(e)}},{key:"onopen",value:function(){this.cleanup(),this._readyState="open",this.emitReserved("open");var e=this.engine;this.subs.push(Pe(e,"ping",this.onping.bind(this)),Pe(e,"data",this.ondata.bind(this)),Pe(e,"error",this.onerror.bind(this)),Pe(e,"close",this.onclose.bind(this)),Pe(this.decoder,"decoded",this.ondecoded.bind(this)))}},{key:"onping",value:function(){this.emitReserved("ping")}},{key:"ondata",value:function(e){this.decoder.add(e)}},{key:"ondecoded",value:function(e){this.emitReserved("packet",e)}},{key:"onerror",value:function(e){this.emitReserved("error",e)}},{key:"socket",value:function(e,t){var n=this.nsps[e];return n||(n=new Oe(this,e,t),this.nsps[e]=n),n}},{key:"_destroy",value:function(e){for(var t=0,n=Object.keys(this.nsps);t<n.length;t++){var o=n[t];if(this.nsps[o].active)return}this._close()}},{key:"_packet",value:function(e){for(var t=this.encoder.encode(e),n=0;n<t.length;n++)this.engine.write(t[n],e.options)}},{key:"cleanup",value:function(){this.subs.forEach((function(e){return e()})),this.subs.length=0,this.decoder.destroy()}},{key:"_close",value:function(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}},{key:"disconnect",value:function(){return this._close()}},{key:"onclose",value:function(e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()}},{key:"reconnect",value:function(){var e=this;if(this._reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{var n=this.backoff.duration();this._reconnecting=!0;var o=this.setTimeoutFn((function(){t.skipReconnect||(e.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((function(n){n?(t._reconnecting=!1,t.reconnect(),e.emitReserved("reconnect_error",n)):t.onreconnect()})))}),n);this.opts.autoUnref&&o.unref(),this.subs.push((function(){clearTimeout(o)}))}}},{key:"onreconnect",value:function(){var e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}]),a}(T),Me={};function De(t,n){"object"===e(t)&&(n=t,t=void 0);var o,r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,o=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==n?n.protocol+"//"+e:"https://"+e),o=h(e)),o.port||(/^(http|ws)$/.test(o.protocol)?o.port="80":/^(http|ws)s$/.test(o.protocol)&&(o.port="443")),o.path=o.path||"/";var r=-1!==o.host.indexOf(":")?"["+o.host+"]":o.host;return o.id=o.protocol+"://"+r+":"+o.port+t,o.href=o.protocol+"://"+r+(n&&n.port===o.port?"":":"+o.port),o}(t,(n=n||{}).path||"/socket.io"),i=r.source,a=r.id,s=r.path,c=Me[a]&&s in Me[a].nsps;return n.forceNew||n["force new connection"]||!1===n.multiplex||c?o=new _e(i,n):(Me[a]||(Me[a]=new _e(i,n)),o=Me[a]),r.query&&!n.query&&(n.query=r.queryKey),o.socket(r.path,n)}return r(De,{Manager:_e,Socket:Oe,io:De,connect:De}),De},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).io=t()}"undefined"!=typeof module&&(module.exports=Ir),"function"==typeof define&&define.amd&&define("RTCMultiConnection",[],(function(){return Ir}));class Nr{constructor(e,n){t(this,"sceneManager"),t(this,"camera"),t(this,"_keys",[]),t(this,"keysUp",[38]),t(this,"keysDown",[40]),t(this,"keysLeft",[37]),t(this,"keysRight",[39]),t(this,"_onKeyDown"),t(this,"_onKeyUp"),this.camera=e,this.sceneManager=n}_onLostFocus(e){this._keys=[]}getClassName(){return"FreeCameraKeyboardWalkInput"}getSimpleName(){return"keyboard"}attachControl(e){var t=this.camera.getEngine().getInputElement();this._onKeyDown||(t.tabIndex=1,this._onKeyDown=t=>{-1===this.keysUp.indexOf(t.keyCode)&&-1===this.keysDown.indexOf(t.keyCode)&&-1===this.keysLeft.indexOf(t.keyCode)&&-1===this.keysRight.indexOf(t.keyCode)||(-1===this._keys.indexOf(t.keyCode)&&this._keys.push(t.keyCode),e||t.preventDefault())},this._onKeyUp=t=>{if(-1!==this.keysUp.indexOf(t.keyCode)||-1!==this.keysDown.indexOf(t.keyCode)||-1!==this.keysLeft.indexOf(t.keyCode)||-1!==this.keysRight.indexOf(t.keyCode)){var n=this._keys.indexOf(t.keyCode);n>=0&&this._keys.splice(n,1),e||t.preventDefault()}},t.addEventListener("keydown",this._onKeyDown,!1),t.addEventListener("keyup",this._onKeyUp,!1))}detachControl(){var e=this.camera.getEngine().getInputElement();this._onKeyDown&&(e.removeEventListener("keydown",this._onKeyDown),e.removeEventListener("keyup",this._onKeyUp),BABYLON.Tools.UnregisterTopRootEvents(canvas,[{name:"blur",handler:this._onLostFocus}]),this._keys=[],this._onKeyDown=null,this._onKeyUp=null)}checkInputs(){if(this._onKeyDown){var e=this.camera;const o=.3,r=.03,i=Math.PI/2,a=new BABYLON.Vector3(Math.cos(i),0,Math.sin(i));for(var t=0;t<this._keys.length;t++){var n=this._keys[t];-1!==this.keysLeft.indexOf(n)?this.sceneManager.lookLeft(r):-1!==this.keysRight.indexOf(n)?this.sceneManager.lookRight(r):-1!==this.keysUp.indexOf(n)?this.sceneManager.moveForward(o):-1!==this.keysDown.indexOf(n)&&this.sceneManager.moveBackward(o),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),BABYLON.Vector3.TransformNormalToRef(a,e._cameraTransformMatrix,e._transformedDirection),e.cameraDirection.addInPlace(e._transformedDirection)}}}}class Br{constructor(e,n){t(this,"vcReadyObj"),t(this,"base_point"),t(this,"base_point_up"),t(this,"engine"),t(this,"scene"),t(this,"canvas"),t(this,"camera"),t(this,"RTCMC"),t(this,"positionBroadcasterID"),t(this,"myPlayer"),t(this,"otherPlayers"),t(this,"defaultPosition",{LNG:33,LAT:33,ALT:33}),this.vcReadyObj=e,this.otherPlayers=new Map,this.canvas=n,navigator.geolocation?navigator.geolocation.getCurrentPosition((e=>{this.defaultPosition.LNG=e.coords.longitude,this.defaultPosition.LAT=e.coords.latitude,this.defaultPosition.ALT=e.coords.altitude,this.init(n)}),(()=>{alert("Unable to retrieve your position!"),this.init(n)}),{timeout:3e3}):alert("Geolocation is not supported by your browser!")}static cart2vec(e){return new oe.Vector3(e.x,e.z,e.y)}addPlayer(e,t,n){var o,r=512;const i=new oe.StandardMaterial("defaultMat",this.scene);i.emissiveColor=oe.Color3.Gray(),i.reflectionTexture=new oe.CubeTexture("https://playground.babylonjs.com/textures/TropicalSunnyDay",this.scene),i.reflectionFresnelParameters=new oe.FresnelParameters,i.reflectionFresnelParameters.leftColor=oe.Color3.White(),i.reflectionFresnelParameters.rightColor=oe.Color3.Black();var a=i.diffuseTexture=new oe.DynamicTexture("dynamicTexture",{width:r,height:r},this.scene),s="bold 96px monospace";var c=(null==(o=hi.system.useUserStore().info)?void 0:o.username)||"Hello!",d=a.getContext();d.font=s;var l=d.measureText(c).width;a.drawText(c,(r-l)/2,280,s,"#FF0000","#00FFFF",!1,!0);var u=[];u[0]=new oe.Vector4(0,0,1,1),u[1]=new oe.Vector4(0,0,0,0),u[2]=new oe.Vector4(0,0,1,1);var p=oe.MeshBuilder.CreateCylinder("player-"+e.id,{height:9,diameter:58,diameterBottom:66,faceUV:u},this.scene);p.id=t,p.rotation.z=Math.PI,p.rotation.y=5*Math.PI/6,p.rotation.x=1*Math.PI/6;var m=new oe.StandardMaterial("playerMat-"+e.id,this.scene),f=new oe.VideoTexture(e.id,e,this.scene,!1,!0);m.diffuseTexture=f,m.roughness=1,m.emissiveColor=oe.Color3.Gray(),m.reflectionTexture=new oe.CubeTexture("https://playground.babylonjs.com/textures/TropicalSunnyDay",this.scene),m.reflectionFresnelParameters=new oe.FresnelParameters,m.reflectionFresnelParameters.leftColor=oe.Color3.White(),m.reflectionFresnelParameters.rightColor=oe.Color3.Black();const h=new oe.MultiMaterial("playerMultiMat",this.scene);h.subMaterials.push(m),h.subMaterials.push(i),p.material=h;const v=p.getTotalVertices();new oe.SubMesh(0,0,v,0,51,p),new oe.SubMesh(1,0,v,51,51,p),new oe.SubMesh(1,0,v,102,116,p),this.scene.onPointerObservable.add((e=>{e.pickInfo.pickedMesh===p&&(f.video.paused?f.video.play():f.video.pause())}),oe.PointerEventTypes.POINTERPICK),n?(p.position=new oe.Vector3(this.defaultPosition.LNG,this.defaultPosition.LAT,this.defaultPosition.ALT),this.myPlayer=p,this.myPlayer.parent=this.camera,this.positionBroadcasterID=setInterval((()=>{this.RTCMC&&this.RTCMC.socket.emit("updatePosition",{player:t,target:this.myPlayer.position})}),3e3)):(p.position=oe.Vector3.Zero(),this.otherPlayers[t]=p)}initRTC(){Ar();const e=new Ir;e.socketURL="http://localhost:9001/",e.session={audio:!0,video:!0,data:!0},e.sdpConstraints.mandatory={OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},e.onstream=t=>{e.setCustomSocketEvent("updatePosition"),e.socket.on("updatePosition",(e=>{this.otherPlayers[e.player].position=e.target})),e.setCustomSocketEvent("updateRotation"),e.socket.on("updateRotation",(e=>{"left"==e.target?this.otherPlayers[e.player].rotation.z+=Math.PI/66:"right"==e.target&&(this.otherPlayers[e.player].rotation.z-=Math.PI/66)})),e.setCustomSocketEvent("movePOV"),e.socket.on("movePOV",(e=>{this.otherPlayers[e.player].movePOV(0,e.target.y,0)})),"local"===t.type?this.addPlayer(t.mediaElement,t.userid,!0):this.addPlayer(t.mediaElement,t.userid,!1)},e.onclose=e=>{let t;t="local"===e.type?this.myPlayer:this.otherPlayers[e.userid],t.dispose(),"local"===e.type?(this.myPlayer=null,clearInterval(this.positionBroadcasterID)):delete this.otherPlayers[e.userid]},e.onstreamended=e=>{let t;t="local"===e.type?this.myPlayer:this.otherPlayers[e.streamid];const n=t.material.diffuseTexture.video;for(;n.firstChild;)n.removeChild(n.lastChild);n.src="",n.removeAttribute("src"),n.load(),n.remove(),t.dispose(),"local"===e.type?this.myPlayer=null:delete this.otherPlayers[e.userid]},e.openOrJoin("GV-Globe"),this.RTCMC=e}moveBabylonCamera(){let e=this.vcReadyObj.Cesium.Math.toDegrees(this.vcReadyObj.viewer.camera.frustum.fovy);this.camera.fov=e/180*Math.PI;let t=this.vcReadyObj.viewer.camera.inverseViewMatrix,n=oe.Matrix.FromValues(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]),o=oe.Vector3.Zero(),r=oe.Vector3.Zero(),i=oe.Vector3.Zero();n.decompose(o,r,i);let a=Br.cart2vec(i),s=Br.cart2vec(this.vcReadyObj.viewer.camera.direction),c=Br.cart2vec(this.vcReadyObj.viewer.camera.up),d=Math.atan(s.z/s.x);s.x<0&&(d+=Math.PI),d=Math.PI/2-d;let l=Math.asin(-s.y),u=new oe.Vector3(-Math.cos(d),0,Math.sin(d)),p=Math.acos(c.x*u.x+c.y*u.y+c.z*u.z);p=Math.PI/2-p,c.y<0&&(p=Math.PI-p),this.camera.position.x=a.x-this.base_point.x,this.camera.position.y=a.y-this.base_point.y,this.camera.position.z=a.z-this.base_point.z,this.camera.rotation.x=l,this.camera.rotation.y=d,this.camera.rotation.z=p}initCesium(){this.base_point=Br.cart2vec(this.vcReadyObj.Cesium.Cartesian3.fromDegrees(this.defaultPosition.LNG,this.defaultPosition.LAT,50)),this.base_point_up=Br.cart2vec(this.vcReadyObj.Cesium.Cartesian3.fromDegrees(this.defaultPosition.LNG,this.defaultPosition.LAT,300)),this.vcReadyObj.viewer.camera.flyTo({destination:this.vcReadyObj.Cesium.Cartesian3.fromDegrees(this.defaultPosition.LNG,this.defaultPosition.LAT-.003,this.defaultPosition.ALT+60),orientation:{heading:this.vcReadyObj.Cesium.Math.toRadians(0),pitch:this.vcReadyObj.Cesium.Math.toRadians(-10)}})}initBabylon(e){const t=new oe.Engine(e),n=new oe.Scene(t);n.clearColor=new oe.Color4(0,0,0,0);const o=new oe.UniversalCamera("camera",new oe.Vector3(0,0,-10),this.scene);n.activeCamera=o,n.activeCamera.attachControl(e,!0);const r=new oe.TransformNode("BaseNode",n);r.lookAt(this.base_point_up.subtract(this.base_point)),r.addRotation(Math.PI/2,0,0),t.runRenderLoop((()=>{this.vcReadyObj.viewer.render(),this.moveBabylonCamera(),n.render()})),o.inputs.removeByType("FreeCameraKeyboardMoveInput"),o.inputs.removeByType("FreeCameraMouseInput"),o.inputs.add(new Nr(o,this)),this.engine=t,this.scene=n,this.camera=o}init(e){this.initCesium(),this.initBabylon(e),this.initRTC()}updatePosition(){this.RTCMC.socket.emit("updatePosition",{player:this.myPlayer.id,target:this.myPlayer.position})}updateRotation(){this.RTCMC.socket.emit("updateRotation",{player:this.myPlayer.id,target:this.myPlayer.rotation})}lookLeft(e){this.vcReadyObj.viewer.camera.lookLeft(e),this.RTCMC.socket.emit("updateRotation",{player:this.myPlayer.id,target:"left"})}lookRight(e){this.vcReadyObj.viewer.camera.lookRight(e),this.RTCMC.socket.emit("updateRotation",{player:this.myPlayer.id,target:"right"})}rotateLeft(e){this.vcReadyObj.viewer.camera.rotateLeft(e)}rotateRight(e){this.vcReadyObj.viewer.camera.rotateRight(e)}moveForward(e){this.vcReadyObj.viewer.camera.moveForward(e),this.myPlayer.movePOV(0,.3,0),this.updatePosition()}moveBackward(e){this.vcReadyObj.viewer.camera.moveBackward(e),this.myPlayer.movePOV(0,-.3,0),this.updatePosition()}}const Vr={class:"vc-drawtip vc-tooltip--style"},jr=y({name:"VcDemoViewer",__name:"Index",emits:["viewerReady","cesiumReady","leftClick","destroyed"],setup(e,{emit:t}){const n={"en-US":Tt,"zh-CN":xt},{locale:o}=Y(),r=t,i=R((()=>n[o.value])),a=hi.system.useThemeStore(),s=R((()=>a.themeConfig[a.activeName])),{toggleGlobalLayout:c}=hi.system.useLayoutStore(),{registerTimeout:d}=Ze(),l=C(null),u=C([0,75]),p=R((()=>({outerOptions:{icon:s.value.navigation.themeVcCompassOuterIcon,color:s.value.navigation.themeVcCompassOuterColor},innerOptions:{icon:s.value.navigation.themeVcCompassInnerIcon,color:s.value.navigation.themeVcCompassInnerColor,background:s.value.navigation.themeVcCompassInnerBackgroundColor},markerOptions:{color:s.value.global.themeColorAlpha},duration:5}))),m=R((()=>({background:s.value.navigation.themeVcZoomControlBackgroundColor,color:s.value.global.themeColor,border:`solid 1px ${s.value.commonPanel.themeCommonPanelListBorderColor}`,zoomInOptions:{color:s.value.global.themeColor},zoomOutOptions:{color:s.value.global.themeColor},zoomResetOptions:{color:s.value.global.themeColor}}))),f=R((()=>({color:s.value.global.themeColor,background:s.value.navigation.themeVcPrintBackgroundColor,round:!0}))),h=R((()=>({color:s.value.global.themeColor,background:s.value.navigation.themeVcPrintBackgroundColor,round:!0}))),v=R((()=>({position:"bottom-right",offset:[0,10],statusBarOpts:{color:s.value.global.themeColor,background:s.value.navigation.themeVcStatusBarBackgroundColor},distancelegendOpts:{color:s.value.global.themeColor,background:s.value.navigation.themeVcDistanceLegendBackgroundColor}}))),y=hi.viewer.useOverlayStore().mouseOverNameOpts;hi.viewer.useRenderStore().selectedRenderData;const S=R((()=>[...hi.viewer.useLayerStore().baseLayers,...hi.viewer.useLayerStore().overlayLayers])),T=R((()=>hi.viewer.useLayerStore().terrainLayers)),x=document.getElementsByTagName("canvas")[0],P=e=>{r("viewerReady",e),c({header:!0}),d((()=>{c({content:!0})}),500),new Br(e,x)},O=e=>{r("cesiumReady",e)};return(e,t)=>{const n=g("vc-navigation"),o=g("vc-ajax-bar"),r=g("vc-overlay-html"),a=g("vc-viewer");return b(),k(U(dt),{locale:i.value,"cesium-path":U("https://unpkg.com/cesium@latest/Build/Cesium/Cesium.js"),"access-token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI5Y2U0ZTk2Ni1jNzdkLTQ3OWYtYjVmYS0yMGM3YTk3NjgzMmUiLCJpZCI6Njk5Nywic2NvcGVzIjpbImFzciIsImdjIl0sImlhdCI6MTU0ODA1MTc0OH0.Csy6yyAnv6JSBppH0Ou3ahshqcHFEhP27iOz5gjQMEo"},{default:L((()=>[E(a,{ref_key:"viewerRef",ref:l,class:"main-viewer",onReady:P,onCesiumReady:O},{default:L((()=>[E(n,{offset:u.value,"compass-opts":p.value,"zoom-opts":m.value,"print-opts":f.value,"location-opts":h.value,"other-opts":v.value},null,8,["offset","compass-opts","zoom-opts","print-opts","location-opts","other-opts"]),E(o,{position:"bottom",color:"#21BA45",size:"3px",positioning:"fixed"}),E(U(Dr)),(b(!0),w(z,null,q(S.value,((e,t)=>(b(),k(re(e.component),ee({key:"layer"+t,ref_for:!0},e.props),{default:L((()=>[(b(!0),w(z,null,q(null==e?void 0:e.children,((e,n)=>(b(),k(re(e.component),ee({key:t+"_"+n,ref_for:!0},e.props),null,16)))),128))])),_:2},1040)))),128)),(b(!0),w(z,null,q(T.value,((e,t)=>(b(),w(z,{key:"terrain"+t},[e.props.show?(b(),k(re(e.component),ee({key:0,ref_for:!0},e.props),null,16)):I("",!0)],64)))),128)),U(y).show?(b(),k(r,{key:0,position:U(y).position,"pixel-offset":U(y).pixelOffset},{default:L((()=>[D("div",Vr,M(U(y).text),1)])),_:1},8,["position","pixel-offset"])):I("",!0),X(e.$slots,"default")])),_:3},512)])),_:3},8,["locale","cesium-path"])}}}),Ur={key:0,elevated:"",class:"main-header-container text-h4 text-center text-white"},Fr={key:1,class:"content"},zr=Jn(y({name:"VcDemoMainLayout",__name:"MainLayout",setup(e){V((e=>({"584dfd5c":d.value.header.themeHeaderContentBackgroundColor,"32b772ff":d.value.menu.themeMenuColor,"5ea75299":d.value.menu.themeMenuActiveColor})));const t=x(),n=Ot(hi.system.useLayoutStore()).global,{active:o}=Ot(hi.system.useGrayStore()),r=hi.system.useMenuStore(),i=C(!1),a=R((()=>{const e=r.header;return e.length?e[0].children:[]})),s=R((()=>r.aside)),c=R((()=>t.name)),d=R((()=>{const e=hi.system.useThemeStore();return e.themeConfig[e.activeName]}));return K((()=>t.matched),(e=>{var t,n;if(e.length>1){const o=a.value.filter((t=>t.path===e[1].path));if(o.length){const e=null==(n=null==(t=o[0])?void 0:t.children)?void 0:n.filter((e=>10===e.type));(null==e?void 0:e.length)?r.asideSet(e):r.asideSet([])}else r.asideSet([])}}),{immediate:!0}),S((()=>{hi.system.useAccountStore().load(),window.onunhandledrejection=e=>{hi.system.useLogStore(fi).push({message:Mt.get(e,"reason.message","Unknown error"),type:"danger",meta:{error:Mt.get(e,"reason"),trace:Mt.get(e,"reason.stack")}})},window.onerror=(e,t,n,o,r)=>{hi.system.useLogStore(fi).push({message:Mt.get(r,"message","Unknown error"),type:"danger",meta:{error:r,trace:Mt.get(r,"stack"),source:`${t}@${n}:${o}`,event:e}})},window.addEventListener("keydown",(function(e){"F11"===e.code&&(e.preventDefault(),Ue.toggle())}))})),(e,t)=>{const r=g("router-view");return b(),k(Fe,{view:"hHh Lpr fFf",class:F(["main-layout",{"gray-mode":U(o)}])},{default:L((()=>{var o;return[(null==(o=s.value)?void 0:o.length)&&U(n).header?(b(),k(ze,{key:0,modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),"show-if-above":"",width:180,breakpoint:500,bordered:"",mini:U(n).leftDrawerMini},{default:L((()=>[E(pe,{class:"drawer-menu-list"},{default:L((()=>[(b(!0),w(z,null,q(s.value,((t,o)=>(b(),w(z,{key:o},[B((b(),k(ge,{clickable:"","active-class":"menu-active-item",active:t.name===c.value,onClick:n=>e.$router.push(t.path),href:t.href,target:t.target},{default:L((()=>[E(me,{avatar:""},{default:L((()=>[E(he,{name:t.icon},null,8,["name"])])),_:2},1024),E(me,null,{default:L((()=>[_(M(e.$t(t.title)||t.caption),1)])),_:2},1024),U(n).leftDrawerMini?(b(),k(de,{key:0,"transition-show":"scale","transition-hide":"scale",anchor:"center right",self:"center left"},{default:L((()=>[_(M(e.$t(t.title)||t.caption),1)])),_:2},1024)):I("",!0)])),_:2},1032,["active","onClick","href","target"])),[[ye]]),t.separator?(b(),k(Ne,{key:"sep"+o})):I("",!0)],64)))),128))])),_:1})])),_:1},8,["modelValue","mini"])):I("",!0),E(Ge,{class:"no-padding"},{default:L((()=>[E(qe,{class:"interaction-root"},{default:L((()=>[E(jr,null,{default:L((()=>[U(n).header?(b(),w("header",Ur,[E(lr)])):I("",!0),U(n).content?(b(),w("div",Fr,[E(_r),E(r)])):I("",!0)])),_:1})])),_:1})])),_:1})]})),_:1},8,["class"])}}}),[["__scopeId","data-v-79ce8a36"]]),qr=Object.freeze(Object.defineProperty({__proto__:null,default:zr},Symbol.toStringTag,{value:"Module"})),Gr=gn([]);gn([]);const Wr={theme:{list:[{title:"经典",name:"classic",preview:"images/theme/classic/preview@2x.png"},{title:"Element",name:"element",preview:"images/theme/element/preview@2x.png"}]},menu:{asideCollapse:!1,asideTransition:!0},hotkey:{search:{open:"s",close:"esc"}},transition:{active:!0}},Hr=Rt("menu",{state:()=>({header:[],aside:[],asideCollapse:Wr.menu.asideCollapse,asideTransition:Wr.menu.asideTransition,moduleHeader:[]}),getters:{},actions:{async asideCollapseSet(e){this.asideCollapse=e;Gn().set({dbName:"sys",path:"menu.asideCollapse",value:String(this.asideCollapse),user:!0})},async asideCollapseToggle(){this.asideCollapse=!this.asideCollapse;Gn().set({dbName:"sys",path:"menu.asideCollapse",value:String(this.asideCollapse),user:!0})},async asideTransitionSet(e){this.asideTransition=e;Gn().set({dbName:"sys",path:"menu.asideTransition",value:String(this.asideTransition),user:!0})},async asideTransitionToggle(){this.asideTransition=!this.asideTransition;Gn().set({dbName:"sys",path:"menu.asideTransition",value:String(this.asideTransition),user:!0})},async asideLoad(){Gn().get({dbName:"sys",path:"menu",defaultValue:String(Wr.menu),user:!0})},headerSet(e){this.header=e},asideSet(e){this.aside=e},clear(){this.header=[],this.aside=[]},moduleHeaderSet(e){this.moduleHeader=e}}}),$r=Rt("search",{state:()=>({active:!1,hotkey:{open:Wr.hotkey.search.open,close:Wr.hotkey.search.close},pool:[]}),actions:{toggle(){this.active=!this.active},set(e){this.active=e},init(e){const t=[],n=function(e,o=[]){e.forEach((e=>{e.children?n(e.children,[...o,e.title]):t.push({...e,fullTitle:[...o,e.title].join(" / ")})}))};n(e),this.pool=t}}}),Jr=[...Gr];const Kr=Object.assign({"../../pages/create/Index.vue":$n,"../../pages/create/tbd/Index.vue":Yn,"../../pages/dynamic-render/Index.vue":Xn,"../../pages/dynamic-render/historical-track/Index.vue":to,"../../pages/dynamic-render/recursive-list/Index.vue":bo,"../../pages/dynamic-render/recursive-list/work-bench/Index.vue":vo,"../../pages/dynamic-render/stack/Index.vue":Po,"../../pages/expansion/Index.vue":Oo,"../../pages/expansion/typhoon/Index.vue":Mo,"../../pages/happiness/Index.vue":Io,"../../pages/happiness/hsa/Index.vue":No,"../../pages/home/Index.vue":jo,"../../pages/system/Error404.vue":Wo,"../../pages/system/Login.vue":Zo,"../../pages/test/on-demand/Index.vue":tr});function Yr(e,t){return null==e&&(e={path:"/",children:[]}),t.forEach((t=>{let n=e;if(20!==t.type&&(null!=(o=t.component)&&""!==o)){let o=null;o="MainLayout"===t.component?zr:(e=>{const t=Kr[`../../pages${e}/Index.vue`];if(t)return t.default;Jt(`动态路由页面【${e}】加载失败。请检查页面文件是否存在。`)})(t.path);const r=e.children;n={path:t.path,name:t.name,component:o,meta:{title:t.title,auth:!0,cache:!0}},t.redirect&&(n.redirect=t.redirect),r.push(n)}var o;null!=t.children&&t.children.length>0&&(null==n.children&&(n.children=[]),Yr(n,t.children))})),e.children}function Qr(e,t){return null==e&&(e=[]),e.forEach((e=>{null!=e.permission&&""!==e.permission&&t.push(e.permission),null!=e.children&&e.children.length>0&&Qr(e.children,t)})),t}function Xr(e){null==e&&(e=[]);let t=[];return e.forEach((e=>{if(10!==e.type)return;let n,o;null!=e.children&&e.children.length>0&&(n=Xr(e.children)),null!=e.icon&&""!==e.icon&&(o=e.icon),t.push({icon:o,children:n,...e})})),0===t.length&&(t=void 0),t}const Zr=Rt("permission",{state:()=>({routes:[],addRoutes:[],permissions:[],inited:!1}),getters:{},actions:{setRoutes({accessedRoutes:e,permissions:t}){this.addRoutes=e,this.routes=Ht.concat(e),this.inited=!0,this.permissions=t},clear(){this.addRoutes=[],this.routes=[],this.inited=!1,this.permissions=[]},generateRoutes({menuTree:e}){return new Promise((t=>{const n=Yr(null,e),o=Qr(e,[]);this.setRoutes({accessedRoutes:n,permissions:o}),n.forEach((e=>{"layout"===e.name&&"/"===e.path&&(e.children=e.children.concat(Wt[0].children)),jn.addRoute(e)}));const r=gn(Xr(e));Gr.splice(0,Gr.length),Gr.push(...Jr),Gr.push(...r);Hr().headerSet(Gr);$r().init(Gr),t(!0)}))},async getAccessibleMenus({state:e,dispatch:t}){}}}),ei=Rt("gray",{state:()=>({active:!1}),getters:{},actions:{toggle(){this.active=!this.active},set(e){this.active=e}}}),ti={themeName:"classic",global:{themeBGColor:"#ebf1f6",themeBGMaskColor:"rgba(0, 0, 0, 0)",themeColor:"#cbe1e5",themeColorAlpha:"rgba(255, 255, 255, 0.6)",themeColorActive:"#fff",themeScrollTopBackgroundColor:"rgba(0, 0, 0, 0)",themeQInputColor:"#fff",themeQInputBorderColor:"#fff9",themeQCheckboxTruthyColor:"#1976d2",themeQMenuColor:"#fff",themeQMenuBackgroundColor:"rgba(0, 68, 82, 0.6)",themeQCardColor:"#fff",themeQCardHeaderBackgroundColor:"rgba(0, 101, 122, 0.5)",themeQCardBackgroundColor:"rgba(0, 68, 82, 0.6)",themeQScrollAreaColor:"#fff"},header:{themeHeaderColor:"#cbe1e5",themeHeaderTitleColor:"#fff",themeHeaderLogoBackgroundColor:"rgba(255, 255, 255, 0)",themeHeaderBackgroundColor:"rgba(29, 29, 29, 0)",themeHeaderContentBackgroundColor:"rgba(0, 68, 82, 0.6)"},commonPanel:{themeCommonPanelHeaderColor:"#fff",themeCommonPanelHeaderBackgroundColor:"rgba(0, 101, 122, 0.8)",themeCommonPanelContentColor:"#fff",themeCommonPanelContentBackgroundColor:"rgba(0, 68, 82, 0.6)",themeCommonPanelListColor:"#fff",themeCommonPanelListBorderColor:"rgba(255, 255, 255, 0.278)"},navigation:{themeVcCompassOuterIcon:"svguse:#vc-icons-compass-outer",themeVcCompassOuterColor:"rgba(0, 68, 82)",themeVcCompassInnerIcon:"fa fa-compass",themeVcCompassInnerColor:"rgba(255, 255, 255, 0.7)",themeVcCompassInnerBackgroundColor:"rgba(0, 68, 82, 0.6)",themeVcZoomControlBackgroundColor:"rgba(0, 68, 82, 0.6)",themeVcPrintBackgroundColor:"rgba(0, 68, 82, 0.6)",themeVcStatusBarBackgroundColor:"rgba(0, 68, 82, 0.8)",themeVcDistanceLegendBackgroundColor:"rgba(0, 68, 82, 0.8)"},pageLogin:{themePageLoginColor:"#fff",themePageLoginBackground:"rgba(29,29,29, 0.5)"},menu:{themeMenuColor:"#cbe1e5",themeMenuActiveColor:"#fff",themeMenuActiveBackgroundColor:"#F2C037"}},ni={themeName:"element",global:{themeBGColor:"#314255",themeBGMaskColor:"rgba(0, 0, 0, 0)",themeColor:"#bfcbd9",themeColorAlpha:"rgba(70, 160, 252, 0.6)",themeColorActive:"#46a0fc",themeScrollTopBackgroundColor:"rgba(0, 0, 0, 0)",themeQInputColor:"#bfcbd9",themeQInputBorderColor:"#fff9",themeQCheckboxTruthyColor:"#46a0fc",themeQMenuColor:"#bfcbd9",themeQMenuBackgroundColor:"rgba(29, 29, 29, 0.6)",themeQCardColor:"#bfcbd9",themeQCardHeaderBackgroundColor:"rgba(49, 66, 85, 0.5)",themeQCardBackgroundColor:"rgba(29, 29, 29, 0.6)",themeQScrollAreaColor:"#46a0fc"},header:{themeHeaderColor:"#bfcbd9",themeHeaderTitleColor:"#bfcbd9",themeHeaderLogoBackgroundColor:"#314255",themeHeaderBackgroundColor:"#202d3d",themeHeaderContentBackgroundColor:"#314255"},commonPanel:{themeCommonPanelHeaderColor:"#bfcbd9",themeCommonPanelHeaderBackgroundColor:"rgba(49, 66, 85, 0.8)",themeCommonPanelContentColor:"#bfcbd9",themeCommonPanelContentBackgroundColor:"rgba(32, 45, 61, 0.6)",themeCommonPanelListColor:"#bfcbd9",themeCommonPanelListBorderColor:"rgba(255, 255, 255, 0.278)"},navigation:{themeVcCompassOuterIcon:"fa fa-circle-o-notch",themeVcCompassOuterColor:"rgb(49, 66, 85)",themeVcCompassInnerIcon:"fa fa-circle",themeVcCompassInnerColor:"rgba(49, 66, 85, 0.7)",themeVcCompassInnerBackgroundColor:"rgba(49, 66, 85, 0.6)",themeVcZoomControlBackgroundColor:"rgba(49, 66, 85, 0.6)",themeVcPrintBackgroundColor:"rgba(49, 66, 85, 0.6)",themeVcStatusBarBackgroundColor:"rgba(49, 66, 85, 0.8)",themeVcDistanceLegendBackgroundColor:"rgba(49, 66, 85, 0.8)"},pageLogin:{themePageLoginColor:"#bfcbd9",themePageLoginBackground:"rgba(32, 45, 61, 0.5)"},menu:{themeMenuColor:"#bfcbd9",themeMenuActiveColor:"#bfcbd9",themeMenuActiveBackgroundColor:"#F2C037"}};let oi="";const ri=Rt("theme",{state:()=>({list:Mt.get(Wr,"theme.list",[]),activeName:Mt.get(Wr,"theme.list[0].name","h2o"),themeConfig:{classic:ti,element:ni}}),getters:{activeSetting:e=>e.list.find((t=>t.name===e.activeName))},actions:{dom(){const e=`theme-${oi}`,t=`theme-${this.activeName}`;document.body.className.includes(e)?document.body.className=document.body.className.replace(e,t):document.body.className+=" "+t;const n=this.themeConfig[this.activeName];Object.keys(n.global).forEach((e=>{document.body.style.setProperty(`--${e}`,n.global[e])}))},async set(e){oi=this.activeName,this.activeName=this.list.find((t=>t.name===e))?e:this.list[0].name,this.dom();Gn().set({dbName:"sys",path:"theme.activeName",value:this.activeName,user:!0})},async load(){oi=this.activeName;const e=Gn(),t=e.get({dbName:"sys",path:"theme.activeName",defaultValue:this.list[0].name,user:!0});this.list.find((e=>e.name===t))?this.activeName=t:(this.activeName=this.list[0].name,e.set({dbName:"sys",path:"theme.activeName",value:this.activeName,user:!0})),this.dom()}}}),ii=Rt("transition",{state:()=>({active:Wr.transition.active}),actions:{async set(e){this.active=e;Gn().set({dbName:"sys",path:"transition.active",value:String(this.active),user:!0})},async load(){const e=Gn();this.active=e.get({dbName:"sys",path:"transition.active",defaultValue:String(Wr.transition.active),user:!0})}}}),ai=Rt("account",{state:()=>({}),getters:{},actions:{async login(e){const t=(await In.login(e)).data;Bt("token",t.token),Bt("uuid",t.id);Wn().set({...t}),this.load()},logout:({confirm:e=!1}={})=>new Promise(((t,n)=>{async function o(){jt("token"),jt("uuid");Wn().set({});Zr().clear();Hr().clear(),jn.push({name:"login"}),t(!0)}if(e){const e=ei();e.set(!0),We.create({title:"Log Out",message:"Confirm Log Out？",cancel:!0}).onOk((()=>{e.set(!1),o()})).onCancel((()=>{e.set(!1),se.create({message:"Cancel Log Out"}),t(!1)}))}else o()})),async load(){Wn().load();ri().load();ii().load();Hr().asideLoad()}}}),si=Rt("layout",{state:()=>({global:{header:!1,leftDrawerMini:!0,content:!1,footer:!1,layerManager:!1,navigation:!1,featureInfo:!1,videoPlayer:!1},dynamicRender:{datasource:{workBench:!1}}}),getters:{},actions:{toggleGlobalLayout(e){Object.keys(e).forEach((t=>{Mt.isBoolean(e[t])&&(this.global[t]=e[t])}))},toggleDynamicRenderPageLayout(e){const t=(e,n)=>{Object.keys(e).forEach((o=>{c(e[o])?t(e[o],n[o]):Mt.isBoolean(e[o])&&(n[o]=e[o])}))};t(e,this.dynamicRender)}}}),ci=Rt("log",{state:()=>({log:[]}),getters:{length:e=>e.log.length,lengthError:e=>e.log.filter((e=>"danger"===e.type)).length},actions:{push({message:e,type:t="info",meta:n}){this.log.push({message:e,type:t,time:He.formatDate(Date.now(),"YYYY-MM-DD HH:mm:ss"),meta:{uuid:Vt("uuid"),token:Vt("token"),url:Mt.get(window,"location.href",""),...n}})},clean(){this.log=[]}}}),di={useAccountStore:e=>ai(e),useDBStore:e=>Gn(e),useGrayStore:e=>ei(e),useLayoutStore:e=>si(e),useLogStore:e=>ci(e),useMenuStore:e=>Hr(e),usePermissionStore:e=>Zr(e),useSearchStore:e=>$r(e),useThemeStore:e=>ri(e),useTransitionStore:e=>ii(e),useUserStore:e=>Wn(e)},li=Rt("layer",{state:()=>({baseLayers:[{name:"tianditu_img",text:"天地图影像",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderTianditu",props:{mapStyle:"img_c",token:"436ce7e50d27eede2f2929307e6b33c0",minimumLevel:0,maximumLevel:17}}]},{name:"tianditu_vec",text:"天地图街道",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderTianditu",props:{mapStyle:"vec_c",token:"436ce7e50d27eede2f2929307e6b33c0",minimumLevel:0,maximumLevel:17}}]},{name:"baidu_img",text:"百度影像",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderBaidu",props:{mapStyle:"img",projectionTransforms:{from:"BD09",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"baidu_vec",text:"百度街道",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderBaidu",props:{mapStyle:"vec",projectionTransforms:{from:"BD09",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"baidu_midnight",text:"百度街道_午夜蓝",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderBaidu",props:{mapStyle:"midnight",projectionTransforms:{from:"BD09",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"baidu_dark",text:"百度街道_黑夜",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderBaidu",props:{mapStyle:"dark",projectionTransforms:{from:"BD09",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"amap_img",text:"高德影像",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderAmap",props:{mapStyle:"6",projectionTransforms:{from:"GCJ02",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"amap_vec",text:"高德街道",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderAmap",props:{mapStyle:"7",projectionTransforms:{from:"GCJ02",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"tencent_img",text:"腾讯影像",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderTencent",props:{mapStyle:"img",projectionTransforms:{from:"GCJ02",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"tencent_vector",text:"腾讯街道",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderTencent",props:{mapStyle:"vector",projectionTransforms:{from:"GCJ02",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"tencent_vector_my",text:"腾讯街道_墨渊",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderTencent",props:{mapStyle:"vector",styleId:"4",projectionTransforms:{from:"GCJ02",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"osm",text:"OSM",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderOsm"}]},{name:"arcgis",text:"ArcGIS",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderArcgis"}]}],overlayLayers:[{name:"tianditu_cva",text:"天地图注记",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:30,show:!1},children:[{component:"VcImageryProviderTianditu",props:{mapStyle:"cva_c",token:"436ce7e50d27eede2f2929307e6b33c0",minimumLevel:0,maximumLevel:17}}]},{name:"amap_label",text:"高德注记",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:30,show:!1},children:[{component:"VcImageryProviderAmap",props:{mapStyle:"8",ltype:"4",minimumLevel:0,maximumLevel:17,projectionTransforms:{from:"GCJ02",to:"WGS84"}}}]},{name:"amap_traffictile",text:"高德路况",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:30,show:!1},children:[{component:"VcImageryProviderAmap",props:{url:"/traffictile?v=1.0&x={x}&y={y}&z={z}&t=1",minimumLevel:0,maximumLevel:17,projectionTransforms:{from:"GCJ02",to:"WGS84"}}}]},{name:"baidu_traffic",text:"百度路况",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:30,show:!1},children:[{component:"VcImageryProviderBaidu",props:{mapStyle:"traffic",projectionTransforms:{from:"BD09",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"admin",text:"行政区划",component:"VcDatasourceGeojson",props:{strokeWidth:5,stroke:"#ffc107",fill:"transparent",show:!1,data:"./datas/china.json"},children:[]}],terrainLayers:[{name:"terrain",text:"全球地形",component:"VcTerrainProviderCesium",props:{show:!1}},{name:"null",text:"不显示地形",component:void 0,props:{show:!1}}]}),getters:{},actions:{toggle({names:e,show:t}){const n=[...this.baseLayers,...this.overlayLayers,...this.terrainLayers];(e=Array.isArray(e)?e:[e]).forEach((e=>{var o;const r=Mt.find(n,(t=>t.name===e));!Mt.isUndefined(null==r?void 0:r.show)&&(r.show=t),!Mt.isUndefined(null==(o=null==r?void 0:r.props)?void 0:o.show)&&(r.props.show=t)}))},loadDefaultLayers(e){const t=[...this.baseLayers,...this.overlayLayers,...this.terrainLayers].map((e=>e.name));this.toggle({names:t,show:!1});this.toggle({names:["tianditu_img","admin"],show:!0})}}}),ui=Rt("overlay",{state:()=>({mouseOverNameOpts:{position:[117.186419,45.66446,20],show:!1,text:"",pixelOffset:[0,0]}}),getters:{},actions:{setMouseOverlayLabel({position:e,show:t,text:n,pixelOffset:o}){this.mouseOverNameOpts.position=e,this.mouseOverNameOpts.show=t,this.mouseOverNameOpts.text=n,this.mouseOverNameOpts.pixelOffset=o},clearMouseOverlayLabel(){this.mouseOverNameOpts.position=void 0,this.mouseOverNameOpts.show=!1,this.mouseOverNameOpts.text=void 0}}}),pi=Rt("render",{state:()=>({renderDatas:[],selectedRenderData:{model:void 0,renderingType:void 0,restoreHandlers:[],feature:void 0,featureInfoListItems:[]}}),getters:{},actions:{addRenderDatas(e){(e=Array.isArray(e)?e:[e]).forEach((e=>{-1===Mt.findIndex(this.renderDatas,(t=>t.id===e.id))?this.renderDatas.push(e):Kt(`添加渲染数据集失败，原因：id 为【${e.id} 】的数据已经存在。`,"渲染数据模型：",e)}))},removeRenderDataById(e){Mt.remove(this.renderDatas,(t=>t.id===e))},removeRenderDataByType(e){Mt.remove(this.renderDatas,(t=>t.type===e))},removeRenderDataByPage(e){Mt.remove(this.renderDatas,(t=>t.page===e))},removeAllRenderData(){this.renderDatas.length=0},setSelectedRenderData(e,t){this.selectedRenderData.model=e.model,this.selectedRenderData.renderingType=e.renderingType,this.selectedRenderData.feature=e.feature,this.selectedRenderData.featureInfoListItems=e.featureInfoListItems,t?this.selectedRenderData.restoreHandlers=[]:this.selectedRenderData.restoreHandlers.push(...e.restoreHandlers)},getRenderDataByDatasetId(e){return Mt.find(this.renderDatas,(t=>t.id===e))}}}),mi={useLayerStore:e=>li(e),useOverlayStore:e=>ui(e),useRenderStore:e=>pi(e)},fi=Lt(),hi={system:{...di},viewer:{...mi}};const vi=ie(Jn({},[["render",function(e,t){const n=g("router-view");return b(),k(n)}]]));vi.use($e,{plugins:{Notify:se,Dialog:We,LocalStorage:ae,Loading:Je,AppFullscreen:Ue},lang:Ke}),vi.use(Vn),vi.use(Pt),vi.use(fi),vi.use(jn),vi.mount("#app");
