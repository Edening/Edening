var e=Object.defineProperty,t=(t,n,o)=>(((t,n,o)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o})(t,"symbol"!=typeof n?n+"":n,o),o);import{cp as n,c9 as o,bE as r,cq as a,cr as i,cs as s,ct as c,cb as d,c8 as l,bz as u,cu as p,cv as m,cw as h,cx as f,cy as v,cz as y,bO as g,cA as b,cB as k,cC as w,cD as C,by as S,bY as T,bZ as P,cE as x,bH as R,bN as O,bL as L,cF as M,cG as E,cH as _,cI as I,cJ as D,ch as A,b$ as N,bQ as B,bR as V,cK as j,c2 as U,bT as F,cL as z,cM as G,cN as W,bS as q,cl as H,cO as $,cP as J,cQ as K,bG as Y,cR as X,cS as Q,co as Z,cT as ee,cU as te,bU as ne,cV as oe,cW as re,cX as ae,cY as ie,cZ as se,c_ as ce,c$ as de,d0 as le,d1 as ue,d2 as pe,d3 as me,d4 as he,d5 as fe,d6 as ve,d7 as ye,d8 as ge,d9 as be,da as ke,db as we,dc as Ce,dd as Se,de as Te,df as Pe,dg as xe,bP as Re}from"./vendor-fa080de3.js";import{P as Oe,N as Le,Q as Me,a as Ee,b as _e,c as Ie,d as De,e as Ae,f as Ne,g as Be,h as Ve,R as je,i as Ue,j as Fe,k as ze,l as Ge,u as We,m as qe,n as He,o as $e,C as Je,p as Ke,q as Ye,r as Xe,s as Qe,t as Ze,v as et,w as tt,x as nt,y as ot,z as rt,A as at,B as it,D as st,E as ct,F as dt,G as lt,H as ut,I as pt,J as mt,K as ht,L as ft,M as vt,O as yt}from"./vendor-quasar-1a785e27.js";import{m as gt,f as bt,u as kt,a as wt,V as Ct,b as St,c as Tt,d as Pt,e as xt,g as Rt,h as Ot,i as Lt,j as Mt,k as Et,l as _t,n as It,o as Dt,p as At,q as Nt,r as Bt}from"./vendor-vue-cesium-126dbdcf.js";import{d as Vt,s as jt,c as Ut}from"./vendor-pinia-6986e695.js";import{A as Ft,a as zt}from"./vendor-axios-9a1ec0cf.js";import{l as Gt}from"./vendor-lodash-397af0f8.js";import{L as Wt,l as qt}from"./vendor-lowdb-27e07a82.js";import{i as Ht}from"./vendor-interactjs-99560c5a.js";import"./vendor-echarts-8e07c436.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const $t="VueCesiumDemo";function Jt(e="default",t=""){Oe.set(`${$t}-0.0.1-${e}`,t)}function Kt(e="default"){return Oe.getItem(`${$t}-0.0.1-${e}`)}function Yt(e="default"){Oe.remove(`${$t}-0.0.1-${e}`)}const Xt=[{path:"/",name:"layout",component:()=>n((()=>Promise.resolve().then((()=>Xr))),void 0,import.meta.url),redirect:{path:"/home"},children:[{name:"login",path:"/login",component:()=>n((()=>Promise.resolve().then((()=>ir))),void 0,import.meta.url)}]}],Qt=[{path:"/:catchAll(.*)*",name:"404",component:()=>n((()=>Promise.resolve().then((()=>Qo))),void 0,import.meta.url)}],Zt=[{name:"test-on-demand",path:"/test-on-demand",meta:{title:"ttt"},component:()=>n((()=>Promise.resolve().then((()=>cr))),void 0,import.meta.url)}],en=Xt,tn=[...Xt,...Zt,...Qt],nn="VueCesiumDemo",on=((e="")=>function(...t){e&&(o(t[0])?t[0]=e.trim()+" "+t[0]:t=[e.trim(),...t]);const n=t.shift(),r=new Error(n);Sa.system.useLogStore(Ca).push({message:"业务逻辑警告",type:"warning",meta:{error:r}}),Le.create({message:n,timeout:3e3,type:"warning"})})(`[${nn}] WARN `),rn=((e="")=>function(...t){e&&(o(t[0])?t[0]=e.trim()+" "+t[0]:t=[e.trim(),...t]);const n=t.shift(),r=new Error(n);Sa.system.useLogStore(Ca).push({message:"业务逻辑异常",type:"danger",meta:{error:r}}),Le.create({message:n,timeout:3e3,type:"negative"})})(`[${nn}] ERR `),an=((e="")=>function(...t){e&&(o(t[0])?t[0]=e.trim()+" "+t[0]:t=[e.trim(),...t])})(`[${nn}] Debug `);function sn(e,t,n){return un(e,t.geometry.coordinates,n,t)}function cn(e,t,n){const o=[],r=t.geometry.coordinates;for(let a=0;a<r.length;a++)o.push(un(e,r[a],n,t));return o}function dn(e,t,n){return pn(e,t.geometry.coordinates,n,t)}function ln(e,t,n,o){var a;const i=!Cesium.defined(o.properties.checked)||r(o.properties,"checked");o.properties.actualRenderingType=n;const s={id:Cesium.createGuid(),position:t,show:i,feature:Gt.cloneDeep(o)};if(s[n]={...e[n]},"model"===n){const e=JSON.parse((null==(a=o.properties)?void 0:a.hpr)||"{}");if(Array.isArray(e)){const n=gt(t),o=new Cesium.HeadingPitchRoll(...e);s.orientation=Cesium.Transforms.headingPitchRollQuaternion(n,o)}}return s}function un(e,t,n,o){const c=r(o.properties,"checked");if(o.properties.actualRenderingType=n,"polygon"===n){return dn(e,a(o),n)}if("billboard"===n||"point"===n||"label"===n){const t={show:c,position:("MultiPolygon"===o.geometry.type?i(o):s(o)).geometry.coordinates,feature:Gt.cloneDeep(o)};switch(n){case"billboard":t.billboard={...e.billboard};break;case"point":t.point={...e.point};break;case"label":t.label={text:o.properties.text||o.properties.name,...e.label}}return t}return{show:c,polyline:{positions:t,...e.polyline},feature:Gt.cloneDeep(o)}}function pn(e,t,n,o){const a=r(o.properties,"checked");if(o.properties.actualRenderingType=n,"polyline"===n){if("MultiPolygon"===o.geometry.type){const t=c(o),r=[];return t.features.forEach((t=>{"LineString"===t.geometry.type?r.push(sn(e,t,n)):r.push(...cn(e,t,n))})),r}if("Polygon"===o.geometry.type){const t=c(o);return sn(e,t,n)}}else{if("polygon"===n){const n=[];for(let e=1;e<t.length;e++)n.push({positions:t[e]});return{show:a,polygon:{height:0,hierarchy:{positions:t[0],holes:n},...e.polygon},feature:Gt.cloneDeep(o)}}if("billboard"===n||"point"===n||"label"===n){const t={show:a,position:("MultiPolygon"===o.geometry.type?i(o):s(o)).geometry.coordinates,feature:Gt.cloneDeep(o)};switch(n){case"billboard":t.billboard={...e.billboard};break;case"point":t.point={...e.point};break;case"label":t.label={text:o.properties.text||o.properties.name,...e.label}}return t}}}const mn={LineString:sn,MultiLineString:cn,MultiPoint:function(e,t,n){const o=[],r=t.geometry.coordinates;for(let a=0;a<r.length;a++)o.push(ln(e,r[a],n,t));return o},MultiPolygon:function(e,t,n){const o=[],r=t.geometry.coordinates;for(let a=0;a<r.length;a++){const i=pn(e,r[a],n,t),s=Array.isArray(i)?i:[i];o.push(...s)}return o},Point:function(e,t,n){return ln(e,t.geometry.coordinates,n,t)},Polygon:dn};function hn(e){Sa.viewer.useRenderStore(Ca).addRenderDatas(e)}function fn(e){Sa.viewer.useRenderStore(Ca).removeRenderDataById(e)}function vn(e){return Sa.viewer.useRenderStore(Ca).getRenderDataByDatasetId(e)}function yn(e,t){Sa.viewer.useRenderStore(Ca).setSelectedRenderData(e,t)}function gn(e,t,n,o=[],r){!function(){var e;const t=Sa.viewer.useRenderStore(Ca).selectedRenderData;t.model&&(null==(e=null==t?void 0:t.restoreHandlers)?void 0:e.length)&&t.restoreHandlers.forEach((e=>{e()})),yn({model:void 0,renderingType:void 0,restoreHandlers:[],feature:void 0,featureInfoListItems:[]},!0)}();const a=e.trim().split(",");a&&a.length||on("高亮渲染模型失败，原因：未知的显示类型。","要素ID：",n.properties.id),a.forEach((e=>{var a;const i=bn(e,vn(t),n.properties.id);if(!i)return void yn({model:null,renderingType:e,restoreHandlers:[()=>{}],feature:n,featureInfoListItems:o});const s=null==(a=i.feature.properties)?void 0:a.selectedProps,c=s&&l(s)?s:s?JSON.parse(s):{},d="primitive"===r?i:i[e],u=null==c?void 0:c[e];if(u){let t={};Object.keys(u).forEach((e=>{t[e]=d[e],d[e]=u[e]})),yn({model:d,renderingType:e,restoreHandlers:[()=>{Object.keys(t).forEach((e=>{d[e]=t[e]})),t=void 0}],feature:i.feature,featureInfoListItems:o})}else on("设置对象选中风格失败，原因：没有设置默认选中样式。请通过数据集或者要素的 selectedProps 字段设置。")}))}function bn(e,t,n,o){let r,a,i;if(r=l(t)?t:vn(t),!r)return;switch(e){case"label":case"point":case"billboard":case"model":a="primitive"===o?"VcCollectionBillboard":"VcDatasourceCustom",i="primitive"===o?"billboards":"entities";break;case"polyline":a="primitive"===o?"VcCollectionPolyline":"VcDatasourceCustom",i="primitive"===o?"polylines":"entities";break;case"polygon":a="primitive"===o?"VcCollectionPrimitive":"VcDatasourceCustom",i="primitive"===o?"polygons":"entities";break;case"geojson":a="VcDatasourceGeojson",i="data";break;case"tileset":a="VcPrimitiveTileset";break;case"imagery":a="VcLayerImagery"}const s=Gt.find(r.datasets,(e=>e.cmpName===a));if("geojson"===e)return s;if(Cesium.defined(s)){if("geojson"===e)return s;return Gt.find(s.props[i],(t=>t.feature.properties.id===n&&t.feature.properties.actualRenderingType===e))}}function kn(e,t){const n=[];if(!Cesium.defined(e.geometry))return on("feature.geometry is required.","要素：",e),"添加渲染模型失败，原因：该要素没有 geometry 属性";const o=Object.keys(t);if(!o||!o.length)return on("添加渲染模型失败，原因：未知的显示类型。","要素：",e),"添加渲染模型失败，原因：未知的显示类型。";const r=e.geometry.type,a=mn[r];return Cesium.defined(a)?(o.forEach((o=>{const r=a(t,e,o),i=Array.isArray(r)?r:[r];n.push(...i)})),n):(on(`添加渲染模型失败，原因：该几何类型${r}没有找到处理方法。`,"要素：",e),`添加渲染模型失败，原因：该几何类型${r}没有找到处理方法。`)}async function wn(e,t,n,o,r,a,i,s){const c={id:r,page:a,type:i,datasets:[]},d=await async function(e,t,n,o,r){"string"==typeof e&&(e=await Cesium.Resource.fetchJson({url:e}));if(!Cesium.defined(e))return void rn("添加数据源失败，原因：GeoJSON 数据格式不正确。",e);const a=[],i=e.type,s=e=>{e.properties.renderingType=e.properties.renderingType||t,Cesium.defined(e.properties.id)||(e.properties.id=Cesium.createGuid()),e.properties.datasetId=r,e.properties.selectedProps=e.properties.selectedProps||o||{}};switch(i){case"FeatureCollection":e.features.forEach((e=>{s(e);const t=kn(e,n);t.length&&a.push(...t)}));break;case"Feature":{const t=e;s(t);const o=kn(t,n);o.length&&a.push(...o)}}return a}(e,t,n,o,r);return d.length&&c.datasets.push({cmpName:"VcDatasourceCustom",props:{entities:d,...s,onReady:e=>{var t;const{cesiumObject:n}=e,o=`VcDatasourceCustom_${c.id}`;n.datasetId=o,null==(t=null==s?void 0:s.onReady)||t.call(s,e)}}}),hn(c),Promise.resolve(c)}function Cn(e,t){let n=[];return t().then((t=>{var o,r;if(0!==t.code)return rn(`添加渲染数据集失败，原因：数据请求失败。数据集id: ${e.id}，数据集名称: ${e.name}`),!1;if(!t.data)return rn(`添加渲染数据集失败，原因：未知的 GeoJSON 类型。数据集id: ${e.id}，数据集名称: ${e.name}`),!1;if(null==(o=t.data)?void 0:o.type){switch(null==(r=t.data)?void 0:r.type){case"Feature":n=[t.data];break;case"FeatureCollection":n=t.data.features,n.forEach((t=>{Cesium.defined(t.properties.renderingType)||(t.properties.renderingType=e.renderingType||"billboard"),Cesium.defined(t.properties.id)||(t.properties.id=Cesium.createGuid()),Cesium.defined(t.properties.checked)||(t.properties.checked=!1)}));break;default:return rn(`添加渲染数据集失败，原因：未知的 GeoJSON 类型。数据集id: ${e.id}，数据集名称: ${e.name}`),!1}}return n.length?n:(rn(`添加渲染数据集失败，原因：请求数据成功，但结果为空。数据集id: ${e.id}，数据集名称: ${e.name}`),!1)})).catch((e=>(rn("添加渲染数据集失败，原因：数据请求异常。",e),!1)))}function Sn(e,t,n,o,r){var a;if(null==(a=e.children)?void 0:a.length)return Promise.resolve(Tn(e,n,o,r));try{return Cn(e,t).then((t=>{if(Array.isArray(t))return e.children=t,Tn(e,n,o,r)}))}catch(i){return void rn(`添加渲染数据集失败，原因：数据请求发生错误。数据集id: ${e.id}，数据集名称: ${e.name}`,"数据模型：",e)}}const Tn=(e,t,n,o)=>new Promise(((a,i)=>{var s,c,p,m,h,f,v,y,g,b,k,w;e.cesiumObjects=e.cesiumObjects||[];const C={id:e.id,name:e.name,page:t,type:n,datasets:[]};let S=[];for(let u=0;u<(null==(s=null==e?void 0:e.children)?void 0:s.length);u++){const i=e.children[u];if(d(i,"type")&&d(i,"properties")){const t=i,n=t.properties;n.datasetId=t.properties.datasetId||e.id,n.datasetName=t.properties.datasetName||e.name,n.selectedProps=t.properties.selectedProps||e.selectedProps||{};const o=e.props&&l(null==e?void 0:e.props)?null==e?void 0:e.props:e.props?JSON.parse(null==e?void 0:e.props):{},s=(null==(c=t.properties)?void 0:c.props)&&l(null==(p=t.properties)?void 0:p.props)?null==(m=t.properties)?void 0:m.props:t.properties.props?JSON.parse(null==(h=t.properties)?void 0:h.props):{},d=Object.assign({},o,s);if("geojson"===e.renderingType){const n=Object.assign({},d[e.renderingType],null==(v=null==(f=t.properties)?void 0:f.props)?void 0:v[e.renderingType]);t.properties.actualRenderingType=e.renderingType,C.datasets.push({cmpName:"VcDatasourceGeojson",props:{...n,show:r(t.properties,"checked"),onReady:e=>{a(e)}},feature:t})}else if("tileset"===e.renderingType){const n=Object.assign({},d[e.renderingType],null==(g=null==(y=t.properties)?void 0:y.props)?void 0:g[e.renderingType]);t.properties.actualRenderingType=e.renderingType,C.datasets.push({cmpName:"VcPrimitiveTileset",props:{...n,show:r(t.properties,"checked"),onReady:e=>{a(e)}},feature:t})}else if("imagery"===e.renderingType){const n=Object.assign({},d[e.renderingType],null==(k=null==(b=t.properties)?void 0:b.props)?void 0:k[e.renderingType]);t.properties.actualRenderingType=e.renderingType;const o=n.children;delete n.children,C.datasets.push({cmpName:"VcLayerImagery",props:{...n,show:r(t.properties,"checked"),onReady:e=>{a(e)}},feature:t,children:[{cmpName:o[0].cmpName,props:{...o[0].props}}]})}else{const e=kn(t,d);if("string"==typeof e)continue;const n=Gt.intersectionWith(e,S,((e,t)=>e.feature.properties.id===t.feature.properties.id&&e.feature.geometry.type===t.feature.geometry.type));S.push(...e),n.length&&(n.forEach((e=>{on(`已添加相同id和类型的渲染数据集，可能有重复数据，请核实。对象 id: ${e.feature.properties.id}，对象类型: ${e.feature.geometry.type}`,"数据模型：",e)})),S=Gt.uniqWith(S,((e,t)=>e.feature.properties.id===t.feature.properties.id&&e.feature.geometry.type===t.feature.geometry.type)))}}else{const e=i;(null==(w=null==e?void 0:e.children)?void 0:w.length)?a(Tn(e,t,n,o)):a(!1)}}S.length&&C.datasets.push({cmpName:"VcDatasourceCustom",props:{...o,entities:S,onReady:t=>{var n;const{cesiumObject:r}=t,i=`VcDatasourceCustom_${e.id}`;r.datasetId=i;!Gt.find(e.cesiumObjects,(e=>e.datasetId===i))&&e.cesiumObjects.push(u(r)),null==(n=null==o?void 0:o.onReady)||n.call(o,t),a(t)}}}),hn(C)}));function Pn(e){return e.map((e=>({...e,path:e.path||Gt.uniqueId("vc-menu-empty-"),...e.children?{children:Pn(e.children)}:{}})))}function xn(e={},t="",n=0){return[200,{code:n,msg:t,data:e}]}function Rn(e){Sa.system.useLogStore(Ca).push({message:"数据请求异常",type:"danger",meta:{error:e}}),Le.create({message:e.message,type:"negative",timeout:3e3})}function On(e){const t=new Error(e);throw Rn(t),t}const Ln=Object.freeze(Object.defineProperty({__proto__:null,errorCreate:On,errorLog:Rn,parse:function(e="{}",t={}){let n=t;try{n=JSON.parse(e)}catch(o){rn(o)}return n},response:xn,responseError:function(e={},t="请求失败",n=500){return xn(e,t,n)},responseSuccess:function(e={},t="成功"){return xn(e,t)}},Symbol.toStringTag,{value:"Module"})),Mn=()=>{const e=zt.create({});return e.interceptors.request.use((e=>e),(e=>(Rn(e),Promise.reject(e)))),e.interceptors.response.use((e=>{const t=e.data,{code:n}=t;if(void 0===n)return t;switch(n){case 0:case 200:return t;case"xxx":On(`[ code: xxx ] ${t.msg}: ${e.config.url}`);break;default:return On(`${t.msg}: ${e.config.url}`),Promise.reject(t)}}),(e=>{switch(Gt.get(e,"response.status")){case 400:e.message="请求错误";break;case 401:e.message="未授权，请登录",Yt("token"),Yt("uuid"),Hn.push("/login");break;case 403:e.message="拒绝访问";break;case 404:e.message=`请求地址出错: ${e.response.config.url}`;break;case 408:e.message="请求超时";break;case 500:e.message="服务器内部错误";break;case 501:e.message="服务未实现";break;case 502:e.message="网关错误";break;case 503:e.message="服务不可用";break;case 504:e.message="网关超时";break;case 505:e.message="HTTP版本不受支持"}return Rn(e),Promise.reject(e)})),e};function En(e){return function(t){const n=Kt("token"),o={headers:{Authorization:n,"Content-Type":Gt.get(t,"headers.Content-Type","application/json")},timeout:2e4,baseURL:e.baseURL||"/",data:{}};return n&&(o.headers.Authorization="Bearer "+n),e(Object.assign(o,t))}}const _n=Mn(),In=En(_n),Dn=Mn(),An=En(Dn),Nn=new Ft(Dn),Bn=[{username:"admin",password:"admin",id:"admin-uuid",name:"Admin"},{username:"editor",password:"editor",id:"editor-uuid",name:"Editor"},{username:"henry",password:"henry",id:"henry-uuid",name:"Henry"},{username:"sam",password:"sam",id:"sam-uuid",name:"Sam"},{username:"mark",password:"mark",id:"mark-uuid",name:"Mark"}],Vn=[{id:p(),component:"MainLayout",icon:"cog",islock:!1,hidden:!1,name:"layout",path:"/",sort:1e3,title:"GlobalVillage",type:10,children:[{id:p(),component:"/home",icon:"cog",islock:!1,hidden:!1,name:"home",path:"/home",sort:1e3,caption:"Home",title:"message.header.index",type:10,children:[{id:p(),component:"",icon:"eye",islock:!1,hidden:!1,name:"left-panel",path:"",sort:100101,title:"查看左侧面板",type:20}]},{id:p(),component:"/create",icon:"cog",islock:!1,hidden:!1,name:"create",path:"/create",sort:1e3,caption:"Create",title:"message.header.create",type:10,redirect:"/create/tbd",children:[{id:p(),component:"/create/tbd",icon:"holiday_village",islock:!1,hidden:!1,name:"tbd",path:"/create/tbd",sort:1e3,caption:"ComingSoon",title:"message.sideBar.create.tbd",type:10}]},{id:p(),component:"/happiness",icon:"cog",islock:!1,hidden:!1,name:"happiness",path:"/happiness",sort:1e3,caption:"Happiness",title:"message.header.happiness",type:10,redirect:"/happiness/hsa",children:[{id:p(),component:"/happiness/hsa",icon:"sentiment_very_satisfied",islock:!1,hidden:!1,name:"hsa",path:"/happiness/hsa",href:"https://www.happinessstudies.academy",target:"_blank",sort:1e3,caption:"HappinessStudiesAcademy",title:"message.sideBar.happiness.hsa",type:10}]}]}],jn=[{id:p(),name:"DataSource",label:"数据源",icon:"",children:[{id:p(),name:"机场",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/机场.json",renderingType:"billboard",lazy:!0,props:{billboard:{image:"./images/飞机场.svg",color:"#ffc10",scale:.25,verticalOrigin:1,scaleByDistance:[100,2,15e4,.5],distanceDisplayCondition:[0,3e7]}},selectedProps:{billboard:{color:"red",scale:1}}},{id:p(),name:"摄像头",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/视频点.json",renderingType:"billboard",lazy:!0,props:{billboard:{image:"./images/video.svg",color:"#ffc10",scale:.25,verticalOrigin:1,scaleByDistance:[100,2,15e4,.5],distanceDisplayCondition:[0,3e7]}},selectedProps:{billboard:{color:"red",scale:1}},children:[{type:"Feature",geometry:{type:"MultiPoint",coordinates:[[108.253394,29.730675]]},properties:{name:"摄像头点位1",pyname:"hstxgjjc",kind:"8100",id:p(),checked:!0}}]},{id:p(),name:"水系",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/水系.json",renderingType:"polyline",lazy:!0,props:{polyline:{width:1}},selectedProps:{polyline:{width:2,material:"#ffc107"}}},{id:p(),name:"岛屿",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/岛屿.json",renderingType:"polygon,polyline,billboard",lazy:!0,props:{billboard:{image:"./images/岛屿.svg",scale:.2,verticalOrigin:1,scaleByDistance:[100,2,15e4,.5],distanceDisplayCondition:[0,3e6]},polygon:{material:"rgba(137,207,240,0.5)"},polyline:{width:4,material:"#0033ff"}},selectedProps:{billboard:{scale:.5},polygon:{material:"#ffc107"},polyline:{width:8,material:"red"}}},{id:p(),name:"模型",icon:"",checked:!1,expanded:!1,renderingType:"model",children:[{id:p(),name:"Tileset 模型",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/Tileset模型.json",lazy:!0,renderingType:"tileset",props:{tileset:{}}},{id:p(),name:"GLTF 模型",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/GLTF模型.json",lazy:!0,renderingType:"model",props:{model:{scale:1}},selectedProps:{model:{color:"red"}}},{id:p(),name:"模型嵌套",icon:"",checked:!1,expanded:!1,renderingType:"model",children:[{id:p(),name:"GLTF 模型",icon:"",checked:!1,expanded:!1,lazy:!0,fetchStr:"/datas/work-bench/GLTF模型.json",renderingType:"model",props:{model:{scale:1}}},{type:"Feature",properties:{id:p(),name:"飞机",hpr:"[135, 0, 0]",renderingType:"model",checked:!0,props:{model:{uri:"../datas/gltf/Cesium_Air.glb"}},selectedProps:{model:{color:"red"}}},geometry:{coordinates:[121.25202608700887,32.14045397527647],type:"Point"}}]}]},{id:p(),name:"图层",icon:"",checked:!1,expanded:!1,renderingType:"imagery",children:[{id:p(),name:"图层嵌套",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/图层.json",lazy:!0,renderingType:"imagery",props:{imagery:{}}},{type:"Feature",properties:{id:p(),checked:!1,name:"WMS",props:{imagery:{alpha:1,brightness:1,contrast:1,sortOrder:60,children:[{cmpName:"VcImageryProviderWms",props:{url:"https://nationalmap.gov.au/proxy/http://geoserver.nationalmap.nicta.com.au/geotopo_250k/ows",layers:"Hydrography:bores",parameters:{format:"image/png",transparent:!0},rectangle:[112,-43,154,-10]}}]}}},geometry:{coordinates:[108.965836,34.225607],type:"Point"}}]},{id:p(),name:"GeoJSON",icon:"",checked:!1,expanded:!1,renderingType:"geojson",children:[{type:"Feature",properties:{id:p(),checked:!1,name:"水系",props:{geojson:{strokeWidth:5,stroke:"#ffc107",fill:"transparent",show:!1,data:"./datas/work-bench/水系.json"}}},geometry:{coordinates:[108.965836,34.225607],type:"Point"}}]}]}],Un={service:_n,request:In,serviceForMock:Dn,requestForMock:An,mock:Nn,tools:Ln},Fn=(({service:e,request:t,serviceForMock:n,requestForMock:o,mock:r,tools:a})=>({login:e=>(r.onAny("/auth/login").reply((e=>{const t=a.parse(e.data),n=Gt.find(Bn,{username:t.username,password:t.password});return n?a.responseSuccess(Gt.assign({},n,{token:"f5befe1a-962c-4cdd-bf45-77ce306dbbce"})):a.responseError({},"Wrong Account or Password!")})),o({url:"/auth/login",method:"post",data:e})),getUserInfo:()=>(r.onAny("/user/info").reply((e=>{const t=Kt("uuid"),n=Gt.find(Bn,{id:t});return n?a.responseSuccess(Gt.assign({},n)):(Yt("token"),Yt("uuid"),Hn.push("/login"),a.responseError({},"Please Login!"))})),o({url:"/user/info",method:"post"})),getAccessibleMenus:(e={})=>(r.onAny("/api/menu/accessible").reply((e=>a.responseSuccess(Vn))),o({url:"/api/menu/accessible",method:"post",data:e}))}))(Un),zn=(({service:e,request:t,serviceForMock:n,requestForMock:o,mock:r,tools:a})=>({getStaticData:(e,n)=>t({baseURL:n=n||"./",url:e,method:"get"}).then((e=>({code:0,data:e,msg:"success"}))),inverseGeocode:e=>t({baseURL:"./",url:"/reverse_geocoding/v3",method:"get",params:e}),getLocationList:e=>t({baseURL:"./",url:"/v3/place/text",method:"get",params:e})}))(Un),Gn=(({service:e,request:t,serviceForMock:n,requestForMock:o,mock:r,tools:a})=>({getTreeData:()=>(r.onAny("/dynamic-render/recursive-list/datatree").reply((e=>a.responseSuccess(jn))),o({url:"/dynamic-render/recursive-list/datatree",method:"post"})),inverseGeocode:e=>t({baseURL:"./",url:"/reverse_geocoding/v3",method:"get",params:e})}))(Un),Wn={"zh-CN":{message:{header:{index:"家园",dynamicRender:"创造",happiness:"幸福",create:"创造"},sideBar:{dynamicRender:{recursiveList:"递归列表",stack:"堆叠展示",historicalTrack:"历史轨迹"},expansion:{typhoon:"台风"},other:{tsx:"TSX",issue:"问题反馈"}},panel:{layerManager:"图层管理",videoPlayer:"视频播放"},baseLayer:"底图图层",overlayLayer:"叠加图层",terrainLayer:"地形图层"}},"en-US":{message:{header:{index:"Home",dynamicRender:"Create",happiness:"Happiness",create:"Create"},sideBar:{dynamicRender:{recursiveList:"RecursiveList",stack:"StackView",historicalTrack:"HistoricalTrack"},happiness:{hsa:"HappinessStudiesAcademy"},create:{tbd:"ComingSoon"},other:{tsx:"TSX",issue:"BugReport"}},panel:{layerManager:"LayerManager",videoPlayer:"VideoPlayer"},baseLayer:"BaseLayer",overlayLayer:"OverlayLayer",terrainLayer:"TerrainLayer"}}},qn=m({legacy:!1,locale:Kt("locale")||"en-US",fallbackLocale:"en-US",globalInjection:!0,messages:Wn}),Hn=h({scrollBehavior:()=>({left:0,top:0}),routes:tn,history:({}.SERVER?v:y)("/")}),$n=["/login","/404"];Hn.beforeEach((async(e,t,n)=>{f.start(),Sa.system.useSearchStore(Ca).set(!1);const o=Kt("token");if("/login"!==e.path&&Fn.getUserInfo(),o)try{if(!Sa.system.usePermissionStore(Ca).inited){const t=[...(await Fn.getAccessibleMenus()).data];return await Sa.system.usePermissionStore(Ca).generateRoutes({menuTree:t}),void n(e.path)}"/login"===e.path?n({path:"/home"}):n()}catch(r){-1!==$n.indexOf(e.path)?n():n("/login")}else-1!==$n.indexOf(e.path)?n():n("/login")})),Hn.afterEach((e=>{var t;f.done(),t=qn.global.t(e.meta.title),window.document.title="Global Village"+(t?` | ${t}`:"")}));const Jn=qt(new Wt("VueCesiumDemo-0.0.1"));function Kn({dbName:e="database",path:t="",user:n=!0,validator:o=e=>!0,defaultValue:r=""}){const a=Kt("uuid")||"ghost-uuid",i=`${e}.${n?`user.${a}`:"public"}${t?`.${t}`:""}`,s=Jn.get(i).value();return void 0!==s&&o(s)||Jn.set(i,r).write(),i}function Yn({dbName:e="database",path:t="",user:n=!1,validator:o=()=>!0,defaultValue:r=""}={}){return Jn.get(Kn({dbName:e,path:t,user:n,validator:o,defaultValue:r}))}Jn.defaults({sys:{},database:{}}).write();const Xn=Vt("db",{state:()=>({}),getters:{},actions:{set({dbName:e="database",path:t="",value:n="",user:o=!1}){!function({dbName:e="database",path:t="",value:n="",user:o=!1}){Jn.set(Kn({dbName:e,path:t,user:o}),n).write()}({dbName:e,path:t,value:n,user:o})},get:({dbName:e="database",path:t="",defaultValue:n="",user:o=!1})=>function({dbName:e="database",path:t="",defaultValue:n="",user:o=!1}){return Gt.cloneDeep(Jn.get(Kn({dbName:e,path:t,user:o,defaultValue:n})).value())}({dbName:e,path:t,defaultValue:n,user:o}),database:({user:e=!1}={})=>Yn({user:e,defaultValue:""}),databaseClear:({user:e=!1}={})=>Yn({user:e,validator:()=>!0,defaultValue:""})}}),Qn=Vt("user",{state:()=>({info:{}}),getters:{},actions:{async set(e){this.info=e;Xn().set({dbName:"sys",path:"user.info",value:e,user:!0})},async load(){const e=Xn().get({dbName:"sys",path:"user.info",defaultValue:"",user:!0});this.set(e)}}}),Zn=g({name:"VcDemoPageExpansion",__name:"Index",setup:e=>(e,t)=>{const n=b("router-view");return k(),w(n)}}),eo=Object.freeze(Object.defineProperty({__proto__:null,default:Zn},Symbol.toStringTag,{value:"Module"})),to=(e,t)=>{const n=e.__vccOpts||e;for(const[o,r]of t)n[o]=r;return n};const no=to({},[["render",function(e,t){return k(),C("div")}]]),oo=Object.freeze(Object.defineProperty({__proto__:null,default:no},Symbol.toStringTag,{value:"Module"})),ro=g({name:"VcDemoPageDynamicRender",__name:"Index",setup:e=>(e,t)=>{const n=b("router-view");return k(),w(n)}}),ao=Object.freeze(Object.defineProperty({__proto__:null,default:ro},Symbol.toStringTag,{value:"Module"})),so={class:"page-demo-dynamic-overlay absolute z-fab"},co=g({__name:"Index",setup(e){const{loadDefaultLayers:t}=Sa.viewer.useLayerStore(),n=S(null),o=S(!1),a=S(null),i=S(null),s=S(null);T((()=>{t(!0),zn.getStaticData("/datas/dynamic-overlay.json").then((e=>{c([e.data])}))})),P((()=>{var e;e="/dynamic-render/historical-track",Sa.viewer.useRenderStore(Ca).removeRenderDataByPage(e)}));const c=async e=>{if(await vn("DynamicOverlay"));else{const t={id:"DynamicOverlay",name:"历史轨迹",page:"/dynamic-render/historical-track",datasets:[]},{overlays:r,stops:c}=d(e),u={show:!0,dynamicOverlays:r};t.datasets.push({cmpName:"VcOverlayDynamic",props:{shouldAnimate:o,"onUpdate:shouldAnimate":e=>{o.value=e},currentTime:a,startTime:i,stopTime:s,multiplier:1e3,onReady:e=>{n.value=e.vm,l(202106)},...u}}),t.datasets.push({cmpName:"VcCollectionPoint",props:{points:c}}),hn(t)}},d=e=>{const t=[],n=[];return e.forEach((e=>{const o=[],a=[],i=r(e,"checked");e.stops.forEach((e=>{o.push({position:[e.lon,e.lat],time:e.DATE_TIME,id:p()}),a.push([e.lon,e.lat]),n.push({id:p(),position:[e.lon,e.lat],color:"rgb(255,229,0)",show:i,...e,distanceDisplayCondition:[0,5e6],scaleByDistance:[100,2,25e5,.5],onMouseover:e=>{},onMouseout:e=>{}})})),t.push({id:String(e.TYPHOON_ID),show:i,maxCacheSize:e.stops.length,polyline:{positions:a,width:3,material:e.TYPHOON_CODE?"#2d8cf0":"#69B273",depthFailMaterial:e.TYPHOON_CODE?"#2d8cf0":"#69B273",clampToGround:!0},sampledPositions:o})})),{overlays:t,stops:n}},l=e=>{const t=vn("DynamicOverlay");if(t){t.datasets[0].cmpRef.zoomToOverlay(String(e))}else rn("定位到该对象失败，原因：还未添加。")};return(e,t)=>(k(),C("div",so))}}),lo=Object.freeze(Object.defineProperty({__proto__:null,default:co},Symbol.toStringTag,{value:"Module"}));function uo(){const e=x(),t=kt(),{toggleGlobalLayout:n,toggleDynamicRenderPageLayout:o}=Sa.system.useLayoutStore(),r=R({selectedId:"",datasourceCategories:[],loading:!1,hasLoadingError:!1,filterText:"",selectedKey:""}),a=Sa.system.useLayoutStore().dynamicRender,i=O((()=>{let e=[];try{null==r||r.datasourceCategories.forEach((t=>{if(t.id===r.selectedId)throw e=t.children,new Error("endForEach")}))}catch(t){if("endForEach"!==t.message)throw t}return e}));t.vm.vcMitt.on("pickEvt",(e=>{r.selectedKey=e}));const s=()=>{r.datasourceCategories.forEach((e=>{var t;null==(t=null==e?void 0:e.children)||t.forEach((e=>{const t=e;(null==t?void 0:t.children)&&c(!0,t)}))}))},c=(t,n,o,r)=>{var a;const i={onReady:e=>{}};if(d(n,"type")&&d(n,"properties")){const r=n;!0===t&&(Cesium.defined(r.properties.datasetId)||fn(null==o?void 0:o.id),L((()=>{if(vn(r.properties.datasetId));else{if(!o)return void rn("添加渲染数据集失败，原因：要素节点不能作为顶节点，请将其放到数据集节点下。","数据模型：",n);if(null==o?void 0:o.renderingType){const t=()=>zn.getStaticData(o.fetchStr);o.loading=!0,Sn(o,t,e.path,"recursive-list",i).finally((()=>{o.loading=!1}))}else""!==o.renderingType&&rn("添加渲染数据集失败，原因：未知的显示类型。","数据模型：",o)}})))}else{const o=n;if(!0===t){if(vn(o.id));else if(o.renderingType){const t=()=>zn.getStaticData(o.fetchStr);o.loading=!0,Sn(o,t,e.path,"recursive-list",i).finally((()=>{o.loading=!1}))}else""!==o.renderingType&&rn("添加渲染数据集失败，原因：未知的显示类型。","数据模型：",o)}else fn(o.id),null==(a=null==o?void 0:o.children)||a.forEach((e=>{c(t,e,o)}))}};return{workBenchModel:r,dynamicRenderLayout:a,selectedDatasetCategories:i,init:()=>{r.loading=!0,(async()=>(r.hasLoadingError=!1,Gn.getTreeData().then((e=>{if(e.code)return;const t=e.data;return r.selectedId=t[0].id,r.datasourceCategories=t,s(),!0})).catch((e=>{r.hasLoadingError=!0}))))().then((()=>{r.loading=!1,n({navigation:!0}),o({datasource:{workBench:!0}})}))},showFeatureInfo:(e,t)=>{!function(e,t){const{toggleGlobalLayout:n}=Sa.system.useLayoutStore(Ca);"摄像头"===e.properties.datasetName&&n({videoPlayer:!0}),n({featureInfo:!0});const o=Object.keys(e.properties).map((t=>({label:t,value:e.properties[t]})));if(t)yn({...t,restoreHandlers:[],featureInfoListItems:o});else{if(!bn(e.properties.renderingType,e.properties.datasetId,e.properties.id))return void yn({...t,restoreHandlers:[],featureInfoListItems:o});gn(e.properties.renderingType,e.properties.datasetId,e,o)}}(t)},flyToFeature:(e,n,o)=>{t.vm.vcMitt.emit("pickEvt",n.properties.id),async function(e,t,n={isHighlightRenderData:!0,showBillboardOverlayMenu:!0,duration:1.5}){var o,r,a,i,s;const c=(null==(o=null==t?void 0:t.properties)?void 0:o.actualRenderingType)||(null==(r=null==t?void 0:t.properties)?void 0:r.renderingType);if(!c)return void rn("定位到要素失败，原因：未知的显示类型。","要素模型：",t);const d=t.properties.datasetId,l=await vn(d);if(!l)return void rn("定位到要素失败，原因：未找到该要素所在的渲染数据。","要素模型：",t);const u=t.properties.id;if(n.isHighlightRenderData&&gn(c,d,t),t.properties.vcCamera)return void bt(e,t.properties.vcCamera);const{toggleGlobalLayout:p}=Sa.system.useLayoutStore(Ca);switch(c){case"billboard":case"point":case"label":case"polyline":case"polygon":case"model":if(p({featureInfo:!1}),null==(a=null==l?void 0:l.datasets)?void 0:a.length){const t=(null==(i=l.datasets[0].cmpRef)?void 0:i.cesiumObject).entities.values.find((e=>e.feature.properties.id===u));e.flyTo(t,{...n}).then((()=>{}))}break;default:if(p({featureInfo:!1}),null==(s=null==l?void 0:l.datasets)?void 0:s.length){const o=l.datasets.find((e=>e.feature.properties.id===t.properties.id)).cmpRef.cesiumObject;e.flyTo(o,{...n}).then((()=>{}))}}}(t.viewer,n)},onLazyLoad:e=>{const t=e.dataset;if(e.key.indexOf("Lazy load empty")>-1)return void e.done([]);t.loading=!0,Cn(t,(()=>zn.getStaticData(t.fetchStr))).then((async n=>{var o;n?e.done(n):e.fail();if(!(await vn(t.id))){const e=null==(o=t.children)?void 0:o.filter((e=>e.properties.checked));e&&e.length>0&&c(!0,t)}t.loading=!1}))},addOrRemoveDataset:c,toggleDynamicRenderPageLayout:o}}const po={class:"loading-ios flex column justify-center items-center z-top"},mo={key:2},ho={key:0,class:"q-pt-md"},fo=g({__name:"Ios",props:{size:{type:String,default:"3em"},dense:{type:Boolean,default:!1},hasError:{type:Boolean,default:!1},errorMsg:{type:String,default:""},errorTip:{type:String,default:"数据加载失败，点我重试"},tipText:{type:String,default:"加载中..."}},emits:["retry"],setup(e,{emit:t}){const n=t,o=()=>{n("retry")};return(t,n)=>(k(),C("div",po,[e.hasError?(k(),w(_e,{key:1,icon:"error",size:e.size,color:"red",round:"",flat:"",dense:""},{default:M((()=>[E(Ee,null,{default:M((()=>[_("加载失败，原因："+I(e.errorMsg),1)])),_:1})])),_:1},8,["size"])):(k(),w(Me,{key:0,size:e.size},null,8,["size"])),e.dense?A("",!0):(k(),C("div",mo,[e.hasError?(k(),w(Ie,{key:1,clickable:"",color:"red","text-color":"white",icon:"error",onClick:o},{default:M((()=>[_(I(e.errorTip),1)])),_:1})):(k(),C("div",ho,[D("span",null,I(e.tipText),1)]))]))]))}}),vo=g({name:"VcDataTreeGeojson",props:{dense:Boolean,nodes:{type:Array,default:()=>[]},filter:String,tickStrategy:{type:String,default:"leaf-filtered"},selectedColor:String,selected:String},emits:{checked:(e,t,n,o)=>!0,"lazy-load":e=>!0,"update:selected":(e,t,n)=>!0,zoomIconClicked:(e,t,n)=>!0},setup(e,t){const n=S({});let o={};N((()=>{o={}}));const r=O((()=>void 0!==e.selected)),a=O((()=>(e,t)=>{const n=t.toLowerCase();return(e.name||e.properties.name).toLowerCase().indexOf(n)>-1})),i=O((()=>{const t={},o=(i,s,c)=>{const l=c?c.tickStrategy:e.tickStrategy;let u,p,m,h,f,v,y,g,b,k,w;if(d(i,"type")&&d(i,"properties")){const e=i;u=e.properties.id,p=!1,m=!1,h=e.properties.name,f=c?c.level+1:1,y=e.properties.checked,v=!1,g=e.properties.disabled,b=e.properties.noTick,k=void 0,w=!0!==e.properties.disabled&&!1!==e.properties.tickable}else{const e=i;u=e.id,p=(null==e?void 0:e.children)&&(null==e?void 0:e.children.length)>0,m=e.lazy,h=e.name,!0===m&&void 0!==n.value[u]&&!0===Array.isArray(e.children)&&(m=n.value[u]),f=c?c.level+1:1,y=e.checked,v=e.expanded,g=e.disabled,b=e.noTick,k=e.indeterminate,w=!0!==e.disabled&&!1!==e.tickable||!e.children}const C=!0!==p,S=!0!==g&&!0===r.value,T="none"!==l,P="strict"===l,x="leaf-filtered"===l,R="leaf"===l||"leaf-filtered"===l;!0===R&&!0===w&&c&&!0!==c.tickable&&(w=!1);const O={index:s,name:h,key:u,parent:c,isParent:p,isLeaf:C,lazy:m,disabled:g,level:f,children:[],matchesFilter:!e.filter||a.value(i,e.filter),selected:u===e.selected&&!0===S,selectable:S,expanded:v,expandable:!0,noTick:!0===b||!0!==P&&m&&"loaded"!==m,tickable:w,tickStrategy:l,hasTicking:T,strictTicking:P,leafFilteredTicking:x,leafTicking:R,indeterminate:k,indeterminateNextState:void 0,ticked:y};if(t[u]=O,!0===p){const t=i;if(O.children=t.children.map(((e,t)=>o(e,t,O))),e.filter&&(!0!==O.matchesFilter?O.matchesFilter=O.children.some((e=>e.matchesFilter)):!0!==O.noTick&&!0!==O.disabled&&!0===O.tickable&&!0===x&&!0===O.children.every((e=>!0!==e.matchesFilter||!0===e.noTick||!0!==e.tickable))&&(O.tickable=!1)),!0===O.matchesFilter&&(!0!==O.noTick&&!0!==P&&!0===O.children.every((e=>e.noTick))&&(O.noTick=!0),R)){if(O.ticked=!1,O.indeterminate=O.children.some((e=>{if(d(e,"type")&&d(e,"properties")){return!0===e.properties.indeterminate}return!0===e.indeterminate})),O.tickable=!0===O.tickable&&O.children.some((e=>e.tickable)),!0!==O.indeterminate){const e=O.children.reduce(((e,t)=>!0===t.ticked?e+1:e),0);e===O.children.length?O.ticked=!0:e>0&&(O.indeterminate=!0)}!0===O.indeterminate&&(O.indeterminateNextState=O.children.every((e=>(!0!==e.tickable||!0!==e.ticked)&&!1!==e.indeterminateNextState)))}}return O};return e.nodes.forEach(((e,t)=>o(e,t,null))),t})),s=(e,o,r,a=i.value[e])=>{if(a.lazy&&"loaded"!==a.lazy){if("loading"===a.lazy)return;n.value[e]="loading",!0!==Array.isArray(r.children)&&(r.children=[]),t.emit("lazy-load",{dataset:r,key:e,done:t=>{n.value[e]="loaded",r.children=!0===Array.isArray(t)?[...null==r?void 0:r.children,...t]:[...null==r?void 0:r.children],L((()=>{const t=i.value[e];t&&t.isParent}))},fail:()=>{delete n.value[e],0===r.children.length&&delete r.children}})}else!0===a.isParent&&a.expandable},c=(n,o,r,i)=>{if(!0===r.indeterminate&&(n=r.indeterminateNextState),r.strictTicking);else if(r.leafTicking){void 0===n&&(n=!1);const t=(o,r)=>{var i;if(d(o,"type")&&"Feature"===o.type){const t=o;if(e.filter){a.value(o,e.filter)&&(t.properties.checked=n)}else t.properties.checked=n}else{const e=o;e.checked=n,e.indeterminate=void 0,null==(i=null==e?void 0:e.children)||i.forEach((e=>t(e)))}};t(o)}t.emit("checked",n,o,i,r.index)};function l(e){const t=o[e];t&&t.focus()}const u=(n,o)=>{if(d(n,"type")&&"Feature"===n.type){const e=n,a=e.properties.id,s=i.value[a],d=[];for(let t=0;t<s.level-1;t++)d.push(B(Ae,{side:!0}));return d.push(B(Ae,{side:!0},(()=>B(Ne,{modelValue:s.ticked,dense:!0,disable:!0!==s.tickable,"onUpdate:modelValue":t=>c(t,e,s,o)})))),d.push(B(Ae,{side:!0},(()=>B(Be,{size:"16px",name:e.properties.icon||"circle",style:"color: #00e472"})))),d.push(B(Ae,{},(()=>B(Ve,{},(()=>e.properties.name))))),"loading"!==s.lazy&&!0!==e.properties.loading||d.push(B(Ae,{side:!0},(()=>B(fo,{size:"1.5em",dense:!0})))),e.properties.checked&&d.push(B(Ae,{side:!0},(()=>B(Be,{size:"20px",name:"room",onClick:n=>{((e,n,o,r)=>{!0!==r&&l(n.key),t.emit("zoomIconClicked",n.key,e,n.index),o.stopPropagation()})(e,s,n)}})))),V(B(Ue,{clickable:!0,activeClass:"text-amber-6",dark:!0,active:s.selected,onClick:n=>{((e,n,o,a)=>{!0!==a&&l(n.key),r.value&&n.selectable&&t.emit("update:selected",n.key,e,n.index),"function"==typeof e.properties.handler&&e.properties.handler(e)})(e,s)}},(()=>d)),[[je]])}{const t=n,r=t.id,a=i.value[r],d=!0===a.isParent?p(t.children,t):[];if(d.length>0||a.lazy&&"loaded"!==a.lazy){const n=[];for(let e=0;e<a.level-1;e++)n.push(B(Ae,{side:!0}));n.push(B(Ae,{side:!0},(()=>B(Ne,{modelValue:!0===a.indeterminate?null:a.ticked,disable:!0!==a.tickable||!(null==t?void 0:t.children),dense:!0,"onUpdate:modelValue":e=>c(e,t,a,o)})))),n.push(B(Ae,{side:!0},(()=>B(Be,{size:"16px",name:"home",style:"color: #00e472"})))),n.push(B(Ae,{},(()=>B(Ve,{},(()=>t.name)))));const r=(e=>{let t=0;const n=e=>{e.forEach((e=>{e.children?n(null==e?void 0:e.children):t++}))};return n((null==e?void 0:e.children)||[]),t})(t);return 0!==r&&n.push(B(Ae,{side:!0},(()=>B(Ie,{dense:!0,dark:!0},(()=>`${r}条`))))),"loading"!==a.lazy&&!0!==t.loading||n.push(B(Ae,{side:!0},(()=>B(fo,{size:"1.5em",dense:!0})))),B(Fe,{modelValue:a.expanded,expandIcon:"arrow_circle_down",expandSeparator:!0,clickable:!0,dark:!0,dense:e.dense,"onUpdate:modelValue":e=>((e,t,n)=>{t.expanded=e,s(n.key,!n.expanded,t,n)})(e,t,a)},{header:()=>n,default:()=>d})}}},p=(t,n)=>{const o=(e.filter?t.filter((e=>i.value[e.id||e.properties.id].matchesFilter)):t).map((e=>u(e,n)));return o.length?[B(De,{dense:e.dense},(()=>o))]:[]};return()=>{const t=p(e.nodes);return B("div",{class:"vc-data-tree "+(0===t.length?"text-center":"")},0===t.length?e.filter?"找不到匹配的数据":"没有可用数据":t)}}});function yo(){const e=S(null),t=S(null);return{scrollAreaRef:e,verticalPositionRef:t,contentStyle:{backgroundColor:"rgba(0,0,0,0.02)",color:"#555"},contentActiveStyle:{backgroundColor:"rgba(0,0,0,0.02)",color:"#555"},thumbStyle:{right:"2px",borderRadius:"3px",backgroundColor:"#EBB107",width:"3px",opacity:.6},onScrollHandler:e=>{t.value=e.verticalPosition},setScrollPosition:(t,n,o)=>{e.value.setScrollPosition("vertical",0,300)}}}const go={class:"work-bench"},bo={class:"dataset-category"},ko={class:"dataset-category-header"},wo={class:"q-ml-md q-mr-md"},Co=to(g({__name:"Index",setup(e){j((e=>({ecf08828:g.value.commonPanel.themeCommonPanelListBorderColor,"144028e9":g.value.commonPanel.themeCommonPanelContentBackgroundColor})));const t=jt(Sa.system.useLayoutStore()).global,{contentStyle:n,contentActiveStyle:o,thumbStyle:r,scrollAreaRef:a,verticalPositionRef:i,setScrollPosition:s,onScrollHandler:c}=yo(),{workBenchModel:d,dynamicRenderLayout:l,selectedDatasetCategories:u,init:p,showFeatureInfo:m,flyToFeature:h,addOrRemoveDataset:f,onLazyLoad:v,toggleDynamicRenderPageLayout:y}=uo(),g=O((()=>{const e=Sa.system.useThemeStore();return e.themeConfig[e.activeName]}));return T((()=>{p()})),P((()=>{d.datasourceCategories.forEach((e=>{e.children.forEach((e=>{var t;f(!1,e),e.checked=!1,e.expanded=!1,(null==(t=null==e?void 0:e.children)?void 0:t.length)&&(e.children.length=0)}))}))})),(e,r)=>(k(),C("div",go,[V(D("div",{class:z(["datasources-container animate__animated animate__fadeInLeft",{"full-width-drawer":!F(t).leftDrawerMini}])},[D("div",bo,[D("div",ko,[E(_e,{dense:"",flat:"",round:"",class:"close text-white",icon:"close",size:"sm",onClick:r[0]||(r[0]=e=>F(y)({datasource:{workBench:!1}}))}),D("div",wo,[E(ze,{modelValue:F(d).filterText,"onUpdate:modelValue":r[1]||(r[1]=e=>F(d).filterText=e),disable:F(d).loading,label:"搜索",dark:"",dense:"",clearable:""},{prepend:M((()=>[E(Be,{color:"white",name:"search"})])),_:1},8,["modelValue","disable"])])]),F(i)>600?(k(),w(_e,{key:0,dense:"",fab:"",round:"",glossy:"","fab-mini":"",ripple:"",icon:"expand_less",padding:"2px",class:"absolute-bottom-right non-selectable z-top scroll-top",onClick:r[2]||(r[2]=e=>F(s)("vertical",0,300))},{default:M((()=>[E(Ee,null,{default:M((()=>[_("回到顶部")])),_:1})])),_:1})):A("",!0),E(Ge,{ref_key:"scrollAreaRef",ref:a,class:"dataset-category-area","content-style":F(n),"content-active-style":F(o),onScroll:F(c)},{default:M((()=>[F(d).loading?(k(),w(fo,{key:0,class:"absolute-center","has-error":F(d).hasLoadingError},null,8,["has-error"])):A("",!0),E(F(vo),{selected:F(d).selectedKey,"onUpdate:selected":[r[3]||(r[3]=e=>F(d).selectedKey=e),F(m)],nodes:F(u),filter:F(d).filterText,onZoomIconClicked:F(h),onLazyLoad:F(v),onChecked:F(f)},null,8,["selected","nodes","filter","onUpdate:selected","onZoomIconClicked","onLazyLoad","onChecked"])])),_:1},8,["content-style","content-active-style","onScroll"])])],2),[[U,F(l).datasource.workBench]]),F(l).datasource.workBench?A("",!0):(k(),w(_e,{key:0,class:"toggle-btn",round:"",loading:F(d).loading,flat:"",color:"white",onClick:r[4]||(r[4]=e=>F(y)({datasource:{workBench:!0}}))},{default:M((()=>[E(Be,{size:"50px",name:"keyboard_double_arrow_right"})])),_:1},8,["loading"]))]))}}),[["__scopeId","data-v-f2c7614f"]]),So=Object.freeze(Object.defineProperty({__proto__:null,default:Co},Symbol.toStringTag,{value:"Module"})),To={class:"page-dynamic-render-recursive-list absolute z-fab"},Po=g({name:"VcDemoDynamicRenderRecursiveList",__name:"Index",setup(e){const{loadDefaultLayers:t}=Sa.viewer.useLayerStore();return T((()=>{t(!0)})),(e,t)=>(k(),C("div",To,[E(Co)]))}}),xo=Object.freeze(Object.defineProperty({__proto__:null,default:Po},Symbol.toStringTag,{value:"Module"}));const Ro={class:"page-dynamic-render-stack"},Oo={key:0,class:"stack-buttons-wrapper"},Lo={class:"stack-buttons-container"},Mo=["onClick"],Eo={style:{"margin-top":"5px"}},_o=to(g({name:"VcDemoDynamicRenderStack",__name:"Index",setup(e){const t=x(),{loadDefaultLayers:n}=Sa.viewer.useLayerStore(),{stackDatas:o}={stackDatas:R([{id:p(),label:"农用地",checked:!1,data:"/datas/work-bench/TDLY农用地.json",renderingType:"polygon",entityProps:{polygon:{material:"rgba(127,194,105,0.8)"}},entitySelectedProps:{polygon:{material:"rgba(137,207,240,0.8)"}}},{id:p(),label:"住宅用地",checked:!1,data:"/datas/work-bench/TDLY住宅用地.json",renderingType:"polygon",entityProps:{polygon:{material:"rgba(238,241,160,0.8)"}},entitySelectedProps:{polygon:{material:"rgba(137,207,240,0.8)"}}},{id:p(),label:"集体建设用地",checked:!1,data:"/datas/work-bench/TDLY集体建设.json",renderingType:"polygon",entityProps:{polygon:{material:"rgba(227,108,9,0.8)"}},entitySelectedProps:{polygon:{material:"rgba(137,207,240,0.8)"}}},{id:p(),label:"工业用地",checked:!1,data:"/datas/work-bench/TDLY工业用地.json",renderingType:"polygon",entityProps:{polygon:{material:"rgba(216,216,216,0.8)"}},entitySelectedProps:{polygon:{material:"rgba(137,207,240,0.8)"}}}])},r=kt(),a=S(!1);S([]),P((()=>{fn(t.path)})),T((()=>{n(!0),bt(r.viewer,{position:{x:-2324661.042454219,y:5396877.953175202,z:2474170.1591741517},heading:6.283185307179586,pitch:-.5001412827126326,roll:6.283185307179586},{duration:1,complete:()=>{a.value=!0}})}));return(e,n)=>(k(),C("div",Ro,[a.value?(k(),C("div",Oo,[D("div",Lo,[(k(!0),C(G,null,W(F(o),((e,n)=>(k(),C("div",{key:n,class:z(["stack-button",{active:e.checked}]),onClick:n=>{return(o=e).checked?fn(o.id):wn(o.data,o.renderingType,o.entityProps,o.entitySelectedProps,o.id,t.path),void(o.checked=!o.checked);var o}},[D("div",Eo,I(e.label),1)],10,Mo)))),128))])])):A("",!0)]))}}),[["__scopeId","data-v-89f0c1d2"]]),Io=Object.freeze(Object.defineProperty({__proto__:null,default:_o},Symbol.toStringTag,{value:"Module"})),Do=g({name:"VcDemoPageExpansion",__name:"Index",setup:e=>(e,t)=>{const n=b("router-view");return k(),w(n)}}),Ao=Object.freeze(Object.defineProperty({__proto__:null,default:Do},Symbol.toStringTag,{value:"Module"})),No=g({name:"VcTyphoon",props:{typhoonDatas:Array,clampToGround:{type:Boolean,default:!1},interval:{type:Number,default:100},radius7Color:{type:String,default:"#00bab2"},radius10Color:{type:String,default:"#ffff00"},radius12Color:{type:String,default:"#da7341"}},emits:{mouseover:e=>!0,mouseout:e=>!0,click:e=>!0,clickout:e=>!0},setup(e,t){const n=q(),o=S(null);wt();const r=kt(),a=R([]),i=e=>{let t="";switch(e){case"STS":t="#0F8000";break;case"TY":t="#FE9C45";break;case"STY":t="#FE00FE";break;case"Super TY":t="#FE0000";break;case"TD":t="#EED139";break;case"TS":t="#0000FF";break;default:t="#409eff"}return t},s=(e,n)=>{n.playIndex=e;const o=n.typhoonData.points[e];o.type="live",o.index=e,o.tfbh=n.name;const r=[o.lng,o.lat];n.positions.push(r),n.points.push({id:o.id||Cesium.createGuid(),position:r,color:i(o.strong),pixelSize:8,outlineColor:"rgba(0,0,0,0.6)",outlineWidth:1,disableDepthTestDistance:Number.POSITIVE_INFINITY,onMouseover(e){t.emit("mouseover",e)},onMouseout(e){t.emit("mouseout",e)},onClick(e){d(o,n),n.playIndex=o.index,t.emit("click",e)},onClickout(e){t.emit("clickout",e)},...o}),e===n.typhoonData.points.length-1&&d(o,n)},c=(t,n)=>{const o=a.findIndex((e=>e.name===t));if(o>=0){let t=0;const r=a[o];r.points.length=0,r.positions.length=0;const i=r.typhoonData;s(t,r),clearInterval(r.playInterval),r.playInterval=setInterval((()=>{t++,t>=i.points.length?clearInterval(r.playInterval):s(t,r)}),n||e.interval)}else on("播放台风失败，原因：未找到对应编号的台风数据。")},d=(e,n)=>{n.children.length=0;const o=e.forecast;if(o&&!(o.length<=0))for(let r=0;r<o.length;r++){const a=o[r],s=[],c=[],d={name:n.name+"_"+a.sets,typhoonData:a,show:!0,positions:c,points:s,type:"forc"};n.children.push(d),a.points.forEach(((n,o)=>{const r=[n.lng,n.lat];d.positions.push(r),0===o&&d.positions.push([e.lng,e.lat]),n.sets=a.sets,n.type="forc",n.index=o,d.points.push({id:n.id||Cesium.createGuid(),position:r,color:i(n.strong),pixelSize:8,outlineColor:"rgba(0,0,0,0.6)",outlineWidth:1,disableDepthTestDistance:Number.POSITIVE_INFINITY,onMouseover(e){t.emit("mouseover",e)},onMouseout(e){t.emit("mouseout",e)},onClick(e){t.emit("click",e)},...n})}))}},l=e=>{const t={name:e.tfbh,typhoonData:e,show:!0,positions:[],points:[],children:[],type:"live"};return a.push(t),c(e.tfbh),t},u=(e,t)=>{let n=[];if("number"==typeof t)n=H(e,1e3*t,{units:"meters"}).geometry.coordinates;else if(t.ne){const o=6,r=360/(4*o),a={0:"ne",1:"nw",2:"sw",3:"se"};for(let i=0;i<4;i++){let s=1e3*parseFloat(t[a[i]]);s||(s=0);for(let t=i*r;t<=(i+1)*r;t++){const r=o*t,a=e[0]+s*Math.cos(r*Math.PI/180)/111e3,i=e[1]+s*Math.sin(r*Math.PI/180)/111e3;n.push([a,i])}}}return n},p=n=>{const o=[];return n.forEach((n=>{if(n.positions.length>1&&o.push(B(e.clampToGround?Rt:Ot,{show:!0,enableMouseEvent:!0,asynchronous:!1,classificationType:2,appearance:{type:"PolylineMaterialAppearance",options:{material:{fabric:{type:"live"===n.type?"Color":"PolylineDash",uniforms:{color:"rgba(0,0,0,0.5)"}}},translucent:!0}},onMouseover(e){t.emit("mouseover",e)},onMouseout(e){t.emit("mouseout",e)},onClick(e){t.emit("click",e)},onClickout(e){t.emit("clickout",e)}},(()=>B(Tt,{id:n.name||Cesium.createGuid()},(()=>B(e.clampToGround?Pt:xt,{positions:St(n.positions),width:2,arcType:Cesium.ArcType.RHUMB,show:!0})))))),o.push(B(Lt,{points:n.points,onReady:e=>{const{cesiumObject:t}=e,n=t.update;t.update=function(e){const t=e.commandList.length;n.call(this,e);const o=e.commandList.length;for(let n=t;n<o;++n)e.commandList[n].pass=Cesium.Pass.TRANSLUCENT,e.commandList[n].renderState=Cesium.RenderState.fromCache({depthTest:{enabled:!1},depthMask:!1})}}})),"live"===n.type){const t=n.points[n.playIndex];(null==t?void 0:t.radius7)>0&&o.push(B(Mt,{positions:u(t.position,t.radius7_quad),clampToGround:e.clampToGround,asynchronous:!1,classificationType:2,appearance:{type:"MaterialAppearance",options:{material:{fabric:{type:"Color",uniforms:{color:e.radius7Color}}},faceForward:!0,renderState:{cull:{enabled:!1},depthTest:{enabled:!1}}}}})),(null==t?void 0:t.radius10)>0&&o.push(B(Mt,{positions:u(t.position,t.radius10_quad),clampToGround:e.clampToGround,asynchronous:!1,classificationType:2,appearance:{type:"MaterialAppearance",options:{material:{fabric:{type:"Color",uniforms:{color:e.radius10Color}}},faceForward:!0,renderState:{cull:{enabled:!1},depthTest:{enabled:!1}}}}})),(null==t?void 0:t.radius12)>0&&o.push(B(Mt,{positions:u(t.position,t.radius12_quad),clampToGround:e.clampToGround,asynchronous:!1,classificationType:2,appearance:{type:"MaterialAppearance",options:{material:{fabric:{type:"Color",uniforms:{color:e.radius12Color}}},faceForward:!0,renderState:{cull:{enabled:!1},depthTest:{enabled:!1}}}}}))}n.children&&o.push(...p(n.children))})),o};return Object.assign(n.proxy,{addTyphoonData:l,addTyphoonByInterval:c,flyToTyphoonData:(e,t)=>{const n=[];"string"==typeof e?n.push(e):n.push(...e);let o=null;n.forEach((e=>{const t=[],n=a.find((t=>t.name===e));n&&n.typhoonData.points&&n.typhoonData.points.forEach((e=>{t.push([e.lng,e.lat])}));const r=St(t),i=Cesium.BoundingSphere.fromPoints(r);o=null===o?i:Cesium.BoundingSphere.union(o,i)})),r.viewer.camera.flyToBoundingSphere(o,{...t})},removeTyphoonData:e=>{const t=a.indexOf(e);t>=0&&(clearInterval(e.playInterval),a.splice(t,1))},removeAllTyphoonData:()=>{a.forEach((e=>{clearInterval(e.playInterval)})),a.length=0},getTyphoonDatasources:()=>a}),e.typhoonDatas.forEach((e=>{l(e)})),()=>{const e=p(a);return B(Ct,{ref:o,show:!0},(()=>e))}}}),Bo={class:"page-dynamic-render-typhoon"},Vo=to(g({name:"VcDemoPageDynamicRenderTyphoon",__name:"Index",setup(e){const t=S([]),n=S(null),o=[{position:[127,34],polyline:{width:1,positions:[[127,34],[127,22],[119,18],[119,11],[113,4.5],[105,0]],material:"rgba(255, 0, 0, 0.8)"}},{polyline:{width:1,positions:[[105,0],[120,0],[132,15],[132,34]],material:{fabric:{type:"PolylineDash",uniforms:{color:"rgba(255, 165, 0, 0.8)",dashLength:10,dashPattern:5}}}}}];T((()=>{r()}));const r=()=>{t.value.length=0;const e=[zn.getStaticData("/datas/typhoon/202209.json"),zn.getStaticData("/datas/typhoon/202210.json")];Promise.all(e).then((([e,n])=>{t.value=[...e.data,...n.data]}))};return(e,r)=>{const a=b("vc-datasource-custom");return k(),C("div",Bo,[E(a,{name:"vc_warnLine",entities:o}),t.value.length?(k(),w(F(No),{key:0,ref_key:"typhoonRef",ref:n,"typhoon-datas":t.value},null,8,["typhoon-datas"])):A("",!0)])}}}),[["__scopeId","data-v-73ea91e7"]]),jo=Object.freeze(Object.defineProperty({__proto__:null,default:Vo},Symbol.toStringTag,{value:"Module"})),Uo=g({name:"VcDemoPageExpansion",__name:"Index",setup:e=>(e,t)=>{const n=b("router-view");return k(),w(n)}}),Fo=Object.freeze(Object.defineProperty({__proto__:null,default:Uo},Symbol.toStringTag,{value:"Module"}));const zo=to({},[["render",function(e,t){return k(),C("div")}]]),Go=Object.freeze(Object.defineProperty({__proto__:null,default:zo},Symbol.toStringTag,{value:"Module"})),Wo={class:"z-top absolute-center page-index"},qo=g({name:"VcDemoPageIndex",__name:"Index",setup(e){kt();const t=S({position:[108,32],point:{pixelSize:28,color:"red"},label:{text:"Hello World",pixelOffset:[0,150]}}),{loadDefaultLayers:n,toggle:o}=Sa.viewer.useLayerStore();T((()=>{n(!0)})),P((()=>{o({names:"admin",show:!1})}));const r=e=>{};return(e,n)=>{const o=b("vc-graphics-billboard"),a=b("vc-graphics-rectangle"),i=b("vc-entity");return k(),C("div",Wo,[E(i,{ref_key:"entity",ref:t,position:t.value.position,point:t.value.point,label:t.value.label,onClick:r},{default:M((()=>[E(o,{ref:"billboard",image:"https://zouyaoji.top/vue-cesium/favicon.png",scale:.5},null,512),E(a,{coordinates:[130,20,80,25],material:"green"})])),_:1},8,["position","point","label"])])}}}),Ho=Object.freeze(Object.defineProperty({__proto__:null,default:qo},Symbol.toStringTag,{value:"Module"})),$o=g({name:"Error404",setup:(e,t)=>({defaultPagePath:"/home"})}),Jo={class:"fullscreen bg-blue text-white text-center q-pa-md flex flex-center"},Ko=D("div",{style:{"font-size":"30vh"}},"404",-1),Yo=D("div",{class:"text-h2",style:{opacity:"0.4"}},"噢. 这儿什么也没有...",-1);const Xo=to($o,[["render",function(e,t,n,o,r,a){return k(),C("div",Jo,[D("div",null,[Ko,Yo,E(_e,{class:"q-mt-xl",color:"white","text-color":"blue",unelevated:"",to:e.defaultPagePath,label:"返回主页","no-caps":""},null,8,["to"])])])}]]),Qo=Object.freeze(Object.defineProperty({__proto__:null,default:Xo},Symbol.toStringTag,{value:"Module"})),Zo=e=>(J("data-v-3aaf0e08"),e=e(),K(),e),er={class:"q-pa-md page-login z-top"},tr={class:"login-container col row"},nr=Zo((()=>D("div",{class:"text-h4 q-my-sm"},"Login",-1))),or=Zo((()=>D("div",{class:"oath flex"},[D("div",{class:"title full-width text-center q-pt-md"},"Social Network LogIn"),D("div",{class:"q-gutter-md full-width text-center q-pt-sm flex justify-center"},[D("svg",{t:"1615200042776",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5886",width:"200",height:"200"},[D("path",{d:"M579.867 511.932c-11.67 0-23.344 10.837-23.344 24.178 0 10.839 11.668 21.678 23.344 21.678 17.514 0 30.020-10.839 30.020-21.678 0-13.34-12.505-24.178-30.020-24.178v0zM503.154 399.36c18.345 0 30.020-11.67 30.020-29.185 0-18.345-11.675-29.183-30.020-29.183-17.51 0-34.188 10.839-34.188 29.183-0.001 17.517 16.678 29.185 34.188 29.185v0zM512.326 0.56c-282.655 0-511.788 229.133-511.788 511.788 0 282.653 229.133 511.786 511.788 511.786 282.653 0 511.786-229.133 511.786-511.786 0.001-282.655-229.132-511.788-511.786-511.788v0zM415.602 642.009c-30.855 0-53.369-4.999-82.553-13.341l-84.218 42.53 24.186-71.715c-59.204-41.689-94.228-94.221-94.228-158.428 0-113.403 106.733-200.123 236.814-200.123 115.069 0 217.633 68.377 237.644 165.106-8.338-1.671-15.844-2.502-22.514-2.502-113.403 0-200.954 85.049-200.954 187.613 0 17.508 2.502 33.351 6.671 50.030-6.671 0.829-14.178 0.829-20.849 0.829v0zM763.314 723.724l16.674 60.041-63.371-35.854c-24.18 4.999-47.529 12.505-71.709 12.505-111.737 0-200.123-76.711-200.123-171.769 0-95.058 88.388-171.771 200.123-171.771 105.895 0 200.954 76.713 200.954 171.771 0 53.362-35.854 100.891-82.548 135.078v0zM338.053 340.992c-17.51 0-35.854 10.839-35.854 29.183 0 17.516 18.343 29.19 35.854 29.19 16.679 0 30.020-11.675 30.020-29.19 0-18.343-13.341-29.183-30.020-29.183v0zM710.783 511.932c-12.51 0-23.349 10.837-23.349 24.178 0 10.839 10.839 21.678 23.349 21.678 16.674 0 29.183-10.839 29.183-21.678 0-13.34-12.509-24.178-29.183-24.178v0zM710.783 511.932z","p-id":"5887","data-spm-anchor-id":"a313x.7781069.0.i22",class:"",fill:"#2dc100"})]),D("svg",{t:"1615199447339",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2522",width:"200",height:"200"},[D("path",{d:"M512 0C229.003636 0 0 229.003636 0 512s229.003636 512 512 512 512-229.003636 512-512S794.996364 0 512 0z m210.385455 641.396364c-7.447273 9.309091-26.996364-1.861818-41.89091-32.581819-3.723636 13.963636-13.032727 36.305455-34.443636 64.232728 35.374545 8.378182 44.683636 42.821818 33.512727 61.44-8.378182 13.032727-26.996364 24.203636-59.578181 24.203636-58.647273 0-83.781818-15.825455-95.883637-26.996364-1.861818-2.792727-5.585455-3.723636-10.24-3.723636-4.654545 0-7.447273 0.930909-10.24 3.723636-11.170909 11.170909-37.236364 26.996364-95.883636 26.996364-32.581818 0-52.130909-11.170909-59.578182-24.203636-12.101818-18.618182-1.861818-53.061818 33.512727-61.44-20.48-27.927273-29.789091-50.269091-34.443636-64.232728-13.963636 30.72-34.443636 42.821818-41.890909 32.581819-5.585455-8.378182-8.378182-26.065455-7.447273-38.167273 3.723636-46.545455 34.443636-85.643636 53.061818-106.123636-2.792727-5.585455-8.378182-40.029091 14.894546-63.301819v-1.861818c0-92.16 65.163636-158.254545 148.014545-158.254545 81.92 0 148.014545 66.094545 148.014546 158.254545v1.861818c23.272727 23.272727 17.687273 57.716364 14.894545 63.301819 17.687273 20.48 49.338182 59.578182 53.061818 106.123636 0.930909 12.101818-0.930909 29.789091-7.447272 38.167273z",fill:"#30A5DD","p-id":"2523"})]),D("svg",{t:"1615199464855",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3380",width:"200",height:"200"},[D("path",{d:"M448.698182 482.210909c-96.814545 4.654545-175.010909 56.785455-175.010909 121.949091s78.196364 114.501818 175.010909 109.847273S623.709091 647.912727 623.709091 582.749091c-0.930909-64.232727-79.127273-105.192727-175.010909-100.538182z m65.163636 164.770909c-29.789091 39.098182-88.436364 57.716364-145.221818 26.065455-26.996364-14.894545-26.065455-43.752727-26.065455-43.752728s-11.170909-92.16 85.643637-103.330909c97.745455-12.101818 115.432727 81.92 85.643636 121.018182z",fill:"#EA5D5C","p-id":"3381"}),D("path",{d:"M448.698182 584.610909c-6.516364 4.654545-7.447273 13.032727-3.723637 18.618182 2.792727 5.585455 11.170909 6.516364 16.756364 1.861818 5.585455-4.654545 8.378182-13.032727 4.654546-18.618182-2.792727-5.585455-10.24-6.516364-17.687273-1.861818zM403.083636 597.643636c-18.618182 1.861818-30.72 17.687273-30.72 33.512728 0 14.894545 14.894545 26.065455 32.581819 24.203636 17.687273-1.861818 32.581818-15.825455 32.581818-31.650909s-13.963636-27.927273-34.443637-26.065455z",fill:"#EA5D5C","p-id":"3382"}),D("path",{d:"M512 0C229.003636 0 0 229.003636 0 512s229.003636 512 512 512 512-229.003636 512-512S794.996364 0 512 0z m197.352727 626.501818C669.323636 712.145455 538.065455 754.036364 441.250909 746.589091c-92.16-7.447273-211.316364-38.167273-223.418182-151.738182 0 0-6.516364-51.2 42.821818-117.294545 0 0 70.749091-99.607273 152.669091-128.465455 82.850909-27.927273 92.16 19.549091 92.16 48.407273-4.654545 24.203636-12.101818 38.167273 18.618182 28.858182 0 0 80.989091-38.167273 114.501818-4.654546 26.996364 26.996364 4.654545 65.163636 4.654546 65.163637s-11.170909 12.101818 12.101818 16.756363c21.410909 3.723636 94.021818 37.236364 53.992727 122.88z m-80.058182-236.450909c-8.378182 0-15.825455-7.447273-15.825454-15.825454 0-9.309091 7.447273-15.825455 15.825454-15.825455 0 0 99.607273-18.618182 87.505455 89.367273v1.861818c-0.930909 7.447273-7.447273 13.963636-15.825455 13.963636-9.309091 0-15.825455-7.447273-15.825454-15.825454 0-1.861818 15.825455-73.541818-55.854546-57.716364zM797.789091 493.381818c-2.792727 18.618182-12.101818 11.170909-22.341818 11.170909-13.032727 0-23.272727-16.756364-23.272728-29.789091 0-11.170909 4.654545-22.341818 4.654546-22.341818 0.930909-4.654545 12.101818-34.443636-7.447273-78.196363-35.374545-60.509091-106.123636-60.509091-114.501818-57.716364-8.378182 3.723636-21.410909 5.585455-21.410909 5.585454-13.032727 0-23.272727-10.24-23.272727-23.272727 0-11.170909 7.447273-19.549091 16.756363-22.341818 0 0 0 0.930909 0.930909 0.930909s1.861818 0.930909 1.861819 0.930909c10.24-1.861818 45.614545-4.654545 79.127272 3.723637 62.370909 14.894545 146.152727 83.781818 108.916364 211.316363z",fill:"#EA5D5C","p-id":"3383"})])])],-1))),rr=Zo((()=>D("div",{class:"row justify-between q-pt-md text-grey-8"},[D("span",null,"Forget Password?"),D("span",{class:"sign-up text-center cursor-pointer"}," Don't Have Account？Register Now！ ")],-1))),ar=to(g({__name:"Login",setup(e){j((e=>({"315472c4":r.value.pageLogin.themePageLoginBackground,"66c497f3":r.value.pageLogin.themePageLoginColor,"1ea0ecf8":r.value.global.themeColorAlpha,b0beb80c:r.value.global.themeColor}))),We();const t=$(),n=S({username:"admin",password:"admin"}),o={username:[e=>e&&e.length>0||"Please Input Username"],password:[e=>e&&e.length>0||"Please Input Password"],rememberMe:[e=>!!e||"You need to accept the license and terms first"]},r=O((()=>{const e=Sa.system.useThemeStore();return e.themeConfig[e.activeName]})),a=async()=>{Sa.system.useAccountStore().login(n.value).then((()=>{t.replace(t.currentRoute.value.query.redirect||"/home")}))},i=()=>{n.value={username:"",password:""}};return(e,t)=>(k(),C("div",er,[D("div",tr,[E(qe,{greedy:"",class:"form-login",onSubmit:a,onReset:i},{default:M((()=>[nr,E(ze,{modelValue:n.value.username,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value.username=e),outlined:"",label:"Name","lazy-rules":"",rules:o.username},{prepend:M((()=>[E(Be,{class:"icon",name:"perm_identity"})])),_:1},8,["modelValue","rules"]),E(ze,{modelValue:n.value.password,"onUpdate:modelValue":t[1]||(t[1]=e=>n.value.password=e),outlined:"",label:"Password","lazy-rules":"",type:"password",rules:o.password},{prepend:M((()=>[E(Be,{class:"icon",name:"lock"})])),_:1},8,["modelValue","rules"]),D("div",null,[E(_e,{class:"btn-submit full-width no-outline text-h6",color:"primary",label:"Login",type:"submit"})]),or,rr])),_:1})])]))}}),[["__scopeId","data-v-3aaf0e08"]]),ir=Object.freeze(Object.defineProperty({__proto__:null,default:ar},Symbol.toStringTag,{value:"Module"})),sr=g({__name:"Index",setup(e){const t=R({cesiumPath:"https://unpkg.com/cesium@latest/Build/Cesium/Cesium.js"});return(e,n)=>(k(),w(F(Et),{"cesium-path":t.cesiumPath},{default:M((()=>[E(F(_t))])),_:1},8,["cesium-path"]))}}),cr=Object.freeze(Object.defineProperty({__proto__:null,default:sr},Symbol.toStringTag,{value:"Module"})),dr=g({__name:"Index",setup(e){const t=We();Y((()=>t.fullscreen.isActive),(e=>{}));const n=()=>{t.fullscreen.toggle()};return(e,o)=>(k(),w(_e,{icon:F(t).fullscreen.isActive?"fullscreen_exit":"fullscreen",size:"md",flat:"",round:"",onClick:n},{default:M((()=>[E(Ee,null,{default:M((()=>[_(I(F(t).fullscreen.isActive?"退出全屏":"全屏"),1)])),_:1})])),_:1},8,["icon"]))}}),lr=g({__name:"Index",setup(e){const{toggleGlobalLayout:t}=Sa.system.useLayoutStore(),{loadDefaultLayers:n}=Sa.viewer.useLayerStore(),o=Sa.system.useUserStore(),r=kt(),a=()=>{Sa.system.useAccountStore().logout({confirm:!0}).then((e=>{if(e){n(!1),t({featureInfo:!1,layerManager:!1}),Sa.viewer.useRenderStore(Ca).removeAllRenderData();const e={position:[105,30,21634101],heading:360,pitch:-90,roll:0};(null==r?void 0:r.viewer)&&bt(null==r?void 0:r.viewer,e,{duration:3})}}))};return(e,t)=>{var n;return"login"!==e.$route.name?(k(),w(Ie,{key:0,dense:"",rounded:"","no-caps":"",size:"md",class:"q-mr-sm cursor-pointer","auto-close":"",icon:"person",label:null==(n=F(o).info)?void 0:n.username},{default:M((()=>[E($e,null,{default:M((()=>[E(De,{dense:""},{default:M((()=>[V((k(),w(Ue,{clickable:"",dense:"",onClick:a},{default:M((()=>[E(Ae,{avatar:""},{default:M((()=>[E(He,{icon:"logout"})])),_:1}),E(Ae,null,{default:M((()=>[E(Ve,null,{default:M((()=>[_("LogOut")])),_:1})])),_:1})])),_:1})),[[Je]])])),_:1})])),_:1})])),_:1},8,["label"])):A("",!0)}}}),ur=g({__name:"Index",setup(e){const{locale:t}=X(),n=S(!1),o=e=>{t.value=e,Jt("locale",e)};return(e,t)=>(k(),w(Ke,{modelValue:n.value,"onUpdate:modelValue":t[2]||(t[2]=e=>n.value=e),dense:"",color:"#fff","fab-mini":"",size:"md","dropdown-icon":"language",flat:""},{default:M((()=>[E(De,null,{default:M((()=>[V((k(),w(Ue,{clickable:"",onClick:t[0]||(t[0]=e=>o("en-US"))},{default:M((()=>[E(Ae,null,{default:M((()=>[E(Ve,null,{default:M((()=>[_("English")])),_:1})])),_:1})])),_:1})),[[Je]]),V((k(),w(Ue,{clickable:"",onClick:t[1]||(t[1]=e=>o("zh-CN"))},{default:M((()=>[E(Ae,null,{default:M((()=>[E(Ve,null,{default:M((()=>[_("简体中文")])),_:1})])),_:1})])),_:1})),[[Je]])])),_:1})])),_:1},8,["modelValue"]))}}),pr={class:"vc-geocoder row"},mr=to(g({__name:"Index",setup(e){const t=kt(),n=S(null),o=S([]),r=S(null),a=S([]),i=async(e,t,r)=>{const a={keywords:e=""===e?n.value:e,citylimit:!0,output:"json",key:"3d933b21d4d5e130a155b4cf2560c610"},i=await zn.getLocationList(a);let s=[];if("1"===i.status){const e=i.pois,t=[];e.forEach((e=>{t.push({value:e.id,label:e.name,pname:e.pname,cityname:e.cityname,adname:e.adname,address:e.address,location:e.location,type:e.type})})),s=[...new Set(t)]}t((()=>{const t=null==e?void 0:e.toLocaleLowerCase();o.value=s.filter((e=>e.label.toLocaleLowerCase().indexOf(t)>-1))}))},s=e=>{n.value=e},c=()=>{n.value=null,a.value.length=0},d=e=>{if(e){const t=It(Number(e.location.trim().split(",")[0]),Number(e.location.trim().split(",")[1])),n={lng:t[0],lat:t[1],address:e.address};l(n,e)}else a.value.length=0},l=(e,n)=>{const o=e.lng,r=e.lat,i=e.address,{Rectangle:s,sampleTerrain:c}=Cesium,{viewer:d}=t;a.value.length=0,a.value.push({position:[o,r],point:{color:"#08ABD5",pixelSize:12,outlineWidth:3,outlineColor:"#fff"},properties:{...n},description:u({"经度":o,"纬度":r,"地址":i})}),new Cesium.HeadingPitchRange(0,0,3e3);const l=.01,p=s.fromDegrees(o-l,r-l,o+l,r+l),m=d.scene.camera,h=m.getRectangleCameraCoordinates(p),f=d.scene.globe.ellipsoid.cartesianToCartographic(h);c(d.scene.globe.terrainProvider,6,[s.center(p)]).then((function(e){const t={longitude:f.longitude,latitude:f.latitude,height:f.height+e[0].height},n=d.scene.globe.ellipsoid.cartographicToCartesian(t);m.flyTo({duration:3,destination:n})}))},u=(e,t)=>{let n="";e instanceof Cesium.PropertyBag&&(e=e.getValue(Cesium.JulianDate.now()));for(let o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(o===t)continue;let r=e[o];"object"==typeof r&&(r=u(r)),o=o.replace(/_/g," "),Cesium.defined(r)&&(n+="<tr><th>"+o+"</th><td>"+r+"</td></tr>")}return n.length>0&&(n='<table class="cesium-infoBox-defaultTable"><tbody>'+n+"</tbody></table>"),n};return(e,t)=>{const l=b("vc-datasource-custom");return k(),C(G,null,[D("div",pr,[E(Ye,{outlined:"","model-value":n.value,"use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",options:o.value,label:"Search(TBD)",style:{width:"250px"},dense:"","hide-dropdown-icon":"",onFilter:i,onInputValue:s,"onUpdate:modelValue":d},{prepend:M((()=>[E(Be,{name:"place",color:"white"})])),"no-option":M((()=>[E(Ue,null,{default:M((()=>[E(Ae,{class:"text-grey"},{default:M((()=>[_(" Not Found ")])),_:1})])),_:1})])),append:M((()=>[null!==n.value?(k(),w(Be,{key:0,name:"cancel",class:"cursor-pointer",onClick:Q(c,["stop"])})):A("",!0),E(Be,{name:"search",color:"orange"})])),_:1},8,["model-value","options"])]),E(l,{ref_key:"datasoureceRef",ref:r,entities:a.value},null,8,["entities"])],64)}}}),[["__scopeId","data-v-4e309cae"]]),hr=(e=>(J("data-v-ba6cc136"),e=e(),K(),e))((()=>D("img",{src:"https://zouyaoji.top/vue-cesium/favicon.png"},null,-1))),fr={class:"menu-container"},vr={key:0,class:"right-btn"},yr=to(g({name:"MainHeader",__name:"Index",setup(e){const t=x();S(!1);const n=S(""),{registerTimeout:o}=Xe(),r=S(100),a=Sa.system.useMenuStore(),i=Sa.system.useLayoutStore(),{global:s}=jt(i),c=O((()=>"Global Village")),d=O((()=>{const e=a.header;return e.length?e[0].children:[]}));O((()=>!1)),O((()=>a.aside)),O((()=>{const e=Sa.system.useThemeStore();return e.themeConfig[e.activeName]})),Y((()=>t.matched),(e=>{o((()=>{if(e.length>1){const t=e[1].path.substring(1,e[1].path.length);t&&(n.value=t)}else n.value="index"}),r.value)}),{immediate:!0}),T((()=>{r.value=5}));const l=()=>{i.toggleGlobalLayout({leftDrawerMini:!s.value.leftDrawerMini})},u=e=>{null===e&&t.matched.length>1?n.value=t.matched[1].path.substring(1,t.matched[1].path.length):n.value=e};return(e,t)=>(k(),w(tt,{class:"main-header"},{default:M((()=>[E(He,{class:"cursor-pointer",onClick:l},{default:M((()=>[hr])),_:1}),E(Qe,{shrink:!0,style:{width:"280px","font-weight":"bold","text-align":"left"}},{default:M((()=>[_(I(c.value),1)])),_:1}),D("div",fr,[E(Ze,{"model-value":n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),align:"left","indicator-color":"cyan-13","onUpdate:modelValueOnce":u},{default:M((()=>[(k(!0),C(G,null,W(d.value,((t,n)=>(k(),w(nt,{key:n,name:t.name,to:t.path,exact:"",label:e.$t(t.title),"content-class":"menu-tab","active-class":"menu-active"},null,8,["name","to","label"])))),128))])),_:1},8,["model-value"])]),E(et),d.value.length?(k(),C("div",vr,[E(mr),E(dr),E(ur),E(lr)])):A("",!0)])),_:1}))}}),[["__scopeId","data-v-ba6cc136"]]),gr={key:0,class:"text-weight-bold"},br={class:"content"},kr=to(g({__name:"Index",props:{title:{type:String,default:""},titleClass:{type:String,default:""},closeTip:{type:String,default:"关闭"},showCloseBtn:{type:Boolean,default:!0},separatorOpts:{type:Object,default:()=>({show:!0,dark:!0,color:"white",size:"1px"})}},emits:["close"],setup(e,{emit:t}){j((e=>({c6e3f058:r.value.commonPanel.themeCommonPanelHeaderColor,a83893f4:r.value.commonPanel.themeCommonPanelHeaderBackgroundColor,"6d7599a8":r.value.commonPanel.themeCommonPanelContentColor,"387e935e":r.value.commonPanel.themeCommonPanelContentBackgroundColor,"452a03e3":r.value.commonPanel.themeCommonPanelListColor,"5d46fb17":r.value.commonPanel.themeCommonPanelListBorderColor,"84b34094":r.value.global.themeColorAlpha,"21f592f0":r.value.global.themeColor})));const n=t,o=e=>{n("close",e)},r=O((()=>{const e=Sa.system.useThemeStore();return e.themeConfig[e.activeName]}));return(t,n)=>(k(),w(at,{class:"common-panel"},{default:M((()=>[E(ot,{class:z(["header",e.titleClass])},{default:M((()=>[""!==e.title?(k(),C("div",gr,I(e.title),1)):A("",!0),Z(t.$slots,"header-left",{},void 0,!0),E(et),Z(t.$slots,"header-right",{},void 0,!0),e.showCloseBtn?V((k(),w(_e,{key:1,dense:"",flat:"",icon:"close",onClick:o},{default:M((()=>[E(Ee,null,{default:M((()=>[_(I(e.closeTip),1)])),_:1})])),_:1})),[[Je]]):A("",!0)])),_:3},8,["class"]),e.separatorOpts.show?(k(),w(rt,ee(te({key:0},e.separatorOpts)),null,16)):A("",!0),D("div",br,[Z(t.$slots,"default",{},void 0,!0)])])),_:3}))}}),[["__scopeId","data-v-70da5cdb"]]),wr=g({name:"DragWrapper",props:{restriction:{type:[String,Object,Function],default:"parent"}},setup(e,t){const n=S(null),o=q(),r=e=>{const t=e.target,n=(parseFloat(t.getAttribute("data-x"))||0)+e.dx,o=(parseFloat(t.getAttribute("data-y"))||0)+e.dy;t.style.webkitTransform=t.style.transform="translate("+n+"px, "+o+"px)",t.setAttribute("data-x",n),t.setAttribute("data-y",o)},a=()=>{const e=n.value;Ht(e).reflow({name:"drag",axis:"xy"})};return T((()=>{const t=n.value;Ht(t).draggable({ignoreFrom:"button, .ignore-drag",allowFrom:".drag-handle",inertia:!0,onmove:r,modifiers:[Ht.modifiers.restrict({restriction:e.restriction,endOnly:!0,elementRect:{left:0,right:1,top:0,bottom:1}})]}),addEventListener("resize",a,!1)})),ne((()=>{const e=n.value;Ht.isSet(e)&&Ht(e).unset(),removeEventListener("resize",a,!1)})),Object.assign(null==o?void 0:o.proxy,{resizeListener:a}),()=>B("div",{ref:n,class:"drag-wrapper absolute"},Dt(t.slots.default))}}),Cr={class:"text-subtitle2"},Sr={class:"q-gutter-sm"},Tr={class:"text-subtitle2"},Pr={class:"q-gutter-sm"},xr={class:"text-subtitle2"},Rr={class:"q-gutter-sm"},Or=to(g({__name:"Index",setup(e){const t=S(null),n=Sa.system.useLayoutStore(),{global:o,dynamicRender:r}=jt(n),{overlayLayers:a,baseLayers:i,terrainLayers:s,toggle:c}=Sa.viewer.useLayerStore();Y(r,(e=>{L((()=>{var e,n;t.value&&(null==(n=(e=t.value).resizeListener)||n.call(e))}))}),{deep:!0});const d=O((()=>({overlayLayers:a,baseLayers:i,terrainLayers:s}))),l=O({get(){var e,t;return null==(t=null==(e=d.value.baseLayers.filter((e=>e.props.show)))?void 0:e[0])?void 0:t.name},set(e){}}),u=O({get(){var e,t;return null==(t=null==(e=d.value.terrainLayers.filter((e=>e.props.show)))?void 0:e[0])?void 0:t.name},set(e){}}),p=(e,t)=>{d.value.baseLayers.forEach((t=>{t.name===e?c({names:t.name,show:!0}):c({names:t.name,show:!1})}))},m=(e,t)=>{d.value.terrainLayers.forEach((t=>{t.name===e?c({names:t.name,show:!0}):c({names:t.name,show:!1})}))},h=()=>{n.toggleGlobalLayout({layerManager:!o.value.layerManager})};return(e,n)=>(k(),C("div",{class:z(["layer-manager",F(r).datasource.workBench?"":"full-srceen"])},[E(F(wr),{ref_key:"dragWrapperRef",ref:t},{default:M((()=>[V(E(kr,{class:"layer-manager-panel",title:e.$t("message.panel.layerManager"),"title-class":"drag-handle",onClose:h},{default:M((()=>[E(it,{class:"q-pt-sm"},{default:M((()=>[D("div",Cr,I(e.$t("message.baseLayer")),1),D("div",Sr,[(k(!0),C(G,null,W(d.value.baseLayers,((e,t)=>(k(),w(st,{key:t,modelValue:l.value,"onUpdate:modelValue":[n[0]||(n[0]=e=>l.value=e),p],val:e.name,label:e.text},null,8,["modelValue","val","label"])))),128))])])),_:1}),E(rt,{inset:""}),E(it,{class:"q-pt-sm"},{default:M((()=>[D("div",Tr,I(e.$t("message.overlayLayer")),1),D("div",Pr,[(k(!0),C(G,null,W(d.value.overlayLayers,((e,t)=>(k(),w(Ne,{key:t,modelValue:e.props.show,"onUpdate:modelValue":[t=>e.props.show=t,t=>((e,t)=>{const n=e.name;c({names:n,show:t})})(e,t)],val:e.name,label:e.text},null,8,["modelValue","onUpdate:modelValue","val","label"])))),128))])])),_:1}),E(rt,{inset:""}),E(it,{class:"q-pt-sm"},{default:M((()=>[D("div",xr,I(e.$t("message.terrainLayer")),1),D("div",Rr,[(k(!0),C(G,null,W(d.value.terrainLayers,((e,t)=>(k(),w(st,{key:t,modelValue:u.value,"onUpdate:modelValue":[n[1]||(n[1]=e=>u.value=e),m],val:e.name,label:e.text},null,8,["modelValue","val","label"])))),128))])])),_:1})])),_:1},8,["title"]),[[U,F(o).layerManager]])])),_:1},512)],2))}}),[["__scopeId","data-v-179cd74a"]]),Lr=to(g({__name:"Index",setup(e){const t=S(null),{contentStyle:n,contentActiveStyle:o,thumbStyle:r,scrollAreaRef:a,verticalPositionRef:i,setScrollPosition:s,onScrollHandler:c}=yo(),d=Sa.system.useLayoutStore(),{global:l,dynamicRender:u}=jt(d),{toggleGlobalLayout:p}=d,m=Sa.viewer.useRenderStore().selectedRenderData,h=S(null),f=S("450px");T((()=>{})),Y(l,(e=>{L((()=>{var e,n;null==(n=null==(e=t.value)?void 0:e.resizeListener)||n.call(e)}))}),{deep:!0}),Y(m,(e=>{L((()=>{var t;if(null==(t=null==e?void 0:e.featureInfoListItems)?void 0:t.length){const e=h.value.$el,t=getComputedStyle(e).height,n=parseInt(t);f.value=n<680?t:"680px"}}))}));const v=O((()=>({height:f.value}))),y=()=>{p({featureInfo:!1})};return(e,r)=>(k(),C("div",{class:z(["feature-info",F(u).datasource.workBench?"":"full-srceen"])},[E(F(wr),{ref_key:"dragWrapperRef",ref:t},{default:M((()=>[V(E(kr,{class:"feature-info-panel animated fadeIn q-ma-xs",title:"要素信息","title-class":"drag-handle",onClose:y},{default:M((()=>{var e;return[0===(null==(e=F(m))?void 0:e.featureInfoListItems.length)?(k(),w(fo,{key:0,class:"absolute-center","show-tip":""})):A("",!0),F(i)>600?(k(),w(_e,{key:1,dense:"",fab:"",round:"",glossy:"","fab-mini":"",ripple:"",icon:"expand_less",padding:"2px",class:"absolute-bottom-right non-selectable scroll-top z-top",onClick:r[0]||(r[0]=e=>F(s)("vertical",0,300))},{default:M((()=>[E(Ee,null,{default:M((()=>[_("回到顶部")])),_:1})])),_:1})):A("",!0),E(Ge,{ref_key:"scrollAreaRef",ref:a,class:"feature-info-panel-content",style:oe(v.value),"content-style":F(n),"content-active-style":F(o),onScroll:F(c)},{default:M((()=>[E(De,{ref_key:"featureInfoListRef",ref:h,dark:"",bordered:"",separator:"",class:"feature-info-list"},{default:M((()=>{var e;return[(k(!0),C(G,null,W(null==(e=F(m))?void 0:e.featureInfoListItems,((e,t)=>V((k(),w(Ue,{key:t,clickable:""},{default:M((()=>[E(Ae,{avatar:""},{default:M((()=>[E(Be,{class:"feature-info-field-icon",name:"article"})])),_:1}),E(Ae,null,{default:M((()=>[E(Ve,null,{default:M((()=>[_(I(e.label),1)])),_:2},1024),E(Ve,{caption:""},{default:M((()=>[_(I(e.value),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)),[[je]]))),128))]})),_:1},512)])),_:1},8,["style","content-style","content-active-style","onScroll"])]})),_:1},512),[[U,F(l).featureInfo]])])),_:1},512)],2))}}),[["__scopeId","data-v-6bce411c"]]),Mr={class:"buttons-box-left"},Er={class:"buttons-box-right"},_r={class:"jessibuca-btn"},Ir=to(g({name:"VcDemoJessibucaPlayer",__name:"Index",props:{url:String,error:String,hasAudio:{type:Boolean,default:!0}},setup(e){const t=e,n=x(),o=S(!1),r=S(!0),a=S(!1),i=S(!1),s=S(!1);S(0);const c=S(""),d=S(0);S(null),S(1),S(0),S(!0);const l=S(""),u=S(!1),p=S(null),m=S(null);let h={};const f=q();T((()=>{let e=t.url;const o=decodeURIComponent(n.params.url);L((()=>{v(),window.onresize=()=>{v()},void 0===e&&(e=o),y(e)}))})),P((()=>{h[f.uid]&&h[f.uid].destroy(),o.value=!1,s.value=!1,c.value=""})),Y((()=>t.url),(e=>{y(e)}));const v=()=>{let e=p.value,t=e.parentNode.clientWidth,n=9/16*t;const o=Math.min(document.body.clientHeight,document.documentElement.clientHeight);n>o&&(n=o,t=16/9*n),e.style.width=t+"px",e.style.height=n+"px"},y=e=>{an(`开始播放视频流：${e}`),h[f.uid]&&M(),g(),h[f.uid].on("play",(()=>{o.value=!0,s.value=!0,a.value=h[f.uid].quieting})),h[f.uid].hasLoaded()?h[f.uid].play(e):h[f.uid].on("load",(()=>{h[f.uid].play(e)}))},g=()=>{an(`hasAudio: ${t.hasAudio}`),h[f.uid]=new Jessibuca({container:p.value,videoBuffer:.2,isResize:!0,decoder:"./libs/jessibuca/decoder.js",useMSE:!0,useWCS:!0,showBandwidth:!1,isFlv:!1,loadingText:"加载中",hasAudio:t.hasAudio,debug:!1,supportDblclickFullscreen:!1,operateBtns:{fullscreen:!1,screenshot:!1,play:!1,audio:!1},forceNoOffscreen:u.value,isNotMute:r.value});let e=h[f.uid];e.on("load",(function(){})),e.on("log",(function(e){})),e.on("record",(function(e){})),e.on("pause",(function(){o.value=!1})),e.on("play",(function(){o.value=!0})),e.on("fullscreen",(function(e){i.value=e})),e.on("mute",(function(e){r.value=!e})),e.on("audioInfo",(function(e){})),e.on("videoInfo",(function(e){})),e.on("bps",(function(e){})),e.on("timeUpdate",(function(e){})),e.on("videoInfo",(function(e){})),e.on("error",(function(e){})),e.on("timeout",(function(){})),e.on("start",(function(){})),e.on("performance",(function(e){let t="卡顿";2===e?t="非常流畅":1===e&&(t="流畅"),c.value=t})),e.on("buffer",(function(e){})),e.on("stats",(function(e){})),e.on("kBps",(function(e){d.value=Math.round(e)})),e.on("videoFrame",(function(){})),e.on("metadata",(function(){}))},b=()=>{let e=w();h[f.uid].setFullscreen(!e),i.value=!e},w=()=>document.fullscreenElement||document.msFullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||!1,R=()=>{y(t.url)},O=()=>{h[f.uid]&&h[f.uid].pause(),o.value=!1,l.value="",c.value=""},M=()=>{h[f.uid]&&h[f.uid].destroy(),null==m.value&&p.value.appendChild(m.value),h[f.uid]=null,o.value=!1,c.value=""},E=()=>{h[f.uid]&&h[f.uid].screenshot("截图","png",.5)};return(e,t)=>(k(),C("div",{ref_key:"palyerContainerRef",ref:p,class:"jessibuca-player",onDblclick:b},[D("div",{id:"buttonsBox",ref_key:"buttonsBoxRef",ref:m,class:"buttons-box"},[D("div",Mr,[o.value?A("",!0):(k(),C("i",{key:0,class:"iconfont icon-play jessibuca-btn",onClick:R})),o.value?(k(),C("i",{key:1,class:"iconfont icon-pause jessibuca-btn",onClick:O})):A("",!0),D("i",{class:"iconfont icon-stop jessibuca-btn",onClick:M}),r.value?(k(),C("i",{key:2,class:"iconfont icon-audio-high jessibuca-btn",onClick:t[0]||(t[0]=e=>{h[f.uid]&&h[f.uid].mute()})})):A("",!0),r.value?A("",!0):(k(),C("i",{key:3,class:"iconfont icon-audio-mute jessibuca-btn",onClick:t[1]||(t[1]=e=>{h[f.uid]&&h[f.uid].cancelMute()})}))]),D("div",Er,[D("span",_r,I(d.value)+" kb/s",1),D("i",{class:"iconfont icon-camera1196054easyiconnet jessibuca-btn",style:{"font-size":"1rem !important"},onClick:E}),D("i",{class:"iconfont icon-shuaxin11 jessibuca-btn",onClick:R}),i.value?A("",!0):(k(),C("i",{key:0,class:"iconfont icon-weibiaoti10 jessibuca-btn",onClick:b})),i.value?(k(),C("i",{key:1,class:"iconfont icon-weibiaoti11 jessibuca-btn",onClick:b})):A("",!0)])],512)],544))}}),[["__scopeId","data-v-4750c349"]]),Dr={class:"video-player-container"},Ar=to(g({name:"VcDemoDevicePlayerPanel",__name:"Index",setup(e){const t=S(null),n=Sa.system.useLayoutStore(),{global:o,dynamicRender:r}=jt(n);Y(r,(e=>{L((()=>{var e,n;t.value&&(null==(n=(e=t.value).resizeListener)||n.call(e))}))}),{deep:!0});const a=()=>{n.toggleGlobalLayout({videoPlayer:!o.value.videoPlayer})};return(e,n)=>F(o).videoPlayer?(k(),C("div",{key:0,class:z(["device-player",F(r).datasource.workBench?"":"full-srceen"])},[E(F(wr),{ref_key:"dragWrapperRef",ref:t},{default:M((()=>[E(kr,{class:"device-player-panel",title:e.$t("message.panel.videoPlayer"),"title-class":"drag-handle",onClose:a},{default:M((()=>[E(it,null,{default:M((()=>[D("div",Dr,[E(Ir,{url:"https://sf1-hscdn-tos.pstatp.com/obj/media-fe/xgplayer_doc_video/flv/xgplayer-demo-720p.flv"})])])),_:1})])),_:1},8,["title"])])),_:1},512)],2)):A("",!0)}}),[["__scopeId","data-v-2aaa4040"]]),Nr={class:"main-interaction"},Br={class:"panel-wrapper"},Vr=to(g({name:"VcDemoInteraction",__name:"Index",setup:e=>(O((()=>{const e=Sa.system.useThemeStore();return e.themeConfig[e.activeName]})),(e,t)=>(k(),C("div",Nr,[D("div",Br,[E(Or),E(Lr),E(Ar)])])))}),[["__scopeId","data-v-4bf69a58"]]);var jr=function(e,t){var n;function o(e,t){function n(e){return!e.audio&&!e.video&&!e.screen&&e.data}var o="";o+="?userid="+e.userid,o+="&sessionid="+e.sessionid,o+="&msgEvent="+e.socketMessageEvent,o+="&socketCustomEvent="+e.socketCustomEvent,o+="&autoCloseEntireSession="+!!e.autoCloseEntireSession,!0===e.session.broadcast&&(o+="&oneToMany=true"),o+="&maxParticipantsAllowed="+e.maxParticipantsAllowed,e.enableScalableBroadcast&&(o+="&enableScalableBroadcast=true",o+="&maxRelayLimitPerUser="+(e.maxRelayLimitPerUser||2)),o+="&extra="+JSON.stringify(e.extra||{}),e.socketCustomParameters&&(o+=e.socketCustomParameters);try{io.sockets={}}catch(s){}if(e.socketURL||(e.socketURL="/"),"/"!=e.socketURL.substr(e.socketURL.length-1,1))throw'"socketURL" MUST end with a slash.';e.enableLogs&&e.socketURL;try{e.socket=io(e.socketURL+o)}catch(s){e.socket=io.connect(e.socketURL+o,e.socketOptions)}var r=e.multiPeersHandler;function a(t,n){e.peersBackup[t]||(e.peersBackup[t]={userid:t,extra:{}}),e.peersBackup[t].extra=n}e.socket.on("extra-data-updated",(function(t,n){e.peers[t]&&(e.peers[t].extra=n,e.onExtraDataUpdated({userid:t,extra:n}),a(t,n))})),e.socket.on(e.socketMessageEvent,(function t(o){if(o.remoteUserId==e.userid)if(e.peers[o.sender]&&e.peers[o.sender].extra!=o.message.extra&&(e.peers[o.sender].extra=o.extra,e.onExtraDataUpdated({userid:o.sender,extra:o.extra}),a(o.sender,o.extra)),o.message.streamSyncNeeded&&e.peers[o.sender]){var i=e.streamEvents[o.message.streamid];if(!i||!i.stream)return;var s=o.message.action;if("ended"===s||"inactive"===s||"stream-removed"===s)return e.peersBackup[i.userid]&&(i.extra=e.peersBackup[i.userid].extra),void e.onstreamended(i);var c="both"!=o.message.type?o.message.type:null;"function"==typeof i.stream[s]&&i.stream[s](c)}else if("dropPeerConnection"!==o.message){if(o.message.allParticipants)return-1===o.message.allParticipants.indexOf(o.sender)&&o.message.allParticipants.push(o.sender),void o.message.allParticipants.forEach((function(t){r[e.peers[t]?"renegotiatePeer":"createNewPeer"](t,{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:n(e.session)})}));if(o.message.newParticipant){if(o.message.newParticipant==e.userid)return;if(e.peers[o.message.newParticipant])return;r.createNewPeer(o.message.newParticipant,o.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:n(e.session)})}else if(o.message.readyForOffer&&(e.attachStreams.length&&(e.waitingForLocalMedia=!1),e.waitingForLocalMedia))setTimeout((function(){t(o)}),1);else if(o.message.newParticipationRequest&&o.sender!==e.userid){e.peers[o.sender]&&e.deletePeer(o.sender);var d={extra:o.extra||{},localPeerSdpConstraints:o.message.remotePeerSdpConstraints||{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:o.message.localPeerSdpConstraints||{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:void 0!==o.message.isOneWay?o.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:void 0!==o.message.isDataOnly?o.message.isDataOnly:n(e.session),dontGetRemoteStream:void 0!==o.message.isOneWay?o.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,dontAttachLocalStream:!!o.message.dontGetRemoteStream,connectionDescription:o,successCallback:function(){}};e.onNewParticipant(o.sender,d)}else{if(o.message.changedUUID&&e.peers[o.message.oldUUID]&&(e.peers[o.message.newUUID]=e.peers[o.message.oldUUID],delete e.peers[o.message.oldUUID]),o.message.userLeft)return r.onUserLeft(o.sender),void(o.message.autoCloseEntireSession&&e.leave());r.addNegotiatedMessage(o.message,o.sender)}}else e.deletePeer(o.sender)}));var i=!1;e.socket.resetProps=function(){i=!1},e.socket.on("connect",(function(){i||(i=!0,e.enableLogs,setTimeout((function(){e.socket.emit("extra-data-updated",e.extra)}),1e3),t&&t(e.socket))})),e.socket.on("disconnect",(function(t){e.onSocketDisconnect(t)})),e.socket.on("error",(function(t){e.onSocketError(t)})),e.socket.on("user-disconnected",(function(t){t!==e.userid&&(e.onUserStatusChanged({userid:t,status:"offline",extra:e.peers[t]&&e.peers[t].extra||{}}),e.deletePeer(t))})),e.socket.on("user-connected",(function(t){t!==e.userid&&e.onUserStatusChanged({userid:t,status:"online",extra:e.peers[t]&&e.peers[t].extra||{}})})),e.socket.on("closed-entire-session",(function(t,n){e.leave(),e.onEntireSessionClosed({sessionid:t,userid:t,extra:n})})),e.socket.on("userid-already-taken",(function(t,n){e.onUserIdAlreadyTaken(t,n)})),e.socket.on("logs",(function(t){e.enableLogs})),e.socket.on("number-of-broadcast-viewers-updated",(function(t){e.onNumberOfBroadcastViewersUpdated(t)})),e.socket.on("set-isInitiator-true",(function(t){t==e.sessionid&&(e.isInitiator=!0)}))}function r(e){var t=this,n=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];function o(){e.fbr=new FileBufferReader,e.fbr.onProgress=function(t){e.onFileProgress(t)},e.fbr.onBegin=function(t){e.onFileStart(t)},e.fbr.onEnd=function(t){e.onFileEnd(t)}}e.peers={getLength:function(){var e=0;for(var t in this)-1==n.indexOf(t)&&e++;return e},selectFirst:function(){var e;for(var t in this)-1==n.indexOf(t)&&(e=this[t]);return e},getAllParticipants:function(e){var t=[];for(var o in this)-1==n.indexOf(o)&&o!=e&&t.push(o);return t},forEach:function(t){this.getAllParticipants().forEach((function(n){t(e.peers[n])}))},send:function(n,o){var r=this;if(!p(n.size)&&!p(n.type)){if(e.enableFileSharing)return void t.shareFile(n,o);"string"!=typeof n&&(n=JSON.stringify(n))}if("text"===n.type||n instanceof ArrayBuffer||n instanceof DataView){if("text"===n.type&&(n=JSON.stringify(n)),o){var a=e.peers[o];if(a)return a.channels.length?void a.channels.forEach((function(e){e.send(n)})):(e.peers[o].createDataChannel(),e.renegotiate(o),void setTimeout((function(){r.send(n,o)}),3e3))}this.getAllParticipants().forEach((function(t){if(!r[t].channels.length)return e.peers[t].createDataChannel(),e.renegotiate(t),void setTimeout((function(){r[t].channels.forEach((function(e){e.send(n)}))}),3e3);r[t].channels.forEach((function(e){e.send(n)}))}))}else E.send({text:n,channel:this,connection:e,remoteUserId:o})}},this.uuid=e.userid,this.getLocalConfig=function(n,r,a){return a||(a={}),{streamsToShare:a.streamsToShare||{},rtcMultiConnection:e,connectionDescription:a.connectionDescription,userid:r,localPeerSdpConstraints:a.localPeerSdpConstraints,remotePeerSdpConstraints:a.remotePeerSdpConstraints,dontGetRemoteStream:!!a.dontGetRemoteStream,dontAttachLocalStream:!!a.dontAttachLocalStream,renegotiatingPeer:!!a.renegotiatingPeer,peerRef:a.peerRef,channels:a.channels||[],onLocalSdp:function(e){t.onNegotiationNeeded(e,r)},onLocalCandidate:function(n){(n=x.processCandidates(e,n))&&t.onNegotiationNeeded(n,r)},remoteSdp:n,onDataChannelMessage:function(n){if(!e.fbr&&e.enableFileSharing&&o(),"string"!=typeof n&&e.enableFileSharing){var a=this;n instanceof ArrayBuffer||n instanceof DataView?e.fbr.convertToObject(n,(function(e){a.onDataChannelMessage(e)})):n.readyForNextChunk?e.fbr.getNextChunk(n,(function(t,n){e.peers[r].channels.forEach((function(e){e.send(t)}))}),r):n.chunkMissing?e.fbr.chunkMissing(n):e.fbr.addChunk(n,(function(t){e.peers[r].peer.channel.send(t)}))}else t.onDataChannelMessage(n,r)},onDataChannelError:function(e){t.onDataChannelError(e,r)},onDataChannelOpened:function(e){t.onDataChannelOpened(e,r)},onDataChannelClosed:function(e){t.onDataChannelClosed(e,r)},onRemoteStream:function(n){e.peers[r]&&e.peers[r].streams.push(n),t.onGettingRemoteMedia(n,r)},onRemoteStreamRemoved:function(e){t.onRemovingRemoteMedia(e,r)},onPeerStateChanged:function(e){t.onPeerStateChanged(e),"new"===e.iceConnectionState&&t.onNegotiationStarted(r,e),"connected"===e.iceConnectionState&&t.onNegotiationCompleted(r,e),-1!==e.iceConnectionState.search(/closed|failed/gi)&&(t.onUserLeft(r),t.disconnectWith(r))}}},this.createNewPeer=function(t,n){if(!(e.maxParticipantsAllowed<=e.getAllParticipants().length)){if(n=n||{},e.isInitiator&&e.session.audio&&"two-way"===e.session.audio&&!n.streamsToShare&&(n.isOneWay=!1,n.isDataOnly=!1,n.session=e.session),!n.isOneWay&&!n.isDataOnly)return n.isOneWay=!0,void this.onNegotiationNeeded({enableMedia:!0,userPreferences:n},t);n=e.setUserPreferences(n,t);var o=this.getLocalConfig(null,t,n);e.peers[t]=new T(o)}},this.createAnsweringPeer=function(t,n,o){o=e.setUserPreferences(o||{},n);var r=this.getLocalConfig(t,n,o);e.peers[n]=new T(r)},this.renegotiatePeer=function(t,n,o){if(e.peers[t]){n||(n={}),n.renegotiatingPeer=!0,n.peerRef=e.peers[t].peer,n.channels=e.peers[t].channels;var r=this.getLocalConfig(o,t,n);e.peers[t]=new T(r)}else e.enableLogs},this.replaceTrack=function(t,n,o){if(!e.peers[n])throw"This peer ("+n+") does not exist.";var r=e.peers[n].peer;r.getSenders&&"function"==typeof r.getSenders&&r.getSenders().length?r.getSenders().forEach((function(r){o&&"video"===r.track.kind&&(e.peers[n].peer.lastVideoTrack=r.track,r.replaceTrack(t)),o||"audio"!==r.track.kind||(e.peers[n].peer.lastAudioTrack=r.track,r.replaceTrack(t))})):this.renegotiatePeer(n)},this.onNegotiationNeeded=function(e,t){},this.addNegotiatedMessage=function(n,o){if(n.type&&n.sdp)return"answer"==n.type&&e.peers[o]&&e.peers[o].addRemoteSdp(n),"offer"==n.type&&(n.renegotiatingPeer?this.renegotiatePeer(o,null,n):this.createAnsweringPeer(n,o)),void e.enableLogs;if(n.candidate)return e.peers[o]&&e.peers[o].addRemoteCandidate(n),void e.enableLogs;if(n.enableMedia){e.session=n.userPreferences.session||e.session,e.session.oneway&&e.attachStreams.length&&(e.attachStreams=[]),n.userPreferences.isDataOnly&&e.attachStreams.length&&(e.attachStreams.length=[]);var r={};e.attachStreams.forEach((function(e){r[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}})),n.userPreferences.streamsToShare=r,t.onNegotiationNeeded({readyForOffer:!0,userPreferences:n.userPreferences},o)}n.readyForOffer&&e.onReadyForOffer(o,n.userPreferences)},this.onGettingRemoteMedia=function(e,t){},this.onRemovingRemoteMedia=function(e,t){},this.onGettingLocalMedia=function(e){},this.onLocalMediaError=function(t,n){e.onMediaError(t,n)},this.shareFile=function(t,n){o(),e.fbr.readAsArrayBuffer(t,(function(t){var o=e.getAllParticipants();n&&(o=[n]),o.forEach((function(n){e.fbr.getNextChunk(t,(function(t){e.peers[n].channels.forEach((function(e){e.send(t)}))}),n)}))}),{userid:e.userid,chunkSize:"Firefox"===DetectRTC.browser.name?15e3:e.chunkSize||0})};var r=new M(e);this.onDataChannelMessage=function(t,n){r.receive(JSON.parse(t),n,e.peers[n]?e.peers[n].extra:{})},this.onDataChannelClosed=function(t,n){t.userid=n,t.extra=e.peers[n]?e.peers[n].extra:{},e.onclose(t)},this.onDataChannelError=function(t,n){t.userid=n,event.extra=e.peers[n]?e.peers[n].extra:{},e.onerror(t)},this.onDataChannelOpened=function(t,n){e.peers[n].channels.length?e.peers[n].channels=[t]:(e.peers[n].channels.push(t),e.onopen({userid:n,extra:e.peers[n]?e.peers[n].extra:{},channel:t}))},this.onPeerStateChanged=function(t){e.onPeerStateChanged(t)},this.onNegotiationStarted=function(e,t){},this.onNegotiationCompleted=function(e,t){},this.getRemoteStreams=function(t){return t=t||e.peers.getAllParticipants()[0],e.peers[t]?e.peers[t].streams:[]}}function a(e,t,n){if("undefined"!=typeof CustomEvent){var o=new CustomEvent(t,{arguments:n,__exposedProps__:n});e.dispatchEvent(o)}}function i(e,t){t.stream&&t.stream&&t.stream.addEventListener&&(t.stream.addEventListener("mute",(function(n){(n=e.streamEvents[t.streamid]).session={audio:"audio"===n.muteType,video:"video"===n.muteType},e.onmute(n)}),!1),t.stream.addEventListener("unmute",(function(n){(n=e.streamEvents[t.streamid]).session={audio:"audio"===n.unmuteType,video:"video"===n.unmuteType},e.onunmute(n)}),!1))}function s(){if(window.crypto&&window.crypto.getRandomValues&&-1===navigator.userAgent.indexOf("Safari")){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),t="",n=0,o=e.length;n<o;n++)t+=e[n].toString(36);return t}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function c(e,t,n){if(n.autoCreateMediaElement){var o=!1;f(e,"video").length||e.isVideo||e.isScreen||(o=!0),"Firefox"===DetectRTC.browser.name&&(n.session.video||n.session.screen)&&(o=!1);var r=document.createElement(o?"audio":"video");if(r.srcObject=e,r.setAttribute("autoplay",!0),r.setAttribute("playsinline",!0),r.setAttribute("controls",!0),r.setAttribute("muted",!1),r.setAttribute("volume",1),"Firefox"===DetectRTC.browser.name){var a="ended";"oninactive"in r&&(a="inactive"),r.addEventListener(a,(function(){if(currentUserMediaRequest.remove(e.idInstance),"local"===e.type){a="ended","oninactive"in e&&(a="inactive"),L.onSyncNeeded(e.streamid,a),n.attachStreams.forEach((function(t,o){e.streamid===t.streamid&&delete n.attachStreams[o]}));var t=[];n.attachStreams.forEach((function(e){e&&t.push(e)})),n.attachStreams=t;var o=n.streamEvents[e.streamid];if(o)return void n.onstreamended(o);this.parentNode&&this.parentNode.removeChild(this)}}),!1)}var i=r.play();if(void 0!==i){var s=!1;setTimeout((function(){s||(s=!0,t(r))}),1e3),i.then((function(){s||(s=!0,t(r))})).catch((function(e){s||(s=!0,t(r))}))}else t(r)}else t({})}function d(e,t){window.removeEventListener(e,t),window.addEventListener(e,t,!1)}function l(e){var t=[];return e.forEach((function(e){e&&t.push(e)})),t}function u(e){return!e.audio&&!e.video&&!e.screen&&e.data}function p(e){return void 0===e}(n="undefined"!=typeof global?global:null)&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},global.console||(global.console={}),void 0===global.console.debug&&(global.console.debug=global.console.info=global.console.error=global.console.log=global.console.log||function(){}),"undefined"==typeof document&&(n.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},document.addEventListener=document.removeEventListener=n.addEventListener=n.removeEventListener=function(){},n.HTMLVideoElement=n.HTMLMediaElement=function(){}),"undefined"==typeof io&&(n.io=function(){return{on:function(e,t){t=t||function(){},"connect"===e&&t()},emit:function(e,t,n){n=n||function(){},"open-room"!==e&&"join-room"!==e||n(!0,t.sessionid,null)}}}),"undefined"==typeof location&&(n.location={protocol:"file:",href:"",hash:"",origin:"self"}),"undefined"==typeof screen&&(n.screen={width:0,height:0}),"undefined"==typeof URL&&(n.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),n.window=global),function(){var e="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";if(y="object"==typeof process&&"object"==typeof process.versions&&process.versions.node&&!process.browser){var t=process.versions.node.toString().replace("v","");e="Nodejs/"+t+" (NodeOS) AppleWebKit/"+t+" (KHTML, like Gecko) Nodejs/"+t+" Nodejs/"+t}!function(t){"undefined"==typeof window&&("undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:e,getUserMedia:function(){}},t.window=global),"undefined"==typeof location&&(t.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(t.screen={width:0,height:0}))}("undefined"!=typeof global?global:window);var n=window.navigator;void 0!==n?(void 0!==n.webkitGetUserMedia&&(n.getUserMedia=n.webkitGetUserMedia),void 0!==n.mozGetUserMedia&&(n.getUserMedia=n.mozGetUserMedia)):n={getUserMedia:function(){},userAgent:e};var o=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(n.userAgent||""),r=!(-1===n.userAgent.indexOf("Edge")||!n.msSaveOrOpenBlob&&!n.msSaveBlob),a=!!window.opera||n.userAgent.indexOf(" OPR/")>=0,i=void 0!==window.InstallTrigger,s=/^((?!chrome|android).)*safari/i.test(n.userAgent),c=!!window.chrome&&!a,d="undefined"!=typeof document&&!!document.documentMode&&!r;function l(e,t){var n=0,o=!1,r=window.setInterval((function(){e()&&(window.clearInterval(r),t(o)),n++>50&&(window.clearInterval(r),t(o=!0))}),10)}var u={Android:function(){return n.userAgent.match(/Android/i)},BlackBerry:function(){return n.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return n.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return n.userAgent.match(/Opera Mini/i)},Windows:function(){return n.userAgent.match(/IEMobile/i)},any:function(){return u.Android()||u.BlackBerry()||u.iOS()||u.Opera()||u.Windows()},getOsName:function(){var e="Unknown OS";return u.Android()&&(e="Android"),u.BlackBerry()&&(e="BlackBerry"),u.iOS()&&(e="iOS"),u.Opera()&&(e="Opera Mini"),u.Windows()&&(e="Windows"),e}};var p="Unknown OS",m="Unknown OS Version";var h,f,v=function(){for(var e,t=n.appVersion,o=n.userAgent,r="-",a=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],i=0;e=a[i];i++)if(e.r.test(o)){r=e.s;break}var s="-";switch(/Windows/.test(r)&&(/Windows (.*)/.test(r)&&(s=/Windows (.*)/.exec(r)[1]),r="Windows"),r){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(o)&&(s=/Mac OS X (10[\.\_\d]+)/.exec(o)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(o)&&(s=/Android ([\.\_\d]+)/.exec(o)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(o)&&(s=(s=/OS (\d+)_(\d+)_?(\d+)?/.exec(t))[1]+"."+s[2]+"."+(0|s[3]))}return{osName:r,osVersion:s}}();v&&v.osName&&"-"!=v.osName?(p=v.osName,m=v.osVersion):u.any()&&"Android"==(p=u.getOsName())&&(m=!!(f=(h=(h||n.userAgent).toLowerCase()).match(/android\s([0-9\.]*)/))&&f[1]);var y="object"==typeof process&&"object"==typeof process.versions&&process.versions.node;"Unknown OS"===p&&y&&(p="Nodejs",m=process.versions.node.toString().replace("v",""));var g=!1,b=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach((function(e){"undefined"!=typeof document&&"function"==typeof document.createElement&&(!g&&e in document.createElement("canvas")&&(g=!0),!b&&e in document.createElement("video")&&(b=!0))}));var k=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,w=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,C=/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/;var T=[],P=[],x=[],R=[];n.mediaDevices&&n.mediaDevices.enumerateDevices&&(n.enumerateDevices=function(e){var t=n.mediaDevices.enumerateDevices();t&&t.then?n.mediaDevices.enumerateDevices().then(e).catch((function(){e([])})):e([])});var O=!1;(void 0!==S&&"getSources"in S||n.mediaDevices&&n.mediaDevices.enumerateDevices)&&(O=!0);var L=!1,M=!1,E=!1,_=!1,I=!1;var D=window.DetectRTC||{};D.browser=function(){n.appVersion;var e,t,o,l=n.userAgent,u=n.appName,p=""+parseFloat(n.appVersion),m=parseInt(n.appVersion,10);if(s&&!c&&-1!==l.indexOf("CriOS")&&(s=!1,c=!0),a){u="Opera";try{m=(p=n.userAgent.split("OPR/")[1].split(" ")[0]).split(".")[0]}catch(h){p="0.0.0.0",m=0}}else d?((t=l.indexOf("rv:"))>0?p=l.substring(t+3):(t=l.indexOf("MSIE"),p=l.substring(t+5)),u="IE"):c?(t=l.indexOf("Chrome"),u="Chrome",p=l.substring(t+7)):s?(t=l.indexOf("Safari"),u="Safari",p=l.substring(t+7),-1!==(t=l.indexOf("Version"))&&(p=l.substring(t+8)),-1!==n.userAgent.indexOf("Version/")&&(p=n.userAgent.split("Version/")[1].split(" ")[0])):i?(t=l.indexOf("Firefox"),u="Firefox",p=l.substring(t+8)):(e=l.lastIndexOf(" ")+1)<(t=l.lastIndexOf("/"))&&(u=l.substring(e,t),p=l.substring(t+1),u.toLowerCase()===u.toUpperCase()&&(u=n.appName));return r&&(u="Edge",p=n.userAgent.split("Edge/")[1]),-1!==(o=p.search(/[; \)]/))&&(p=p.substring(0,o)),m=parseInt(""+p,10),isNaN(m)&&(p=""+parseFloat(n.appVersion),m=parseInt(n.appVersion,10)),{fullVersion:p,version:m,name:u,isPrivateBrowsing:!1}}(),function(e){var t;try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,(function(){t=!1}),(function(e){t=!0}));else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var n;try{(n=window.indexedDB.open("test")).onerror=function(){return!0}}catch(o){t=!0}void 0===t&&l((function(){return"done"===n.readyState}),(function(e){e||(t=!n.result)}))}else if(function(e){var t=e.toLowerCase();if(0===t.indexOf("msie")&&0===t.indexOf("trident"))return!1;var n=/(?:msie|rv:)\s?([\d\.]+)/.exec(t);return!!(n&&parseInt(n[1],10)>=10)}(window.navigator.userAgent)){t=!1;try{window.indexedDB||(t=!0)}catch(o){t=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(o){t=!0}void 0===t&&(t=!1,window.localStorage.removeItem("test"))}}catch(o){t=!1}l((function(){return void 0!==t}),(function(n){e(t)}))}((function(e){D.browser.isPrivateBrowsing=!!e})),D.browser["is"+D.browser.name]=!0,D.osName=p,D.osVersion=m,"object"==typeof process&&"object"==typeof process.versions&&process.versions["node-webkit"];var A=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach((function(e){A||e in window&&(A=!0)})),D.isWebRTCSupported=A,D.isORTCSupported="undefined"!=typeof RTCIceGatherer;var N=!1;((D.browser.isChrome&&D.browser.version>=35||D.browser.isFirefox&&D.browser.version>=34||D.browser.isEdge&&D.browser.version>=17||"Android"===D.osName&&D.browser.isChrome)&&(N=!0),/^(https:|chrome-extension:)$/g.test(location.protocol||""))||("undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(D.browser.isChrome||D.browser.isEdge||D.browser.isOpera)||D.browser.isFirefox)&&(N=!1);D.isScreenCapturingSupported=N;var B={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach((function(e){B.isSupported||e in window&&(B.isSupported=!0,window[e]&&"createMediaStreamSource"in window[e].prototype&&(B.isCreateMediaStreamSourceSupported=!0))})),D.isAudioContextSupported=B.isSupported,D.isCreateMediaStreamSourceSupported=B.isCreateMediaStreamSourceSupported;var V=!1;D.browser.isChrome&&D.browser.version>31&&(V=!0),D.isRtpDataChannelsSupported=V;var j=!1;(D.browser.isFirefox&&D.browser.version>28||D.browser.isChrome&&D.browser.version>25||D.browser.isOpera&&D.browser.version>=11)&&(j=!0),D.isSctpDataChannelsSupported=j,D.isMobileDevice=o;var U=!1;(n.getUserMedia||n.mediaDevices&&n.mediaDevices.getUserMedia)&&(U=!0),D.browser.isChrome&&D.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(U="Requires HTTPs"),"Nodejs"===D.osName&&(U=!1),D.isGetUserMediaSupported=U;var F,z,G,W="";screen.width&&(W+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:""));D.displayResolution=W,D.displayAspectRatio=(F=screen.width,z=screen.height,G=function e(t,n){return 0==n?t:e(n,t%n)}(F,z),F/G/(z/G)).toFixed(2),D.isCanvasSupportsStreamCapturing=g,D.isVideoSupportsStreamCapturing=b,"Chrome"==D.browser.name&&D.browser.version>=53&&(D.isCanvasSupportsStreamCapturing||(D.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),D.isVideoSupportsStreamCapturing||(D.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),D.DetectLocalIPAddress=function(e,t){if(D.isWebRTCSupported){var n=!0,o=!0;!function(e,t){if("undefined"==typeof document||"function"!=typeof document.getElementById)return;var n={},o=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!o){var r=document.getElementById("iframe");if(!r)return;var a=r.contentWindow;o=a.RTCPeerConnection||a.mozRTCPeerConnection||a.webkitRTCPeerConnection}if(!o)return;var i=null;"Chrome"===D.browser&&D.browser.version<58&&(i={optional:[{RtpDataChannels:!0}]});var s=new o({iceServers:[{urls:"stun:stun.l.google.com:19302"}]},i);t&&(s.addStream?s.addStream(t):s.addTrack&&t.getTracks()[0]&&s.addTrack(t.getTracks()[0],t));function c(t){if(t){var o=w.exec(t);if(o){var r=o[1],a=t.match(k),i=!0;void 0===n[r]&&e(r,a,i),n[r]=!0}}else e()}if(s.onicecandidate=function(e){e.candidate&&e.candidate.candidate?c(e.candidate.candidate):c()},!t)try{s.createDataChannel("sctp",{})}catch(l){}D.isPromisesSupported?s.createOffer().then((function(e){s.setLocalDescription(e).then(d)})):s.createOffer((function(e){s.setLocalDescription(e,d,(function(){}))}),(function(){}));function d(){s.localDescription.sdp.split("\n").forEach((function(e){e&&0===e.indexOf("a=candidate:")&&c(e)}))}}((function(t){t?t.match(k)?e("Local: "+t,n=!1,o):t.match(C)?e("Public: "+t,n,o=!1):e("Public: "+t,n,o):e()}),t)}},D.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,D.isWebSocketsBlocked=!D.isWebSocketsSupported,"Nodejs"===D.osName&&(D.isWebSocketsSupported=!0,D.isWebSocketsBlocked=!1),D.checkWebSocketsSupport=function(e){e=e||function(){};try{var t,n=new WebSocket("wss://echo.websocket.org:443/");n.onopen=function(){D.isWebSocketsBlocked=!1,t=(new Date).getTime(),n.send("ping")},n.onmessage=function(){D.WebsocketLatency=(new Date).getTime()-t+"ms",e(),n.close(),n=null},n.onerror=function(){D.isWebSocketsBlocked=!0,e()}}catch(o){D.isWebSocketsBlocked=!0,e()}},D.load=function(e){!function(e){if(O)if(!n.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(n.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!n.enumerateDevices&&n.enumerateDevices&&(n.enumerateDevices=n.enumerateDevices.bind(n)),n.enumerateDevices){T=[],P=[],x=[],R=[],L=!1,M=!1,E=!1,_=!1,I=!1;var t={};n.enumerateDevices((function(n){n.forEach((function(e){var n={};for(var o in e)try{"function"!=typeof e[o]&&(n[o]=e[o])}catch(r){}t[n.deviceId+n.label+n.kind]||("audio"===n.kind&&(n.kind="audioinput"),"video"===n.kind&&(n.kind="videoinput"),n.deviceId||(n.deviceId=n.id),n.id||(n.id=n.deviceId),n.label?("videoinput"!==n.kind||I||(I=!0),"audioinput"!==n.kind||_||(_=!0)):(n.isCustomLabel=!0,"videoinput"===n.kind?n.label="Camera "+(R.length+1):"audioinput"===n.kind?n.label="Microphone "+(P.length+1):"audiooutput"===n.kind?n.label="Speaker "+(x.length+1):n.label="Please invoke getUserMedia once.",void 0!==D&&D.browser.isChrome&&D.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(n.label="HTTPs is required to get label of this "+n.kind+" device.")),"audioinput"===n.kind&&(L=!0,-1===P.indexOf(n)&&P.push(n)),"audiooutput"===n.kind&&(M=!0,-1===x.indexOf(n)&&x.push(n)),"videoinput"===n.kind&&(E=!0,-1===R.indexOf(n)&&R.push(n)),T.push(n),t[n.deviceId+n.label+n.kind]=n)})),void 0!==D&&(D.MediaDevices=T,D.hasMicrophone=L,D.hasSpeakers=M,D.hasWebcam=E,D.isWebsiteHasWebcamPermissions=I,D.isWebsiteHasMicrophonePermissions=_,D.audioInputDevices=P,D.audioOutputDevices=x,D.videoInputDevices=R),e&&e()}))}else e&&e();else e&&e()}(e=e||function(){})},D.MediaDevices=void 0!==T?T:[],D.hasMicrophone=L,D.hasSpeakers=M,D.hasWebcam=E,D.isWebsiteHasWebcamPermissions=I,D.isWebsiteHasMicrophonePermissions=_,D.audioInputDevices=P,D.audioOutputDevices=x,D.videoInputDevices=R;var q=!1;"undefined"!=typeof document&&"function"==typeof document.createElement&&"setSinkId"in document.createElement("video")&&(q=!0),D.isSetSinkIdSupported=q;var H=!1;D.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(H=!0):D.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(H=!0),D.isRTPSenderReplaceTracksSupported=H;var $=!1;D.browser.isFirefox&&D.browser.version>38&&($=!0),D.isRemoteStreamProcessingSupported=$;var J=!1;void 0!==S&&"applyConstraints"in S.prototype&&(J=!0),D.isApplyConstraintsSupported=J;var K=!1;D.browser.isFirefox&&D.browser.version>=43&&(K=!0),D.isMultiMonitorScreenCapturingSupported=K,D.isPromisesSupported=!!("Promise"in window),D.version="1.3.9",void 0===D&&(window.DetectRTC={});var Y=window.MediaStream;void 0===Y&&"undefined"!=typeof webkitMediaStream&&(Y=webkitMediaStream),D.MediaStream=void 0!==Y&&"function"==typeof Y&&Object.keys(Y.prototype),D.MediaStreamTrack=void 0!==S&&Object.keys(S.prototype);var X=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;D.RTCPeerConnection=void 0!==X&&Object.keys(X.prototype),window.DetectRTC=D,"undefined"!=typeof module&&(module.exports=D),"function"==typeof define&&define.amd&&define("DetectRTC",[],(function(){return D}))}(),"undefined"!=typeof cordova&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Crosswalk")&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),window.addEventListener||(window.addEventListener=function(e,t,n){e.attachEvent&&e.attachEvent("on"+t,n)}),window.attachEventListener=function(e,t,n,o){e.addEventListener(t,n,o)};var m=window.MediaStream;function h(e,t){return(!e.session.audio||"two-way"!==e.session.audio)&&("Firefox"===DetectRTC.browser.name&&!1!==t||!("Chrome"!==DetectRTC.browser.name||DetectRTC.browser.version<50)&&(!0===typeof t||!(void 0!==t||!e.session.audio||!e.session.screen||e.session.video)&&(t=!0,!0)))}function f(e,t){return e&&e.getTracks?e.getTracks().filter((function(e){return e.kind===(t||"audio")})):[]}function v(){var e=!1;try{if("undefined"==typeof RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var t=new g;try{t.addTransceiver("audio"),e=!0}catch(n){}t.close()}catch(n){e=!1}return e&&function(){var e=!1;try{var t=new g({sdpSemantics:"unified-plan"});try{var o=t.getConfiguration();e="unified-plan"==o.sdpSemantics||(o.sdpSemantics,!1)}catch(n){e=!1}}catch(n){e=!1}return e}()}function y(){if("undefined"!=typeof cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc){var e=cordova.plugins.iosrtc;window.webkitRTCPeerConnection=e.RTCPeerConnection,window.RTCSessionDescription=e.RTCSessionDescription,window.RTCIceCandidate=e.RTCIceCandidate,window.MediaStream=e.MediaStream,window.MediaStreamTrack=e.MediaStreamTrack,navigator.getUserMedia=navigator.webkitGetUserMedia=e.getUserMedia,e.debug.enable("iosrtc*"),"function"==typeof e.selectAudioOutput&&e.selectAudioOutput(window.iOSDefaultAudioOutputDevice||"speaker"),e.registerGlobals()}}void 0===m&&"undefined"!=typeof webkitMediaStream&&(m=webkitMediaStream),void 0!==m&&("stop"in m.prototype||(m.prototype.stop=function(){this.getTracks().forEach((function(e){e.stop()}))})),window.iOSDefaultAudioOutputDevice=window.iOSDefaultAudioOutputDevice||"speaker",document.addEventListener("deviceready",y,!1),y();var g,b={};function k(e){return{OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo}}void 0!==window.RTCPeerConnection?g=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?g=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(g=webkitRTCPeerConnection);var w=window.RTCSessionDescription||window.mozRTCSessionDescription,C=window.RTCIceCandidate||window.mozRTCIceCandidate,S=window.MediaStreamTrack;function T(e){if(void 0!==window.RTCPeerConnection?g=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?g=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(g=webkitRTCPeerConnection),w=window.RTCSessionDescription||window.mozRTCSessionDescription,C=window.RTCIceCandidate||window.mozRTCIceCandidate,S=window.MediaStreamTrack,!g)throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser.";var t=e.rtcMultiConnection;this.extra=e.remoteSdp?e.remoteSdp.extra:t.extra,this.userid=e.userid,this.streams=[],this.channels=e.channels||[],this.connectionDescription=e.connectionDescription,this.addStream=function(e){t.addStream(e,n.userid)},this.removeStream=function(e){t.removeStream(e,n.userid)};var n=this;e.remoteSdp&&(this.connectionDescription=e.remoteSdp.connectionDescription);var o,r={};b.sdpConstraints=k({OfferToReceiveAudio:!0,OfferToReceiveVideo:!0});var a=!!e.renegotiatingPeer;e.remoteSdp&&(a=!!e.remoteSdp.renegotiatingPeer);var i=[];if(t.attachStreams.forEach((function(e){e&&i.push(e)})),a)o=e.peerRef;else{var s="all";(t.candidates.turn||t.candidates.relay)&&(t.candidates.stun||t.candidates.reflexive||t.candidates.host||(s="relay"));try{var c={iceServers:t.iceServers,iceTransportPolicy:t.iceTransportPolicy||s};void 0!==t.iceCandidatePoolSize&&(c.iceCandidatePoolSize=t.iceCandidatePoolSize),void 0!==t.bundlePolicy&&(c.bundlePolicy=t.bundlePolicy),void 0!==t.rtcpMuxPolicy&&(c.rtcpMuxPolicy=t.rtcpMuxPolicy),t.sdpSemantics&&(c.sdpSemantics=t.sdpSemantics||"unified-plan"),t.iceServers&&t.iceServers.length||(c=null,t.optionalArgument=null),o=new g(c,t.optionalArgument)}catch(y){try{c={iceServers:t.iceServers};o=new g(c)}catch(T){o=new g}}}!o.getRemoteStreams&&o.getReceivers&&(o.getRemoteStreams=function(){var e=new m;return o.getReceivers().forEach((function(t){e.addTrack(t.track)})),[e]}),!o.getLocalStreams&&o.getSenders&&(o.getLocalStreams=function(){var e=new m;return o.getSenders().forEach((function(t){e.addTrack(t.track)})),[e]}),o.onicecandidate=function(r){if(r.candidate)t.trickleIce&&e.onLocalCandidate({candidate:r.candidate.candidate,sdpMid:r.candidate.sdpMid,sdpMLineIndex:r.candidate.sdpMLineIndex});else if(!t.trickleIce){var a=o.localDescription;e.onLocalSdp({type:a.type,sdp:a.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:n.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:t?t.extra:{},streamsToShare:h})}},i.forEach((function(r){e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream||e.dontAttachLocalStream||(r=t.beforeAddingStream(r,n))&&(o.getLocalStreams().forEach((function(e){r&&e.id==r.id&&(r=null)})),r&&r.getTracks&&r.getTracks().forEach((function(e){try{o.addTrack(e,r)}catch(y){}})))})),o.oniceconnectionstatechange=o.onsignalingstatechange=function(){var r=n.extra;t.peers[n.userid]&&(r=t.peers[n.userid].extra||r),o&&(e.onPeerStateChanged({iceConnectionState:o.iceConnectionState,iceGatheringState:o.iceGatheringState,signalingState:o.signalingState,extra:r,userid:n.userid}),o&&o.iceConnectionState&&-1!==o.iceConnectionState.search(/closed|failed/gi)&&n.streams instanceof Array&&n.streams.forEach((function(e){var n=t.streamEvents[e.id]||{streamid:e.id,stream:e,type:"remote"};t.onstreamended(n)})))};var d={OfferToReceiveAudio:!!i.length,OfferToReceiveVideo:!!i.length};e.localPeerSdpConstraints&&(d=e.localPeerSdpConstraints),b.sdpConstraints=k(d);var l={};o.ontrack=function(t){if(t&&"track"===t.type)if(t.stream=t.streams[t.streams.length-1],t.stream.id||(t.stream.id=t.track.id),l[t.stream.id]&&"Safari"!==DetectRTC.browser.name)t.track&&(t.track.onended=function(){o&&o.onremovestream(t)});else{l[t.stream.id]=t.stream.id;var n={};e.remoteSdp&&e.remoteSdp.streamsToShare?n=e.remoteSdp.streamsToShare:e.streamsToShare&&(n=e.streamsToShare);var a=n[t.stream.id];a?(t.stream.isAudio=a.isAudio,t.stream.isVideo=a.isVideo,t.stream.isScreen=a.isScreen):(t.stream.isVideo=!!f(t.stream,"video").length,t.stream.isAudio=!t.stream.isVideo,t.stream.isScreen=!1),t.stream.streamid=t.stream.id,r[t.stream.id]=t.stream,e.onRemoteStream(t.stream),t.stream.getTracks().forEach((function(e){e.onended=function(){o&&o.onremovestream(t)}})),t.stream.onremovetrack=function(){o&&o.onremovestream(t)}}},o.onremovestream=function(t){t.stream.streamid=t.stream.id,r[t.stream.id]&&delete r[t.stream.id],e.onRemoteStreamRemoved(t.stream)},"function"!=typeof o.removeStream&&(o.removeStream=function(e){e.getTracks().forEach((function(t){o.removeTrack(t,e)}))}),this.addRemoteCandidate=function(e){o.addIceCandidate(new C(e))},this.addRemoteSdp=function(e,n){n=n||function(){},"Safari"!==DetectRTC.browser.name&&(e.sdp=t.processSdp(e.sdp)),o.setRemoteDescription(new w(e)).then(n,(function(e){t.enableLogs,n()})).catch((function(e){t.enableLogs,n()}))};var u=!0;function p(t){t.binaryType="arraybuffer",t.onmessage=function(t){e.onDataChannelMessage(t.data)},t.onopen=function(){e.onDataChannelOpened(t)},t.onerror=function(t){e.onDataChannelError(t)},t.onclose=function(t){e.onDataChannelClosed(t)},t.internalSend=t.send,t.send=function(e){"open"===t.readyState&&t.internalSend(e)},o.channel=t}e.remoteSdp&&(u=!1),this.createDataChannel=function(){p(o.createDataChannel("sctp",{}))},!0!==t.session.data||a||(u?this.createDataChannel():o.ondatachannel=function(e){p(e.channel)}),this.enableDisableVideoEncoding=function(e){var t;if(o.getSenders().forEach((function(e){t||"video"!==e.track.kind||(t=e)})),t&&t.getParameters){var n=t.getParameters();n.encodings[1]&&(n.encodings[1].active=!!e),n.encodings[2]&&(n.encodings[2].active=!!e),t.setParameters(n)}},e.remoteSdp&&(e.remoteSdp.remotePeerSdpConstraints&&(d=e.remoteSdp.remotePeerSdpConstraints),b.sdpConstraints=k(d),this.addRemoteSdp(e.remoteSdp,(function(){v("createAnswer")}))),"two-way"!=t.session.audio&&"two-way"!=t.session.video&&"two-way"!=t.session.screen||(b.sdpConstraints=k({OfferToReceiveAudio:"two-way"==t.session.audio||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio,OfferToReceiveVideo:"two-way"==t.session.video||"two-way"==t.session.screen||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio}));var h={};function v(r){o[r](b.sdpConstraints).then((function(r){"Safari"!==DetectRTC.browser.name&&(r.sdp=t.processSdp(r.sdp)),o.setLocalDescription(r).then((function(){t.trickleIce&&(e.onLocalSdp({type:r.type,sdp:r.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:n.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:t?t.extra:{},streamsToShare:h}),t.onSettingLocalDescription(n))}),(function(e){t.enableLogs}))}),(function(e){t.enableLogs}))}o.getLocalStreams().forEach((function(e){h[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}})),u&&v("createOffer"),o.nativeClose=o.close,o.close=function(){if(o){try{o.nativeClose!==o.close&&o.nativeClose()}catch(y){}o=null,n.peer=null}},this.peer=o}var P=function(){function e(e,o){var r=n(e);return r.videoCodecNumbers?"vp8"===o&&r.vp8LineNumber===r.videoCodecNumbers[0]||"vp9"===o&&r.vp9LineNumber===r.videoCodecNumbers[0]||"h264"===o&&r.h264LineNumber===r.videoCodecNumbers[0]?e:e=t(e,o,r):e}function t(e,t,n,o){var r="";if("vp8"===t){if(!n.vp8LineNumber)return e;r=n.vp8LineNumber}if("vp9"===t){if(!n.vp9LineNumber)return e;r=n.vp9LineNumber}if("h264"===t){if(!n.h264LineNumber)return e;r=n.h264LineNumber}var a=n.videoCodecNumbersOriginal.split("SAVPF")[0]+"SAVPF ",i=[r];return o&&(i=[]),n.videoCodecNumbers.forEach((function(e){e!==r&&i.push(e)})),a+=i.join(" "),e=e.replace(n.videoCodecNumbersOriginal,a)}function n(e){var t={};return e.split("\n").forEach((function(e){0===e.indexOf("m=video")&&(t.videoCodecNumbers=[],e.split("SAVPF")[1].split(" ").forEach((function(n){(n=n.trim())&&n.length&&(t.videoCodecNumbers.push(n),t.videoCodecNumbersOriginal=e)}))),-1===e.indexOf("VP8/90000")||t.vp8LineNumber||(t.vp8LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("VP9/90000")||t.vp9LineNumber||(t.vp9LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("H264/90000")||t.h264LineNumber||(t.h264LineNumber=e.replace("a=rtpmap:","").split(" ")[0])})),t}function o(e,t,n){return function(e,t,n,o,r){for(var a=-1!==n?n:e.length,i=t;i<a;++i)if(0===e[i].indexOf(o)&&(!r||-1!==e[i].toLowerCase().indexOf(r.toLowerCase())))return i;return null}(e,0,-1,t,n)}function r(e){var t=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),n=e.match(t);return n&&2===n.length?n[1]:null}return{removeVPX:function(e){var o=n(e);return e=t(e,"vp9",o,!0),e=t(e,"vp8",o,!0)},disableNACK:function(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return e=(e=(e=(e=e.replace("a=rtcp-fb:126 nack\r\n","")).replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n")).replace("a=rtcp-fb:97 nack\r\n","")).replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n")},prioritize:function(e,t){if(t&&t.getSenders&&t.getSenders().length){if(!e||"string"!=typeof e)throw"Invalid arguments.";t.getSenders().forEach((function(t){for(var n=t.getParameters(),o=0;o<n.codecs.length;o++)if(n.codecs[o].mimeType==e){n.codecs.unshift(n.codecs.splice(o,1));break}t.setParameters(n)}))}},removeNonG722:function(e){return e.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")},setApplicationSpecificBandwidth:function(e,t,n){return function(e,t,n){return t?("undefined"!=typeof isFirefox&&isFirefox||(n&&t.screen&&t.screen,t.screen&&n&&(e=(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")).replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.screen+"\r\n")),(t.audio||t.video)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),t.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+t.audio+"\r\n")),t.screen?e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.screen+"\r\n"):t.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.video+"\r\n"))),e):e}(e,t,n)},setVideoBitrates:function(e,t){return function(e,t){var n,a=(t=t||{}).min,i=t.max,s=e.split("\r\n"),c=o(s,"a=rtpmap","VP8/90000");if(c&&(n=r(s[c])),!n)return e;var d,l=o(s,"a=rtpmap","rtx/90000");if(l&&(d=r(s[l])),!l)return e;var u=o(s,"a=fmtp:"+d.toString());if(null!==u){var p="\r\n";p+="a=fmtp:"+n+" x-google-min-bitrate="+(a||"228")+"; x-google-max-bitrate="+(i||"228"),s[u]=s[u].concat(p),e=s.join("\r\n")}return e}(e,t)},setOpusAttributes:function(e,t){return function(e,t){t=t||{};var n,a=e.split("\r\n"),i=o(a,"a=rtpmap","opus/48000");if(i&&(n=r(a[i])),!n)return e;var s=o(a,"a=fmtp:"+n.toString());if(null===s)return e;var c="";return c+="; stereo="+(void 0!==t.stereo?t.stereo:"1"),c+="; sprop-stereo="+(void 0!==t["sprop-stereo"]?t["sprop-stereo"]:"1"),void 0!==t.maxaveragebitrate&&(c+="; maxaveragebitrate="+(t.maxaveragebitrate||1048576)),void 0!==t.maxplaybackrate&&(c+="; maxplaybackrate="+(t.maxplaybackrate||1048576)),void 0!==t.cbr&&(c+="; cbr="+(void 0!==t.cbr?t.cbr:"1")),void 0!==t.useinbandfec&&(c+="; useinbandfec="+t.useinbandfec),void 0!==t.usedtx&&(c+="; usedtx="+t.usedtx),void 0!==t.maxptime&&(c+="\r\na=maxptime:"+t.maxptime),a[s]=a[s].concat(c),a.join("\r\n")}(e,t)},preferVP9:function(t){return e(t,"vp9")},preferCodec:e,forceStereoAudio:function(e){for(var t=e.split("\r\n"),n=null,o=0;o<t.length;o++)if(-1!==t[o].search("opus/48000")){var r=extractSdp(t[o],/:(\d+) opus\/48000/i);break}for(o=0;o<t.length;o++){if(-1!==t[o].search("a=fmtp"))if(extractSdp(t[o],/a=fmtp:(\d+)/)===r){n=o;break}}return null===n?e:(t[n]=t[n].concat("; stereo=1; sprop-stereo=1"),e=t.join("\r\n"))}}}();window.BandwidthHandler=P;var x={processCandidates:function(e,t){var n=t.candidate,o=e.candidates,r=o.stun,a=o.turn;if(p(o.reflexive)||(r=o.reflexive),p(o.relay)||(a=o.relay),(o.host||!n.match(/typ host/g))&&(a||!n.match(/typ relay/g))&&(r||!n.match(/typ srflx/g))){var i=e.iceProtocols;if((i.udp||!n.match(/ udp /g))&&(i.tcp||!n.match(/ tcp /g)))return e.enableLogs,{candidate:n,sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex}}}},R={getIceServers:function(e){return[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun.l.google.com:19302?transport=udp"]}]}};function O(e){if(!0!==currentUserMediaRequest.mutex){currentUserMediaRequest.mutex=!0;var t=JSON.stringify(e.localMediaConstraints);if(currentUserMediaRequest.streams[t])a(currentUserMediaRequest.streams[t].stream,!0);else{if(!!/BB10|BlackBerry/i.test(navigator.userAgent||"")||void 0===navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia)return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,void navigator.getUserMedia(e.localMediaConstraints,(function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=t,a(e)}),(function(t){e.onLocalMediaError(t,e.localMediaConstraints)}));if(void 0===navigator.mediaDevices){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var n,o,r=function(){};navigator.mediaDevices={getUserMedia:function(e){return navigator.getUserMedia(e,(function(e){e(stream),n=stream}),(function(e){r(e),o=e})),{then:function(e){if(!n)return{then:function(e){o?e(o):r=e}};e(n)}}}}}if(!0===e.localMediaConstraints.isScreen){if(navigator.mediaDevices.getDisplayMedia)navigator.mediaDevices.getDisplayMedia(e.localMediaConstraints).then((function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=t,a(e)})).catch((function(t){e.onLocalMediaError(t,e.localMediaConstraints)}));else{if(!navigator.getDisplayMedia)throw new Error("getDisplayMedia API is not availabe in this browser.");navigator.getDisplayMedia(e.localMediaConstraints).then((function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=t,a(e)})).catch((function(t){e.onLocalMediaError(t,e.localMediaConstraints)}))}return}navigator.mediaDevices.getUserMedia(e.localMediaConstraints).then((function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=t,a(e)})).catch((function(t){e.onLocalMediaError(t,e.localMediaConstraints)}))}}else currentUserMediaRequest.queueRequests.push(e);function a(n,o){!function(e,t){e.mandatory&&e.mandatory.chromeMediaSource||e.mozMediaSource||e.mediaSource?t.isScreen=!0:e.video?t.isVideo=!0:e.audio&&(t.isAudio=!0)}(e.localMediaConstraints,n);var r="ended";"oninactive"in n&&(r="inactive"),n.addEventListener(r,(function(){delete currentUserMediaRequest.streams[t],currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.indexOf(e)&&(delete currentUserMediaRequest.queueRequests[currentUserMediaRequest.queueRequests.indexOf(e)],currentUserMediaRequest.queueRequests=l(currentUserMediaRequest.queueRequests))}),!1),currentUserMediaRequest.streams[t]={stream:n},currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.length&&O(currentUserMediaRequest.queueRequests.shift()),e.onGettingLocalMedia(n,o)}}window.currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[],remove:function(e){this.mutex=!1;var t=this.streams[e];if(t){var n=(t=t.stream).currentUserMediaRequestOptions;this.queueRequests.indexOf(n)&&(delete this.queueRequests[this.queueRequests.indexOf(n)],this.queueRequests=l(this.queueRequests)),this.streams[e].stream=null,delete this.streams[e]}}};var L=function(){function e(e){if(e)return"string"==typeof e||void 0===e?e:e.audio&&e.video?null:e.audio?"audio":e.video?"video":void 0}function t(e,n,o,r){(r=(r||0)+1)>=n||setTimeout((function(){o(),t(e,n,o,r)}),e)}return{setHandlers:function(n,o,r){if(n&&n.addEventListener){if(void 0===o||1==o){var i="ended";"oninactive"in n&&(i="inactive"),n.addEventListener(i,(function(){L.onSyncNeeded(this.streamid,i)}),!1)}n.mute=function(t,i){t=e(t),void 0!==i&&(o=i),void 0!==t&&"audio"!=t||f(n,"audio").forEach((function(e){e.enabled=!1,r.streamEvents[n.streamid].isAudioMuted=!0})),void 0!==t&&"video"!=t||f(n,"video").forEach((function(e){e.enabled=!1})),void 0!==o&&1!=o||L.onSyncNeeded(n.streamid,"mute",t),r.streamEvents[n.streamid].muteType=t||"both",a(n,"mute",t)},n.unmute=function(i,s){i=e(i),void 0!==s&&(o=s),function(){if(!r.streamEvents[n.streamid].mediaElement)return;var e=r.streamEvents[n.streamid].mediaElement;e.volume=0,t(200,5,(function(){try{e.volume+=.2}catch(t){e.volume=1}}))}(),void 0!==i&&"audio"!=i||f(n,"audio").forEach((function(e){e.enabled=!0,r.streamEvents[n.streamid].isAudioMuted=!1})),void 0!==i&&"video"!=i||(f(n,"video").forEach((function(e){e.enabled=!0})),void 0!==i&&"video"==i&&r.streamEvents[n.streamid].isAudioMuted&&function e(t){t||(t=0),++t<100&&r.streamEvents[n.streamid].isAudioMuted&&(n.mute("audio"),setTimeout((function(){e(t)}),50))}()),void 0!==o&&1!=o||L.onSyncNeeded(n.streamid,"unmute",i),r.streamEvents[n.streamid].unmuteType=i||"both",a(n,"unmute",i)}}},onSyncNeeded:function(e,t,n){}}}();function M(e){var t={};return{receive:function(n,o,r){var a=n.uuid;if(t[a]||(t[a]=[]),t[a].push(n.message),n.last){var i=t[a].join("");n.isobject&&(i=JSON.parse(i));var s={data:i,userid:o,extra:r,latency:(new Date).getTime()-n.sendingTime};e.autoTranslateText?(s.original=s.data,e.Translator.TranslateText(s.data,(function(t){s.data=t,e.onmessage(s)}))):e.onmessage(s),delete t[a]}}}}var E={send:function(e){var t=e.connection,n=e.channel,o=e.remoteUserId,r=e.text,a=t.chunkSize||1e3,i="",c=!1;"string"!=typeof r&&(c=!0,r=JSON.stringify(r));var d=s(),l=(new Date).getTime();!function e(r,s){var u={type:"text",uuid:d,sendingTime:l};r&&(s=r,u.packets=parseInt(s.length/a));s.length>a?u.message=s.slice(0,a):(u.message=s,u.last=!0,u.isobject=c);n.send(u,o),(i=s.slice(u.message.length)).length&&setTimeout((function(){e(null,i)}),t.chunkInterval||100)}(r)}},_={handle:function(e){var t={};e.onFileStart=function(n){var o=document.createElement("div");if(o.title=n.name,o.innerHTML="<label>0%</label> <progress></progress>",n.remoteUserId&&(o.innerHTML+=" (Sharing with:"+n.remoteUserId+")"),e.filesContainer||(e.filesContainer=document.body||document.documentElement),e.filesContainer.insertBefore(o,e.filesContainer.firstChild),!n.remoteUserId)return t[n.uuid]={div:o,progress:o.querySelector("progress"),label:o.querySelector("label")},void(t[n.uuid].progress.max=n.maxChunks);t[n.uuid]||(t[n.uuid]={}),t[n.uuid][n.remoteUserId]={div:o,progress:o.querySelector("progress"),label:o.querySelector("label")},t[n.uuid][n.remoteUserId].progress.max=n.maxChunks},e.onFileProgress=function(e){var n=t[e.uuid];n&&(e.remoteUserId&&!(n=t[e.uuid][e.remoteUserId])||(n.progress.value=e.currentPosition||e.maxChunks||n.progress.max,function(e,t){if(-1!==e.position){var n=+e.position.toFixed(2).split(".")[1]||100;t.innerHTML=n+"%"}}(n.progress,n.label)))},e.onFileEnd=function(e){var n=t[e.uuid];if(n&&(!e.remoteUserId||(n=t[e.uuid][e.remoteUserId]))){var o=n.div;-1!=e.type.indexOf("image")?o.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><img src="'+e.url+'" title="'+e.name+'" style="max-width: 80%;">':o.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><iframe src="'+e.url+'" title="'+e.name+'" style="width: 80%;border: 0;height: inherit;margin-top:1em;"></iframe>'}}}},I={handle:function(e){e.autoTranslateText=!1,e.language="en",e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.Translator={TranslateText:function(t,n){var o=document.createElement("script");o.type="text/javascript";var r=encodeURIComponent(t),a="method"+e.token();window[a]=function(e){e.data&&e.data.translations[0]&&n?n(e.data.translations[0].translatedText):e.error&&"Daily Limit Exceeded"===e.error.message||e.error};var i="https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+a+"&q="+r;o.src=i,document.getElementsByTagName("head")[0].appendChild(o)},getListOfLanguages:function(t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE){var e=JSON.parse(n.responseText);if(e&&e.data&&e.data.languages)return void t(e.data.languages);if(e.error&&"Daily Limit Exceeded"===e.error.message)return;if(e.error)return}};var o="https://www.googleapis.com/language/translate/v2/languages?key="+e.googKey+"&target=en";n.open("GET",o,!0),n.send(null)}}}};!function(n){t=t||{useDefaultDevices:!0},n.channel=n.sessionid=(e||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""))+"";var a=new r(n),l={};function p(e){if(n.socketAutoReConnect=!0,n.socket)e&&e(n.socket);else{if(void 0===o)if("undefined"!=typeof FirebaseConnection)window.SocketConnection=FirebaseConnection;else{if("undefined"==typeof PubNubConnection)throw"SocketConnection.js seems missed.";window.SocketConnection=PubNubConnection}new o(n,(function(t){e&&e(n.socket)}))}}function y(e,t){n.socket.emit("join-room",{sessionid:n.sessionid,session:n.session,mediaConstraints:n.mediaConstraints,sdpConstraints:n.sdpConstraints,streams:k(),extra:n.extra,password:void 0!==n.password&&"object"!=typeof n.password?n.password:""},(function(o,r){if(!0===o){if(n.enableLogs,n.peers[n.sessionid])return;a.onNegotiationNeeded(e)}!1===o&&n.enableLogs,t(o,n.sessionid,r)}))}function b(e){n.enableLogs,n.waitingForLocalMedia=!1,n.socket.emit("open-room",{sessionid:n.sessionid,session:n.session,mediaConstraints:n.mediaConstraints,sdpConstraints:n.sdpConstraints,streams:k(),extra:n.extra,identifier:n.publicRoomIdentifier,password:void 0!==n.password&&"object"!=typeof n.password?n.password:""},(function(t,o){!0===t&&(n.enableLogs,e(t,n.sessionid)),!1===t&&(n.enableLogs,e(t,n.sessionid,o))}))}function k(){try{return n.streamEvents.selectAll("local").map((function(e){return{streamid:e.streamid,tracks:e.stream.getTracks().length}}))}catch(e){return[]}}function w(e,t){if(n.dontCaptureUserMedia||e.isDataOnly)t();else{e.localPeerSdpConstraints.OfferToReceiveAudio&&n.mediaConstraints.audio,e.localPeerSdpConstraints.OfferToReceiveVideo&&n.mediaConstraints.video;var o=e.session||n.session;o.oneway&&"two-way"!==o.audio&&"two-way"!==o.video&&"two-way"!==o.screen?t():(o.oneway&&o.audio&&"two-way"===o.audio&&(o={audio:!0}),(o.audio||o.video||o.screen)&&(o.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:h(n)}).then((function(e){e.isScreen=!0,a.onGettingLocalMedia(e),!o.audio&&!o.video||h(n)?t(e):n.invokeGetUserMedia(null,t)}),(function(e){})):n.invokeGetUserMedia({audio:h(n),video:!0,isScreen:!0},!o.audio&&!o.video||h(n)?t:n.invokeGetUserMedia(null,t)):(o.audio||o.video)&&n.invokeGetUserMedia(null,t,o)))}}function C(e,t){e?(t.audio&&f(e,"audio").forEach((function(e){e.applyConstraints(t.audio)})),t.video&&f(e,"video").forEach((function(e){e.applyConstraints(t.video)}))):n.enableLogs}function T(e,t,o){t?a.replaceTrack(e,t,o):n.peers.getAllParticipants().forEach((function(t){a.replaceTrack(e,t,o)}))}a.onGettingLocalMedia=function(e,t){if(t=t||function(){},l[e.streamid])t();else{l[e.streamid]=!0;try{e.type="local"}catch(o){}n.setStreamEndHandler(e),c(e,(function(r){r.id=e.streamid,r.muted=!0,r.volume=0,-1===n.attachStreams.indexOf(e)&&n.attachStreams.push(e),void 0!==L&&L.setHandlers(e,!0,n);var a=0===e.getAudioTracks().filter((function(e){return e.enabled})).length;n.streamEvents[e.streamid]={stream:e,type:"local",mediaElement:r,userid:n.userid,extra:n.extra,streamid:e.streamid,isAudioMuted:a};try{!function(e,t){if(t.stream&&f(t.stream,"audio").length){if(!e||!t)throw"Both arguments are required.";if(e.onspeaking&&e.onsilence){if("undefined"==typeof hark)throw"hark.js not found.";hark(t.stream,{onspeaking:function(){e.onspeaking(t)},onsilence:function(){e.onsilence(t)},onvolumechange:function(n,o){e.onvolumechange&&e.onvolumechange(merge({volume:n,threshold:o},t))}})}}}(n,n.streamEvents[e.streamid]),i(n,n.streamEvents[e.streamid]),n.onstream(n.streamEvents[e.streamid])}catch(o){}t()}),n)}},a.onGettingRemoteMedia=function(e,t){try{e.type="remote"}catch(o){}n.setStreamEndHandler(e,"remote-stream"),c(e,(function(o){o.id=e.streamid,void 0!==L&&L.setHandlers(e,!1,n),n.streamEvents[e.streamid]={stream:e,type:"remote",userid:t,extra:n.peers[t]?n.peers[t].extra:{},mediaElement:o,streamid:e.streamid},i(n,n.streamEvents[e.streamid]),n.onstream(n.streamEvents[e.streamid])}),n)},a.onRemovingRemoteMedia=function(e,t){var o=n.streamEvents[e.streamid];o||(o={stream:e,type:"remote",userid:t,extra:n.peers[t]?n.peers[t].extra:{},streamid:e.streamid,mediaElement:n.streamEvents[e.streamid]?n.streamEvents[e.streamid].mediaElement:null}),n.peersBackup[o.userid]&&(o.extra=n.peersBackup[o.userid].extra),n.onstreamended(o),delete n.streamEvents[e.streamid]},a.onNegotiationNeeded=function(e,t,o){o=o||function(){};var r={remoteUserId:t=t||e.remoteUserId,message:e=e||"",sender:n.userid};e.remoteUserId&&e.message&&e.sender&&(r=e),p((function(){n.socket.emit(n.socketMessageEvent,r,o)}))},a.onUserLeft=function(e){n.deletePeer(e)},a.disconnectWith=function(e,t){n.socket&&n.socket.emit("disconnect-with",e,t||function(){}),n.deletePeer(e)},n.socketOptions={transport:"polling"},n.openOrJoin=function(e,t){t=t||function(){},n.checkPresence(e,(function(e,o){if(e){n.sessionid=o;var r,a,i=!!n.session.oneway,s=u(n.session);a={OfferToReceiveAudio:n.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:n.sdpConstraints.mandatory.OfferToReceiveVideo},r={OfferToReceiveAudio:i?!!n.session.audio:n.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:i?!!n.session.video||!!n.session.screen:n.sdpConstraints.mandatory.OfferToReceiveVideo};var c={remoteUserId:n.sessionid,message:{newParticipationRequest:!0,isOneWay:i,isDataOnly:s,localPeerSdpConstraints:r,remotePeerSdpConstraints:a},sender:n.userid};w(c.message,(function(){y(c,t)}))}else n.waitingForLocalMedia=!0,n.isInitiator=!0,n.sessionid=o||n.sessionid,u(n.session)?b(t):n.captureUserMedia((function(){b(t)}))}))},n.waitingForLocalMedia=!1,n.open=function(e,t){t=t||function(){},n.waitingForLocalMedia=!0,n.isInitiator=!0,n.sessionid=e||n.sessionid,p((function(){u(n.session)?b(t):n.captureUserMedia((function(){b(t)}))}))},n.peersBackup={},n.deletePeer=function(e){if(e&&n.peers[e]){var t={userid:e,extra:n.peers[e]?n.peers[e].extra:{}};if(n.peersBackup[t.userid]&&(t.extra=n.peersBackup[t.userid].extra),n.onleave(t),n.peers[e]){n.peers[e].streams.forEach((function(e){e.stop()}));var o=n.peers[e].peer;if(o&&"closed"!==o.iceConnectionState)try{o.close()}catch(r){}n.peers[e]&&(n.peers[e].peer=null,delete n.peers[e])}}},n.rejoin=function(e){if(!n.isInitiator&&e&&Object.keys(e).length){var t={};n.peers[e.remoteUserId]&&(t=n.peers[e.remoteUserId].extra,n.deletePeer(e.remoteUserId)),e&&e.remoteUserId&&(n.join(e.remoteUserId),n.onReConnecting({userid:e.remoteUserId,extra:t}))}},n.join=function(e,t){n.sessionid=!!e&&(e.sessionid||e.remoteUserId||e)||n.sessionid,n.sessionid+="";var o=!1,r=!1,a=!1,i=!1;if(e&&e.session||!e||"string"==typeof e){var s=e&&e.session||n.session;a=!!s.oneway,i=u(s),r={OfferToReceiveAudio:n.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:n.sdpConstraints.mandatory.OfferToReceiveVideo},o={OfferToReceiveAudio:a?!!n.session.audio:n.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:a?!!n.session.video||!!n.session.screen:n.sdpConstraints.mandatory.OfferToReceiveVideo}}var c=function(){};"function"==typeof(t=t||{})&&(c=t,t={}),void 0!==t.localPeerSdpConstraints&&(o=t.localPeerSdpConstraints),void 0!==t.remotePeerSdpConstraints&&(r=t.remotePeerSdpConstraints),void 0!==t.isOneWay&&(a=t.isOneWay),void 0!==t.isDataOnly&&(i=t.isDataOnly);var d={remoteUserId:n.sessionid,message:{newParticipationRequest:!0,isOneWay:a,isDataOnly:i,localPeerSdpConstraints:o,remotePeerSdpConstraints:r},sender:n.userid};return w(d.message,(function(){p((function(){y(d,c)}))})),d},n.publicRoomIdentifier="",n.getUserMedia=n.captureUserMedia=function(e,t){e=e||function(){};var o=t||n.session;n.dontCaptureUserMedia||u(o)?e():(o.audio||o.video||o.screen)&&(o.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:h(n)}).then((function(r){if(r.isScreen=!0,a.onGettingLocalMedia(r),!o.audio&&!o.video||h(n))e(r);else{var i={};for(var s in o)"screen"!==s&&(i[s]=o[s]);n.invokeGetUserMedia(t,e,i)}}),(function(e){})):n.invokeGetUserMedia({audio:h(n),video:!0,isScreen:!0},(function(r){if(!o.audio&&!o.video||h(n))e(r);else{var a={};for(var i in o)"screen"!==i&&(a[i]=o[i]);n.invokeGetUserMedia(t,e,a)}})):(o.audio||o.video)&&n.invokeGetUserMedia(t,e,o))},n.onbeforeunload=function(e,t){n.closeBeforeUnload&&(n.peers.getAllParticipants().forEach((function(e){a.onNegotiationNeeded({userLeft:!0},e),n.peers[e]&&n.peers[e].peer&&n.peers[e].peer.close(),delete n.peers[e]})),t||n.closeSocket(),n.isInitiator=!1)},window.ignoreBeforeUnload?n.closeBeforeUnload=!1:(n.closeBeforeUnload=!0,window.addEventListener("beforeunload",n.onbeforeunload,!1)),n.userid=s(),n.changeUserId=function(e,t){t=t||function(){},n.userid=e||s(),n.socket.emit("changed-uuid",n.userid,t)},n.extra={},n.attachStreams=[],n.session={audio:!0,video:!0},n.enableFileSharing=!1,n.bandwidth={screen:!1,audio:!1,video:!1},n.codecs={audio:"opus",video:"VP9"},n.processSdp=function(e){return v()||"Safari"===DetectRTC.browser.name?e:("VP8"===n.codecs.video.toUpperCase()&&(e=P.preferCodec(e,"vp8")),"VP9"===n.codecs.video.toUpperCase()&&(e=P.preferCodec(e,"vp9")),"H264"===n.codecs.video.toUpperCase()&&(e=P.preferCodec(e,"h264")),"G722"===n.codecs.audio&&(e=P.removeNonG722(e)),"Firefox"===DetectRTC.browser.name||((n.bandwidth.video||n.bandwidth.screen)&&(e=P.setApplicationSpecificBandwidth(e,n.bandwidth,!!n.session.screen)),n.bandwidth.video&&(e=P.setVideoBitrates(e,{min:8*n.bandwidth.video*1024,max:8*n.bandwidth.video*1024})),n.bandwidth.audio&&(e=P.setOpusAttributes(e,{maxaveragebitrate:8*n.bandwidth.audio*1024,maxplaybackrate:8*n.bandwidth.audio*1024,stereo:1,maxptime:3}))),e)},void 0!==P&&(n.BandwidthHandler=n.CodecsHandler=P),n.mediaConstraints={audio:{mandatory:{},optional:n.bandwidth.audio?[{bandwidth:8*n.bandwidth.audio*1024||1048576}]:[]},video:{mandatory:{},optional:n.bandwidth.video?[{bandwidth:8*n.bandwidth.video*1024||1048576},{facingMode:"user"}]:[{facingMode:"user"}]}},"Firefox"===DetectRTC.browser.name&&(n.mediaConstraints={audio:!0,video:!0}),t.useDefaultDevices||DetectRTC.isMobileDevice||DetectRTC.load((function(){var e,t;if(DetectRTC.MediaDevices.forEach((function(o){"audioinput"===o.kind&&!1!==n.mediaConstraints.audio&&(e=o),"videoinput"===o.kind&&!1!==n.mediaConstraints.video&&(t=o)})),e){if("Firefox"===DetectRTC.browser.name)return void(!0!==n.mediaConstraints.audio?n.mediaConstraints.audio.deviceId=e.id:n.mediaConstraints.audio={deviceId:e.id});1==n.mediaConstraints.audio&&(n.mediaConstraints.audio={mandatory:{},optional:[]}),n.mediaConstraints.audio.optional||(n.mediaConstraints.audio.optional=[]);var o=[{sourceId:e.id}];n.mediaConstraints.audio.optional=o.concat(n.mediaConstraints.audio.optional)}if(t){if("Firefox"===DetectRTC.browser.name)return void(!0!==n.mediaConstraints.video?n.mediaConstraints.video.deviceId=t.id:n.mediaConstraints.video={deviceId:t.id});1==n.mediaConstraints.video&&(n.mediaConstraints.video={mandatory:{},optional:[]}),n.mediaConstraints.video.optional||(n.mediaConstraints.video.optional=[]);o=[{sourceId:t.id}];n.mediaConstraints.video.optional=o.concat(n.mediaConstraints.video.optional)}})),n.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{VoiceActivityDetection:!1}]},n.sdpSemantics=null,n.iceCandidatePoolSize=null,n.bundlePolicy=null,n.rtcpMuxPolicy=null,n.iceTransportPolicy=null,n.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},n.iceServers=R.getIceServers(n),n.candidates={host:!0,stun:!0,turn:!0},n.iceProtocols={tcp:!0,udp:!0},n.onopen=function(e){n.enableLogs},n.onclose=function(e){n.enableLogs},n.onerror=function(e){n.enableLogs},n.onmessage=function(e){n.enableLogs},n.send=function(e,t){n.peers.send(e,t)},n.close=n.disconnect=n.leave=function(){n.onbeforeunload(!1,!0)},n.closeEntireSession=function(e){e=e||function(){},n.socket.emit("close-entire-session",(function t(){n.getAllParticipants().length?setTimeout(t,100):(n.onEntireSessionClosed({sessionid:n.sessionid,userid:n.userid,extra:n.extra}),n.changeUserId(null,(function(){n.close(),e()})))}))},n.onEntireSessionClosed=function(e){n.enableLogs},n.onstream=function(e){var t=n.videosContainer;t.insertBefore(e.mediaElement,t.firstChild);var o=e.mediaElement.play();void 0===o?setTimeout((function(){e.mediaElement.play()}),2e3):o.catch((function(){})).then((function(){setTimeout((function(){e.mediaElement.play()}),2e3)}))},n.onstreamended=function(e){e.mediaElement||(e.mediaElement=document.getElementById(e.streamid)),e.mediaElement&&e.mediaElement.parentNode&&e.mediaElement.parentNode.removeChild(e.mediaElement)},n.direction="many-to-many",n.removeStream=function(e,t){var o;n.attachStreams.forEach((function(t){t.id===e&&(o=t)})),o&&(n.peers.getAllParticipants().forEach((function(e){if(!t||e===t){var r=n.peers[e];try{r.peer.removeStream(o)}catch(a){}}})),n.renegotiate())},n.addStream=function(e,t){if(e.getTracks)return-1===n.attachStreams.indexOf(e)&&(e.streamid||(e.streamid=e.id),n.attachStreams.push(e)),void n.renegotiate(t);function o(o){e.streamCallback&&e.streamCallback(o),n.renegotiate(t)}u(e)?n.renegotiate(t):(e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:h(n)}).then((function(t){t.isScreen=!0,a.onGettingLocalMedia(t),!e.audio&&!e.video||h(n)?o(t):n.invokeGetUserMedia(null,(function(e){o(e)}))}),(function(e){})):n.invokeGetUserMedia({audio:h(n),video:!0,isScreen:!0},(function(t){!e.audio&&!e.video||h(n)?o(t):n.invokeGetUserMedia(null,(function(e){o(e)}))})):(e.audio||e.video)&&n.invokeGetUserMedia(null,o))},n.invokeGetUserMedia=function(e,t,o){o||(o=n.session),e||(e=n.mediaConstraints),O({onGettingLocalMedia:function(n){var o=e.video;o&&(o.mediaSource||o.mozMediaSource||o.mandatory&&o.mandatory.chromeMediaSource)&&(n.isScreen=!0),n.isScreen||(n.isVideo=!!f(n,"video").length,n.isAudio=!n.isVideo&&f(n,"audio").length),a.onGettingLocalMedia(n,(function(){"function"==typeof t&&t(n)}))},onLocalMediaError:function(e,t){a.onLocalMediaError(e,t)},localMediaConstraints:e||{audio:!!o.audio&&e.audio,video:!!o.video&&e.video}})},n.applyConstraints=function(e,t){if(S&&S.prototype.applyConstraints){var o;if(t)return n.streamEvents[t]&&(o=n.streamEvents[t].stream),void C(o,e);n.attachStreams.forEach((function(t){C(t,e)}))}else alert("track.applyConstraints is NOT supported in your browser.")},n.replaceTrack=function(e,t,o){if(e=e||{},g.prototype.getSenders)if(e instanceof S)T(e,t,o);else{if(e instanceof m)return f(e,"video").length&&T(f(e,"video")[0],t,!0),void(f(e,"audio").length&&T(f(e,"audio")[0],t,!1));if(u(e))throw"connection.replaceTrack requires audio and/or video and/or screen.";(e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:h(n)}).then((function(t){t.isScreen=!0,a.onGettingLocalMedia(t),!e.audio&&!e.video||h(n)?r(t):n.invokeGetUserMedia(null,r)}),(function(e){})):n.invokeGetUserMedia({audio:h(n),video:!0,isScreen:!0},!e.audio&&!e.video||h(n)?r:n.invokeGetUserMedia(null,r)):(e.audio||e.video)&&n.invokeGetUserMedia(null,r))}else n.addStream(e);function r(r){n.replaceTrack(r,t,o||e.video||e.screen)}},n.resetTrack=function(e,t){e||(e=n.getAllParticipants()),"string"==typeof e&&(e=[e]),e.forEach((function(e){var o=n.peers[e].peer;void 0!==t&&!0!==t||!o.lastVideoTrack||n.replaceTrack(o.lastVideoTrack,e,!0),void 0!==t&&!1!==t||!o.lastAudioTrack||n.replaceTrack(o.lastAudioTrack,e,!1)}))},n.renegotiate=function(e){e?a.renegotiatePeer(e):n.peers.getAllParticipants().forEach((function(e){a.renegotiatePeer(e)}))},n.setStreamEndHandler=function(e,t){if(e&&e.addEventListener&&(t=!!t,!e.alreadySetEndHandler)){e.alreadySetEndHandler=!0;var o="ended";"oninactive"in e&&(o="inactive"),e.addEventListener(o,(function(){if(e.idInstance&&currentUserMediaRequest.remove(e.idInstance),!t){var o=[];n.attachStreams.forEach((function(t){t.id!=e.id&&o.push(t)})),n.attachStreams=o}var r=n.streamEvents[e.streamid];if(r||(r={stream:e,streamid:e.streamid,type:t?"remote":"local",userid:n.userid,extra:n.extra,mediaElement:n.streamEvents[e.streamid]?n.streamEvents[e.streamid].mediaElement:null}),t&&n.peers[r.userid]){var a=n.peers[r.userid].peer;o=[];a.getRemoteStreams().forEach((function(t){t.id!=e.id&&o.push(t)})),n.peers[r.userid].streams=o}r.userid===n.userid&&"remote"===r.type||(n.peersBackup[r.userid]&&(r.extra=n.peersBackup[r.userid].extra),n.onstreamended(r),delete n.streamEvents[e.streamid])}),!1)}},n.onMediaError=function(e,t){n.enableLogs},n.autoCloseEntireSession=!1,n.filesContainer=n.videosContainer=document.body||document.documentElement,n.isInitiator=!1,n.shareFile=a.shareFile,void 0!==_&&_.handle(n),void 0!==I&&I.handle(n),n.token=s,n.onNewParticipant=function(e,t){n.acceptParticipationRequest(e,t)},n.acceptParticipationRequest=function(e,t){t.successCallback&&(t.successCallback(),delete t.successCallback),a.createNewPeer(e,t)},void 0!==L&&(n.StreamsHandler=L),n.onleave=function(e){},n.invokeSelectFileDialog=function(e){var t=new FileSelector;t.accept="*.*",t.selectSingleFile(e)},n.onmute=function(e){if(e&&e.mediaElement)if("both"===e.muteType||"video"===e.muteType){e.mediaElement.src=null;var t=e.mediaElement.pause();void 0!==t?t.then((function(){e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"})):e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"}else"audio"===e.muteType&&(e.mediaElement.muted=!0)},n.onunmute=function(e){e&&e.mediaElement&&e.stream&&("both"===e.unmuteType||"video"===e.unmuteType?(e.mediaElement.poster=null,e.mediaElement.srcObject=e.stream,e.mediaElement.play()):"audio"===e.unmuteType&&(e.mediaElement.muted=!1))},n.onExtraDataUpdated=function(e){e.status="online",n.onUserStatusChanged(e,!0)},n.getAllParticipants=function(e){return n.peers.getAllParticipants(e)},void 0!==L&&(L.onSyncNeeded=function(e,t,o){n.peers.getAllParticipants().forEach((function(n){a.onNegotiationNeeded({streamid:e,action:t,streamSyncNeeded:!0,type:o||"both"},n)}))}),n.connectSocket=function(e){p(e)},n.closeSocket=function(){try{io.sockets={}}catch(e){}n.socket&&("function"==typeof n.socket.disconnect&&n.socket.disconnect(),"function"==typeof n.socket.resetProps&&n.socket.resetProps(),n.socket=null)},n.getSocket=function(e){return!e&&n.enableLogs,e=e||function(){},n.socket?e(n.socket):p((function(){e(n.socket)})),n.socket},n.getRemoteStreams=a.getRemoteStreams;var x=["selectFirst","selectAll","forEach"];if(n.streamEvents={selectFirst:function(e){return n.streamEvents.selectAll(e)[0]},selectAll:function(e){e||(e={local:!0,remote:!0,isScreen:!0,isAudio:!0,isVideo:!0}),"local"==e&&(e={local:!0}),"remote"==e&&(e={remote:!0}),"screen"==e&&(e={isScreen:!0}),"audio"==e&&(e={isAudio:!0}),"video"==e&&(e={isVideo:!0});var t=[];return Object.keys(n.streamEvents).forEach((function(o){var r=n.streamEvents[o];if(-1===x.indexOf(o)){var a=!0;e.local&&"local"===r.type&&(a=!1),e.remote&&"remote"===r.type&&(a=!1),e.isScreen&&r.stream.isScreen&&(a=!1),e.isVideo&&r.stream.isVideo&&(a=!1),e.isAudio&&r.stream.isAudio&&(a=!1),e.userid&&r.userid===e.userid&&(a=!1),!1===a&&t.push(r)}})),t}},n.socketURL="/",n.socketMessageEvent="RTCMultiConnection-Message",n.socketCustomEvent="RTCMultiConnection-Custom-Message",n.DetectRTC=DetectRTC,n.setCustomSocketEvent=function(e){e&&(n.socketCustomEvent=e),n.socket&&n.socket.emit("set-custom-socket-event-listener",n.socketCustomEvent)},n.getNumberOfBroadcastViewers=function(e,t){n.socket&&e&&t&&n.socket.emit("get-number-of-users-in-specific-broadcast",e,t)},n.onNumberOfBroadcastViewersUpdated=function(e){n.enableLogs&&n.isInitiator},n.onUserStatusChanged=function(e,t){n.enableLogs},n.getUserMediaHandler=O,n.multiPeersHandler=a,n.enableLogs=!0,n.setCustomSocketHandler=function(e){void 0!==o&&(o=e)},n.chunkSize=4e4,n.maxParticipantsAllowed=1e3,n.disconnectWith=a.disconnectWith,n.checkPresence=function(e,t){e=e||n.sessionid,"SSEConnection"!==o.name?n.socket?n.socket.emit("check-presence",e+"",(function(e,o,r){n.enableLogs,t(e,o,r)})):n.connectSocket((function(){n.checkPresence(e,t)})):SSEConnection.checkPresence(e,(function(e,o,r){if(!n.socket)return e||(n.userid=o),void n.connectSocket((function(){t(e,o,r)}));t(e,o)}))},n.onReadyForOffer=function(e,t){n.multiPeersHandler.createNewPeer(e,t)},n.setUserPreferences=function(e){return n.dontAttachStream&&(e.dontAttachLocalStream=!0),n.dontGetRemoteStream&&(e.dontGetRemoteStream=!0),e},n.updateExtraData=function(){n.socket.emit("extra-data-updated",n.extra)},n.enableScalableBroadcast=!1,n.maxRelayLimitPerUser=3,n.dontCaptureUserMedia=!1,n.dontAttachStream=!1,n.dontGetRemoteStream=!1,n.onReConnecting=function(e){n.enableLogs},n.beforeAddingStream=function(e){return e},n.beforeRemovingStream=function(e){return e},"undefined"!=typeof isChromeExtensionAvailable&&(n.checkIfChromeExtensionAvailable=isChromeExtensionAvailable),"undefined"!=typeof isFirefoxExtensionAvailable&&(n.checkIfChromeExtensionAvailable=isFirefoxExtensionAvailable),"undefined"!=typeof getChromeExtensionStatus&&(n.getChromeExtensionStatus=getChromeExtensionStatus),n.modifyScreenConstraints=function(e){return e},n.onPeerStateChanged=function(e){n.enableLogs&&e.iceConnectionState.search(/closed|failed/gi)},n.isOnline=!0,d("online",(function(){n.isOnline=!0})),d("offline",(function(){n.isOnline=!1})),n.isLowBandwidth=!1,navigator&&navigator.connection&&navigator.connection.type&&(n.isLowBandwidth=-1!==navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g),n.isLowBandwidth)){if(n.bandwidth={audio:!1,video:!1,screen:!1},n.mediaConstraints.audio&&n.mediaConstraints.audio.optional&&n.mediaConstraints.audio.optional.length){var M=[];n.mediaConstraints.audio.optional.forEach((function(e){void 0===e.bandwidth&&M.push(e)})),n.mediaConstraints.audio.optional=M}if(n.mediaConstraints.video&&n.mediaConstraints.video.optional&&n.mediaConstraints.video.optional.length){M=[];n.mediaConstraints.video.optional.forEach((function(e){void 0===e.bandwidth&&M.push(e)})),n.mediaConstraints.video.optional=M}}n.getExtraData=function(e,t){if(!e)throw"remoteUserId is required.";if("function"!=typeof t)return n.peers[e]?n.peers[e].extra:n.peersBackup[e]?n.peersBackup[e].extra:{};n.socket.emit("get-remote-user-extra-data",e,(function(e,n,o){t(e,n,o)}))},t.autoOpenOrJoin&&n.openOrJoin(n.sessionid),n.onUserIdAlreadyTaken=function(e,t){n.close(),n.closeSocket(),n.isInitiator=!1,n.userid=n.token(),n.join(n.sessionid),n.enableLogs},n.trickleIce=!0,n.version="3.7.0",n.onSettingLocalDescription=function(e){n.enableLogs},n.resetScreen=function(){sourceId=null,DetectRTC&&DetectRTC.screen&&delete DetectRTC.screen.sourceId,currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[]}},n.autoCreateMediaElement=!0,n.password=null,n.setPassword=function(e,t){t=t||function(){},n.socket?n.socket.emit("set-password",e,t):(n.password=e,t(!0,n.sessionid,null))},n.onSocketDisconnect=function(e){n.enableLogs},n.onSocketError=function(e){n.enableLogs},n.errors={ROOM_NOT_AVAILABLE:"Room not available",INVALID_PASSWORD:"Invalid password",USERID_NOT_AVAILABLE:"User ID does not exist",ROOM_PERMISSION_DENIED:"Room permission denied",ROOM_FULL:"Room full",DID_NOT_JOIN_ANY_ROOM:"Did not join any room yet",INVALID_SOCKET:"Invalid socket",PUBLIC_IDENTIFIER_MISSING:"publicRoomIdentifier is required",INVALID_ADMIN_CREDENTIAL:"Invalid username or password attempted"}}(this)};
/*!
 * Socket.IO v4.4.1
 * (c) 2014-2022 Guillermo Rauch
 * Released under the MIT License.
 */
function Ur(){var e,t;e=this,t=function(){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function o(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},r.apply(this,arguments)}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=i(e);if(t){var r=i(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return c(e)}(this,n)}}function l(e,t,n){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}},l(e,t,n||e)}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function p(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}var m=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,h=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],f=function(e){var t,n,o,r=e,a=e.indexOf("["),i=e.indexOf("]");-1!=a&&-1!=i&&(e=e.substring(0,a)+e.substring(a,i).replace(/:/g,";")+e.substring(i,e.length));for(var s,c,d=m.exec(e||""),l={},u=14;u--;)l[h[u]]=d[u]||"";return-1!=a&&-1!=i&&(l.source=r,l.host=l.host.substring(1,l.host.length-1).replace(/;/g,":"),l.authority=l.authority.replace("[","").replace("]","").replace(/;/g,":"),l.ipv6uri=!0),l.pathNames=(t=l.path,n=/\/{2,9}/g,o=t.replace(n,"/").split("/"),"/"!=t.substr(0,1)&&0!==t.length||o.splice(0,1),"/"==t.substr(t.length-1,1)&&o.splice(o.length-1,1),o),l.queryKey=(s=l.query,c={},s.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(c[t]=n)})),c),l},v={exports:{}};try{v.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(De){v.exports=!1}var y=v.exports,g="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function b(e){var t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||y))return new XMLHttpRequest}catch(n){}if(!t)try{return new(g[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(n){}}function k(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return n.reduce((function(t,n){return e.hasOwnProperty(n)&&(t[n]=e[n]),t}),{})}var w=setTimeout,C=clearTimeout;function S(e,t){t.useNativeTimers?(e.setTimeoutFn=w.bind(g),e.clearTimeoutFn=C.bind(g)):(e.setTimeoutFn=setTimeout.bind(g),e.clearTimeoutFn=clearTimeout.bind(g))}var T=P;function P(e){if(e)return function(e){for(var t in P.prototype)e[t]=P.prototype[t];return e}(e)}P.prototype.on=P.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},P.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},P.prototype.off=P.prototype.removeListener=P.prototype.removeAllListeners=P.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,o=this._callbacks["$"+e];if(!o)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r=0;r<o.length;r++)if((n=o[r])===t||n.fn===t){o.splice(r,1);break}return 0===o.length&&delete this._callbacks["$"+e],this},P.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],o=1;o<arguments.length;o++)t[o-1]=arguments[o];if(n){o=0;for(var r=(n=n.slice(0)).length;o<r;++o)n[o].apply(this,t)}return this},P.prototype.emitReserved=P.prototype.emit,P.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},P.prototype.hasListeners=function(e){return!!this.listeners(e).length};var x=Object.create(null);x.open="0",x.close="1",x.ping="2",x.pong="3",x.message="4",x.upgrade="5",x.noop="6";var R=Object.create(null);Object.keys(x).forEach((function(e){R[x[e]]=e}));for(var O={type:"error",data:"parser error"},L="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),M="function"==typeof ArrayBuffer,E=function(e,t,n){var o,r=e.type,a=e.data;return L&&a instanceof Blob?t?n(a):_(a,n):M&&(a instanceof ArrayBuffer||(o=a,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(o):o&&o.buffer instanceof ArrayBuffer))?t?n(a):_(new Blob([a]),n):n(x[r]+(a||""))},_=function(e,t){var n=new FileReader;return n.onload=function(){var e=n.result.split(",")[1];t("b"+e)},n.readAsDataURL(e)},I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",D="undefined"==typeof Uint8Array?[]:new Uint8Array(256),A=0;A<64;A++)D[I.charCodeAt(A)]=A;var N,B="function"==typeof ArrayBuffer,V=function(e,t){if("string"!=typeof e)return{type:"message",data:U(e,t)};var n=e.charAt(0);return"b"===n?{type:"message",data:j(e.substring(1),t)}:R[n]?e.length>1?{type:R[n],data:e.substring(1)}:{type:R[n]}:O},j=function(e,t){if(B){var n=function(e){var t,n,o,r,a,i=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var d=new ArrayBuffer(i),l=new Uint8Array(d);for(t=0;t<s;t+=4)n=D[e.charCodeAt(t)],o=D[e.charCodeAt(t+1)],r=D[e.charCodeAt(t+2)],a=D[e.charCodeAt(t+3)],l[c++]=n<<2|o>>4,l[c++]=(15&o)<<4|r>>2,l[c++]=(3&r)<<6|63&a;return d}(e);return U(n,t)}return{base64:!0,data:e}},U=function(e,t){return"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e},F=String.fromCharCode(30),z=function(e){a(r,e);var n=d(r);function r(e){var o;return t(this,r),(o=n.call(this)).writable=!1,S(c(o),e),o.opts=e,o.query=e.query,o.readyState="",o.socket=e.socket,o}return o(r,[{key:"onError",value:function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,l(i(r.prototype),"emit",this).call(this,"error",n),this}},{key:"open",value:function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}},{key:"close",value:function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}},{key:"send",value:function(e){"open"===this.readyState&&this.write(e)}},{key:"onOpen",value:function(){this.readyState="open",this.writable=!0,l(i(r.prototype),"emit",this).call(this,"open")}},{key:"onData",value:function(e){var t=V(e,this.socket.binaryType);this.onPacket(t)}},{key:"onPacket",value:function(e){l(i(r.prototype),"emit",this).call(this,"packet",e)}},{key:"onClose",value:function(){this.readyState="closed",l(i(r.prototype),"emit",this).call(this,"close")}}]),r}(T),G="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),W=64,q={},H=0,$=0;function J(e){var t="";do{t=G[e%W]+t,e=Math.floor(e/W)}while(e>0);return t}function K(){var e=J(+new Date);return e!==N?(H=0,N=e):e+"."+J(H++)}for(;$<W;$++)q[G[$]]=$;K.encode=J,K.decode=function(e){var t=0;for($=0;$<e.length;$++)t=t*W+q[e.charAt($)];return t};var Y=K,X={encode:function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},decode:function(e){for(var t={},n=e.split("&"),o=0,r=n.length;o<r;o++){var a=n[o].split("=");t[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return t}},Q=function(e){a(r,e);var n=d(r);function r(){var e;return t(this,r),(e=n.apply(this,arguments)).polling=!1,e}return o(r,[{key:"name",get:function(){return"polling"}},{key:"doOpen",value:function(){this.poll()}},{key:"pause",value:function(e){var t=this;this.readyState="pausing";var n=function(){t.readyState="paused",e()};if(this.polling||!this.writable){var o=0;this.polling&&(o++,this.once("pollComplete",(function(){--o||n()}))),this.writable||(o++,this.once("drain",(function(){--o||n()})))}else n()}},{key:"poll",value:function(){this.polling=!0,this.doPoll(),this.emit("poll")}},{key:"onData",value:function(e){var t=this;(function(e,t){for(var n=e.split(F),o=[],r=0;r<n.length;r++){var a=V(n[r],t);if(o.push(a),"error"===a.type)break}return o})(e,this.socket.binaryType).forEach((function(e){if("opening"===t.readyState&&"open"===e.type&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState&&this.poll())}},{key:"doClose",value:function(){var e=this,t=function(){e.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}},{key:"write",value:function(e){var t=this;this.writable=!1,function(e,t){var n=e.length,o=new Array(n),r=0;e.forEach((function(e,a){E(e,!1,(function(e){o[a]=e,++r===n&&t(o.join(F))}))}))}(e,(function(e){t.doWrite(e,(function(){t.writable=!0,t.emit("drain")}))}))}},{key:"uri",value:function(){var e=this.query||{},t=this.opts.secure?"https":"http",n="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=Y()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port);var o=X.encode(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(o.length?"?"+o:"")}}]),r}(z);function Z(){}var ee=null!=new b({xdomain:!1}).responseType,te=function(e){a(i,e);var n=d(i);function i(e){var o;if(t(this,i),o=n.call(this,e),"undefined"!=typeof location){var r="https:"===location.protocol,a=location.port;a||(a=r?"443":"80"),o.xd="undefined"!=typeof location&&e.hostname!==location.hostname||a!==e.port,o.xs=e.secure!==r}var s=e&&e.forceBase64;return o.supportsBinary=ee&&!s,o}return o(i,[{key:"request",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(e,{xd:this.xd,xs:this.xs},this.opts),new ne(this.uri(),e)}},{key:"doWrite",value:function(e,t){var n=this,o=this.request({method:"POST",data:e});o.on("success",t),o.on("error",(function(e){n.onError("xhr post error",e)}))}},{key:"doPoll",value:function(){var e=this,t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(function(t){e.onError("xhr poll error",t)})),this.pollXhr=t}}]),i}(Q),ne=function(e){a(r,e);var n=d(r);function r(e,o){var a;return t(this,r),S(c(a=n.call(this)),o),a.opts=o,a.method=o.method||"GET",a.uri=e,a.async=!1!==o.async,a.data=void 0!==o.data?o.data:null,a.create(),a}return o(r,[{key:"create",value:function(){var e=this,t=k(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;var n=this.xhr=new b(t);try{n.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders)for(var o in n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(o)&&n.setRequestHeader(o,this.opts.extraHeaders[o])}catch(a){}if("POST"===this.method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(a){}try{n.setRequestHeader("Accept","*/*")}catch(a){}"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=function(){4===n.readyState&&(200===n.status||1223===n.status?e.onLoad():e.setTimeoutFn((function(){e.onError("number"==typeof n.status?n.status:0)}),0))},n.send(this.data)}catch(a){return void this.setTimeoutFn((function(){e.onError(a)}),0)}"undefined"!=typeof document&&(this.index=r.requestsCount++,r.requests[this.index]=this)}},{key:"onSuccess",value:function(){this.emit("success"),this.cleanup()}},{key:"onData",value:function(e){this.emit("data",e),this.onSuccess()}},{key:"onError",value:function(e){this.emit("error",e),this.cleanup(!0)}},{key:"cleanup",value:function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=Z,e)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete r.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function(){var e=this.xhr.responseText;null!==e&&this.onData(e)}},{key:"abort",value:function(){this.cleanup()}}]),r}(T);function oe(){for(var e in ne.requests)ne.requests.hasOwnProperty(e)&&ne.requests[e].abort()}ne.requestsCount=0,ne.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",oe):"function"==typeof addEventListener&&addEventListener("onpagehide"in g?"pagehide":"unload",oe,!1));var re="function"==typeof Promise&&"function"==typeof Promise.resolve?function(e){return Promise.resolve().then(e)}:function(e,t){return t(e,0)},ae=g.WebSocket||g.MozWebSocket,ie="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),se={websocket:function(e){a(r,e);var n=d(r);function r(e){var o;return t(this,r),(o=n.call(this,e)).supportsBinary=!e.forceBase64,o}return o(r,[{key:"name",get:function(){return"websocket"}},{key:"doOpen",value:function(){if(this.check()){var e=this.uri(),t=this.opts.protocols,n=ie?{}:k(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=ie?new ae(e,t,n):t?new ae(e,t):new ae(e)}catch(De){return this.emit("error",De)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}}},{key:"addEventListeners",value:function(){var e=this;this.ws.onopen=function(){e.opts.autoUnref&&e.ws._socket.unref(),e.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=function(t){return e.onData(t.data)},this.ws.onerror=function(t){return e.onError("websocket error",t)}}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var n=function(n){var o=e[n],r=n===e.length-1;E(o,t.supportsBinary,(function(e){try{t.ws.send(e)}catch(n){}r&&re((function(){t.writable=!0,t.emit("drain")}),t.setTimeoutFn)}))},o=0;o<e.length;o++)n(o)}},{key:"doClose",value:function(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function(){var e=this.query||{},t=this.opts.secure?"wss":"ws",n="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=Y()),this.supportsBinary||(e.b64=1);var o=X.encode(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(o.length?"?"+o:"")}},{key:"check",value:function(){return!(!ae||"__initialize"in ae&&this.name===r.prototype.name)}}]),r}(z),polling:te},ce=function(n){a(s,n);var i=d(s);function s(n){var o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t(this,s),o=i.call(this),n&&"object"===e(n)&&(a=n,n=null),n?(n=f(n),a.hostname=n.host,a.secure="https"===n.protocol||"wss"===n.protocol,a.port=n.port,n.query&&(a.query=n.query)):a.host&&(a.hostname=f(a.host).host),S(c(o),a),o.secure=null!=a.secure?a.secure:"undefined"!=typeof location&&"https:"===location.protocol,a.hostname&&!a.port&&(a.port=o.secure?"443":"80"),o.hostname=a.hostname||("undefined"!=typeof location?location.hostname:"localhost"),o.port=a.port||("undefined"!=typeof location&&location.port?location.port:o.secure?"443":"80"),o.transports=a.transports||["polling","websocket"],o.readyState="",o.writeBuffer=[],o.prevBufferLen=0,o.opts=r({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},a),o.opts.path=o.opts.path.replace(/\/$/,"")+"/","string"==typeof o.opts.query&&(o.opts.query=X.decode(o.opts.query)),o.id=null,o.upgrades=null,o.pingInterval=null,o.pingTimeout=null,o.pingTimeoutTimer=null,"function"==typeof addEventListener&&(o.opts.closeOnBeforeunload&&addEventListener("beforeunload",(function(){o.transport&&(o.transport.removeAllListeners(),o.transport.close())}),!1),"localhost"!==o.hostname&&(o.offlineEventListener=function(){o.onClose("transport close")},addEventListener("offline",o.offlineEventListener,!1))),o.open(),o}return o(s,[{key:"createTransport",value:function(e){var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);var n=r({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new se[e](n)}},{key:"open",value:function(){var e,t=this;if(this.opts.rememberUpgrade&&s.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((function(){t.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(n){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}},{key:"setTransport",value:function(e){var t=this;this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(function(){t.onClose("transport close")}))}},{key:"probe",value:function(e){var t=this,n=this.createTransport(e),o=!1;s.priorWebsocketSuccess=!1;var r=function(){o||(n.send([{type:"ping",data:"probe"}]),n.once("packet",(function(e){if(!o)if("pong"===e.type&&"probe"===e.data){if(t.upgrading=!0,t.emitReserved("upgrading",n),!n)return;s.priorWebsocketSuccess="websocket"===n.name,t.transport.pause((function(){o||"closed"!==t.readyState&&(u(),t.setTransport(n),n.send([{type:"upgrade"}]),t.emitReserved("upgrade",n),n=null,t.upgrading=!1,t.flush())}))}else{var r=new Error("probe error");r.transport=n.name,t.emitReserved("upgradeError",r)}})))};function a(){o||(o=!0,u(),n.close(),n=null)}var i=function(e){var o=new Error("probe error: "+e);o.transport=n.name,a(),t.emitReserved("upgradeError",o)};function c(){i("transport closed")}function d(){i("socket closed")}function l(e){n&&e.name!==n.name&&a()}var u=function(){n.removeListener("open",r),n.removeListener("error",i),n.removeListener("close",c),t.off("close",d),t.off("upgrading",l)};n.once("open",r),n.once("error",i),n.once("close",c),this.once("close",d),this.once("upgrading",l),n.open()}},{key:"onOpen",value:function(){if(this.readyState="open",s.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause)for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},{key:"onPacket",value:function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}},{key:"onHandshake",value:function(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function(){var e=this;this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((function(){e.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}},{key:"onDrain",value:function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}},{key:"flush",value:function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emitReserved("flush"))}},{key:"write",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"send",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"sendPacket",value:function(e,t,n,o){if("function"==typeof t&&(o=t,t=void 0),"function"==typeof n&&(o=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var r={type:e,data:t,options:n};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),o&&this.once("flush",o),this.flush()}}},{key:"close",value:function(){var e=this,t=function(){e.onClose("forced close"),e.transport.close()},n=function n(){e.off("upgrade",n),e.off("upgradeError",n),t()},o=function(){e.once("upgrade",n),e.once("upgradeError",n)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(function(){e.upgrading?o():t()})):this.upgrading?o():t()),this}},{key:"onError",value:function(e){s.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}},{key:"onClose",value:function(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}},{key:"filterUpgrades",value:function(e){for(var t=[],n=0,o=e.length;n<o;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}]),s}(T);ce.protocol=4;var de,le,ue="function"==typeof ArrayBuffer,pe=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer},me=Object.prototype.toString,he="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===me.call(Blob),fe="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===me.call(File);function ve(e){return ue&&(e instanceof ArrayBuffer||pe(e))||he&&e instanceof Blob||fe&&e instanceof File}function ye(t,n){if(!t||"object"!==e(t))return!1;if(Array.isArray(t)){for(var o=0,r=t.length;o<r;o++)if(ye(t[o]))return!0;return!1}if(ve(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return ye(t.toJSON(),!0);for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)&&ye(t[a]))return!0;return!1}function ge(e){var t=[],n=e.data,o=e;return o.data=be(n,t),o.attachments=t.length,{packet:o,buffers:t}}function be(t,n){if(!t)return t;if(ve(t)){var o={_placeholder:!0,num:n.length};return n.push(t),o}if(Array.isArray(t)){for(var r=new Array(t.length),a=0;a<t.length;a++)r[a]=be(t[a],n);return r}if("object"===e(t)&&!(t instanceof Date)){var i={};for(var s in t)t.hasOwnProperty(s)&&(i[s]=be(t[s],n));return i}return t}function ke(e,t){return e.data=we(e.data,t),e.attachments=void 0,e}function we(t,n){if(!t)return t;if(t&&t._placeholder)return n[t.num];if(Array.isArray(t))for(var o=0;o<t.length;o++)t[o]=we(t[o],n);else if("object"===e(t))for(var r in t)t.hasOwnProperty(r)&&(t[r]=we(t[r],n));return t}(le=de||(de={}))[le.CONNECT=0]="CONNECT",le[le.DISCONNECT=1]="DISCONNECT",le[le.EVENT=2]="EVENT",le[le.ACK=3]="ACK",le[le.CONNECT_ERROR=4]="CONNECT_ERROR",le[le.BINARY_EVENT=5]="BINARY_EVENT",le[le.BINARY_ACK=6]="BINARY_ACK";var Ce=function(){function e(){t(this,e)}return o(e,[{key:"encode",value:function(e){return e.type!==de.EVENT&&e.type!==de.ACK||!ye(e)?[this.encodeAsString(e)]:(e.type=e.type===de.EVENT?de.BINARY_EVENT:de.BINARY_ACK,this.encodeAsBinary(e))}},{key:"encodeAsString",value:function(e){var t=""+e.type;return e.type!==de.BINARY_EVENT&&e.type!==de.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data)),t}},{key:"encodeAsBinary",value:function(e){var t=ge(e),n=this.encodeAsString(t.packet),o=t.buffers;return o.unshift(n),o}}]),e}(),Se=function(n){a(s,n);var r=d(s);function s(){return t(this,s),r.call(this)}return o(s,[{key:"add",value:function(e){var t;if("string"==typeof e)(t=this.decodeString(e)).type===de.BINARY_EVENT||t.type===de.BINARY_ACK?(this.reconstructor=new Te(t),0===t.attachments&&l(i(s.prototype),"emitReserved",this).call(this,"decoded",t)):l(i(s.prototype),"emitReserved",this).call(this,"decoded",t);else{if(!ve(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,l(i(s.prototype),"emitReserved",this).call(this,"decoded",t))}}},{key:"decodeString",value:function(e){var t=0,n={type:Number(e.charAt(0))};if(void 0===de[n.type])throw new Error("unknown packet type "+n.type);if(n.type===de.BINARY_EVENT||n.type===de.BINARY_ACK){for(var o=t+1;"-"!==e.charAt(++t)&&t!=e.length;);var r=e.substring(o,t);if(r!=Number(r)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(r)}if("/"===e.charAt(t+1)){for(var a=t+1;++t&&","!==e.charAt(t)&&t!==e.length;);n.nsp=e.substring(a,t)}else n.nsp="/";var i=e.charAt(t+1);if(""!==i&&Number(i)==i){for(var c=t+1;++t;){var d=e.charAt(t);if(null==d||Number(d)!=d){--t;break}if(t===e.length)break}n.id=Number(e.substring(c,t+1))}if(e.charAt(++t)){var l=function(e){try{return JSON.parse(e)}catch(t){return!1}}(e.substr(t));if(!s.isPayloadValid(n.type,l))throw new Error("invalid payload");n.data=l}return n}},{key:"destroy",value:function(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}],[{key:"isPayloadValid",value:function(t,n){switch(t){case de.CONNECT:return"object"===e(n);case de.DISCONNECT:return void 0===n;case de.CONNECT_ERROR:return"string"==typeof n||"object"===e(n);case de.EVENT:case de.BINARY_EVENT:return Array.isArray(n)&&n.length>0;case de.ACK:case de.BINARY_ACK:return Array.isArray(n)}}}]),s}(T),Te=function(){function e(n){t(this,e),this.packet=n,this.buffers=[],this.reconPack=n}return o(e,[{key:"takeBinaryData",value:function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=ke(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}},{key:"finishedReconstruction",value:function(){this.reconPack=null,this.buffers=[]}}]),e}(),Pe=Object.freeze({__proto__:null,protocol:5,get PacketType(){return de},Encoder:Ce,Decoder:Se});function xe(e,t,n){return e.on(t,n),function(){e.off(t,n)}}var Re=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Oe=function(e){a(r,e);var n=d(r);function r(e,o,a){var i;return t(this,r),(i=n.call(this)).connected=!1,i.disconnected=!0,i.receiveBuffer=[],i.sendBuffer=[],i.ids=0,i.acks={},i.flags={},i.io=e,i.nsp=o,a&&a.auth&&(i.auth=a.auth),i.io._autoConnect&&i.open(),i}return o(r,[{key:"subEvents",value:function(){if(!this.subs){var e=this.io;this.subs=[xe(e,"open",this.onopen.bind(this)),xe(e,"packet",this.onpacket.bind(this)),xe(e,"error",this.onerror.bind(this)),xe(e,"close",this.onclose.bind(this))]}}},{key:"active",get:function(){return!!this.subs}},{key:"connect",value:function(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}},{key:"open",value:function(){return this.connect()}},{key:"send",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift("message"),this.emit.apply(this,t),this}},{key:"emit",value:function(e){if(Re.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];n.unshift(e);var r={type:de.EVENT,data:n,options:{}};if(r.options.compress=!1!==this.flags.compress,"function"==typeof n[n.length-1]){var a=this.ids++,i=n.pop();this._registerAckCallback(a,i),r.id=a}var s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!s||!this.connected)||(this.connected?this.packet(r):this.sendBuffer.push(r)),this.flags={},this}},{key:"_registerAckCallback",value:function(e,t){var n=this,o=this.flags.timeout;if(void 0!==o){var r=this.io.setTimeoutFn((function(){delete n.acks[e];for(var o=0;o<n.sendBuffer.length;o++)n.sendBuffer[o].id===e&&n.sendBuffer.splice(o,1);t.call(n,new Error("operation has timed out"))}),o);this.acks[e]=function(){n.io.clearTimeoutFn(r);for(var e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];t.apply(n,[null].concat(o))}}else this.acks[e]=t}},{key:"packet",value:function(e){e.nsp=this.nsp,this.io._packet(e)}},{key:"onopen",value:function(){var e=this;"function"==typeof this.auth?this.auth((function(t){e.packet({type:de.CONNECT,data:t})})):this.packet({type:de.CONNECT,data:this.auth})}},{key:"onerror",value:function(e){this.connected||this.emitReserved("connect_error",e)}},{key:"onclose",value:function(e){this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",e)}},{key:"onpacket",value:function(e){if(e.nsp===this.nsp)switch(e.type){case de.CONNECT:if(e.data&&e.data.sid){var t=e.data.sid;this.onconnect(t)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case de.EVENT:case de.BINARY_EVENT:this.onevent(e);break;case de.ACK:case de.BINARY_ACK:this.onack(e);break;case de.DISCONNECT:this.ondisconnect();break;case de.CONNECT_ERROR:this.destroy();var n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n)}}},{key:"onevent",value:function(e){var t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}},{key:"emitEvent",value:function(e){if(this._anyListeners&&this._anyListeners.length){var t,n=p(this._anyListeners.slice());try{for(n.s();!(t=n.n()).done;)t.value.apply(this,e)}catch(De){n.e(De)}finally{n.f()}}l(i(r.prototype),"emit",this).apply(this,e)}},{key:"ack",value:function(e){var t=this,n=!1;return function(){if(!n){n=!0;for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];t.packet({type:de.ACK,id:e,data:r})}}}},{key:"onack",value:function(e){var t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}},{key:"onconnect",value:function(e){this.id=e,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}},{key:"emitBuffered",value:function(){var e=this;this.receiveBuffer.forEach((function(t){return e.emitEvent(t)})),this.receiveBuffer=[],this.sendBuffer.forEach((function(t){return e.packet(t)})),this.sendBuffer=[]}},{key:"ondisconnect",value:function(){this.destroy(),this.onclose("io server disconnect")}},{key:"destroy",value:function(){this.subs&&(this.subs.forEach((function(e){return e()})),this.subs=void 0),this.io._destroy(this)}},{key:"disconnect",value:function(){return this.connected&&this.packet({type:de.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{key:"close",value:function(){return this.disconnect()}},{key:"compress",value:function(e){return this.flags.compress=e,this}},{key:"volatile",get:function(){return this.flags.volatile=!0,this}},{key:"timeout",value:function(e){return this.flags.timeout=e,this}},{key:"onAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}},{key:"prependAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}},{key:"offAny",value:function(e){if(!this._anyListeners)return this;if(e){for(var t=this._anyListeners,n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}},{key:"listenersAny",value:function(){return this._anyListeners||[]}}]),r}(T),Le=Me;function Me(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Me.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+n:e-n}return 0|Math.min(e,this.max)},Me.prototype.reset=function(){this.attempts=0},Me.prototype.setMin=function(e){this.ms=e},Me.prototype.setMax=function(e){this.max=e},Me.prototype.setJitter=function(e){this.jitter=e};var Ee=function(n){a(i,n);var r=d(i);function i(n,o){var a,s;t(this,i),(a=r.call(this)).nsps={},a.subs=[],n&&"object"===e(n)&&(o=n,n=void 0),(o=o||{}).path=o.path||"/socket.io",a.opts=o,S(c(a),o),a.reconnection(!1!==o.reconnection),a.reconnectionAttempts(o.reconnectionAttempts||1/0),a.reconnectionDelay(o.reconnectionDelay||1e3),a.reconnectionDelayMax(o.reconnectionDelayMax||5e3),a.randomizationFactor(null!==(s=o.randomizationFactor)&&void 0!==s?s:.5),a.backoff=new Le({min:a.reconnectionDelay(),max:a.reconnectionDelayMax(),jitter:a.randomizationFactor()}),a.timeout(null==o.timeout?2e4:o.timeout),a._readyState="closed",a.uri=n;var d=o.parser||Pe;return a.encoder=new d.Encoder,a.decoder=new d.Decoder,a._autoConnect=!1!==o.autoConnect,a._autoConnect&&a.open(),a}return o(i,[{key:"reconnection",value:function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}},{key:"reconnectionAttempts",value:function(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}},{key:"reconnectionDelay",value:function(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}},{key:"randomizationFactor",value:function(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}},{key:"reconnectionDelayMax",value:function(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}},{key:"timeout",value:function(e){return arguments.length?(this._timeout=e,this):this._timeout}},{key:"maybeReconnectOnOpen",value:function(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}},{key:"open",value:function(e){var t=this;if(~this._readyState.indexOf("open"))return this;this.engine=new ce(this.uri,this.opts);var n=this.engine,o=this;this._readyState="opening",this.skipReconnect=!1;var r=xe(n,"open",(function(){o.onopen(),e&&e()})),a=xe(n,"error",(function(n){o.cleanup(),o._readyState="closed",t.emitReserved("error",n),e?e(n):o.maybeReconnectOnOpen()}));if(!1!==this._timeout){var i=this._timeout;0===i&&r();var s=this.setTimeoutFn((function(){r(),n.close(),n.emit("error",new Error("timeout"))}),i);this.opts.autoUnref&&s.unref(),this.subs.push((function(){clearTimeout(s)}))}return this.subs.push(r),this.subs.push(a),this}},{key:"connect",value:function(e){return this.open(e)}},{key:"onopen",value:function(){this.cleanup(),this._readyState="open",this.emitReserved("open");var e=this.engine;this.subs.push(xe(e,"ping",this.onping.bind(this)),xe(e,"data",this.ondata.bind(this)),xe(e,"error",this.onerror.bind(this)),xe(e,"close",this.onclose.bind(this)),xe(this.decoder,"decoded",this.ondecoded.bind(this)))}},{key:"onping",value:function(){this.emitReserved("ping")}},{key:"ondata",value:function(e){this.decoder.add(e)}},{key:"ondecoded",value:function(e){this.emitReserved("packet",e)}},{key:"onerror",value:function(e){this.emitReserved("error",e)}},{key:"socket",value:function(e,t){var n=this.nsps[e];return n||(n=new Oe(this,e,t),this.nsps[e]=n),n}},{key:"_destroy",value:function(e){for(var t=0,n=Object.keys(this.nsps);t<n.length;t++){var o=n[t];if(this.nsps[o].active)return}this._close()}},{key:"_packet",value:function(e){for(var t=this.encoder.encode(e),n=0;n<t.length;n++)this.engine.write(t[n],e.options)}},{key:"cleanup",value:function(){this.subs.forEach((function(e){return e()})),this.subs.length=0,this.decoder.destroy()}},{key:"_close",value:function(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}},{key:"disconnect",value:function(){return this._close()}},{key:"onclose",value:function(e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()}},{key:"reconnect",value:function(){var e=this;if(this._reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{var n=this.backoff.duration();this._reconnecting=!0;var o=this.setTimeoutFn((function(){t.skipReconnect||(e.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((function(n){n?(t._reconnecting=!1,t.reconnect(),e.emitReserved("reconnect_error",n)):t.onreconnect()})))}),n);this.opts.autoUnref&&o.unref(),this.subs.push((function(){clearTimeout(o)}))}}},{key:"onreconnect",value:function(){var e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}]),i}(T),_e={};function Ie(t,n){"object"===e(t)&&(n=t,t=void 0);var o,r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,o=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==n?n.protocol+"//"+e:"https://"+e),o=f(e)),o.port||(/^(http|ws)$/.test(o.protocol)?o.port="80":/^(http|ws)s$/.test(o.protocol)&&(o.port="443")),o.path=o.path||"/";var r=-1!==o.host.indexOf(":")?"["+o.host+"]":o.host;return o.id=o.protocol+"://"+r+":"+o.port+t,o.href=o.protocol+"://"+r+(n&&n.port===o.port?"":":"+o.port),o}(t,(n=n||{}).path||"/socket.io"),a=r.source,i=r.id,s=r.path,c=_e[i]&&s in _e[i].nsps;return n.forceNew||n["force new connection"]||!1===n.multiplex||c?o=new Ee(a,n):(_e[i]||(_e[i]=new Ee(a,n)),o=_e[i]),r.query&&!n.query&&(n.query=r.queryKey),o.socket(r.path,n)}return r(Ie,{Manager:Ee,Socket:Oe,io:Ie,connect:Ie}),Ie},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).io=t()}"undefined"!=typeof module&&(module.exports=jr),"function"==typeof define&&define.amd&&define("RTCMultiConnection",[],(function(){return jr}));class Fr{constructor(e,n){t(this,"sceneManager"),t(this,"camera"),t(this,"_keys",[]),t(this,"keysUp",[38]),t(this,"keysDown",[40]),t(this,"keysLeft",[37]),t(this,"keysRight",[39]),t(this,"_onKeyDown"),t(this,"_onKeyUp"),this.camera=e,this.sceneManager=n}_onLostFocus(e){this._keys=[]}getClassName(){return"FreeCameraKeyboardWalkInput"}getSimpleName(){return"keyboard"}attachControl(e){var t=this.camera.getEngine().getInputElement();this._onKeyDown||(t.tabIndex=1,this._onKeyDown=t=>{-1===this.keysUp.indexOf(t.keyCode)&&-1===this.keysDown.indexOf(t.keyCode)&&-1===this.keysLeft.indexOf(t.keyCode)&&-1===this.keysRight.indexOf(t.keyCode)||(-1===this._keys.indexOf(t.keyCode)&&this._keys.push(t.keyCode),e||t.preventDefault())},this._onKeyUp=t=>{if(-1!==this.keysUp.indexOf(t.keyCode)||-1!==this.keysDown.indexOf(t.keyCode)||-1!==this.keysLeft.indexOf(t.keyCode)||-1!==this.keysRight.indexOf(t.keyCode)){var n=this._keys.indexOf(t.keyCode);n>=0&&this._keys.splice(n,1),e||t.preventDefault()}},t.addEventListener("keydown",this._onKeyDown,!1),t.addEventListener("keyup",this._onKeyUp,!1))}detachControl(){var e=this.camera.getEngine().getInputElement();this._onKeyDown&&(e.removeEventListener("keydown",this._onKeyDown),e.removeEventListener("keyup",this._onKeyUp),re.UnregisterTopRootEvents(canvas,[{name:"blur",handler:this._onLostFocus}]),this._keys=[],this._onKeyDown=null,this._onKeyUp=null)}checkInputs(){if(this._onKeyDown){var e=this.camera;const o=.3,r=.03,a=Math.PI/2,i=new ae(Math.cos(a),0,Math.sin(a));for(var t=0;t<this._keys.length;t++){var n=this._keys[t];-1!==this.keysLeft.indexOf(n)?this.sceneManager.lookLeft(r):-1!==this.keysRight.indexOf(n)?this.sceneManager.lookRight(r):-1!==this.keysUp.indexOf(n)?this.sceneManager.moveForward(o):-1!==this.keysDown.indexOf(n)&&this.sceneManager.moveBackward(o),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),ae.TransformNormalToRef(i,e._cameraTransformMatrix,e._transformedDirection),e.cameraDirection.addInPlace(e._transformedDirection)}}}}const zr=class e{constructor(e,n){t(this,"vcReadyObj"),t(this,"base_point"),t(this,"base_point_up"),t(this,"engine"),t(this,"scene"),t(this,"root_node"),t(this,"canvas"),t(this,"camera"),t(this,"RTCMC"),t(this,"positionBroadcasterID"),t(this,"myPlayer"),t(this,"otherPlayers"),t(this,"defaultPosition",{LNG:120.07,LAT:30.27,ALT:60}),this.vcReadyObj=e,this.otherPlayers=new Map,this.canvas=n,navigator.geolocation?navigator.geolocation.getCurrentPosition((e=>{this.defaultPosition.LNG=e.coords.longitude,this.defaultPosition.LAT=e.coords.latitude,this.defaultPosition.ALT=e.coords.altitude,this.init(n)}),(()=>{alert("Unable to retrieve your position!"),this.init(n)}),{timeout:3e3}):alert("Geolocation is not supported by your browser!")}static sphericalToCartesian(e,t,n){const o=t*Math.PI/180,r=e*Math.PI/180,a=6378137+n,i=a*Math.cos(o)*Math.cos(r),s=a*Math.cos(o)*Math.sin(r),c=a*Math.sin(o);return new ae(-i,s,-c)}static cart2vec(e){return new ae(e.x,e.z,e.y)}addPlayer(e,t,n){var o,r=512;const a=new ie("defaultMat",this.scene);a.emissiveColor=se.Gray(),a.reflectionTexture=new ce("https://playground.babylonjs.com/textures/TropicalSunnyDay",this.scene),a.reflectionFresnelParameters=new de,a.reflectionFresnelParameters.leftColor=se.White(),a.reflectionFresnelParameters.rightColor=se.Black();var i=a.diffuseTexture=new le("dynamicTexture",{width:r,height:r},this.scene),s="bold 96px monospace";var c=(null==(o=Sa.system.useUserStore().info)?void 0:o.username)||"Hello!",d=i.getContext();d.font=s;var l=d.measureText(c).width;i.drawText(c,(r-l)/2,280,s,"#FF0000","#00FFFF",!1,!0);var u=[];u[0]=new Se(0,0,1,1),u[1]=new Se(0,0,0,0),u[2]=new Se(0,0,1,1);var p=ue.CreateCylinder("player-"+e.id,{height:9,diameter:58,diameterBottom:66,faceUV:u,tessellation:68},this.scene);p.id=t,p.rotation.z=Math.PI,p.rotation.y=5*Math.PI/6,p.rotation.x=1*Math.PI/6;var m=new ie("playerMat-"+e.id,this.scene),h=new pe(e.id,e,this.scene,!1,!0);m.diffuseTexture=h,m.roughness=1,m.emissiveColor=se.Gray(),m.reflectionTexture=new ce("https://playground.babylonjs.com/textures/TropicalSunnyDay",this.scene),m.reflectionFresnelParameters=new de,m.reflectionFresnelParameters.leftColor=se.White(),m.reflectionFresnelParameters.rightColor=se.Black();const f=new me("playerMultiMat",this.scene);f.subMaterials.push(m),f.subMaterials.push(a),p.material=f;const v=p.getTotalVertices();new he(1,0,v,0,613,p),this.scene.onPointerObservable.add((e=>{e.pickInfo.pickedMesh===p&&(h.video.paused?h.video.play():h.video.pause())}),fe.POINTERPICK),n?(p.position=new ae(this.defaultPosition.LNG-230*Math.random(),this.defaultPosition.LAT-180*Math.random(),this.defaultPosition.ALT),this.myPlayer=p,this.myPlayer.parent=this.camera,this.positionBroadcasterID=setInterval((()=>{this.RTCMC&&this.updatePosition()}),3e3)):(p.position=ae.Zero(),this.otherPlayers[t]=p)}initRTC(){Ur();const e=new jr;e.socketURL={}.VITE_SIGNALING||"https://muazkhan.com:9001/",e.session={audio:!0,video:!0,data:!0},e.sdpConstraints.mandatory={OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},e.onstream=t=>{e.setCustomSocketEvent("updateScaling"),e.socket.on("updateScaling",(e=>{this.otherPlayers[e.player].scaling=new ae(18,10,18)})),e.setCustomSocketEvent("updatePosition"),e.socket.on("updatePosition",(e=>{this.otherPlayers[e.player]&&(this.otherPlayers[e.player].position=e.target)})),e.setCustomSocketEvent("updateRotation"),e.socket.on("updateRotation",(e=>{"left"==e.target?this.otherPlayers[e.player].rotation.z+=Math.PI/66:"right"==e.target&&(this.otherPlayers[e.player].rotation.z-=Math.PI/66)})),e.setCustomSocketEvent("movePOV"),e.socket.on("movePOV",(e=>{this.otherPlayers[e.player].movePOV(0,e.target.y,0)})),"local"===t.type?this.addPlayer(t.mediaElement,t.userid,!0):this.addPlayer(t.mediaElement,t.userid,!1)},e.onclose=e=>{let t;t="local"===e.type?this.myPlayer:this.otherPlayers[e.userid],t.dispose(),"local"===e.type?(this.myPlayer=null,clearInterval(this.positionBroadcasterID)):delete this.otherPlayers[e.userid]},e.onstreamended=e=>{let t;t="local"===e.type?this.myPlayer:this.otherPlayers[e.streamid],t.dispose(),"local"===e.type?(this.myPlayer=null,clearInterval(this.positionBroadcasterID)):delete this.otherPlayers[e.userid]},e.openOrJoin("GV-Globe"),this.RTCMC=e}moveBabylonCamera(){let t=this.vcReadyObj.Cesium.Math.toDegrees(this.vcReadyObj.viewer.camera.frustum.fovy);this.camera.fov=t/180*Math.PI;let n=this.vcReadyObj.viewer.camera.inverseViewMatrix,o=ve.FromValues(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]),r=ae.Zero(),a=ye.Zero(),i=ae.Zero();o.decompose(r,a,i);let s=e.cart2vec(i),c=e.cart2vec(this.vcReadyObj.viewer.camera.direction),d=e.cart2vec(this.vcReadyObj.viewer.camera.up),l=Math.atan(c.z/c.x);c.x<0&&(l+=Math.PI),l=Math.PI/2-l;let u=Math.asin(-c.y),p=new ae(-Math.cos(l),0,Math.sin(l)),m=Math.acos(d.x*p.x+d.y*p.y+d.z*p.z);m=Math.PI/2-m,d.y<0&&(m=Math.PI-m),this.camera.position.x=s.x-this.base_point.x,this.camera.position.y=s.y-this.base_point.y,this.camera.position.z=s.z-this.base_point.z,this.camera.rotation.x=u,this.camera.rotation.y=l,this.camera.rotation.z=m}initCesium(){this.base_point=e.cart2vec(this.vcReadyObj.Cesium.Cartesian3.fromDegrees(this.defaultPosition.LNG,this.defaultPosition.LAT,50)),this.base_point_up=e.cart2vec(this.vcReadyObj.Cesium.Cartesian3.fromDegrees(this.defaultPosition.LNG,this.defaultPosition.LAT,300)),this.vcReadyObj.viewer.camera.flyTo({destination:this.vcReadyObj.Cesium.Cartesian3.fromDegrees(this.defaultPosition.LNG,this.defaultPosition.LAT-.003,this.defaultPosition.ALT+60),orientation:{heading:this.vcReadyObj.Cesium.Math.toRadians(0),pitch:this.vcReadyObj.Cesium.Math.toRadians(-10)}})}initBabylon(t){const n=new ge(t),o=new be(n);o.clearColor=new ke(0,0,0,0);const r=new we("camera",new ae(0,0,-10),this.scene);o.activeCamera=r,o.activeCamera.attachControl(t,!0),this.root_node=new Ce("BaseNode",o),this.root_node.lookAt(this.base_point_up.subtract(this.base_point)),this.root_node.addRotation(Math.PI/2,0,0),r.inputs.removeByType("FreeCameraKeyboardMoveInput"),r.inputs.removeByType("FreeCameraMouseInput"),r.inputs.add(new Fr(r,this)),this.engine=n,this.scene=o,this.camera=r;const a=document.createElement("button");a.style.top="60px",a.style.left="30px",a.textContent="@XiXiWetland",a.style.width="106px",a.style.height="33px",a.style.position="absolute",a.style.color="white",a.style.background="rgba(0, 68, 82, 0.6)",a.style["border-radius"]="30px",document.body.appendChild(a),a.addEventListener("click",(()=>{const t=this.RTCMC;t.getAllParticipants().forEach((function(e){t.disconnectWith(e)})),t.attachStreams.forEach((function(e){e.stop()})),t.closeSocket(),t.onstream=e=>{t.setCustomSocketEvent("updatePosition"),t.socket.on("updatePosition",(e=>{this.otherPlayers[e.player]&&(this.otherPlayers[e.player].position=e.target)})),t.setCustomSocketEvent("updateRotation"),t.socket.on("updateRotation",(e=>{"left"==e.target?this.otherPlayers[e.player].rotation.z+=Math.PI/66:"right"==e.target&&(this.otherPlayers[e.player].rotation.z-=Math.PI/66)})),t.setCustomSocketEvent("movePOV"),t.socket.on("movePOV",(e=>{this.otherPlayers[e.player].movePOV(0,e.target.y,0)})),"local"===e.type?this.addPlayer(e.mediaElement,e.userid,!0):this.addPlayer(e.mediaElement,e.userid,!1)},t.openOrJoin("GV-XiXiWetland"),this.base_point=e.cart2vec(this.vcReadyObj.Cesium.Cartesian3.fromDegrees(120.07,30.27,50)),this.base_point_up=e.cart2vec(this.vcReadyObj.Cesium.Cartesian3.fromDegrees(120.07,30.27,300)),this.root_node.lookAt(this.base_point_up.subtract(this.base_point)),this.root_node.addRotation(Math.PI/2,0,0),this.vcReadyObj.viewer.camera.flyTo({destination:this.vcReadyObj.Cesium.Cartesian3.fromDegrees(120.07,30.267,60),orientation:{heading:this.vcReadyObj.Cesium.Math.toRadians(0),pitch:this.vcReadyObj.Cesium.Math.toRadians(-10)}}),this.myPlayer.position=new ae(120.07-230*Math.random(),30.27-180*Math.random(),60),n.runRenderLoop((()=>{this.vcReadyObj.viewer.render(),this.moveBabylonCamera(),this.scene.render()}))})),n.runRenderLoop((()=>{this.vcReadyObj.viewer.render(),this.moveBabylonCamera(),this.scene.render()}))}init(e){this.initCesium(),this.initBabylon(e),this.initRTC()}updateScaling(){this.RTCMC.socket.emit("updateScaling",{player:this.myPlayer.id,target:this.myPlayer.scaling})}updatePosition(){this.RTCMC.socket.emit("updatePosition",{player:this.myPlayer.id,target:this.myPlayer.position})}updateRotation(){this.RTCMC.socket.emit("updateRotation",{player:this.myPlayer.id,target:this.myPlayer.rotation})}updatePlayer(){this.RTCMC.socket.emit("updatePlayer",{player:this.myPlayer.id,target:this.myPlayer})}static getInstance(t,n){return e.instance||(e.instance=new e(t,n)),e.instance}lookLeft(e){this.vcReadyObj.viewer.camera.lookLeft(e),this.RTCMC.socket.emit("updateRotation",{player:this.myPlayer.id,target:"left"})}lookRight(e){this.vcReadyObj.viewer.camera.lookRight(e),this.RTCMC.socket.emit("updateRotation",{player:this.myPlayer.id,target:"right"})}rotateLeft(e){this.vcReadyObj.viewer.camera.rotateLeft(e)}rotateRight(e){this.vcReadyObj.viewer.camera.rotateRight(e)}moveForward(e){this.vcReadyObj.viewer.camera.moveForward(e),this.myPlayer.movePOV(0,.3,0),this.updatePosition()}moveBackward(e){this.vcReadyObj.viewer.camera.moveBackward(e),this.myPlayer.movePOV(0,-.3,0),this.updatePosition()}};t(zr,"instance");let Gr=zr;Te();class Wr{constructor(e,n){t(this,"baseSceneManager"),t(this,"wCafeScene"),this.baseSceneManager=Gr.getInstance(e,n);const o=document.createElement("button");o.style.top="60px",o.style.left="228px",o.textContent="@WCafe",o.style.width="86px",o.style.height="33px",o.style.position="absolute",o.style.color="white",o.style.background="rgba(0, 68, 82, 0.6)",o.style["border-radius"]="30px",document.body.appendChild(o),o.addEventListener("click",(()=>{this.load()}))}addWCafePlayer(e,t,n){var o,r=512;const a=new ie("defaultMat",this.wCafeScene);a.emissiveColor=se.Gray(),a.reflectionTexture=new ce("https://playground.babylonjs.com/textures/TropicalSunnyDay",this.wCafeScene),a.reflectionFresnelParameters=new de,a.reflectionFresnelParameters.leftColor=se.White(),a.reflectionFresnelParameters.rightColor=se.Black();var i=a.diffuseTexture=new le("dynamicTexture",{width:r,height:r},this.wCafeScene),s="bold 96px monospace";var c=(null==(o=Sa.system.useUserStore().info)?void 0:o.username)||"Hello!",d=i.getContext();d.font=s;var l=d.measureText(c).width;i.drawText(c,(r-l)/2,280,s,"#FF0000","#00FFFF",!1,!0);var u=[];u[0]=new Se(0,0,1,1),u[1]=new Se(0,0,0,0),u[2]=new Se(0,0,1,1);var p=ue.CreateCylinder("player-"+e.id,{height:.09,diameter:.68,diameterBottom:.73,faceUV:u,tessellation:68},this.wCafeScene);p.id=t,p.rotation.z=Math.PI,p.rotation.y=9*Math.PI/6,p.rotation.x=3*Math.PI/6;var m=new ie("playerMat-"+e.id,this.wCafeScene),h=new pe(e.id,e,this.wCafeScene,!1,!0);m.diffuseTexture=h,m.roughness=1,m.emissiveColor=se.Gray(),m.reflectionTexture=new ce("https://playground.babylonjs.com/textures/TropicalSunnyDay",this.wCafeScene),m.reflectionFresnelParameters=new de,m.reflectionFresnelParameters.leftColor=se.White(),m.reflectionFresnelParameters.rightColor=se.Black();const f=new me("playerMultiMat",this.wCafeScene);f.subMaterials.push(m),f.subMaterials.push(a),p.material=f;const v=p.getTotalVertices();new he(1,0,v,0,613,p),this.wCafeScene.onPointerObservable.add((e=>{e.pickInfo.pickedMesh===p&&(h.video.paused?h.video.play():h.video.pause())}),fe.POINTERPICK),n?(p.position=new ae(-61-3*Math.random(),1.693,.316-Math.random()),this.baseSceneManager.myPlayer=p,this.baseSceneManager.myPlayer.parent=this.wCafeScene.activeCamera,this.baseSceneManager.positionBroadcasterID=setInterval((()=>{this.baseSceneManager.RTCMC&&this.baseSceneManager.updatePosition()}),3e3)):(p.position=new ae(-61,.327,.316),this.baseSceneManager.otherPlayers[t]=p)}enter(){const e=this.baseSceneManager.RTCMC;e.getAllParticipants().forEach((function(t){e.disconnectWith(t)})),e.attachStreams.forEach((function(e){e.stop()})),e.closeSocket(),e.onstream=t=>{const n=this.baseSceneManager.otherPlayers;e.setCustomSocketEvent("updatePosition"),e.socket.on("updatePosition",(e=>{n[e.player]&&(n[e.player].position=e.target)})),e.setCustomSocketEvent("updateRotation"),e.socket.on("updateRotation",(e=>{"left"==e.target?n[e.player].rotation.z+=Math.PI/66:"right"==e.target&&(n[e.player].rotation.z-=Math.PI/66)})),e.setCustomSocketEvent("movePOV"),e.socket.on("movePOV",(e=>{n[e.player].movePOV(0,e.target.y,0)})),"local"===t.type?this.addWCafePlayer(t.mediaElement,t.userid,!0):this.addWCafePlayer(t.mediaElement,t.userid,!1)},e.openOrJoin("GV-WCafe")}async load(){const e=this.baseSceneManager.engine;let t=0;Pe.Load("/datas/babylon/WCafe/","WCafe.babylon",e,(t=>{t.executeWhenReady((()=>{t.activeCamera&&t.activeCamera.attachControl(this.baseSceneManager.canvas),this.wCafeScene=t,e.runRenderLoop((()=>{this.wCafeScene.render()})),this.enter()}))}),(n=>{n.lengthComputable?e.loadingUIText="Loading, please wait..."+(100*n.loaded/n.total).toFixed()+"%":(t=n.loaded/1048576,e.loadingUIText="Loading, please wait..."+Math.floor(100*t)/100+" MB already loaded.")}))}}Te();class qr{constructor(e,n){t(this,"baseSceneManager"),t(this,"islandScene"),this.baseSceneManager=Gr.getInstance(e,n);const o=document.createElement("button");o.style.top="60px",o.style.left="139px",o.textContent="@Island",o.style.width="86px",o.style.height="33px",o.style.position="absolute",o.style.color="white",o.style.background="rgba(0, 68, 82, 0.6)",o.style["border-radius"]="30px",document.body.appendChild(o),o.addEventListener("click",(()=>{this.load()}))}addIslandPlayer(e,t,n){var o,r=512;const a=new ie("defaultMat",this.islandScene);a.emissiveColor=se.Gray(),a.reflectionTexture=new ce("https://playground.babylonjs.com/textures/TropicalSunnyDay",this.islandScene),a.reflectionFresnelParameters=new de,a.reflectionFresnelParameters.leftColor=se.White(),a.reflectionFresnelParameters.rightColor=se.Black();var i=a.diffuseTexture=new le("dynamicTexture",{width:r,height:r},this.islandScene),s="bold 96px monospace";var c=(null==(o=Sa.system.useUserStore().info)?void 0:o.username)||"Hello!",d=i.getContext();d.font=s;var l=d.measureText(c).width;i.drawText(c,(r-l)/2,280,s,"#FF0000","#00FFFF",!1,!0);var u=[];u[0]=new Se(0,0,1,1),u[1]=new Se(0,0,0,0),u[2]=new Se(0,0,1,1);var p=ue.CreateCylinder("player-"+e.id,{height:.09,diameter:.68,diameterBottom:.73,faceUV:u,tessellation:68},this.islandScene);p.id=t,p.rotation.z=Math.PI,p.rotation.y=9*Math.PI/6,p.rotation.x=3*Math.PI/6;var m=new ie("playerMat-"+e.id,this.islandScene),h=new pe(e.id,e,this.islandScene,!1,!0);m.diffuseTexture=h,m.roughness=1,m.emissiveColor=se.Gray(),m.reflectionTexture=new ce("https://playground.babylonjs.com/textures/TropicalSunnyDay",this.islandScene),m.reflectionFresnelParameters=new de,m.reflectionFresnelParameters.leftColor=se.White(),m.reflectionFresnelParameters.rightColor=se.Black();const f=new me("playerMultiMat",this.islandScene);f.subMaterials.push(m),f.subMaterials.push(a),p.material=f;const v=p.getTotalVertices();new he(1,0,v,0,613,p),this.islandScene.onPointerObservable.add((e=>{e.pickInfo.pickedMesh===p&&(h.video.paused?h.video.play():h.video.pause())}),fe.POINTERPICK),n?(p.position=new ae(1.08-3*Math.random(),3.33,1.27-3*Math.random()),this.baseSceneManager.myPlayer=p,this.baseSceneManager.myPlayer.parent=this.islandScene.activeCamera,this.baseSceneManager.positionBroadcasterID=setInterval((()=>{this.baseSceneManager.RTCMC&&this.baseSceneManager.updatePosition()}),3e3)):(p.position=new ae(-61,.327,.316),this.baseSceneManager.otherPlayers[t]=p)}enter(){const e=this.baseSceneManager.RTCMC;e.getAllParticipants().forEach((function(t){e.disconnectWith(t)})),e.attachStreams.forEach((function(e){e.stop()})),e.closeSocket(),e.onstream=t=>{const n=this.baseSceneManager.otherPlayers;e.setCustomSocketEvent("updatePosition"),e.socket.on("updatePosition",(e=>{n[e.player]&&(n[e.player].position=e.target)})),e.setCustomSocketEvent("updateRotation"),e.socket.on("updateRotation",(e=>{"left"==e.target?n[e.player].rotation.z+=Math.PI/66:"right"==e.target&&(n[e.player].rotation.z-=Math.PI/66)})),e.setCustomSocketEvent("movePOV"),e.socket.on("movePOV",(e=>{n[e.player].movePOV(0,e.target.y,0)})),"local"===t.type?this.addIslandPlayer(t.mediaElement,t.userid,!0):this.addIslandPlayer(t.mediaElement,t.userid,!1)},e.openOrJoin("GV-Island")}async load(){const e=this.baseSceneManager.engine;let t=0;Pe.Load("/datas/gltf/Island/","island.glb",e,(t=>{t.executeWhenReady((()=>{t.createDefaultCamera(!0,!0,!0),t.createDefaultEnvironment({createGround:!1,createSkybox:!1}),t.activeCamera&&(t.activeCamera.attachControl(this.baseSceneManager.canvas),t.activeCamera.alpha=0,t.activeCamera.radius=31.168),this.islandScene=t,e.runRenderLoop((()=>{this.islandScene.render()})),this.enter()}))}),(n=>{n.lengthComputable?e.loadingUIText="Loading, please wait..."+(100*n.loaded/n.total).toFixed()+"%":(t=n.loaded/1048576,e.loadingUIText="Loading, please wait..."+Math.floor(100*t)/100+" MB already loaded.")}))}}const Hr={class:"vc-drawtip vc-tooltip--style"},$r=g({name:"VcDemoViewer",__name:"Index",emits:["viewerReady","cesiumReady","leftClick","destroyed"],setup(e,{emit:t}){const n={"en-US":At,"zh-CN":Nt},{locale:o}=X(),r=t,a=O((()=>n[o.value])),i=Sa.system.useThemeStore(),s=O((()=>i.themeConfig[i.activeName])),{toggleGlobalLayout:c}=Sa.system.useLayoutStore(),{registerTimeout:d}=wt(),l=S(null),u=S([0,75]),p=O((()=>({outerOptions:{icon:s.value.navigation.themeVcCompassOuterIcon,color:s.value.navigation.themeVcCompassOuterColor},innerOptions:{icon:s.value.navigation.themeVcCompassInnerIcon,color:s.value.navigation.themeVcCompassInnerColor,background:s.value.navigation.themeVcCompassInnerBackgroundColor},markerOptions:{color:s.value.global.themeColorAlpha},duration:5}))),m=O((()=>({background:s.value.navigation.themeVcZoomControlBackgroundColor,color:s.value.global.themeColor,border:`solid 1px ${s.value.commonPanel.themeCommonPanelListBorderColor}`,zoomInOptions:{color:s.value.global.themeColor},zoomOutOptions:{color:s.value.global.themeColor},zoomResetOptions:{color:s.value.global.themeColor}}))),h=O((()=>({color:s.value.global.themeColor,background:s.value.navigation.themeVcPrintBackgroundColor,round:!0}))),f=O((()=>({color:s.value.global.themeColor,background:s.value.navigation.themeVcPrintBackgroundColor,round:!0}))),v=O((()=>({position:"bottom-right",offset:[0,10],statusBarOpts:{color:s.value.global.themeColor,background:s.value.navigation.themeVcStatusBarBackgroundColor},distancelegendOpts:{color:s.value.global.themeColor,background:s.value.navigation.themeVcDistanceLegendBackgroundColor}}))),y=Sa.viewer.useOverlayStore().mouseOverNameOpts;Sa.viewer.useRenderStore().selectedRenderData;const g=O((()=>[...Sa.viewer.useLayerStore().baseLayers,...Sa.viewer.useLayerStore().overlayLayers])),T=O((()=>Sa.viewer.useLayerStore().terrainLayers)),P=document.getElementsByTagName("canvas")[0],x=e=>{r("viewerReady",e),c({header:!0}),d((()=>{c({content:!0})}),500),Gr.getInstance(e,P),new qr(e,P),new Wr(e,P)},R=e=>{r("cesiumReady",e)};return(e,t)=>{const n=b("vc-navigation"),o=b("vc-ajax-bar"),r=b("vc-overlay-html"),i=b("vc-viewer");return k(),w(F(Et),{locale:a.value,"cesium-path":F("https://unpkg.com/cesium@latest/Build/Cesium/Cesium.js"),"access-token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI5Y2U0ZTk2Ni1jNzdkLTQ3OWYtYjVmYS0yMGM3YTk3NjgzMmUiLCJpZCI6Njk5Nywic2NvcGVzIjpbImFzciIsImdjIl0sImlhdCI6MTU0ODA1MTc0OH0.Csy6yyAnv6JSBppH0Ou3ahshqcHFEhP27iOz5gjQMEo"},{default:M((()=>[E(i,{ref_key:"viewerRef",ref:l,class:"main-viewer",onReady:x,onCesiumReady:R},{default:M((()=>[E(n,{offset:u.value,"compass-opts":p.value,"zoom-opts":m.value,"print-opts":h.value,"location-opts":f.value,"other-opts":v.value},null,8,["offset","compass-opts","zoom-opts","print-opts","location-opts","other-opts"]),E(o,{position:"bottom",color:"#21BA45",size:"3px",positioning:"fixed"}),(k(!0),C(G,null,W(g.value,((e,t)=>(k(),w(xe(e.component),te({key:"layer"+t,ref_for:!0},e.props),{default:M((()=>[(k(!0),C(G,null,W(null==e?void 0:e.children,((e,n)=>(k(),w(xe(e.component),te({key:t+"_"+n,ref_for:!0},e.props),null,16)))),128))])),_:2},1040)))),128)),(k(!0),C(G,null,W(T.value,((e,t)=>(k(),C(G,{key:"terrain"+t},[e.props.show?(k(),w(xe(e.component),te({key:0,ref_for:!0},e.props),null,16)):A("",!0)],64)))),128)),F(y).show?(k(),w(r,{key:0,position:F(y).position,"pixel-offset":F(y).pixelOffset},{default:M((()=>[D("div",Hr,I(F(y).text),1)])),_:1},8,["position","pixel-offset"])):A("",!0),Z(e.$slots,"default")])),_:3},512)])),_:3},8,["locale","cesium-path"])}}}),Jr={key:0,elevated:"",class:"main-header-container text-h4 text-center text-white"},Kr={key:1,class:"content"},Yr=to(g({name:"VcDemoMainLayout",__name:"MainLayout",setup(e){j((e=>({"584dfd5c":d.value.header.themeHeaderContentBackgroundColor,"32b772ff":d.value.menu.themeMenuColor,"5ea75299":d.value.menu.themeMenuActiveColor})));const t=x(),n=jt(Sa.system.useLayoutStore()).global,{active:o}=jt(Sa.system.useGrayStore()),r=Sa.system.useMenuStore(),a=S(!1),i=O((()=>{const e=r.header;return e.length?e[0].children:[]})),s=O((()=>r.aside)),c=O((()=>t.name)),d=O((()=>{const e=Sa.system.useThemeStore();return e.themeConfig[e.activeName]}));return Y((()=>t.matched),(e=>{var t,n;if(e.length>1){const o=i.value.filter((t=>t.path===e[1].path));if(o.length){const e=null==(n=null==(t=o[0])?void 0:t.children)?void 0:n.filter((e=>10===e.type));(null==e?void 0:e.length)?r.asideSet(e):r.asideSet([])}else r.asideSet([])}}),{immediate:!0}),T((()=>{Sa.system.useAccountStore().load(),window.onunhandledrejection=e=>{Sa.system.useLogStore(Ca).push({message:Gt.get(e,"reason.message","Unknown error"),type:"danger",meta:{error:Gt.get(e,"reason"),trace:Gt.get(e,"reason.stack")}})},window.onerror=(e,t,n,o,r)=>{Sa.system.useLogStore(Ca).push({message:Gt.get(r,"message","Unknown error"),type:"danger",meta:{error:r,trace:Gt.get(r,"stack"),source:`${t}@${n}:${o}`,event:e}})},window.addEventListener("keydown",(function(e){"F11"===e.code&&(e.preventDefault(),ct.toggle())}))})),(e,t)=>{const r=b("router-view");return k(),w(dt,{view:"hHh Lpr fFf",class:z(["main-layout",{"gray-mode":F(o)}])},{default:M((()=>{var o;return[(null==(o=s.value)?void 0:o.length)&&F(n).header?(k(),w(lt,{key:0,modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value=e),"show-if-above":"",width:180,breakpoint:500,bordered:"",mini:F(n).leftDrawerMini},{default:M((()=>[E(De,{class:"drawer-menu-list"},{default:M((()=>[(k(!0),C(G,null,W(s.value,((t,o)=>(k(),C(G,{key:o},[V((k(),w(Ue,{clickable:"","active-class":"menu-active-item",active:t.name===c.value,onClick:n=>e.$router.push(t.path),href:t.href,target:t.target},{default:M((()=>[E(Ae,{avatar:""},{default:M((()=>[E(Be,{name:t.icon},null,8,["name"])])),_:2},1024),E(Ae,null,{default:M((()=>[_(I(e.$t(t.title)||t.caption),1)])),_:2},1024),F(n).leftDrawerMini?(k(),w(Ee,{key:0,"transition-show":"scale","transition-hide":"scale",anchor:"center right",self:"center left"},{default:M((()=>[_(I(e.$t(t.title)||t.caption),1)])),_:2},1024)):A("",!0)])),_:2},1032,["active","onClick","href","target"])),[[je]]),t.separator?(k(),w(rt,{key:"sep"+o})):A("",!0)],64)))),128))])),_:1})])),_:1},8,["modelValue","mini"])):A("",!0),E(pt,{class:"no-padding"},{default:M((()=>[E(ut,{class:"interaction-root"},{default:M((()=>[E($r,null,{default:M((()=>[F(n).header?(k(),C("header",Jr,[E(yr)])):A("",!0),F(n).content?(k(),C("div",Kr,[E(Vr),E(r)])):A("",!0)])),_:1})])),_:1})])),_:1})]})),_:1},8,["class"])}}}),[["__scopeId","data-v-79ce8a36"]]),Xr=Object.freeze(Object.defineProperty({__proto__:null,default:Yr},Symbol.toStringTag,{value:"Module"})),Qr=Pn([]);Pn([]);const Zr={theme:{list:[{title:"经典",name:"classic",preview:"images/theme/classic/preview@2x.png"},{title:"Element",name:"element",preview:"images/theme/element/preview@2x.png"}]},menu:{asideCollapse:!1,asideTransition:!0},hotkey:{search:{open:"s",close:"esc"}},transition:{active:!0}},ea=Vt("menu",{state:()=>({header:[],aside:[],asideCollapse:Zr.menu.asideCollapse,asideTransition:Zr.menu.asideTransition,moduleHeader:[]}),getters:{},actions:{async asideCollapseSet(e){this.asideCollapse=e;Xn().set({dbName:"sys",path:"menu.asideCollapse",value:String(this.asideCollapse),user:!0})},async asideCollapseToggle(){this.asideCollapse=!this.asideCollapse;Xn().set({dbName:"sys",path:"menu.asideCollapse",value:String(this.asideCollapse),user:!0})},async asideTransitionSet(e){this.asideTransition=e;Xn().set({dbName:"sys",path:"menu.asideTransition",value:String(this.asideTransition),user:!0})},async asideTransitionToggle(){this.asideTransition=!this.asideTransition;Xn().set({dbName:"sys",path:"menu.asideTransition",value:String(this.asideTransition),user:!0})},async asideLoad(){Xn().get({dbName:"sys",path:"menu",defaultValue:String(Zr.menu),user:!0})},headerSet(e){this.header=e},asideSet(e){this.aside=e},clear(){this.header=[],this.aside=[]},moduleHeaderSet(e){this.moduleHeader=e}}}),ta=Vt("search",{state:()=>({active:!1,hotkey:{open:Zr.hotkey.search.open,close:Zr.hotkey.search.close},pool:[]}),actions:{toggle(){this.active=!this.active},set(e){this.active=e},init(e){const t=[],n=function(e,o=[]){e.forEach((e=>{e.children?n(e.children,[...o,e.title]):t.push({...e,fullTitle:[...o,e.title].join(" / ")})}))};n(e),this.pool=t}}}),na=[...Qr];const oa=Object.assign({"../../pages/create/Index.vue":eo,"../../pages/create/tbd/Index.vue":oo,"../../pages/dynamic-render/Index.vue":ao,"../../pages/dynamic-render/historical-track/Index.vue":lo,"../../pages/dynamic-render/recursive-list/Index.vue":xo,"../../pages/dynamic-render/recursive-list/work-bench/Index.vue":So,"../../pages/dynamic-render/stack/Index.vue":Io,"../../pages/expansion/Index.vue":Ao,"../../pages/expansion/typhoon/Index.vue":jo,"../../pages/happiness/Index.vue":Fo,"../../pages/happiness/hsa/Index.vue":Go,"../../pages/home/Index.vue":Ho,"../../pages/system/Error404.vue":Qo,"../../pages/system/Login.vue":ir,"../../pages/test/on-demand/Index.vue":cr});function ra(e,t){return null==e&&(e={path:"/",children:[]}),t.forEach((t=>{let n=e;if(20!==t.type&&(null!=(o=t.component)&&""!==o)){let o=null;o="MainLayout"===t.component?Yr:(e=>{const t=oa[`../../pages${e}/Index.vue`];if(t)return t.default;on(`动态路由页面【${e}】加载失败。请检查页面文件是否存在。`)})(t.path);const r=e.children;n={path:t.path,name:t.name,component:o,meta:{title:t.title,auth:!0,cache:!0}},t.redirect&&(n.redirect=t.redirect),r.push(n)}var o;null!=t.children&&t.children.length>0&&(null==n.children&&(n.children=[]),ra(n,t.children))})),e.children}function aa(e,t){return null==e&&(e=[]),e.forEach((e=>{null!=e.permission&&""!==e.permission&&t.push(e.permission),null!=e.children&&e.children.length>0&&aa(e.children,t)})),t}function ia(e){null==e&&(e=[]);let t=[];return e.forEach((e=>{if(10!==e.type)return;let n,o;null!=e.children&&e.children.length>0&&(n=ia(e.children)),null!=e.icon&&""!==e.icon&&(o=e.icon),t.push({icon:o,children:n,...e})})),0===t.length&&(t=void 0),t}const sa=Vt("permission",{state:()=>({routes:[],addRoutes:[],permissions:[],inited:!1}),getters:{},actions:{setRoutes({accessedRoutes:e,permissions:t}){this.addRoutes=e,this.routes=tn.concat(e),this.inited=!0,this.permissions=t},clear(){this.addRoutes=[],this.routes=[],this.inited=!1,this.permissions=[]},generateRoutes({menuTree:e}){return new Promise((t=>{const n=ra(null,e),o=aa(e,[]);this.setRoutes({accessedRoutes:n,permissions:o}),n.forEach((e=>{"layout"===e.name&&"/"===e.path&&(e.children=e.children.concat(en[0].children)),Hn.addRoute(e)}));const r=Pn(ia(e));Qr.splice(0,Qr.length),Qr.push(...na),Qr.push(...r);ea().headerSet(Qr);ta().init(Qr),t(!0)}))},async getAccessibleMenus({state:e,dispatch:t}){}}}),ca=Vt("gray",{state:()=>({active:!1}),getters:{},actions:{toggle(){this.active=!this.active},set(e){this.active=e}}}),da={themeName:"classic",global:{themeBGColor:"#ebf1f6",themeBGMaskColor:"rgba(0, 0, 0, 0)",themeColor:"#cbe1e5",themeColorAlpha:"rgba(255, 255, 255, 0.6)",themeColorActive:"#fff",themeScrollTopBackgroundColor:"rgba(0, 0, 0, 0)",themeQInputColor:"#fff",themeQInputBorderColor:"#fff9",themeQCheckboxTruthyColor:"#1976d2",themeQMenuColor:"#fff",themeQMenuBackgroundColor:"rgba(0, 68, 82, 0.6)",themeQCardColor:"#fff",themeQCardHeaderBackgroundColor:"rgba(0, 101, 122, 0.5)",themeQCardBackgroundColor:"rgba(0, 68, 82, 0.6)",themeQScrollAreaColor:"#fff"},header:{themeHeaderColor:"#cbe1e5",themeHeaderTitleColor:"#fff",themeHeaderLogoBackgroundColor:"rgba(255, 255, 255, 0)",themeHeaderBackgroundColor:"rgba(29, 29, 29, 0)",themeHeaderContentBackgroundColor:"rgba(0, 68, 82, 0.6)"},commonPanel:{themeCommonPanelHeaderColor:"#fff",themeCommonPanelHeaderBackgroundColor:"rgba(0, 101, 122, 0.8)",themeCommonPanelContentColor:"#fff",themeCommonPanelContentBackgroundColor:"rgba(0, 68, 82, 0.6)",themeCommonPanelListColor:"#fff",themeCommonPanelListBorderColor:"rgba(255, 255, 255, 0.278)"},navigation:{themeVcCompassOuterIcon:"svguse:#vc-icons-compass-outer",themeVcCompassOuterColor:"rgba(0, 68, 82)",themeVcCompassInnerIcon:"fa fa-compass",themeVcCompassInnerColor:"rgba(255, 255, 255, 0.7)",themeVcCompassInnerBackgroundColor:"rgba(0, 68, 82, 0.6)",themeVcZoomControlBackgroundColor:"rgba(0, 68, 82, 0.6)",themeVcPrintBackgroundColor:"rgba(0, 68, 82, 0.6)",themeVcStatusBarBackgroundColor:"rgba(0, 68, 82, 0.8)",themeVcDistanceLegendBackgroundColor:"rgba(0, 68, 82, 0.8)"},pageLogin:{themePageLoginColor:"#fff",themePageLoginBackground:"rgba(29,29,29, 0.5)"},menu:{themeMenuColor:"#cbe1e5",themeMenuActiveColor:"#fff",themeMenuActiveBackgroundColor:"#F2C037"}},la={themeName:"element",global:{themeBGColor:"#314255",themeBGMaskColor:"rgba(0, 0, 0, 0)",themeColor:"#bfcbd9",themeColorAlpha:"rgba(70, 160, 252, 0.6)",themeColorActive:"#46a0fc",themeScrollTopBackgroundColor:"rgba(0, 0, 0, 0)",themeQInputColor:"#bfcbd9",themeQInputBorderColor:"#fff9",themeQCheckboxTruthyColor:"#46a0fc",themeQMenuColor:"#bfcbd9",themeQMenuBackgroundColor:"rgba(29, 29, 29, 0.6)",themeQCardColor:"#bfcbd9",themeQCardHeaderBackgroundColor:"rgba(49, 66, 85, 0.5)",themeQCardBackgroundColor:"rgba(29, 29, 29, 0.6)",themeQScrollAreaColor:"#46a0fc"},header:{themeHeaderColor:"#bfcbd9",themeHeaderTitleColor:"#bfcbd9",themeHeaderLogoBackgroundColor:"#314255",themeHeaderBackgroundColor:"#202d3d",themeHeaderContentBackgroundColor:"#314255"},commonPanel:{themeCommonPanelHeaderColor:"#bfcbd9",themeCommonPanelHeaderBackgroundColor:"rgba(49, 66, 85, 0.8)",themeCommonPanelContentColor:"#bfcbd9",themeCommonPanelContentBackgroundColor:"rgba(32, 45, 61, 0.6)",themeCommonPanelListColor:"#bfcbd9",themeCommonPanelListBorderColor:"rgba(255, 255, 255, 0.278)"},navigation:{themeVcCompassOuterIcon:"fa fa-circle-o-notch",themeVcCompassOuterColor:"rgb(49, 66, 85)",themeVcCompassInnerIcon:"fa fa-circle",themeVcCompassInnerColor:"rgba(49, 66, 85, 0.7)",themeVcCompassInnerBackgroundColor:"rgba(49, 66, 85, 0.6)",themeVcZoomControlBackgroundColor:"rgba(49, 66, 85, 0.6)",themeVcPrintBackgroundColor:"rgba(49, 66, 85, 0.6)",themeVcStatusBarBackgroundColor:"rgba(49, 66, 85, 0.8)",themeVcDistanceLegendBackgroundColor:"rgba(49, 66, 85, 0.8)"},pageLogin:{themePageLoginColor:"#bfcbd9",themePageLoginBackground:"rgba(32, 45, 61, 0.5)"},menu:{themeMenuColor:"#bfcbd9",themeMenuActiveColor:"#bfcbd9",themeMenuActiveBackgroundColor:"#F2C037"}};let ua="";const pa=Vt("theme",{state:()=>({list:Gt.get(Zr,"theme.list",[]),activeName:Gt.get(Zr,"theme.list[0].name","h2o"),themeConfig:{classic:da,element:la}}),getters:{activeSetting:e=>e.list.find((t=>t.name===e.activeName))},actions:{dom(){const e=`theme-${ua}`,t=`theme-${this.activeName}`;document.body.className.includes(e)?document.body.className=document.body.className.replace(e,t):document.body.className+=" "+t;const n=this.themeConfig[this.activeName];Object.keys(n.global).forEach((e=>{document.body.style.setProperty(`--${e}`,n.global[e])}))},async set(e){ua=this.activeName,this.activeName=this.list.find((t=>t.name===e))?e:this.list[0].name,this.dom();Xn().set({dbName:"sys",path:"theme.activeName",value:this.activeName,user:!0})},async load(){ua=this.activeName;const e=Xn(),t=e.get({dbName:"sys",path:"theme.activeName",defaultValue:this.list[0].name,user:!0});this.list.find((e=>e.name===t))?this.activeName=t:(this.activeName=this.list[0].name,e.set({dbName:"sys",path:"theme.activeName",value:this.activeName,user:!0})),this.dom()}}}),ma=Vt("transition",{state:()=>({active:Zr.transition.active}),actions:{async set(e){this.active=e;Xn().set({dbName:"sys",path:"transition.active",value:String(this.active),user:!0})},async load(){const e=Xn();this.active=e.get({dbName:"sys",path:"transition.active",defaultValue:String(Zr.transition.active),user:!0})}}}),ha=Vt("account",{state:()=>({}),getters:{},actions:{async login(e){const t=(await Fn.login(e)).data;Jt("token",t.token),Jt("uuid",t.id);Qn().set({...t}),this.load()},logout:({confirm:e=!1}={})=>new Promise(((t,n)=>{async function o(){Yt("token"),Yt("uuid");Qn().set({});sa().clear();ea().clear(),Hn.push({name:"login"}),t(!0)}if(e){const e=ca();e.set(!0),mt.create({title:"Log Out",message:"Confirm Log Out？",cancel:!0}).onOk((()=>{e.set(!1),o()})).onCancel((()=>{e.set(!1),Le.create({message:"Cancel Log Out"}),t(!1)}))}else o()})),async load(){Qn().load();pa().load();ma().load();ea().asideLoad()}}}),fa=Vt("layout",{state:()=>({global:{header:!1,leftDrawerMini:!0,content:!1,footer:!1,layerManager:!1,navigation:!1,featureInfo:!1,videoPlayer:!1},dynamicRender:{datasource:{workBench:!1}}}),getters:{},actions:{toggleGlobalLayout(e){Object.keys(e).forEach((t=>{Gt.isBoolean(e[t])&&(this.global[t]=e[t])}))},toggleDynamicRenderPageLayout(e){const t=(e,n)=>{Object.keys(e).forEach((o=>{l(e[o])?t(e[o],n[o]):Gt.isBoolean(e[o])&&(n[o]=e[o])}))};t(e,this.dynamicRender)}}}),va=Vt("log",{state:()=>({log:[]}),getters:{length:e=>e.log.length,lengthError:e=>e.log.filter((e=>"danger"===e.type)).length},actions:{push({message:e,type:t="info",meta:n}){this.log.push({message:e,type:t,time:ht.formatDate(Date.now(),"YYYY-MM-DD HH:mm:ss"),meta:{uuid:Kt("uuid"),token:Kt("token"),url:Gt.get(window,"location.href",""),...n}})},clean(){this.log=[]}}}),ya={useAccountStore:e=>ha(e),useDBStore:e=>Xn(e),useGrayStore:e=>ca(e),useLayoutStore:e=>fa(e),useLogStore:e=>va(e),useMenuStore:e=>ea(e),usePermissionStore:e=>sa(e),useSearchStore:e=>ta(e),useThemeStore:e=>pa(e),useTransitionStore:e=>ma(e),useUserStore:e=>Qn(e)},ga=Vt("layer",{state:()=>({baseLayers:[{name:"tianditu_img",text:"天地图影像",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderTianditu",props:{mapStyle:"img_c",token:"436ce7e50d27eede2f2929307e6b33c0",minimumLevel:0,maximumLevel:17}}]},{name:"tianditu_vec",text:"天地图街道",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderTianditu",props:{mapStyle:"vec_c",token:"436ce7e50d27eede2f2929307e6b33c0",minimumLevel:0,maximumLevel:17}}]},{name:"baidu_img",text:"百度影像",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderBaidu",props:{mapStyle:"img",projectionTransforms:{from:"BD09",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"baidu_vec",text:"百度街道",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderBaidu",props:{mapStyle:"vec",projectionTransforms:{from:"BD09",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"baidu_midnight",text:"百度街道_午夜蓝",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderBaidu",props:{mapStyle:"midnight",projectionTransforms:{from:"BD09",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"baidu_dark",text:"百度街道_黑夜",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderBaidu",props:{mapStyle:"dark",projectionTransforms:{from:"BD09",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"amap_img",text:"高德影像",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderAmap",props:{mapStyle:"6",projectionTransforms:{from:"GCJ02",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"amap_vec",text:"高德街道",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderAmap",props:{mapStyle:"7",projectionTransforms:{from:"GCJ02",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"tencent_img",text:"腾讯影像",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderTencent",props:{mapStyle:"img",projectionTransforms:{from:"GCJ02",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"tencent_vector",text:"腾讯街道",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderTencent",props:{mapStyle:"vector",projectionTransforms:{from:"GCJ02",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"tencent_vector_my",text:"腾讯街道_墨渊",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderTencent",props:{mapStyle:"vector",styleId:"4",projectionTransforms:{from:"GCJ02",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"osm",text:"OSM",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderOsm"}]},{name:"arcgis",text:"ArcGIS",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderArcgis"}]}],overlayLayers:[{name:"tianditu_cva",text:"天地图注记",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:30,show:!1},children:[{component:"VcImageryProviderTianditu",props:{mapStyle:"cva_c",token:"436ce7e50d27eede2f2929307e6b33c0",minimumLevel:0,maximumLevel:17}}]},{name:"amap_label",text:"高德注记",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:30,show:!1},children:[{component:"VcImageryProviderAmap",props:{mapStyle:"8",ltype:"4",minimumLevel:0,maximumLevel:17,projectionTransforms:{from:"GCJ02",to:"WGS84"}}}]},{name:"amap_traffictile",text:"高德路况",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:30,show:!1},children:[{component:"VcImageryProviderAmap",props:{url:"/traffictile?v=1.0&x={x}&y={y}&z={z}&t=1",minimumLevel:0,maximumLevel:17,projectionTransforms:{from:"GCJ02",to:"WGS84"}}}]},{name:"baidu_traffic",text:"百度路况",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:30,show:!1},children:[{component:"VcImageryProviderBaidu",props:{mapStyle:"traffic",projectionTransforms:{from:"BD09",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"admin",text:"行政区划",component:"VcDatasourceGeojson",props:{strokeWidth:5,stroke:"#ffc107",fill:"transparent",show:!1,data:"./datas/china.json"},children:[]}],terrainLayers:[{name:"terrain",text:"全球地形",component:"VcTerrainProviderCesium",props:{show:!1}},{name:"null",text:"不显示地形",component:void 0,props:{show:!1}}]}),getters:{},actions:{toggle({names:e,show:t}){const n=[...this.baseLayers,...this.overlayLayers,...this.terrainLayers];(e=Array.isArray(e)?e:[e]).forEach((e=>{var o;const r=Gt.find(n,(t=>t.name===e));!Gt.isUndefined(null==r?void 0:r.show)&&(r.show=t),!Gt.isUndefined(null==(o=null==r?void 0:r.props)?void 0:o.show)&&(r.props.show=t)}))},loadDefaultLayers(e){const t=[...this.baseLayers,...this.overlayLayers,...this.terrainLayers].map((e=>e.name));this.toggle({names:t,show:!1});this.toggle({names:["tianditu_img","admin"],show:!0})}}}),ba=Vt("overlay",{state:()=>({mouseOverNameOpts:{position:[117.186419,45.66446,20],show:!1,text:"",pixelOffset:[0,0]}}),getters:{},actions:{setMouseOverlayLabel({position:e,show:t,text:n,pixelOffset:o}){this.mouseOverNameOpts.position=e,this.mouseOverNameOpts.show=t,this.mouseOverNameOpts.text=n,this.mouseOverNameOpts.pixelOffset=o},clearMouseOverlayLabel(){this.mouseOverNameOpts.position=void 0,this.mouseOverNameOpts.show=!1,this.mouseOverNameOpts.text=void 0}}}),ka=Vt("render",{state:()=>({renderDatas:[],selectedRenderData:{model:void 0,renderingType:void 0,restoreHandlers:[],feature:void 0,featureInfoListItems:[]}}),getters:{},actions:{addRenderDatas(e){(e=Array.isArray(e)?e:[e]).forEach((e=>{-1===Gt.findIndex(this.renderDatas,(t=>t.id===e.id))?this.renderDatas.push(e):rn(`添加渲染数据集失败，原因：id 为【${e.id} 】的数据已经存在。`,"渲染数据模型：",e)}))},removeRenderDataById(e){Gt.remove(this.renderDatas,(t=>t.id===e))},removeRenderDataByType(e){Gt.remove(this.renderDatas,(t=>t.type===e))},removeRenderDataByPage(e){Gt.remove(this.renderDatas,(t=>t.page===e))},removeAllRenderData(){this.renderDatas.length=0},setSelectedRenderData(e,t){this.selectedRenderData.model=e.model,this.selectedRenderData.renderingType=e.renderingType,this.selectedRenderData.feature=e.feature,this.selectedRenderData.featureInfoListItems=e.featureInfoListItems,t?this.selectedRenderData.restoreHandlers=[]:this.selectedRenderData.restoreHandlers.push(...e.restoreHandlers)},getRenderDataByDatasetId(e){return Gt.find(this.renderDatas,(t=>t.id===e))}}}),wa={useLayerStore:e=>ga(e),useOverlayStore:e=>ba(e),useRenderStore:e=>ka(e)},Ca=Ut(),Sa={system:{...ya},viewer:{...wa}};const Ta=Re(to({},[["render",function(e,t){const n=b("router-view");return k(),w(n)}]]));Ta.use(ft,{plugins:{Notify:Le,Dialog:mt,LocalStorage:Oe,Loading:vt,AppFullscreen:ct},lang:yt}),Ta.use(qn),Ta.use(Bt),Ta.use(Ca),Ta.use(Hn),Ta.mount("#app");
