var e=Object.defineProperty,t=(t,n,a)=>(((t,n,a)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a})(t,"symbol"!=typeof n?n+"":n,a),a);import{cp as n,c9 as a,bE as o,cq as i,cr as r,cs as s,ct as c,cb as d,c8 as l,bz as u,cu as p,cv as h,cw as m,cx as f,cy as v,cz as y,bO as g,cA as b,cB as C,cC as k,cD as S,by as w,bY as P,bZ as M,cE as T,bH as x,bN as R,bL as I,cF as O,cG as E,cH as _,cI as L,cJ as D,ch as A,b$ as B,bQ as N,bR as V,cK as j,c2 as U,bT as z,cL as F,cM as W,cN as G,bS as q,cl as H,cO as $,cP as J,cQ as K,cR as Y,cS as X,bG as Q,cT as Z,cU as ee,co as te,cV as ne,cW as ae,bU as oe,cX as ie,cY as re,cZ as se,c_ as ce,c$ as de,d0 as le,d1 as ue,d2 as pe,d3 as he,d4 as me,d5 as fe,d6 as ve,d7 as ye,d8 as ge,d9 as be,da as Ce,db as ke,dc as Se,dd as we,de as Pe,df as Me,dg as Te,dh as xe,di as Re,dj as Ie,dk as Oe,dl as Ee,dm as _e,dn as Le,dp as De,dq as Ae,bP as Be}from"./vendor-025cc855.js";import{P as Ne,N as Ve,Q as je,a as Ue,b as ze,c as Fe,d as We,e as Ge,f as qe,g as He,h as $e,R as Je,i as Ke,j as Ye,k as Xe,l as Qe,u as Ze,m as et,n as tt,o as nt,C as at,p as ot,q as it,r as rt,s as st,t as ct,v as dt,w as lt,x as ut,y as pt,z as ht,A as mt,B as ft,D as vt,E as yt,F as gt,G as bt,H as Ct,I as kt,J as St,K as wt,L as Pt,M as Mt,O as Tt}from"./vendor-quasar-942d8559.js";import{m as xt,f as Rt,u as It,a as Ot,V as Et,b as _t,c as Lt,d as Dt,e as At,g as Bt,h as Nt,i as Vt,j as jt,k as Ut,l as zt,n as Ft,o as Wt,p as Gt,q as qt,r as Ht}from"./vendor-vue-cesium-eb895b13.js";import{d as $t,s as Jt,c as Kt}from"./vendor-pinia-b8aee983.js";import{A as Yt,a as Xt}from"./vendor-axios-3b136b4f.js";import{l as Qt}from"./vendor-lodash-ec20ba63.js";import{L as Zt,l as en}from"./vendor-lowdb-043b11dd.js";import{i as tn}from"./vendor-interactjs-71f9a614.js";import"./vendor-echarts-dcd89e70.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const nn="VueCesiumDemo";function an(e="default",t=""){Ne.set(`${nn}-0.0.1-${e}`,t)}function on(e="default"){return Ne.getItem(`${nn}-0.0.1-${e}`)}function rn(e="default"){Ne.remove(`${nn}-0.0.1-${e}`)}const sn=[{path:"/",name:"layout",component:()=>n((()=>Promise.resolve().then((()=>bi))),void 0,import.meta.url),redirect:{path:"/home"},children:[{name:"login",path:"/login",component:()=>n((()=>Promise.resolve().then((()=>Mo))),void 0,import.meta.url)}]},{path:"/home",name:"home",component:()=>n((()=>Promise.resolve().then((()=>bi))),void 0,import.meta.url),children:[{name:"login",path:"/login",component:()=>n((()=>Promise.resolve().then((()=>Mo))),void 0,import.meta.url)}]},{path:"/create",name:"create",component:()=>n((()=>Promise.resolve().then((()=>bi))),void 0,import.meta.url),redirect:{path:"/create/tbd"},children:[{name:"login",path:"/login",component:()=>n((()=>Promise.resolve().then((()=>Mo))),void 0,import.meta.url)}]},{path:"/happiness",name:"happiness",component:()=>n((()=>Promise.resolve().then((()=>bi))),void 0,import.meta.url),redirect:{path:"/happiness/hsa"},children:[{name:"login",path:"/login",component:()=>n((()=>Promise.resolve().then((()=>Mo))),void 0,import.meta.url)}]},{path:"/auth/callback",name:"auth-callback",component:()=>n((()=>Promise.resolve().then((()=>oo))),void 0,import.meta.url)}],cn=[{path:"/:catchAll(.*)*",name:"404",component:()=>n((()=>Promise.resolve().then((()=>po))),void 0,import.meta.url)}],dn=[{name:"test-on-demand",path:"/test-on-demand",meta:{title:"ttt"},component:()=>n((()=>Promise.resolve().then((()=>xo))),void 0,import.meta.url)}],ln=sn,un=[...sn,...dn,...cn],pn="VueCesiumDemo",hn=((e="")=>function(...t){e&&(a(t[0])?t[0]=e.trim()+" "+t[0]:t=[e.trim(),...t]);const n=t.shift(),o=new Error(n);qi.system.useLogStore(Gi).push({message:"业务逻辑警告",type:"warning",meta:{error:o}}),Ve.create({message:n,timeout:3e3,type:"warning"})})(`[${pn}] WARN `),mn=((e="")=>function(...t){e&&(a(t[0])?t[0]=e.trim()+" "+t[0]:t=[e.trim(),...t]);const n=t.shift(),o=new Error(n);qi.system.useLogStore(Gi).push({message:"业务逻辑异常",type:"danger",meta:{error:o}}),Ve.create({message:n,timeout:3e3,type:"negative"})})(`[${pn}] ERR `),fn=((e="")=>function(...t){e&&(a(t[0])?t[0]=e.trim()+" "+t[0]:t=[e.trim(),...t])})(`[${pn}] Debug `);function vn(e,t,n){return Cn(e,t.geometry.coordinates,n,t)}function yn(e,t,n){const a=[],o=t.geometry.coordinates;for(let i=0;i<o.length;i++)a.push(Cn(e,o[i],n,t));return a}function gn(e,t,n){return kn(e,t.geometry.coordinates,n,t)}function bn(e,t,n,a){var i;const r=!Cesium.defined(a.properties.checked)||o(a.properties,"checked");a.properties.actualRenderingType=n;const s={id:Cesium.createGuid(),position:t,show:r,feature:Qt.cloneDeep(a)};if(s[n]={...e[n]},"model"===n){const e=JSON.parse((null==(i=a.properties)?void 0:i.hpr)||"{}");if(Array.isArray(e)){const n=xt(t),a=new Cesium.HeadingPitchRoll(...e);s.orientation=Cesium.Transforms.headingPitchRollQuaternion(n,a)}}return s}function Cn(e,t,n,a){const c=o(a.properties,"checked");if(a.properties.actualRenderingType=n,"polygon"===n){return gn(e,i(a),n)}if("billboard"===n||"point"===n||"label"===n){const t={show:c,position:("MultiPolygon"===a.geometry.type?r(a):s(a)).geometry.coordinates,feature:Qt.cloneDeep(a)};switch(n){case"billboard":t.billboard={...e.billboard};break;case"point":t.point={...e.point};break;case"label":t.label={text:a.properties.text||a.properties.name,...e.label}}return t}return{show:c,polyline:{positions:t,...e.polyline},feature:Qt.cloneDeep(a)}}function kn(e,t,n,a){const i=o(a.properties,"checked");if(a.properties.actualRenderingType=n,"polyline"===n){if("MultiPolygon"===a.geometry.type){const t=c(a),o=[];return t.features.forEach((t=>{"LineString"===t.geometry.type?o.push(vn(e,t,n)):o.push(...yn(e,t,n))})),o}if("Polygon"===a.geometry.type){const t=c(a);return vn(e,t,n)}}else{if("polygon"===n){const n=[];for(let e=1;e<t.length;e++)n.push({positions:t[e]});return{show:i,polygon:{height:0,hierarchy:{positions:t[0],holes:n},...e.polygon},feature:Qt.cloneDeep(a)}}if("billboard"===n||"point"===n||"label"===n){const t={show:i,position:("MultiPolygon"===a.geometry.type?r(a):s(a)).geometry.coordinates,feature:Qt.cloneDeep(a)};switch(n){case"billboard":t.billboard={...e.billboard};break;case"point":t.point={...e.point};break;case"label":t.label={text:a.properties.text||a.properties.name,...e.label}}return t}}}const Sn={LineString:vn,MultiLineString:yn,MultiPoint:function(e,t,n){const a=[],o=t.geometry.coordinates;for(let i=0;i<o.length;i++)a.push(bn(e,o[i],n,t));return a},MultiPolygon:function(e,t,n){const a=[],o=t.geometry.coordinates;for(let i=0;i<o.length;i++){const r=kn(e,o[i],n,t),s=Array.isArray(r)?r:[r];a.push(...s)}return a},Point:function(e,t,n){return bn(e,t.geometry.coordinates,n,t)},Polygon:gn};function wn(e){qi.viewer.useRenderStore(Gi).addRenderDatas(e)}function Pn(e){qi.viewer.useRenderStore(Gi).removeRenderDataById(e)}function Mn(e){return qi.viewer.useRenderStore(Gi).getRenderDataByDatasetId(e)}function Tn(e,t){qi.viewer.useRenderStore(Gi).setSelectedRenderData(e,t)}function xn(e,t,n,a=[],o){!function(){var e;const t=qi.viewer.useRenderStore(Gi).selectedRenderData;t.model&&(null==(e=null==t?void 0:t.restoreHandlers)?void 0:e.length)&&t.restoreHandlers.forEach((e=>{e()})),Tn({model:void 0,renderingType:void 0,restoreHandlers:[],feature:void 0,featureInfoListItems:[]},!0)}();const i=e.trim().split(",");i&&i.length||hn("高亮渲染模型失败，原因：未知的显示类型。","要素ID：",n.properties.id),i.forEach((e=>{var i;const r=Rn(e,Mn(t),n.properties.id);if(!r)return void Tn({model:null,renderingType:e,restoreHandlers:[()=>{}],feature:n,featureInfoListItems:a});const s=null==(i=r.feature.properties)?void 0:i.selectedProps,c=s&&l(s)?s:s?JSON.parse(s):{},d="primitive"===o?r:r[e],u=null==c?void 0:c[e];if(u){let t={};Object.keys(u).forEach((e=>{t[e]=d[e],d[e]=u[e]})),Tn({model:d,renderingType:e,restoreHandlers:[()=>{Object.keys(t).forEach((e=>{d[e]=t[e]})),t=void 0}],feature:r.feature,featureInfoListItems:a})}else hn("设置对象选中风格失败，原因：没有设置默认选中样式。请通过数据集或者要素的 selectedProps 字段设置。")}))}function Rn(e,t,n,a){let o,i,r;if(o=l(t)?t:Mn(t),!o)return;switch(e){case"label":case"point":case"billboard":case"model":i="primitive"===a?"VcCollectionBillboard":"VcDatasourceCustom",r="primitive"===a?"billboards":"entities";break;case"polyline":i="primitive"===a?"VcCollectionPolyline":"VcDatasourceCustom",r="primitive"===a?"polylines":"entities";break;case"polygon":i="primitive"===a?"VcCollectionPrimitive":"VcDatasourceCustom",r="primitive"===a?"polygons":"entities";break;case"geojson":i="VcDatasourceGeojson",r="data";break;case"tileset":i="VcPrimitiveTileset";break;case"imagery":i="VcLayerImagery"}const s=Qt.find(o.datasets,(e=>e.cmpName===i));if("geojson"===e)return s;if(Cesium.defined(s)){if("geojson"===e)return s;return Qt.find(s.props[r],(t=>t.feature.properties.id===n&&t.feature.properties.actualRenderingType===e))}}function In(e,t){const n=[];if(!Cesium.defined(e.geometry))return hn("feature.geometry is required.","要素：",e),"添加渲染模型失败，原因：该要素没有 geometry 属性";const a=Object.keys(t);if(!a||!a.length)return hn("添加渲染模型失败，原因：未知的显示类型。","要素：",e),"添加渲染模型失败，原因：未知的显示类型。";const o=e.geometry.type,i=Sn[o];return Cesium.defined(i)?(a.forEach((a=>{const o=i(t,e,a),r=Array.isArray(o)?o:[o];n.push(...r)})),n):(hn(`添加渲染模型失败，原因：该几何类型${o}没有找到处理方法。`,"要素：",e),`添加渲染模型失败，原因：该几何类型${o}没有找到处理方法。`)}async function On(e,t,n,a,o,i,r,s){const c={id:o,page:i,type:r,datasets:[]},d=await async function(e,t,n,a,o){"string"==typeof e&&(e=await Cesium.Resource.fetchJson({url:e}));if(!Cesium.defined(e))return void mn("添加数据源失败，原因：GeoJSON 数据格式不正确。",e);const i=[],r=e.type,s=e=>{e.properties.renderingType=e.properties.renderingType||t,Cesium.defined(e.properties.id)||(e.properties.id=Cesium.createGuid()),e.properties.datasetId=o,e.properties.selectedProps=e.properties.selectedProps||a||{}};switch(r){case"FeatureCollection":e.features.forEach((e=>{s(e);const t=In(e,n);t.length&&i.push(...t)}));break;case"Feature":{const t=e;s(t);const a=In(t,n);a.length&&i.push(...a)}}return i}(e,t,n,a,o);return d.length&&c.datasets.push({cmpName:"VcDatasourceCustom",props:{entities:d,...s,onReady:e=>{var t;const{cesiumObject:n}=e,a=`VcDatasourceCustom_${c.id}`;n.datasetId=a,null==(t=null==s?void 0:s.onReady)||t.call(s,e)}}}),wn(c),Promise.resolve(c)}function En(e,t){let n=[];return t().then((t=>{var a,o;if(0!==t.code)return mn(`添加渲染数据集失败，原因：数据请求失败。数据集id: ${e.id}，数据集名称: ${e.name}`),!1;if(!t.data)return mn(`添加渲染数据集失败，原因：未知的 GeoJSON 类型。数据集id: ${e.id}，数据集名称: ${e.name}`),!1;if(null==(a=t.data)?void 0:a.type){switch(null==(o=t.data)?void 0:o.type){case"Feature":n=[t.data];break;case"FeatureCollection":n=t.data.features,n.forEach((t=>{Cesium.defined(t.properties.renderingType)||(t.properties.renderingType=e.renderingType||"billboard"),Cesium.defined(t.properties.id)||(t.properties.id=Cesium.createGuid()),Cesium.defined(t.properties.checked)||(t.properties.checked=!1)}));break;default:return mn(`添加渲染数据集失败，原因：未知的 GeoJSON 类型。数据集id: ${e.id}，数据集名称: ${e.name}`),!1}}return n.length?n:(mn(`添加渲染数据集失败，原因：请求数据成功，但结果为空。数据集id: ${e.id}，数据集名称: ${e.name}`),!1)})).catch((e=>(mn("添加渲染数据集失败，原因：数据请求异常。",e),!1)))}function _n(e,t,n,a,o){var i;if(null==(i=e.children)?void 0:i.length)return Promise.resolve(Ln(e,n,a,o));try{return En(e,t).then((t=>{if(Array.isArray(t))return e.children=t,Ln(e,n,a,o)}))}catch(r){return void mn(`添加渲染数据集失败，原因：数据请求发生错误。数据集id: ${e.id}，数据集名称: ${e.name}`,"数据模型：",e)}}const Ln=(e,t,n,a)=>new Promise(((i,r)=>{var s,c,p,h,m,f,v,y,g,b,C,k;e.cesiumObjects=e.cesiumObjects||[];const S={id:e.id,name:e.name,page:t,type:n,datasets:[]};let w=[];for(let u=0;u<(null==(s=null==e?void 0:e.children)?void 0:s.length);u++){const r=e.children[u];if(d(r,"type")&&d(r,"properties")){const t=r,n=t.properties;n.datasetId=t.properties.datasetId||e.id,n.datasetName=t.properties.datasetName||e.name,n.selectedProps=t.properties.selectedProps||e.selectedProps||{};const a=e.props&&l(null==e?void 0:e.props)?null==e?void 0:e.props:e.props?JSON.parse(null==e?void 0:e.props):{},s=(null==(c=t.properties)?void 0:c.props)&&l(null==(p=t.properties)?void 0:p.props)?null==(h=t.properties)?void 0:h.props:t.properties.props?JSON.parse(null==(m=t.properties)?void 0:m.props):{},d=Object.assign({},a,s);if("geojson"===e.renderingType){const n=Object.assign({},d[e.renderingType],null==(v=null==(f=t.properties)?void 0:f.props)?void 0:v[e.renderingType]);t.properties.actualRenderingType=e.renderingType,S.datasets.push({cmpName:"VcDatasourceGeojson",props:{...n,show:o(t.properties,"checked"),onReady:e=>{i(e)}},feature:t})}else if("tileset"===e.renderingType){const n=Object.assign({},d[e.renderingType],null==(g=null==(y=t.properties)?void 0:y.props)?void 0:g[e.renderingType]);t.properties.actualRenderingType=e.renderingType,S.datasets.push({cmpName:"VcPrimitiveTileset",props:{...n,show:o(t.properties,"checked"),onReady:e=>{i(e)}},feature:t})}else if("imagery"===e.renderingType){const n=Object.assign({},d[e.renderingType],null==(C=null==(b=t.properties)?void 0:b.props)?void 0:C[e.renderingType]);t.properties.actualRenderingType=e.renderingType;const a=n.children;delete n.children,S.datasets.push({cmpName:"VcLayerImagery",props:{...n,show:o(t.properties,"checked"),onReady:e=>{i(e)}},feature:t,children:[{cmpName:a[0].cmpName,props:{...a[0].props}}]})}else{const e=In(t,d);if("string"==typeof e)continue;const n=Qt.intersectionWith(e,w,((e,t)=>e.feature.properties.id===t.feature.properties.id&&e.feature.geometry.type===t.feature.geometry.type));w.push(...e),n.length&&(n.forEach((e=>{hn(`已添加相同id和类型的渲染数据集，可能有重复数据，请核实。对象 id: ${e.feature.properties.id}，对象类型: ${e.feature.geometry.type}`,"数据模型：",e)})),w=Qt.uniqWith(w,((e,t)=>e.feature.properties.id===t.feature.properties.id&&e.feature.geometry.type===t.feature.geometry.type)))}}else{const e=r;(null==(k=null==e?void 0:e.children)?void 0:k.length)?i(Ln(e,t,n,a)):i(!1)}}w.length&&S.datasets.push({cmpName:"VcDatasourceCustom",props:{...a,entities:w,onReady:t=>{var n;const{cesiumObject:o}=t,r=`VcDatasourceCustom_${e.id}`;o.datasetId=r;!Qt.find(e.cesiumObjects,(e=>e.datasetId===r))&&e.cesiumObjects.push(u(o)),null==(n=null==a?void 0:a.onReady)||n.call(a,t),i(t)}}}),wn(S)}));function Dn(e){return e.map((e=>({...e,path:e.path||Qt.uniqueId("vc-menu-empty-"),...e.children?{children:Dn(e.children)}:{}})))}function An(e={},t="",n=0){return[200,{code:n,msg:t,data:e}]}function Bn(e){qi.system.useLogStore(Gi).push({message:"数据请求异常",type:"danger",meta:{error:e}}),Ve.create({message:e.message,type:"negative",timeout:3e3})}function Nn(e){const t=new Error(e);throw Bn(t),t}const Vn=Object.freeze(Object.defineProperty({__proto__:null,errorCreate:Nn,errorLog:Bn,parse:function(e="{}",t={}){let n=t;try{n=JSON.parse(e)}catch(a){mn(a)}return n},response:An,responseError:function(e={},t="请求失败",n=500){return An(e,t,n)},responseSuccess:function(e={},t="成功"){return An(e,t)}},Symbol.toStringTag,{value:"Module"})),jn=()=>{const e=Xt.create({});return e.interceptors.request.use((e=>e),(e=>(Bn(e),Promise.reject(e)))),e.interceptors.response.use((e=>{const t=e.data,{code:n}=t;if(void 0===n)return t;switch(n){case 0:case 200:return t;case"xxx":Nn(`[ code: xxx ] ${t.msg}: ${e.config.url}`);break;default:return Nn(`${t.msg}: ${e.config.url}`),Promise.reject(t)}}),(e=>{switch(Qt.get(e,"response.status")){case 400:e.message="请求错误";break;case 401:e.message="未授权，请登录",rn("token"),rn("uuid"),ta.push("/login");break;case 403:e.message="拒绝访问";break;case 404:e.message=`请求地址出错: ${e.response.config.url}`;break;case 408:e.message="请求超时";break;case 500:e.message="服务器内部错误";break;case 501:e.message="服务未实现";break;case 502:e.message="网关错误";break;case 503:e.message="服务不可用";break;case 504:e.message="网关超时";break;case 505:e.message="HTTP版本不受支持"}return Bn(e),Promise.reject(e)})),e};function Un(e){return function(t){const n=on("token"),a={headers:{Authorization:n,"Content-Type":Qt.get(t,"headers.Content-Type","application/json")},timeout:2e4,baseURL:e.baseURL||"/",data:{}};return n&&(a.headers.Authorization="Bearer "+n),e(Object.assign(a,t))}}const zn=jn(),Fn=Un(zn),Wn=jn(),Gn=Un(Wn),qn=new Yt(Wn),Hn=[{username:"admin",password:"admin",id:"admin-uuid",name:"Admin"},{username:"editor",password:"editor",id:"editor-uuid",name:"Editor"},{username:"henry",password:"henry",id:"henry-uuid",name:"Henry"},{username:"sam",password:"sam",id:"sam-uuid",name:"Sam"},{username:"mark",password:"mark",id:"mark-uuid",name:"Mark"}],$n=[{id:p(),component:"MainLayout",icon:"cog",islock:!1,hidden:!1,name:"layout",path:"/",sort:1e3,title:"GlobalVillage",type:10,children:[{id:p(),component:"/home",icon:"cog",islock:!1,hidden:!1,name:"home",path:"/home",sort:1e3,caption:"Home",title:"message.header.index",type:10,children:[{id:p(),component:"",icon:"eye",islock:!1,hidden:!1,name:"left-panel",path:"",sort:100101,title:"查看左侧面板",type:20}]},{id:p(),component:"/create",icon:"cog",islock:!1,hidden:!1,name:"create",path:"/create",sort:1e3,caption:"Create",title:"message.header.create",type:10,redirect:"/create/tbd",children:[{id:p(),component:"/create/tbd",icon:"holiday_village",islock:!1,hidden:!1,name:"tbd",path:"/create/tbd",sort:1e3,caption:"ComingSoon",title:"message.sideBar.create.tbd",type:10}]},{id:p(),component:"/happiness",icon:"cog",islock:!1,hidden:!1,name:"happiness",path:"/happiness",sort:1e3,caption:"Happiness",title:"message.header.happiness",type:10,redirect:"/happiness/hsa",children:[{id:p(),component:"/happiness/hsa",icon:"sentiment_very_satisfied",islock:!1,hidden:!1,name:"hsa",path:"/happiness/hsa",href:"https://www.happinessstudies.academy",target:"_blank",sort:1e3,caption:"HappinessStudiesAcademy",title:"message.sideBar.happiness.hsa",type:10}]}]}],Jn=[{id:p(),name:"DataSource",label:"数据源",icon:"",children:[{id:p(),name:"机场",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/机场.json",renderingType:"billboard",lazy:!0,props:{billboard:{image:"./images/飞机场.svg",color:"#ffc10",scale:.25,verticalOrigin:1,scaleByDistance:[100,2,15e4,.5],distanceDisplayCondition:[0,3e7]}},selectedProps:{billboard:{color:"red",scale:1}}},{id:p(),name:"摄像头",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/视频点.json",renderingType:"billboard",lazy:!0,props:{billboard:{image:"./images/video.svg",color:"#ffc10",scale:.25,verticalOrigin:1,scaleByDistance:[100,2,15e4,.5],distanceDisplayCondition:[0,3e7]}},selectedProps:{billboard:{color:"red",scale:1}},children:[{type:"Feature",geometry:{type:"MultiPoint",coordinates:[[108.253394,29.730675]]},properties:{name:"摄像头点位1",pyname:"hstxgjjc",kind:"8100",id:p(),checked:!0}}]},{id:p(),name:"水系",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/水系.json",renderingType:"polyline",lazy:!0,props:{polyline:{width:1}},selectedProps:{polyline:{width:2,material:"#ffc107"}}},{id:p(),name:"岛屿",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/岛屿.json",renderingType:"polygon,polyline,billboard",lazy:!0,props:{billboard:{image:"./images/岛屿.svg",scale:.2,verticalOrigin:1,scaleByDistance:[100,2,15e4,.5],distanceDisplayCondition:[0,3e6]},polygon:{material:"rgba(137,207,240,0.5)"},polyline:{width:4,material:"#0033ff"}},selectedProps:{billboard:{scale:.5},polygon:{material:"#ffc107"},polyline:{width:8,material:"red"}}},{id:p(),name:"模型",icon:"",checked:!1,expanded:!1,renderingType:"model",children:[{id:p(),name:"Tileset 模型",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/Tileset模型.json",lazy:!0,renderingType:"tileset",props:{tileset:{}}},{id:p(),name:"GLTF 模型",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/GLTF模型.json",lazy:!0,renderingType:"model",props:{model:{scale:1}},selectedProps:{model:{color:"red"}}},{id:p(),name:"模型嵌套",icon:"",checked:!1,expanded:!1,renderingType:"model",children:[{id:p(),name:"GLTF 模型",icon:"",checked:!1,expanded:!1,lazy:!0,fetchStr:"/datas/work-bench/GLTF模型.json",renderingType:"model",props:{model:{scale:1}}},{type:"Feature",properties:{id:p(),name:"飞机",hpr:"[135, 0, 0]",renderingType:"model",checked:!0,props:{model:{uri:"../datas/gltf/Cesium_Air.glb"}},selectedProps:{model:{color:"red"}}},geometry:{coordinates:[121.25202608700887,32.14045397527647],type:"Point"}}]}]},{id:p(),name:"图层",icon:"",checked:!1,expanded:!1,renderingType:"imagery",children:[{id:p(),name:"图层嵌套",icon:"",checked:!1,expanded:!1,fetchStr:"/datas/work-bench/图层.json",lazy:!0,renderingType:"imagery",props:{imagery:{}}},{type:"Feature",properties:{id:p(),checked:!1,name:"WMS",props:{imagery:{alpha:1,brightness:1,contrast:1,sortOrder:60,children:[{cmpName:"VcImageryProviderWms",props:{url:"https://nationalmap.gov.au/proxy/http://geoserver.nationalmap.nicta.com.au/geotopo_250k/ows",layers:"Hydrography:bores",parameters:{format:"image/png",transparent:!0},rectangle:[112,-43,154,-10]}}]}}},geometry:{coordinates:[108.965836,34.225607],type:"Point"}}]},{id:p(),name:"GeoJSON",icon:"",checked:!1,expanded:!1,renderingType:"geojson",children:[{type:"Feature",properties:{id:p(),checked:!1,name:"水系",props:{geojson:{strokeWidth:5,stroke:"#ffc107",fill:"transparent",show:!1,data:"./datas/work-bench/水系.json"}}},geometry:{coordinates:[108.965836,34.225607],type:"Point"}}]}]}],Kn={service:zn,request:Fn,serviceForMock:Wn,requestForMock:Gn,mock:qn,tools:Vn},Yn=(({service:e,request:t,serviceForMock:n,requestForMock:a,mock:o,tools:i})=>({login:e=>(o.onAny("/auth/login").reply((e=>{const t=i.parse(e.data),n=Qt.find(Hn,{username:t.username,password:t.password});return n?i.responseSuccess(Qt.assign({},n,{token:"f5befe1a-962c-4cdd-bf45-77ce306dbbce"})):i.responseError({},"Wrong Account or Password!")})),a({url:"/auth/login",method:"post",data:e})),getUserInfo:()=>(o.onAny("/user/info").reply((e=>{const t=on("uuid"),n=Qt.find(Hn,{id:t});return n?i.responseSuccess(Qt.assign({},n)):(rn("token"),rn("uuid"),ta.push("/login"),i.responseError({},"Please Login!"))})),a({url:"/user/info",method:"post"})),getAccessibleMenus:(e={})=>(o.onAny("/api/menu/accessible").reply((e=>i.responseSuccess($n))),a({url:"/api/menu/accessible",method:"post",data:e}))}))(Kn),Xn=(({service:e,request:t,serviceForMock:n,requestForMock:a,mock:o,tools:i})=>({getStaticData:(e,n)=>t({baseURL:n=n||"./",url:e,method:"get"}).then((e=>({code:0,data:e,msg:"success"}))),inverseGeocode:e=>t({baseURL:"./",url:"/reverse_geocoding/v3",method:"get",params:e}),getLocationList:e=>t({baseURL:"./",url:"/v3/place/text",method:"get",params:e})}))(Kn),Qn=(({service:e,request:t,serviceForMock:n,requestForMock:a,mock:o,tools:i})=>({getTreeData:()=>(o.onAny("/dynamic-render/recursive-list/datatree").reply((e=>i.responseSuccess(Jn))),a({url:"/dynamic-render/recursive-list/datatree",method:"post"})),inverseGeocode:e=>t({baseURL:"./",url:"/reverse_geocoding/v3",method:"get",params:e})}))(Kn),Zn={"zh-CN":{message:{header:{index:"家园",dynamicRender:"创造",happiness:"幸福",create:"创造"},sideBar:{dynamicRender:{recursiveList:"递归列表",stack:"堆叠展示",historicalTrack:"历史轨迹"},expansion:{typhoon:"台风"},other:{tsx:"TSX",issue:"问题反馈"}},panel:{layerManager:"图层管理",videoPlayer:"视频播放"},baseLayer:"底图图层",overlayLayer:"叠加图层",terrainLayer:"地形图层"}},"en-US":{message:{header:{index:"Home",dynamicRender:"Create",happiness:"Happiness",create:"Create"},sideBar:{dynamicRender:{recursiveList:"RecursiveList",stack:"StackView",historicalTrack:"HistoricalTrack"},happiness:{hsa:"HappinessStudiesAcademy"},create:{tbd:"ComingSoon"},other:{tsx:"TSX",issue:"BugReport"}},panel:{layerManager:"LayerManager",videoPlayer:"VideoPlayer"},baseLayer:"BaseLayer",overlayLayer:"OverlayLayer",terrainLayer:"TerrainLayer"}}},ea=h({legacy:!1,locale:on("locale")||"en-US",fallbackLocale:"en-US",globalInjection:!0,messages:Zn}),ta=m({scrollBehavior:()=>({left:0,top:0}),routes:un,history:({}.SERVER?v:y)("/")}),na=["/login","/404","/auth/callback"];ta.beforeEach((async(e,t,n)=>{f.start(),qi.system.useSearchStore(Gi).set(!1);if(on("token"))try{if(!qi.system.usePermissionStore(Gi).inited){const t=[...(await Yn.getAccessibleMenus()).data];return await qi.system.usePermissionStore(Gi).generateRoutes({menuTree:t}),void n(e.path)}"/login"===e.path?n({path:"/home"}):n()}catch(a){-1!==na.indexOf(e.path)?n():n("/login")}else-1!==na.indexOf(e.path)?n():n("/login")})),ta.afterEach((e=>{var t;f.done(),t=ea.global.t(e.meta.title),window.document.title="Global Village"+(t?` | ${t}`:"")}));const aa=en(new Zt("VueCesiumDemo-0.0.1"));function oa({dbName:e="database",path:t="",user:n=!0,validator:a=e=>!0,defaultValue:o=""}){const i=on("uuid")||"ghost-uuid",r=`${e}.${n?`user.${i}`:"public"}${t?`.${t}`:""}`,s=aa.get(r).value();return void 0!==s&&a(s)||aa.set(r,o).write(),r}function ia({dbName:e="database",path:t="",user:n=!1,validator:a=()=>!0,defaultValue:o=""}={}){return aa.get(oa({dbName:e,path:t,user:n,validator:a,defaultValue:o}))}aa.defaults({sys:{},database:{}}).write();const ra=$t("db",{state:()=>({}),getters:{},actions:{set({dbName:e="database",path:t="",value:n="",user:a=!1}){!function({dbName:e="database",path:t="",value:n="",user:a=!1}){aa.set(oa({dbName:e,path:t,user:a}),n).write()}({dbName:e,path:t,value:n,user:a})},get:({dbName:e="database",path:t="",defaultValue:n="",user:a=!1})=>function({dbName:e="database",path:t="",defaultValue:n="",user:a=!1}){return Qt.cloneDeep(aa.get(oa({dbName:e,path:t,user:a,defaultValue:n})).value())}({dbName:e,path:t,defaultValue:n,user:a}),database:({user:e=!1}={})=>ia({user:e,defaultValue:""}),databaseClear:({user:e=!1}={})=>ia({user:e,validator:()=>!0,defaultValue:""})}}),sa=$t("user",{state:()=>({info:{}}),getters:{},actions:{async set(e){this.info=e;ra().set({dbName:"sys",path:"user.info",value:e,user:!0})},async load(){const e=ra().get({dbName:"sys",path:"user.info",defaultValue:"",user:!0});this.set(e)}}}),ca=g({name:"VcDemoPageExpansion",__name:"Index",setup:e=>(e,t)=>{const n=b("router-view");return C(),k(n)}}),da=Object.freeze(Object.defineProperty({__proto__:null,default:ca},Symbol.toStringTag,{value:"Module"})),la=(e,t)=>{const n=e.__vccOpts||e;for(const[a,o]of t)n[a]=o;return n};const ua=la({},[["render",function(e,t){return C(),S("div")}]]),pa=Object.freeze(Object.defineProperty({__proto__:null,default:ua},Symbol.toStringTag,{value:"Module"})),ha=g({name:"VcDemoPageDynamicRender",__name:"Index",setup:e=>(e,t)=>{const n=b("router-view");return C(),k(n)}}),ma=Object.freeze(Object.defineProperty({__proto__:null,default:ha},Symbol.toStringTag,{value:"Module"})),fa={class:"page-demo-dynamic-overlay absolute z-fab"},va=g({__name:"Index",setup(e){const{loadDefaultLayers:t}=qi.viewer.useLayerStore(),n=w(null),a=w(!1),i=w(null),r=w(null),s=w(null);P((()=>{t(!0),Xn.getStaticData("/datas/dynamic-overlay.json").then((e=>{c([e.data])}))})),M((()=>{var e;e="/dynamic-render/historical-track",qi.viewer.useRenderStore(Gi).removeRenderDataByPage(e)}));const c=async e=>{if(await Mn("DynamicOverlay"));else{const t={id:"DynamicOverlay",name:"历史轨迹",page:"/dynamic-render/historical-track",datasets:[]},{overlays:o,stops:c}=d(e),u={show:!0,dynamicOverlays:o};t.datasets.push({cmpName:"VcOverlayDynamic",props:{shouldAnimate:a,"onUpdate:shouldAnimate":e=>{a.value=e},currentTime:i,startTime:r,stopTime:s,multiplier:1e3,onReady:e=>{n.value=e.vm,l(202106)},...u}}),t.datasets.push({cmpName:"VcCollectionPoint",props:{points:c}}),wn(t)}},d=e=>{const t=[],n=[];return e.forEach((e=>{const a=[],i=[],r=o(e,"checked");e.stops.forEach((e=>{a.push({position:[e.lon,e.lat],time:e.DATE_TIME,id:p()}),i.push([e.lon,e.lat]),n.push({id:p(),position:[e.lon,e.lat],color:"rgb(255,229,0)",show:r,...e,distanceDisplayCondition:[0,5e6],scaleByDistance:[100,2,25e5,.5],onMouseover:e=>{},onMouseout:e=>{}})})),t.push({id:String(e.TYPHOON_ID),show:r,maxCacheSize:e.stops.length,polyline:{positions:i,width:3,material:e.TYPHOON_CODE?"#2d8cf0":"#69B273",depthFailMaterial:e.TYPHOON_CODE?"#2d8cf0":"#69B273",clampToGround:!0},sampledPositions:a})})),{overlays:t,stops:n}},l=e=>{const t=Mn("DynamicOverlay");if(t){t.datasets[0].cmpRef.zoomToOverlay(String(e))}else mn("定位到该对象失败，原因：还未添加。")};return(e,t)=>(C(),S("div",fa))}}),ya=Object.freeze(Object.defineProperty({__proto__:null,default:va},Symbol.toStringTag,{value:"Module"}));function ga(){const e=T(),t=It(),{toggleGlobalLayout:n,toggleDynamicRenderPageLayout:a}=qi.system.useLayoutStore(),o=x({selectedId:"",datasourceCategories:[],loading:!1,hasLoadingError:!1,filterText:"",selectedKey:""}),i=qi.system.useLayoutStore().dynamicRender,r=R((()=>{let e=[];try{null==o||o.datasourceCategories.forEach((t=>{if(t.id===o.selectedId)throw e=t.children,new Error("endForEach")}))}catch(t){if("endForEach"!==t.message)throw t}return e}));t.vm.vcMitt.on("pickEvt",(e=>{o.selectedKey=e}));const s=()=>{o.datasourceCategories.forEach((e=>{var t;null==(t=null==e?void 0:e.children)||t.forEach((e=>{const t=e;(null==t?void 0:t.children)&&c(!0,t)}))}))},c=(t,n,a,o)=>{var i;const r={onReady:e=>{}};if(d(n,"type")&&d(n,"properties")){const o=n;!0===t&&(Cesium.defined(o.properties.datasetId)||Pn(null==a?void 0:a.id),I((()=>{if(Mn(o.properties.datasetId));else{if(!a)return void mn("添加渲染数据集失败，原因：要素节点不能作为顶节点，请将其放到数据集节点下。","数据模型：",n);if(null==a?void 0:a.renderingType){const t=()=>Xn.getStaticData(a.fetchStr);a.loading=!0,_n(a,t,e.path,"recursive-list",r).finally((()=>{a.loading=!1}))}else""!==a.renderingType&&mn("添加渲染数据集失败，原因：未知的显示类型。","数据模型：",a)}})))}else{const a=n;if(!0===t){if(Mn(a.id));else if(a.renderingType){const t=()=>Xn.getStaticData(a.fetchStr);a.loading=!0,_n(a,t,e.path,"recursive-list",r).finally((()=>{a.loading=!1}))}else""!==a.renderingType&&mn("添加渲染数据集失败，原因：未知的显示类型。","数据模型：",a)}else Pn(a.id),null==(i=null==a?void 0:a.children)||i.forEach((e=>{c(t,e,a)}))}};return{workBenchModel:o,dynamicRenderLayout:i,selectedDatasetCategories:r,init:()=>{o.loading=!0,(async()=>(o.hasLoadingError=!1,Qn.getTreeData().then((e=>{if(e.code)return;const t=e.data;return o.selectedId=t[0].id,o.datasourceCategories=t,s(),!0})).catch((e=>{o.hasLoadingError=!0}))))().then((()=>{o.loading=!1,n({navigation:!0}),a({datasource:{workBench:!0}})}))},showFeatureInfo:(e,t)=>{!function(e,t){const{toggleGlobalLayout:n}=qi.system.useLayoutStore(Gi);"摄像头"===e.properties.datasetName&&n({videoPlayer:!0}),n({featureInfo:!0});const a=Object.keys(e.properties).map((t=>({label:t,value:e.properties[t]})));if(t)Tn({...t,restoreHandlers:[],featureInfoListItems:a});else{if(!Rn(e.properties.renderingType,e.properties.datasetId,e.properties.id))return void Tn({...t,restoreHandlers:[],featureInfoListItems:a});xn(e.properties.renderingType,e.properties.datasetId,e,a)}}(t)},flyToFeature:(e,n,a)=>{t.vm.vcMitt.emit("pickEvt",n.properties.id),async function(e,t,n={isHighlightRenderData:!0,showBillboardOverlayMenu:!0,duration:1.5}){var a,o,i,r,s;const c=(null==(a=null==t?void 0:t.properties)?void 0:a.actualRenderingType)||(null==(o=null==t?void 0:t.properties)?void 0:o.renderingType);if(!c)return void mn("定位到要素失败，原因：未知的显示类型。","要素模型：",t);const d=t.properties.datasetId,l=await Mn(d);if(!l)return void mn("定位到要素失败，原因：未找到该要素所在的渲染数据。","要素模型：",t);const u=t.properties.id;if(n.isHighlightRenderData&&xn(c,d,t),t.properties.vcCamera)return void Rt(e,t.properties.vcCamera);const{toggleGlobalLayout:p}=qi.system.useLayoutStore(Gi);switch(c){case"billboard":case"point":case"label":case"polyline":case"polygon":case"model":if(p({featureInfo:!1}),null==(i=null==l?void 0:l.datasets)?void 0:i.length){const t=(null==(r=l.datasets[0].cmpRef)?void 0:r.cesiumObject).entities.values.find((e=>e.feature.properties.id===u));e.flyTo(t,{...n}).then((()=>{}))}break;default:if(p({featureInfo:!1}),null==(s=null==l?void 0:l.datasets)?void 0:s.length){const a=l.datasets.find((e=>e.feature.properties.id===t.properties.id)).cmpRef.cesiumObject;e.flyTo(a,{...n}).then((()=>{}))}}}(t.viewer,n)},onLazyLoad:e=>{const t=e.dataset;if(e.key.indexOf("Lazy load empty")>-1)return void e.done([]);t.loading=!0,En(t,(()=>Xn.getStaticData(t.fetchStr))).then((async n=>{var a;n?e.done(n):e.fail();if(!(await Mn(t.id))){const e=null==(a=t.children)?void 0:a.filter((e=>e.properties.checked));e&&e.length>0&&c(!0,t)}t.loading=!1}))},addOrRemoveDataset:c,toggleDynamicRenderPageLayout:a}}const ba={class:"loading-ios flex column justify-center items-center z-top"},Ca={key:2},ka={key:0,class:"q-pt-md"},Sa=g({__name:"Ios",props:{size:{type:String,default:"3em"},dense:{type:Boolean,default:!1},hasError:{type:Boolean,default:!1},errorMsg:{type:String,default:""},errorTip:{type:String,default:"数据加载失败，点我重试"},tipText:{type:String,default:"加载中..."}},emits:["retry"],setup(e,{emit:t}){const n=t,a=()=>{n("retry")};return(t,n)=>(C(),S("div",ba,[e.hasError?(C(),k(ze,{key:1,icon:"error",size:e.size,color:"red",round:"",flat:"",dense:""},{default:O((()=>[E(Ue,null,{default:O((()=>[_("加载失败，原因："+L(e.errorMsg),1)])),_:1})])),_:1},8,["size"])):(C(),k(je,{key:0,size:e.size},null,8,["size"])),e.dense?A("",!0):(C(),S("div",Ca,[e.hasError?(C(),k(Fe,{key:1,clickable:"",color:"red","text-color":"white",icon:"error",onClick:a},{default:O((()=>[_(L(e.errorTip),1)])),_:1})):(C(),S("div",ka,[D("span",null,L(e.tipText),1)]))]))]))}}),wa=g({name:"VcDataTreeGeojson",props:{dense:Boolean,nodes:{type:Array,default:()=>[]},filter:String,tickStrategy:{type:String,default:"leaf-filtered"},selectedColor:String,selected:String},emits:{checked:(e,t,n,a)=>!0,"lazy-load":e=>!0,"update:selected":(e,t,n)=>!0,zoomIconClicked:(e,t,n)=>!0},setup(e,t){const n=w({});let a={};B((()=>{a={}}));const o=R((()=>void 0!==e.selected)),i=R((()=>(e,t)=>{const n=t.toLowerCase();return(e.name||e.properties.name).toLowerCase().indexOf(n)>-1})),r=R((()=>{const t={},a=(r,s,c)=>{const l=c?c.tickStrategy:e.tickStrategy;let u,p,h,m,f,v,y,g,b,C,k;if(d(r,"type")&&d(r,"properties")){const e=r;u=e.properties.id,p=!1,h=!1,m=e.properties.name,f=c?c.level+1:1,y=e.properties.checked,v=!1,g=e.properties.disabled,b=e.properties.noTick,C=void 0,k=!0!==e.properties.disabled&&!1!==e.properties.tickable}else{const e=r;u=e.id,p=(null==e?void 0:e.children)&&(null==e?void 0:e.children.length)>0,h=e.lazy,m=e.name,!0===h&&void 0!==n.value[u]&&!0===Array.isArray(e.children)&&(h=n.value[u]),f=c?c.level+1:1,y=e.checked,v=e.expanded,g=e.disabled,b=e.noTick,C=e.indeterminate,k=!0!==e.disabled&&!1!==e.tickable||!e.children}const S=!0!==p,w=!0!==g&&!0===o.value,P="none"!==l,M="strict"===l,T="leaf-filtered"===l,x="leaf"===l||"leaf-filtered"===l;!0===x&&!0===k&&c&&!0!==c.tickable&&(k=!1);const R={index:s,name:m,key:u,parent:c,isParent:p,isLeaf:S,lazy:h,disabled:g,level:f,children:[],matchesFilter:!e.filter||i.value(r,e.filter),selected:u===e.selected&&!0===w,selectable:w,expanded:v,expandable:!0,noTick:!0===b||!0!==M&&h&&"loaded"!==h,tickable:k,tickStrategy:l,hasTicking:P,strictTicking:M,leafFilteredTicking:T,leafTicking:x,indeterminate:C,indeterminateNextState:void 0,ticked:y};if(t[u]=R,!0===p){const t=r;if(R.children=t.children.map(((e,t)=>a(e,t,R))),e.filter&&(!0!==R.matchesFilter?R.matchesFilter=R.children.some((e=>e.matchesFilter)):!0!==R.noTick&&!0!==R.disabled&&!0===R.tickable&&!0===T&&!0===R.children.every((e=>!0!==e.matchesFilter||!0===e.noTick||!0!==e.tickable))&&(R.tickable=!1)),!0===R.matchesFilter&&(!0!==R.noTick&&!0!==M&&!0===R.children.every((e=>e.noTick))&&(R.noTick=!0),x)){if(R.ticked=!1,R.indeterminate=R.children.some((e=>{if(d(e,"type")&&d(e,"properties")){return!0===e.properties.indeterminate}return!0===e.indeterminate})),R.tickable=!0===R.tickable&&R.children.some((e=>e.tickable)),!0!==R.indeterminate){const e=R.children.reduce(((e,t)=>!0===t.ticked?e+1:e),0);e===R.children.length?R.ticked=!0:e>0&&(R.indeterminate=!0)}!0===R.indeterminate&&(R.indeterminateNextState=R.children.every((e=>(!0!==e.tickable||!0!==e.ticked)&&!1!==e.indeterminateNextState)))}}return R};return e.nodes.forEach(((e,t)=>a(e,t,null))),t})),s=(e,a,o,i=r.value[e])=>{if(i.lazy&&"loaded"!==i.lazy){if("loading"===i.lazy)return;n.value[e]="loading",!0!==Array.isArray(o.children)&&(o.children=[]),t.emit("lazy-load",{dataset:o,key:e,done:t=>{n.value[e]="loaded",o.children=!0===Array.isArray(t)?[...null==o?void 0:o.children,...t]:[...null==o?void 0:o.children],I((()=>{const t=r.value[e];t&&t.isParent}))},fail:()=>{delete n.value[e],0===o.children.length&&delete o.children}})}else!0===i.isParent&&i.expandable},c=(n,a,o,r)=>{if(!0===o.indeterminate&&(n=o.indeterminateNextState),o.strictTicking);else if(o.leafTicking){void 0===n&&(n=!1);const t=(a,o)=>{var r;if(d(a,"type")&&"Feature"===a.type){const t=a;if(e.filter){i.value(a,e.filter)&&(t.properties.checked=n)}else t.properties.checked=n}else{const e=a;e.checked=n,e.indeterminate=void 0,null==(r=null==e?void 0:e.children)||r.forEach((e=>t(e)))}};t(a)}t.emit("checked",n,a,r,o.index)};function l(e){const t=a[e];t&&t.focus()}const u=(n,a)=>{if(d(n,"type")&&"Feature"===n.type){const e=n,i=e.properties.id,s=r.value[i],d=[];for(let t=0;t<s.level-1;t++)d.push(N(Ge,{side:!0}));return d.push(N(Ge,{side:!0},(()=>N(qe,{modelValue:s.ticked,dense:!0,disable:!0!==s.tickable,"onUpdate:modelValue":t=>c(t,e,s,a)})))),d.push(N(Ge,{side:!0},(()=>N(He,{size:"16px",name:e.properties.icon||"circle",style:"color: #00e472"})))),d.push(N(Ge,{},(()=>N($e,{},(()=>e.properties.name))))),"loading"!==s.lazy&&!0!==e.properties.loading||d.push(N(Ge,{side:!0},(()=>N(Sa,{size:"1.5em",dense:!0})))),e.properties.checked&&d.push(N(Ge,{side:!0},(()=>N(He,{size:"20px",name:"room",onClick:n=>{((e,n,a,o)=>{!0!==o&&l(n.key),t.emit("zoomIconClicked",n.key,e,n.index),a.stopPropagation()})(e,s,n)}})))),V(N(Ke,{clickable:!0,activeClass:"text-amber-6",dark:!0,active:s.selected,onClick:n=>{((e,n,a,i)=>{!0!==i&&l(n.key),o.value&&n.selectable&&t.emit("update:selected",n.key,e,n.index),"function"==typeof e.properties.handler&&e.properties.handler(e)})(e,s)}},(()=>d)),[[Je]])}{const t=n,o=t.id,i=r.value[o],d=!0===i.isParent?p(t.children,t):[];if(d.length>0||i.lazy&&"loaded"!==i.lazy){const n=[];for(let e=0;e<i.level-1;e++)n.push(N(Ge,{side:!0}));n.push(N(Ge,{side:!0},(()=>N(qe,{modelValue:!0===i.indeterminate?null:i.ticked,disable:!0!==i.tickable||!(null==t?void 0:t.children),dense:!0,"onUpdate:modelValue":e=>c(e,t,i,a)})))),n.push(N(Ge,{side:!0},(()=>N(He,{size:"16px",name:"home",style:"color: #00e472"})))),n.push(N(Ge,{},(()=>N($e,{},(()=>t.name)))));const o=(e=>{let t=0;const n=e=>{e.forEach((e=>{e.children?n(null==e?void 0:e.children):t++}))};return n((null==e?void 0:e.children)||[]),t})(t);return 0!==o&&n.push(N(Ge,{side:!0},(()=>N(Fe,{dense:!0,dark:!0},(()=>`${o}条`))))),"loading"!==i.lazy&&!0!==t.loading||n.push(N(Ge,{side:!0},(()=>N(Sa,{size:"1.5em",dense:!0})))),N(Ye,{modelValue:i.expanded,expandIcon:"arrow_circle_down",expandSeparator:!0,clickable:!0,dark:!0,dense:e.dense,"onUpdate:modelValue":e=>((e,t,n)=>{t.expanded=e,s(n.key,!n.expanded,t,n)})(e,t,i)},{header:()=>n,default:()=>d})}}},p=(t,n)=>{const a=(e.filter?t.filter((e=>r.value[e.id||e.properties.id].matchesFilter)):t).map((e=>u(e,n)));return a.length?[N(We,{dense:e.dense},(()=>a))]:[]};return()=>{const t=p(e.nodes);return N("div",{class:"vc-data-tree "+(0===t.length?"text-center":"")},0===t.length?e.filter?"找不到匹配的数据":"没有可用数据":t)}}});function Pa(){const e=w(null),t=w(null);return{scrollAreaRef:e,verticalPositionRef:t,contentStyle:{backgroundColor:"rgba(0,0,0,0.02)",color:"#555"},contentActiveStyle:{backgroundColor:"rgba(0,0,0,0.02)",color:"#555"},thumbStyle:{right:"2px",borderRadius:"3px",backgroundColor:"#EBB107",width:"3px",opacity:.6},onScrollHandler:e=>{t.value=e.verticalPosition},setScrollPosition:(t,n,a)=>{e.value.setScrollPosition("vertical",0,300)}}}const Ma={class:"work-bench"},Ta={class:"dataset-category"},xa={class:"dataset-category-header"},Ra={class:"q-ml-md q-mr-md"},Ia=la(g({__name:"Index",setup(e){j((e=>({ecf08828:g.value.commonPanel.themeCommonPanelListBorderColor,"144028e9":g.value.commonPanel.themeCommonPanelContentBackgroundColor})));const t=Jt(qi.system.useLayoutStore()).global,{contentStyle:n,contentActiveStyle:a,thumbStyle:o,scrollAreaRef:i,verticalPositionRef:r,setScrollPosition:s,onScrollHandler:c}=Pa(),{workBenchModel:d,dynamicRenderLayout:l,selectedDatasetCategories:u,init:p,showFeatureInfo:h,flyToFeature:m,addOrRemoveDataset:f,onLazyLoad:v,toggleDynamicRenderPageLayout:y}=ga(),g=R((()=>{const e=qi.system.useThemeStore();return e.themeConfig[e.activeName]}));return P((()=>{p()})),M((()=>{d.datasourceCategories.forEach((e=>{e.children.forEach((e=>{var t;f(!1,e),e.checked=!1,e.expanded=!1,(null==(t=null==e?void 0:e.children)?void 0:t.length)&&(e.children.length=0)}))}))})),(e,o)=>(C(),S("div",Ma,[V(D("div",{class:F(["datasources-container animate__animated animate__fadeInLeft",{"full-width-drawer":!z(t).leftDrawerMini}])},[D("div",Ta,[D("div",xa,[E(ze,{dense:"",flat:"",round:"",class:"close text-white",icon:"close",size:"sm",onClick:o[0]||(o[0]=e=>z(y)({datasource:{workBench:!1}}))}),D("div",Ra,[E(Xe,{modelValue:z(d).filterText,"onUpdate:modelValue":o[1]||(o[1]=e=>z(d).filterText=e),disable:z(d).loading,label:"搜索",dark:"",dense:"",clearable:""},{prepend:O((()=>[E(He,{color:"white",name:"search"})])),_:1},8,["modelValue","disable"])])]),z(r)>600?(C(),k(ze,{key:0,dense:"",fab:"",round:"",glossy:"","fab-mini":"",ripple:"",icon:"expand_less",padding:"2px",class:"absolute-bottom-right non-selectable z-top scroll-top",onClick:o[2]||(o[2]=e=>z(s)("vertical",0,300))},{default:O((()=>[E(Ue,null,{default:O((()=>[_("回到顶部")])),_:1})])),_:1})):A("",!0),E(Qe,{ref_key:"scrollAreaRef",ref:i,class:"dataset-category-area","content-style":z(n),"content-active-style":z(a),onScroll:z(c)},{default:O((()=>[z(d).loading?(C(),k(Sa,{key:0,class:"absolute-center","has-error":z(d).hasLoadingError},null,8,["has-error"])):A("",!0),E(z(wa),{selected:z(d).selectedKey,"onUpdate:selected":[o[3]||(o[3]=e=>z(d).selectedKey=e),z(h)],nodes:z(u),filter:z(d).filterText,onZoomIconClicked:z(m),onLazyLoad:z(v),onChecked:z(f)},null,8,["selected","nodes","filter","onUpdate:selected","onZoomIconClicked","onLazyLoad","onChecked"])])),_:1},8,["content-style","content-active-style","onScroll"])])],2),[[U,z(l).datasource.workBench]]),z(l).datasource.workBench?A("",!0):(C(),k(ze,{key:0,class:"toggle-btn",round:"",loading:z(d).loading,flat:"",color:"white",onClick:o[4]||(o[4]=e=>z(y)({datasource:{workBench:!0}}))},{default:O((()=>[E(He,{size:"50px",name:"keyboard_double_arrow_right"})])),_:1},8,["loading"]))]))}}),[["__scopeId","data-v-f2c7614f"]]),Oa=Object.freeze(Object.defineProperty({__proto__:null,default:Ia},Symbol.toStringTag,{value:"Module"})),Ea={class:"page-dynamic-render-recursive-list absolute z-fab"},_a=g({name:"VcDemoDynamicRenderRecursiveList",__name:"Index",setup(e){const{loadDefaultLayers:t}=qi.viewer.useLayerStore();return P((()=>{t(!0)})),(e,t)=>(C(),S("div",Ea,[E(Ia)]))}}),La=Object.freeze(Object.defineProperty({__proto__:null,default:_a},Symbol.toStringTag,{value:"Module"}));const Da={class:"page-dynamic-render-stack"},Aa={key:0,class:"stack-buttons-wrapper"},Ba={class:"stack-buttons-container"},Na=["onClick"],Va={style:{"margin-top":"5px"}},ja=la(g({name:"VcDemoDynamicRenderStack",__name:"Index",setup(e){const t=T(),{loadDefaultLayers:n}=qi.viewer.useLayerStore(),{stackDatas:a}={stackDatas:x([{id:p(),label:"农用地",checked:!1,data:"/datas/work-bench/TDLY农用地.json",renderingType:"polygon",entityProps:{polygon:{material:"rgba(127,194,105,0.8)"}},entitySelectedProps:{polygon:{material:"rgba(137,207,240,0.8)"}}},{id:p(),label:"住宅用地",checked:!1,data:"/datas/work-bench/TDLY住宅用地.json",renderingType:"polygon",entityProps:{polygon:{material:"rgba(238,241,160,0.8)"}},entitySelectedProps:{polygon:{material:"rgba(137,207,240,0.8)"}}},{id:p(),label:"集体建设用地",checked:!1,data:"/datas/work-bench/TDLY集体建设.json",renderingType:"polygon",entityProps:{polygon:{material:"rgba(227,108,9,0.8)"}},entitySelectedProps:{polygon:{material:"rgba(137,207,240,0.8)"}}},{id:p(),label:"工业用地",checked:!1,data:"/datas/work-bench/TDLY工业用地.json",renderingType:"polygon",entityProps:{polygon:{material:"rgba(216,216,216,0.8)"}},entitySelectedProps:{polygon:{material:"rgba(137,207,240,0.8)"}}}])},o=It(),i=w(!1);w([]),M((()=>{Pn(t.path)})),P((()=>{n(!0),Rt(o.viewer,{position:{x:-2324661.042454219,y:5396877.953175202,z:2474170.1591741517},heading:6.283185307179586,pitch:-.5001412827126326,roll:6.283185307179586},{duration:1,complete:()=>{i.value=!0}})}));return(e,n)=>(C(),S("div",Da,[i.value?(C(),S("div",Aa,[D("div",Ba,[(C(!0),S(W,null,G(z(a),((e,n)=>(C(),S("div",{key:n,class:F(["stack-button",{active:e.checked}]),onClick:n=>{return(a=e).checked?Pn(a.id):On(a.data,a.renderingType,a.entityProps,a.entitySelectedProps,a.id,t.path),void(a.checked=!a.checked);var a}},[D("div",Va,L(e.label),1)],10,Na)))),128))])])):A("",!0)]))}}),[["__scopeId","data-v-89f0c1d2"]]),Ua=Object.freeze(Object.defineProperty({__proto__:null,default:ja},Symbol.toStringTag,{value:"Module"})),za=g({name:"VcDemoPageExpansion",__name:"Index",setup:e=>(e,t)=>{const n=b("router-view");return C(),k(n)}}),Fa=Object.freeze(Object.defineProperty({__proto__:null,default:za},Symbol.toStringTag,{value:"Module"})),Wa=g({name:"VcTyphoon",props:{typhoonDatas:Array,clampToGround:{type:Boolean,default:!1},interval:{type:Number,default:100},radius7Color:{type:String,default:"#00bab2"},radius10Color:{type:String,default:"#ffff00"},radius12Color:{type:String,default:"#da7341"}},emits:{mouseover:e=>!0,mouseout:e=>!0,click:e=>!0,clickout:e=>!0},setup(e,t){const n=q(),a=w(null);Ot();const o=It(),i=x([]),r=e=>{let t="";switch(e){case"STS":t="#0F8000";break;case"TY":t="#FE9C45";break;case"STY":t="#FE00FE";break;case"Super TY":t="#FE0000";break;case"TD":t="#EED139";break;case"TS":t="#0000FF";break;default:t="#409eff"}return t},s=(e,n)=>{n.playIndex=e;const a=n.typhoonData.points[e];a.type="live",a.index=e,a.tfbh=n.name;const o=[a.lng,a.lat];n.positions.push(o),n.points.push({id:a.id||Cesium.createGuid(),position:o,color:r(a.strong),pixelSize:8,outlineColor:"rgba(0,0,0,0.6)",outlineWidth:1,disableDepthTestDistance:Number.POSITIVE_INFINITY,onMouseover(e){t.emit("mouseover",e)},onMouseout(e){t.emit("mouseout",e)},onClick(e){d(a,n),n.playIndex=a.index,t.emit("click",e)},onClickout(e){t.emit("clickout",e)},...a}),e===n.typhoonData.points.length-1&&d(a,n)},c=(t,n)=>{const a=i.findIndex((e=>e.name===t));if(a>=0){let t=0;const o=i[a];o.points.length=0,o.positions.length=0;const r=o.typhoonData;s(t,o),clearInterval(o.playInterval),o.playInterval=setInterval((()=>{t++,t>=r.points.length?clearInterval(o.playInterval):s(t,o)}),n||e.interval)}else hn("播放台风失败，原因：未找到对应编号的台风数据。")},d=(e,n)=>{n.children.length=0;const a=e.forecast;if(a&&!(a.length<=0))for(let o=0;o<a.length;o++){const i=a[o],s=[],c=[],d={name:n.name+"_"+i.sets,typhoonData:i,show:!0,positions:c,points:s,type:"forc"};n.children.push(d),i.points.forEach(((n,a)=>{const o=[n.lng,n.lat];d.positions.push(o),0===a&&d.positions.push([e.lng,e.lat]),n.sets=i.sets,n.type="forc",n.index=a,d.points.push({id:n.id||Cesium.createGuid(),position:o,color:r(n.strong),pixelSize:8,outlineColor:"rgba(0,0,0,0.6)",outlineWidth:1,disableDepthTestDistance:Number.POSITIVE_INFINITY,onMouseover(e){t.emit("mouseover",e)},onMouseout(e){t.emit("mouseout",e)},onClick(e){t.emit("click",e)},...n})}))}},l=e=>{const t={name:e.tfbh,typhoonData:e,show:!0,positions:[],points:[],children:[],type:"live"};return i.push(t),c(e.tfbh),t},u=(e,t)=>{let n=[];if("number"==typeof t)n=H(e,1e3*t,{units:"meters"}).geometry.coordinates;else if(t.ne){const a=6,o=360/(4*a),i={0:"ne",1:"nw",2:"sw",3:"se"};for(let r=0;r<4;r++){let s=1e3*parseFloat(t[i[r]]);s||(s=0);for(let t=r*o;t<=(r+1)*o;t++){const o=a*t,i=e[0]+s*Math.cos(o*Math.PI/180)/111e3,r=e[1]+s*Math.sin(o*Math.PI/180)/111e3;n.push([i,r])}}}return n},p=n=>{const a=[];return n.forEach((n=>{if(n.positions.length>1&&a.push(N(e.clampToGround?Bt:Nt,{show:!0,enableMouseEvent:!0,asynchronous:!1,classificationType:2,appearance:{type:"PolylineMaterialAppearance",options:{material:{fabric:{type:"live"===n.type?"Color":"PolylineDash",uniforms:{color:"rgba(0,0,0,0.5)"}}},translucent:!0}},onMouseover(e){t.emit("mouseover",e)},onMouseout(e){t.emit("mouseout",e)},onClick(e){t.emit("click",e)},onClickout(e){t.emit("clickout",e)}},(()=>N(Lt,{id:n.name||Cesium.createGuid()},(()=>N(e.clampToGround?Dt:At,{positions:_t(n.positions),width:2,arcType:Cesium.ArcType.RHUMB,show:!0})))))),a.push(N(Vt,{points:n.points,onReady:e=>{const{cesiumObject:t}=e,n=t.update;t.update=function(e){const t=e.commandList.length;n.call(this,e);const a=e.commandList.length;for(let n=t;n<a;++n)e.commandList[n].pass=Cesium.Pass.TRANSLUCENT,e.commandList[n].renderState=Cesium.RenderState.fromCache({depthTest:{enabled:!1},depthMask:!1})}}})),"live"===n.type){const t=n.points[n.playIndex];(null==t?void 0:t.radius7)>0&&a.push(N(jt,{positions:u(t.position,t.radius7_quad),clampToGround:e.clampToGround,asynchronous:!1,classificationType:2,appearance:{type:"MaterialAppearance",options:{material:{fabric:{type:"Color",uniforms:{color:e.radius7Color}}},faceForward:!0,renderState:{cull:{enabled:!1},depthTest:{enabled:!1}}}}})),(null==t?void 0:t.radius10)>0&&a.push(N(jt,{positions:u(t.position,t.radius10_quad),clampToGround:e.clampToGround,asynchronous:!1,classificationType:2,appearance:{type:"MaterialAppearance",options:{material:{fabric:{type:"Color",uniforms:{color:e.radius10Color}}},faceForward:!0,renderState:{cull:{enabled:!1},depthTest:{enabled:!1}}}}})),(null==t?void 0:t.radius12)>0&&a.push(N(jt,{positions:u(t.position,t.radius12_quad),clampToGround:e.clampToGround,asynchronous:!1,classificationType:2,appearance:{type:"MaterialAppearance",options:{material:{fabric:{type:"Color",uniforms:{color:e.radius12Color}}},faceForward:!0,renderState:{cull:{enabled:!1},depthTest:{enabled:!1}}}}}))}n.children&&a.push(...p(n.children))})),a};return Object.assign(n.proxy,{addTyphoonData:l,addTyphoonByInterval:c,flyToTyphoonData:(e,t)=>{const n=[];"string"==typeof e?n.push(e):n.push(...e);let a=null;n.forEach((e=>{const t=[],n=i.find((t=>t.name===e));n&&n.typhoonData.points&&n.typhoonData.points.forEach((e=>{t.push([e.lng,e.lat])}));const o=_t(t),r=Cesium.BoundingSphere.fromPoints(o);a=null===a?r:Cesium.BoundingSphere.union(a,r)})),o.viewer.camera.flyToBoundingSphere(a,{...t})},removeTyphoonData:e=>{const t=i.indexOf(e);t>=0&&(clearInterval(e.playInterval),i.splice(t,1))},removeAllTyphoonData:()=>{i.forEach((e=>{clearInterval(e.playInterval)})),i.length=0},getTyphoonDatasources:()=>i}),e.typhoonDatas.forEach((e=>{l(e)})),()=>{const e=p(i);return N(Et,{ref:a,show:!0},(()=>e))}}}),Ga={class:"page-dynamic-render-typhoon"},qa=la(g({name:"VcDemoPageDynamicRenderTyphoon",__name:"Index",setup(e){const t=w([]),n=w(null),a=[{position:[127,34],polyline:{width:1,positions:[[127,34],[127,22],[119,18],[119,11],[113,4.5],[105,0]],material:"rgba(255, 0, 0, 0.8)"}},{polyline:{width:1,positions:[[105,0],[120,0],[132,15],[132,34]],material:{fabric:{type:"PolylineDash",uniforms:{color:"rgba(255, 165, 0, 0.8)",dashLength:10,dashPattern:5}}}}}];P((()=>{o()}));const o=()=>{t.value.length=0;const e=[Xn.getStaticData("/datas/typhoon/202209.json"),Xn.getStaticData("/datas/typhoon/202210.json")];Promise.all(e).then((([e,n])=>{t.value=[...e.data,...n.data]}))};return(e,o)=>{const i=b("vc-datasource-custom");return C(),S("div",Ga,[E(i,{name:"vc_warnLine",entities:a}),t.value.length?(C(),k(z(Wa),{key:0,ref_key:"typhoonRef",ref:n,"typhoon-datas":t.value},null,8,["typhoon-datas"])):A("",!0)])}}}),[["__scopeId","data-v-73ea91e7"]]),Ha=Object.freeze(Object.defineProperty({__proto__:null,default:qa},Symbol.toStringTag,{value:"Module"})),$a=g({name:"VcDemoPageExpansion",__name:"Index",setup:e=>(e,t)=>{const n=b("router-view");return C(),k(n)}}),Ja=Object.freeze(Object.defineProperty({__proto__:null,default:$a},Symbol.toStringTag,{value:"Module"}));const Ka=la({},[["render",function(e,t){return C(),S("div")}]]),Ya=Object.freeze(Object.defineProperty({__proto__:null,default:Ka},Symbol.toStringTag,{value:"Module"})),Xa={class:"z-top absolute-center page-index"},Qa=g({name:"VcDemoPageIndex",__name:"Index",setup(e){It();const t=w({position:[108,32],point:{pixelSize:28,color:"red"},label:{text:"Hello World",pixelOffset:[0,150]}}),{loadDefaultLayers:n,toggle:a}=qi.viewer.useLayerStore();P((()=>{n(!0)})),M((()=>{a({names:"admin",show:!1})}));const o=e=>{};return(e,n)=>{const a=b("vc-graphics-billboard"),i=b("vc-graphics-rectangle"),r=b("vc-entity");return C(),S("div",Xa,[E(r,{ref_key:"entity",ref:t,position:t.value.position,point:t.value.point,label:t.value.label,onClick:o},{default:O((()=>[E(a,{ref:"billboard",image:"https://zouyaoji.top/vue-cesium/favicon.png",scale:.5},null,512),E(i,{coordinates:[130,20,80,25],material:"green"})])),_:1},8,["position","point","label"])])}}}),Za=Object.freeze(Object.defineProperty({__proto__:null,default:Qa},Symbol.toStringTag,{value:"Module"})),eo=$("https://xeopsongjzudezkpnmqd.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhlb3Bzb25nanp1ZGV6a3BubXFkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY4MjU4MzksImV4cCI6MjA1MjQwMTgzOX0.Su8q5OQ1-ENKlmJfdcrwxUMw2LBAPF52xLnaPa59stE"),to={class:"min-h-screen flex items-center justify-center bg-gray-50"},no=[D("div",{class:"text-center"},[D("h2",{class:"text-2xl font-semibold mb-4"},"Completing sign in..."),D("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto"})],-1)],ao=g({__name:"AuthCallback",setup(e){const t=J();return P((()=>{eo.auth.onAuthStateChange(((e,n)=>{if("SIGNED_IN"===e&&n){if(null==n?void 0:n.user){const e=n.user;an("token",n.provider_token),an("uuid",e.id);sa().set({...e})}t.push("/home")}}))})),(e,t)=>(C(),S("div",to,no))}}),oo=Object.freeze(Object.defineProperty({__proto__:null,default:ao},Symbol.toStringTag,{value:"Module"})),ro=g({name:"Error404",setup:(e,t)=>({defaultPagePath:"/home"})}),so={class:"fullscreen bg-blue text-white text-center q-pa-md flex flex-center"},co=D("div",{style:{"font-size":"30vh"}},"404",-1),lo=D("div",{class:"text-h2",style:{opacity:"0.4"}},"噢. 这儿什么也没有...",-1);const uo=la(ro,[["render",function(e,t,n,a,o,i){return C(),S("div",so,[D("div",null,[co,lo,E(ze,{class:"q-mt-xl",color:"white","text-color":"blue",unelevated:"",to:e.defaultPagePath,label:"返回主页","no-caps":""},null,8,["to"])])])}]]),po=Object.freeze(Object.defineProperty({__proto__:null,default:uo},Symbol.toStringTag,{value:"Module"})),ho=$t("auth",(()=>{const e=w(null),t=w(!1);return eo.auth.onAuthStateChange(((n,a)=>{if(null==a?void 0:a.user){const n=a.user;an("token",a.provider_token),an("uuid",n.id);sa().set({...n}),e.value={email:a.user.email,id:a.user.id},t.value=!0}else e.value=null,t.value=!1})),{user:e,isAuthenticated:t,login:async function(n,a){const{data:o,error:i}=await eo.auth.signInWithPassword({email:n,password:a});if(i)throw i;o.user&&(e.value={email:o.user.email,id:o.user.id},t.value=!0)},loginWithOAuth:async function(e){const{data:t,error:n}=await eo.auth.signInWithOAuth({provider:e,options:{redirectTo:`${window.location.origin}/auth/callback`}}),a=await eo.auth.getSession();alert("session: "+JSON.stringify(a));const o=await eo.auth.getUser();if(alert("user: "+JSON.stringify(o)),t)return t.user;if(n)throw n},register:async function(n,a){const{data:o,error:i}=await eo.auth.signUp({email:n,password:a});if(i)throw i;o.user&&(e.value={email:o.user.email,id:o.user.id},t.value=!0)},logout:async function(){const{error:n}=await eo.auth.signOut();if(n)throw n;e.value=null,t.value=!1}}})),mo=e=>(K("data-v-1c93b446"),e=e(),Y(),e),fo={class:"q-pa-md page-login z-top"},vo={class:"login-container col row"},yo=mo((()=>D("div",{class:"text-h4 q-my-sm"},"Login",-1))),go={class:"oath flex"},bo=mo((()=>D("div",{class:"title full-width text-center q-pt-md"},"Social Network LogIn",-1))),Co={class:"q-gutter-md full-width text-center q-pt-sm flex justify-center"},ko=[X('<svg width="36px" height="36px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" data-v-1c93b446><title data-v-1c93b446>github [#142]</title><desc data-v-1c93b446>Created with Sketch.</desc><defs data-v-1c93b446></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" data-v-1c93b446><g id="Dribbble-Light-Preview" transform="translate(-140.000000, -7559.000000)" fill="#000000" data-v-1c93b446><g id="icons" transform="translate(56.000000, 160.000000)" data-v-1c93b446><path id="github-[#142]" d="M94,7399 C99.523,7399 104,7403.59 104,7409.253 C104,7413.782 101.138,7417.624 97.167,7418.981 C96.66,7419.082 96.48,7418.762 96.48,7418.489 C96.48,7418.151 96.492,7417.047 96.492,7415.675 C96.492,7414.719 96.172,7414.095 95.813,7413.777 C98.04,7413.523 100.38,7412.656 100.38,7408.718 C100.38,7407.598 99.992,7406.684 99.35,7405.966 C99.454,7405.707 99.797,7404.664 99.252,7403.252 C99.252,7403.252 98.414,7402.977 96.505,7404.303 C95.706,7404.076 94.85,7403.962 94,7403.958 C93.15,7403.962 92.295,7404.076 91.497,7404.303 C89.586,7402.977 88.746,7403.252 88.746,7403.252 C88.203,7404.664 88.546,7405.707 88.649,7405.966 C88.01,7406.684 87.619,7407.598 87.619,7408.718 C87.619,7412.646 89.954,7413.526 92.175,7413.785 C91.889,7414.041 91.63,7414.493 91.54,7415.156 C90.97,7415.418 89.522,7415.871 88.63,7414.304 C88.63,7414.304 88.101,7413.319 87.097,7413.247 C87.097,7413.247 86.122,7413.234 87.029,7413.87 C87.029,7413.87 87.684,7414.185 88.139,7415.37 C88.139,7415.37 88.726,7417.2 91.508,7416.58 C91.513,7417.437 91.522,7418.245 91.522,7418.489 C91.522,7418.76 91.338,7419.077 90.839,7418.982 C86.865,7417.627 84,7413.783 84,7409.253 C84,7403.59 88.478,7399 94,7399" data-v-1c93b446></path></g></g></g></svg>',1)],So=[mo((()=>D("svg",{id:"Layer_1",fill:"#000000",height:"36px",width:"36px",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"-143 145 512 512","xml:space":"preserve"},[D("path",{d:"M113,145c-141.4,0-256,114.6-256,256s114.6,256,256,256s256-114.6,256-256S254.4,145,113,145z M41.4,508.1H-8.5V348.4h49.9\n              V508.1z M15.1,328.4h-0.4c-18.1,0-29.8-12.2-29.8-27.7c0-15.8,12.1-27.7,30.5-27.7c18.4,0,29.7,11.9,30.1,27.7\n              C45.6,316.1,33.9,328.4,15.1,328.4z M241,508.1h-56.6v-82.6c0-21.6-8.8-36.4-28.3-36.4c-14.9,0-23.2,10-27,19.6\n              c-1.4,3.4-1.2,8.2-1.2,13.1v86.3H71.8c0,0,0.7-146.4,0-159.7h56.1v25.1c3.3-11,21.2-26.6,49.8-26.6c35.5,0,63.3,23,63.3,72.4V508.1z\n              "})],-1)))],wo=[mo((()=>D("svg",{width:"36px",height:"36px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[D("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M12 0C5.37246 0 0 5.37267 0 11.9998C0 18.6273 5.37246 24 12 24C18.6271 24 24 18.6274 24 11.9998C24 5.37267 18.6271 0 12 0ZM12.1402 19.0184C8.27229 19.0184 5.13943 15.8776 5.13943 11.9999C5.13943 8.12231 8.27229 4.98151 12.1402 4.98151C14.0305 4.98151 15.6097 5.67893 16.822 6.81071L14.8483 8.78908V8.78461C14.1134 8.08272 13.1815 7.72313 12.1402 7.72313C9.83 7.72313 7.95297 9.67945 7.95297 11.9957C7.95297 14.3114 9.83006 16.2725 12.1402 16.2725C14.2361 16.2725 15.6623 15.0706 15.9558 13.4213H12.1402V10.684H18.725C18.8126 11.1532 18.8605 11.6446 18.8605 12.1578C18.8605 16.1672 16.1831 19.0184 12.1402 19.0184Z",fill:"#000000"})],-1)))],Po=la(g({__name:"Login",setup(e){j((e=>({"6a0a6224":i.value.pageLogin.themePageLoginBackground,"5e8f9da3":i.value.pageLogin.themePageLoginColor,"7fe289d4":i.value.global.themeColorAlpha,"0102b1aa":i.value.global.themeColor}))),Ze();const t=J();ho();const n=w({username:"admin",password:"admin"});async function a(e){try{qi.system.useAccountStore().oAuthLogin(e).then((()=>{t.replace(t.currentRoute.value.query.redirect||"/home")}))}catch(n){}}const o={username:[e=>e&&e.length>0||"Please Input Username"],password:[e=>e&&e.length>0||"Please Input Password"],rememberMe:[e=>!!e||"You need to accept the license and terms first"]},i=R((()=>{const e=qi.system.useThemeStore();return e.themeConfig[e.activeName]})),r=async()=>{qi.system.useAccountStore().login(n.value).then((()=>{t.replace(t.currentRoute.value.query.redirect||"/home")}))},s=()=>{n.value={username:"",password:""}};return(e,t)=>(C(),S("div",fo,[D("div",vo,[E(et,{greedy:"",class:"form-login",onSubmit:r,onReset:s},{default:O((()=>[yo,E(Xe,{modelValue:n.value.username,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value.username=e),outlined:"",label:"Name","lazy-rules":"",rules:o.username},{prepend:O((()=>[E(He,{class:"icon",name:"perm_identity"})])),_:1},8,["modelValue","rules"]),E(Xe,{modelValue:n.value.password,"onUpdate:modelValue":t[1]||(t[1]=e=>n.value.password=e),outlined:"",label:"Password","lazy-rules":"",type:"password",rules:o.password},{prepend:O((()=>[E(He,{class:"icon",name:"lock"})])),_:1},8,["modelValue","rules"]),D("div",null,[E(ze,{class:"btn-submit full-width no-outline text-h6",color:"primary",label:"Login",type:"submit"})])])),_:1}),D("div",go,[bo,D("div",Co,[D("button",{onClick:t[2]||(t[2]=e=>a("github"))},ko),D("button",{onClick:t[3]||(t[3]=e=>a("linkedin_oidc"))},So),D("button",{onClick:t[4]||(t[4]=e=>a("google"))},wo)])])])]))}}),[["__scopeId","data-v-1c93b446"]]),Mo=Object.freeze(Object.defineProperty({__proto__:null,default:Po},Symbol.toStringTag,{value:"Module"})),To=g({__name:"Index",setup(e){const t=x({cesiumPath:"https://unpkg.com/cesium@latest/Build/Cesium/Cesium.js"});return(e,n)=>(C(),k(z(Ut),{"cesium-path":t.cesiumPath},{default:O((()=>[E(z(zt))])),_:1},8,["cesium-path"]))}}),xo=Object.freeze(Object.defineProperty({__proto__:null,default:To},Symbol.toStringTag,{value:"Module"})),Ro=g({__name:"Index",setup(e){const t=Ze();Q((()=>t.fullscreen.isActive),(e=>{}));const n=()=>{t.fullscreen.toggle()};return(e,a)=>(C(),k(ze,{icon:z(t).fullscreen.isActive?"fullscreen_exit":"fullscreen",size:"md",flat:"",round:"",onClick:n},{default:O((()=>[E(Ue,null,{default:O((()=>[_(L(z(t).fullscreen.isActive?"退出全屏":"全屏"),1)])),_:1})])),_:1},8,["icon"]))}}),Io=g({__name:"Index",setup(e){const{toggleGlobalLayout:t}=qi.system.useLayoutStore(),{loadDefaultLayers:n}=qi.viewer.useLayerStore(),a=qi.system.useUserStore(),o=It(),i=()=>{qi.system.useAccountStore().logout({confirm:!0}).then((e=>{if(e){n(!1),t({featureInfo:!1,layerManager:!1}),qi.viewer.useRenderStore(Gi).removeAllRenderData();const e={position:[105,30,21634101],heading:360,pitch:-90,roll:0};(null==o?void 0:o.viewer)&&Rt(null==o?void 0:o.viewer,e,{duration:3})}}))};return(e,t)=>{var n,o,r;return"login"!==e.$route.name?(C(),k(Fe,{key:0,dense:"",rounded:"","no-caps":"",size:"md",class:"q-mr-sm cursor-pointer","auto-close":"",icon:"person",label:(null==(n=z(a).info)?void 0:n.username)||(null==(r=null==(o=z(a).info)?void 0:o.user_metadata)?void 0:r.name)||"Guest"},{default:O((()=>[E(nt,null,{default:O((()=>[E(We,{dense:""},{default:O((()=>[V((C(),k(Ke,{clickable:"",dense:"",onClick:i},{default:O((()=>[E(Ge,{avatar:""},{default:O((()=>[E(tt,{icon:"logout"})])),_:1}),E(Ge,null,{default:O((()=>[E($e,null,{default:O((()=>[_("LogOut")])),_:1})])),_:1})])),_:1})),[[at]])])),_:1})])),_:1})])),_:1},8,["label"])):A("",!0)}}}),Oo=g({__name:"Index",setup(e){const{locale:t}=Z(),n=w(!1),a=e=>{t.value=e,an("locale",e)};return(e,t)=>(C(),k(ot,{modelValue:n.value,"onUpdate:modelValue":t[2]||(t[2]=e=>n.value=e),dense:"",color:"#fff","fab-mini":"",size:"md","dropdown-icon":"language",flat:""},{default:O((()=>[E(We,null,{default:O((()=>[V((C(),k(Ke,{clickable:"",onClick:t[0]||(t[0]=e=>a("en-US"))},{default:O((()=>[E(Ge,null,{default:O((()=>[E($e,null,{default:O((()=>[_("English")])),_:1})])),_:1})])),_:1})),[[at]]),V((C(),k(Ke,{clickable:"",onClick:t[1]||(t[1]=e=>a("zh-CN"))},{default:O((()=>[E(Ge,null,{default:O((()=>[E($e,null,{default:O((()=>[_("简体中文")])),_:1})])),_:1})])),_:1})),[[at]])])),_:1})])),_:1},8,["modelValue"]))}}),Eo={class:"vc-geocoder row"},_o=la(g({__name:"Index",setup(e){const t=It(),n=w(null),a=w([]),o=w(null),i=w([]),r=async(e,t,o)=>{const i={keywords:e=""===e?n.value:e,citylimit:!0,output:"json",key:"3d933b21d4d5e130a155b4cf2560c610"},r=await Xn.getLocationList(i);let s=[];if("1"===r.status){const e=r.pois,t=[];e.forEach((e=>{t.push({value:e.id,label:e.name,pname:e.pname,cityname:e.cityname,adname:e.adname,address:e.address,location:e.location,type:e.type})})),s=[...new Set(t)]}t((()=>{const t=null==e?void 0:e.toLocaleLowerCase();a.value=s.filter((e=>e.label.toLocaleLowerCase().indexOf(t)>-1))}))},s=e=>{n.value=e},c=()=>{n.value=null,i.value.length=0},d=e=>{if(e){const t=Ft(Number(e.location.trim().split(",")[0]),Number(e.location.trim().split(",")[1])),n={lng:t[0],lat:t[1],address:e.address};l(n,e)}else i.value.length=0},l=(e,n)=>{const a=e.lng,o=e.lat,r=e.address,{Rectangle:s,sampleTerrain:c}=Cesium,{viewer:d}=t;i.value.length=0,i.value.push({position:[a,o],point:{color:"#08ABD5",pixelSize:12,outlineWidth:3,outlineColor:"#fff"},properties:{...n},description:u({"经度":a,"纬度":o,"地址":r})}),new Cesium.HeadingPitchRange(0,0,3e3);const l=.01,p=s.fromDegrees(a-l,o-l,a+l,o+l),h=d.scene.camera,m=h.getRectangleCameraCoordinates(p),f=d.scene.globe.ellipsoid.cartesianToCartographic(m);c(d.scene.globe.terrainProvider,6,[s.center(p)]).then((function(e){const t={longitude:f.longitude,latitude:f.latitude,height:f.height+e[0].height},n=d.scene.globe.ellipsoid.cartographicToCartesian(t);h.flyTo({duration:3,destination:n})}))},u=(e,t)=>{let n="";e instanceof Cesium.PropertyBag&&(e=e.getValue(Cesium.JulianDate.now()));for(let a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(a===t)continue;let o=e[a];"object"==typeof o&&(o=u(o)),a=a.replace(/_/g," "),Cesium.defined(o)&&(n+="<tr><th>"+a+"</th><td>"+o+"</td></tr>")}return n.length>0&&(n='<table class="cesium-infoBox-defaultTable"><tbody>'+n+"</tbody></table>"),n};return(e,t)=>{const l=b("vc-datasource-custom");return C(),S(W,null,[D("div",Eo,[E(it,{outlined:"","model-value":n.value,"use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",options:a.value,label:"Search(TBD)",style:{width:"250px"},dense:"","hide-dropdown-icon":"",onFilter:r,onInputValue:s,"onUpdate:modelValue":d},{prepend:O((()=>[E(He,{name:"place",color:"white"})])),"no-option":O((()=>[E(Ke,null,{default:O((()=>[E(Ge,{class:"text-grey"},{default:O((()=>[_(" Not Found ")])),_:1})])),_:1})])),append:O((()=>[null!==n.value?(C(),k(He,{key:0,name:"cancel",class:"cursor-pointer",onClick:ee(c,["stop"])})):A("",!0),E(He,{name:"search",color:"orange"})])),_:1},8,["model-value","options"])]),E(l,{ref_key:"datasoureceRef",ref:o,entities:i.value},null,8,["entities"])],64)}}}),[["__scopeId","data-v-4e309cae"]]),Lo=(e=>(K("data-v-ba6cc136"),e=e(),Y(),e))((()=>D("img",{src:"https://zouyaoji.top/vue-cesium/favicon.png"},null,-1))),Do={class:"menu-container"},Ao={key:0,class:"right-btn"},Bo=la(g({name:"MainHeader",__name:"Index",setup(e){const t=T();w(!1);const n=w(""),{registerTimeout:a}=rt(),o=w(100),i=qi.system.useMenuStore(),r=qi.system.useLayoutStore(),{global:s}=Jt(r),c=R((()=>"Global Village")),d=R((()=>{const e=i.header;return e.length?e[0].children:[]}));R((()=>!1)),R((()=>i.aside)),R((()=>{const e=qi.system.useThemeStore();return e.themeConfig[e.activeName]})),Q((()=>t.matched),(e=>{a((()=>{if(e.length>1){const t=e[1].path.substring(1,e[1].path.length);t&&(n.value=t)}else n.value="index"}),o.value)}),{immediate:!0}),P((()=>{o.value=5}));const l=()=>{r.toggleGlobalLayout({leftDrawerMini:!s.value.leftDrawerMini})},u=e=>{null===e&&t.matched.length>1?n.value=t.matched[1].path.substring(1,t.matched[1].path.length):n.value=e};return(e,t)=>(C(),k(lt,{class:"main-header"},{default:O((()=>[E(tt,{class:"cursor-pointer",onClick:l},{default:O((()=>[Lo])),_:1}),E(st,{shrink:!0,style:{width:"280px","font-weight":"bold","text-align":"left"}},{default:O((()=>[_(L(c.value),1)])),_:1}),D("div",Do,[E(ct,{"model-value":n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),align:"left","indicator-color":"cyan-13","onUpdate:modelValueOnce":u},{default:O((()=>[(C(!0),S(W,null,G(d.value,((t,n)=>(C(),k(ut,{key:n,name:t.name,to:t.path,exact:"",label:e.$t(t.title),"content-class":"menu-tab","active-class":"menu-active"},null,8,["name","to","label"])))),128))])),_:1},8,["model-value"])]),E(dt),d.value.length?(C(),S("div",Ao,[E(_o),E(Ro),E(Oo),E(Io)])):A("",!0)])),_:1}))}}),[["__scopeId","data-v-ba6cc136"]]),No={key:0,class:"text-weight-bold"},Vo={class:"content"},jo=la(g({__name:"Index",props:{title:{type:String,default:""},titleClass:{type:String,default:""},closeTip:{type:String,default:"关闭"},showCloseBtn:{type:Boolean,default:!0},separatorOpts:{type:Object,default:()=>({show:!0,dark:!0,color:"white",size:"1px"})}},emits:["close"],setup(e,{emit:t}){j((e=>({c6e3f058:o.value.commonPanel.themeCommonPanelHeaderColor,a83893f4:o.value.commonPanel.themeCommonPanelHeaderBackgroundColor,"6d7599a8":o.value.commonPanel.themeCommonPanelContentColor,"387e935e":o.value.commonPanel.themeCommonPanelContentBackgroundColor,"452a03e3":o.value.commonPanel.themeCommonPanelListColor,"5d46fb17":o.value.commonPanel.themeCommonPanelListBorderColor,"84b34094":o.value.global.themeColorAlpha,"21f592f0":o.value.global.themeColor})));const n=t,a=e=>{n("close",e)},o=R((()=>{const e=qi.system.useThemeStore();return e.themeConfig[e.activeName]}));return(t,n)=>(C(),k(mt,{class:"common-panel"},{default:O((()=>[E(pt,{class:F(["header",e.titleClass])},{default:O((()=>[""!==e.title?(C(),S("div",No,L(e.title),1)):A("",!0),te(t.$slots,"header-left",{},void 0,!0),E(dt),te(t.$slots,"header-right",{},void 0,!0),e.showCloseBtn?V((C(),k(ze,{key:1,dense:"",flat:"",icon:"close",onClick:a},{default:O((()=>[E(Ue,null,{default:O((()=>[_(L(e.closeTip),1)])),_:1})])),_:1})),[[at]]):A("",!0)])),_:3},8,["class"]),e.separatorOpts.show?(C(),k(ht,ne(ae({key:0},e.separatorOpts)),null,16)):A("",!0),D("div",Vo,[te(t.$slots,"default",{},void 0,!0)])])),_:3}))}}),[["__scopeId","data-v-70da5cdb"]]),Uo=g({name:"DragWrapper",props:{restriction:{type:[String,Object,Function],default:"parent"}},setup(e,t){const n=w(null),a=q(),o=e=>{const t=e.target,n=(parseFloat(t.getAttribute("data-x"))||0)+e.dx,a=(parseFloat(t.getAttribute("data-y"))||0)+e.dy;t.style.webkitTransform=t.style.transform="translate("+n+"px, "+a+"px)",t.setAttribute("data-x",n),t.setAttribute("data-y",a)},i=()=>{const e=n.value;tn(e).reflow({name:"drag",axis:"xy"})};return P((()=>{const t=n.value;tn(t).draggable({ignoreFrom:"button, .ignore-drag",allowFrom:".drag-handle",inertia:!0,onmove:o,modifiers:[tn.modifiers.restrict({restriction:e.restriction,endOnly:!0,elementRect:{left:0,right:1,top:0,bottom:1}})]}),addEventListener("resize",i,!1)})),oe((()=>{const e=n.value;tn.isSet(e)&&tn(e).unset(),removeEventListener("resize",i,!1)})),Object.assign(null==a?void 0:a.proxy,{resizeListener:i}),()=>N("div",{ref:n,class:"drag-wrapper absolute"},Wt(t.slots.default))}}),zo={class:"text-subtitle2"},Fo={class:"q-gutter-sm"},Wo={class:"text-subtitle2"},Go={class:"q-gutter-sm"},qo={class:"text-subtitle2"},Ho={class:"q-gutter-sm"},$o=la(g({__name:"Index",setup(e){const t=w(null),n=qi.system.useLayoutStore(),{global:a,dynamicRender:o}=Jt(n),{overlayLayers:i,baseLayers:r,terrainLayers:s,toggle:c}=qi.viewer.useLayerStore();Q(o,(e=>{I((()=>{var e,n;t.value&&(null==(n=(e=t.value).resizeListener)||n.call(e))}))}),{deep:!0});const d=R((()=>({overlayLayers:i,baseLayers:r,terrainLayers:s}))),l=R({get(){var e,t;return null==(t=null==(e=d.value.baseLayers.filter((e=>e.props.show)))?void 0:e[0])?void 0:t.name},set(e){}}),u=R({get(){var e,t;return null==(t=null==(e=d.value.terrainLayers.filter((e=>e.props.show)))?void 0:e[0])?void 0:t.name},set(e){}}),p=(e,t)=>{d.value.baseLayers.forEach((t=>{t.name===e?c({names:t.name,show:!0}):c({names:t.name,show:!1})}))},h=(e,t)=>{d.value.terrainLayers.forEach((t=>{t.name===e?c({names:t.name,show:!0}):c({names:t.name,show:!1})}))},m=()=>{n.toggleGlobalLayout({layerManager:!a.value.layerManager})};return(e,n)=>(C(),S("div",{class:F(["layer-manager",z(o).datasource.workBench?"":"full-srceen"])},[E(z(Uo),{ref_key:"dragWrapperRef",ref:t},{default:O((()=>[V(E(jo,{class:"layer-manager-panel",title:e.$t("message.panel.layerManager"),"title-class":"drag-handle",onClose:m},{default:O((()=>[E(ft,{class:"q-pt-sm"},{default:O((()=>[D("div",zo,L(e.$t("message.baseLayer")),1),D("div",Fo,[(C(!0),S(W,null,G(d.value.baseLayers,((e,t)=>(C(),k(vt,{key:t,modelValue:l.value,"onUpdate:modelValue":[n[0]||(n[0]=e=>l.value=e),p],val:e.name,label:e.text},null,8,["modelValue","val","label"])))),128))])])),_:1}),E(ht,{inset:""}),E(ft,{class:"q-pt-sm"},{default:O((()=>[D("div",Wo,L(e.$t("message.overlayLayer")),1),D("div",Go,[(C(!0),S(W,null,G(d.value.overlayLayers,((e,t)=>(C(),k(qe,{key:t,modelValue:e.props.show,"onUpdate:modelValue":[t=>e.props.show=t,t=>((e,t)=>{const n=e.name;c({names:n,show:t})})(e,t)],val:e.name,label:e.text},null,8,["modelValue","onUpdate:modelValue","val","label"])))),128))])])),_:1}),E(ht,{inset:""}),E(ft,{class:"q-pt-sm"},{default:O((()=>[D("div",qo,L(e.$t("message.terrainLayer")),1),D("div",Ho,[(C(!0),S(W,null,G(d.value.terrainLayers,((e,t)=>(C(),k(vt,{key:t,modelValue:u.value,"onUpdate:modelValue":[n[1]||(n[1]=e=>u.value=e),h],val:e.name,label:e.text},null,8,["modelValue","val","label"])))),128))])])),_:1})])),_:1},8,["title"]),[[U,z(a).layerManager]])])),_:1},512)],2))}}),[["__scopeId","data-v-179cd74a"]]),Jo=la(g({__name:"Index",setup(e){const t=w(null),{contentStyle:n,contentActiveStyle:a,thumbStyle:o,scrollAreaRef:i,verticalPositionRef:r,setScrollPosition:s,onScrollHandler:c}=Pa(),d=qi.system.useLayoutStore(),{global:l,dynamicRender:u}=Jt(d),{toggleGlobalLayout:p}=d,h=qi.viewer.useRenderStore().selectedRenderData,m=w(null),f=w("450px");P((()=>{})),Q(l,(e=>{I((()=>{var e,n;null==(n=null==(e=t.value)?void 0:e.resizeListener)||n.call(e)}))}),{deep:!0}),Q(h,(e=>{I((()=>{var t;if(null==(t=null==e?void 0:e.featureInfoListItems)?void 0:t.length){const e=m.value.$el,t=getComputedStyle(e).height,n=parseInt(t);f.value=n<680?t:"680px"}}))}));const v=R((()=>({height:f.value}))),y=()=>{p({featureInfo:!1})};return(e,o)=>(C(),S("div",{class:F(["feature-info",z(u).datasource.workBench?"":"full-srceen"])},[E(z(Uo),{ref_key:"dragWrapperRef",ref:t},{default:O((()=>[V(E(jo,{class:"feature-info-panel animated fadeIn q-ma-xs",title:"要素信息","title-class":"drag-handle",onClose:y},{default:O((()=>{var e;return[0===(null==(e=z(h))?void 0:e.featureInfoListItems.length)?(C(),k(Sa,{key:0,class:"absolute-center","show-tip":""})):A("",!0),z(r)>600?(C(),k(ze,{key:1,dense:"",fab:"",round:"",glossy:"","fab-mini":"",ripple:"",icon:"expand_less",padding:"2px",class:"absolute-bottom-right non-selectable scroll-top z-top",onClick:o[0]||(o[0]=e=>z(s)("vertical",0,300))},{default:O((()=>[E(Ue,null,{default:O((()=>[_("回到顶部")])),_:1})])),_:1})):A("",!0),E(Qe,{ref_key:"scrollAreaRef",ref:i,class:"feature-info-panel-content",style:ie(v.value),"content-style":z(n),"content-active-style":z(a),onScroll:z(c)},{default:O((()=>[E(We,{ref_key:"featureInfoListRef",ref:m,dark:"",bordered:"",separator:"",class:"feature-info-list"},{default:O((()=>{var e;return[(C(!0),S(W,null,G(null==(e=z(h))?void 0:e.featureInfoListItems,((e,t)=>V((C(),k(Ke,{key:t,clickable:""},{default:O((()=>[E(Ge,{avatar:""},{default:O((()=>[E(He,{class:"feature-info-field-icon",name:"article"})])),_:1}),E(Ge,null,{default:O((()=>[E($e,null,{default:O((()=>[_(L(e.label),1)])),_:2},1024),E($e,{caption:""},{default:O((()=>[_(L(e.value),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)),[[Je]]))),128))]})),_:1},512)])),_:1},8,["style","content-style","content-active-style","onScroll"])]})),_:1},512),[[U,z(l).featureInfo]])])),_:1},512)],2))}}),[["__scopeId","data-v-6bce411c"]]),Ko={class:"buttons-box-left"},Yo={class:"buttons-box-right"},Xo={class:"jessibuca-btn"},Qo=la(g({name:"VcDemoJessibucaPlayer",__name:"Index",props:{url:String,error:String,hasAudio:{type:Boolean,default:!0}},setup(e){const t=e,n=T(),a=w(!1),o=w(!0),i=w(!1),r=w(!1),s=w(!1);w(0);const c=w(""),d=w(0);w(null),w(1),w(0),w(!0);const l=w(""),u=w(!1),p=w(null),h=w(null);let m={};const f=q();P((()=>{let e=t.url;const a=decodeURIComponent(n.params.url);I((()=>{v(),window.onresize=()=>{v()},void 0===e&&(e=a),y(e)}))})),M((()=>{m[f.uid]&&m[f.uid].destroy(),a.value=!1,s.value=!1,c.value=""})),Q((()=>t.url),(e=>{y(e)}));const v=()=>{let e=p.value,t=e.parentNode.clientWidth,n=9/16*t;const a=Math.min(document.body.clientHeight,document.documentElement.clientHeight);n>a&&(n=a,t=16/9*n),e.style.width=t+"px",e.style.height=n+"px"},y=e=>{fn(`开始播放视频流：${e}`),m[f.uid]&&O(),g(),m[f.uid].on("play",(()=>{a.value=!0,s.value=!0,i.value=m[f.uid].quieting})),m[f.uid].hasLoaded()?m[f.uid].play(e):m[f.uid].on("load",(()=>{m[f.uid].play(e)}))},g=()=>{fn(`hasAudio: ${t.hasAudio}`),m[f.uid]=new Jessibuca({container:p.value,videoBuffer:.2,isResize:!0,decoder:"./libs/jessibuca/decoder.js",useMSE:!0,useWCS:!0,showBandwidth:!1,isFlv:!1,loadingText:"加载中",hasAudio:t.hasAudio,debug:!1,supportDblclickFullscreen:!1,operateBtns:{fullscreen:!1,screenshot:!1,play:!1,audio:!1},forceNoOffscreen:u.value,isNotMute:o.value});let e=m[f.uid];e.on("load",(function(){})),e.on("log",(function(e){})),e.on("record",(function(e){})),e.on("pause",(function(){a.value=!1})),e.on("play",(function(){a.value=!0})),e.on("fullscreen",(function(e){r.value=e})),e.on("mute",(function(e){o.value=!e})),e.on("audioInfo",(function(e){})),e.on("videoInfo",(function(e){})),e.on("bps",(function(e){})),e.on("timeUpdate",(function(e){})),e.on("videoInfo",(function(e){})),e.on("error",(function(e){})),e.on("timeout",(function(){})),e.on("start",(function(){})),e.on("performance",(function(e){let t="卡顿";2===e?t="非常流畅":1===e&&(t="流畅"),c.value=t})),e.on("buffer",(function(e){})),e.on("stats",(function(e){})),e.on("kBps",(function(e){d.value=Math.round(e)})),e.on("videoFrame",(function(){})),e.on("metadata",(function(){}))},b=()=>{let e=k();m[f.uid].setFullscreen(!e),r.value=!e},k=()=>document.fullscreenElement||document.msFullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||!1,x=()=>{y(t.url)},R=()=>{m[f.uid]&&m[f.uid].pause(),a.value=!1,l.value="",c.value=""},O=()=>{m[f.uid]&&m[f.uid].destroy(),null==h.value&&p.value.appendChild(h.value),m[f.uid]=null,a.value=!1,c.value=""},E=()=>{m[f.uid]&&m[f.uid].screenshot("截图","png",.5)};return(e,t)=>(C(),S("div",{ref_key:"palyerContainerRef",ref:p,class:"jessibuca-player",onDblclick:b},[D("div",{id:"buttonsBox",ref_key:"buttonsBoxRef",ref:h,class:"buttons-box"},[D("div",Ko,[a.value?A("",!0):(C(),S("i",{key:0,class:"iconfont icon-play jessibuca-btn",onClick:x})),a.value?(C(),S("i",{key:1,class:"iconfont icon-pause jessibuca-btn",onClick:R})):A("",!0),D("i",{class:"iconfont icon-stop jessibuca-btn",onClick:O}),o.value?(C(),S("i",{key:2,class:"iconfont icon-audio-high jessibuca-btn",onClick:t[0]||(t[0]=e=>{m[f.uid]&&m[f.uid].mute()})})):A("",!0),o.value?A("",!0):(C(),S("i",{key:3,class:"iconfont icon-audio-mute jessibuca-btn",onClick:t[1]||(t[1]=e=>{m[f.uid]&&m[f.uid].cancelMute()})}))]),D("div",Yo,[D("span",Xo,L(d.value)+" kb/s",1),D("i",{class:"iconfont icon-camera1196054easyiconnet jessibuca-btn",style:{"font-size":"1rem !important"},onClick:E}),D("i",{class:"iconfont icon-shuaxin11 jessibuca-btn",onClick:x}),r.value?A("",!0):(C(),S("i",{key:0,class:"iconfont icon-weibiaoti10 jessibuca-btn",onClick:b})),r.value?(C(),S("i",{key:1,class:"iconfont icon-weibiaoti11 jessibuca-btn",onClick:b})):A("",!0)])],512)],544))}}),[["__scopeId","data-v-4750c349"]]),Zo={class:"video-player-container"},ei=la(g({name:"VcDemoDevicePlayerPanel",__name:"Index",setup(e){const t=w(null),n=qi.system.useLayoutStore(),{global:a,dynamicRender:o}=Jt(n);Q(o,(e=>{I((()=>{var e,n;t.value&&(null==(n=(e=t.value).resizeListener)||n.call(e))}))}),{deep:!0});const i=()=>{n.toggleGlobalLayout({videoPlayer:!a.value.videoPlayer})};return(e,n)=>z(a).videoPlayer?(C(),S("div",{key:0,class:F(["device-player",z(o).datasource.workBench?"":"full-srceen"])},[E(z(Uo),{ref_key:"dragWrapperRef",ref:t},{default:O((()=>[E(jo,{class:"device-player-panel",title:e.$t("message.panel.videoPlayer"),"title-class":"drag-handle",onClose:i},{default:O((()=>[E(ft,null,{default:O((()=>[D("div",Zo,[E(Qo,{url:"https://sf1-hscdn-tos.pstatp.com/obj/media-fe/xgplayer_doc_video/flv/xgplayer-demo-720p.flv"})])])),_:1})])),_:1},8,["title"])])),_:1},512)],2)):A("",!0)}}),[["__scopeId","data-v-2aaa4040"]]),ti={class:"main-interaction"},ni={class:"panel-wrapper"},ai=la(g({name:"VcDemoInteraction",__name:"Index",setup:e=>(R((()=>{const e=qi.system.useThemeStore();return e.themeConfig[e.activeName]})),(e,t)=>(C(),S("div",ti,[D("div",ni,[E($o),E(Jo),E(ei)])])))}),[["__scopeId","data-v-4bf69a58"]]);var oi=function(e,t){var n;function a(e,t){function n(e){return!e.audio&&!e.video&&!e.screen&&e.data}var a="";a+="?userid="+e.userid,a+="&sessionid="+e.sessionid,a+="&msgEvent="+e.socketMessageEvent,a+="&socketCustomEvent="+e.socketCustomEvent,a+="&autoCloseEntireSession="+!!e.autoCloseEntireSession,!0===e.session.broadcast&&(a+="&oneToMany=true"),a+="&maxParticipantsAllowed="+e.maxParticipantsAllowed,e.enableScalableBroadcast&&(a+="&enableScalableBroadcast=true",a+="&maxRelayLimitPerUser="+(e.maxRelayLimitPerUser||2)),a+="&extra="+JSON.stringify(e.extra||{}),e.socketCustomParameters&&(a+=e.socketCustomParameters);try{io.sockets={}}catch(s){}if(e.socketURL||(e.socketURL="/"),"/"!=e.socketURL.substr(e.socketURL.length-1,1))throw'"socketURL" MUST end with a slash.';e.enableLogs&&e.socketURL;try{e.socket=io(e.socketURL+a)}catch(s){e.socket=io.connect(e.socketURL+a,e.socketOptions)}var o=e.multiPeersHandler;function i(t,n){e.peersBackup[t]||(e.peersBackup[t]={userid:t,extra:{}}),e.peersBackup[t].extra=n}e.socket.on("extra-data-updated",(function(t,n){e.peers[t]&&(e.peers[t].extra=n,e.onExtraDataUpdated({userid:t,extra:n}),i(t,n))})),e.socket.on(e.socketMessageEvent,(function t(a){if(a.remoteUserId==e.userid)if(e.peers[a.sender]&&e.peers[a.sender].extra!=a.message.extra&&(e.peers[a.sender].extra=a.extra,e.onExtraDataUpdated({userid:a.sender,extra:a.extra}),i(a.sender,a.extra)),a.message.streamSyncNeeded&&e.peers[a.sender]){var r=e.streamEvents[a.message.streamid];if(!r||!r.stream)return;var s=a.message.action;if("ended"===s||"inactive"===s||"stream-removed"===s)return e.peersBackup[r.userid]&&(r.extra=e.peersBackup[r.userid].extra),void e.onstreamended(r);var c="both"!=a.message.type?a.message.type:null;"function"==typeof r.stream[s]&&r.stream[s](c)}else if("dropPeerConnection"!==a.message){if(a.message.allParticipants)return-1===a.message.allParticipants.indexOf(a.sender)&&a.message.allParticipants.push(a.sender),void a.message.allParticipants.forEach((function(t){o[e.peers[t]?"renegotiatePeer":"createNewPeer"](t,{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:n(e.session)})}));if(a.message.newParticipant){if(a.message.newParticipant==e.userid)return;if(e.peers[a.message.newParticipant])return;o.createNewPeer(a.message.newParticipant,a.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:n(e.session)})}else if(a.message.readyForOffer&&(e.attachStreams.length&&(e.waitingForLocalMedia=!1),e.waitingForLocalMedia))setTimeout((function(){t(a)}),1);else if(a.message.newParticipationRequest&&a.sender!==e.userid){e.peers[a.sender]&&e.deletePeer(a.sender);var d={extra:a.extra||{},localPeerSdpConstraints:a.message.remotePeerSdpConstraints||{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:a.message.localPeerSdpConstraints||{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:void 0!==a.message.isOneWay?a.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:void 0!==a.message.isDataOnly?a.message.isDataOnly:n(e.session),dontGetRemoteStream:void 0!==a.message.isOneWay?a.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,dontAttachLocalStream:!!a.message.dontGetRemoteStream,connectionDescription:a,successCallback:function(){}};e.onNewParticipant(a.sender,d)}else{if(a.message.changedUUID&&e.peers[a.message.oldUUID]&&(e.peers[a.message.newUUID]=e.peers[a.message.oldUUID],delete e.peers[a.message.oldUUID]),a.message.userLeft)return o.onUserLeft(a.sender),void(a.message.autoCloseEntireSession&&e.leave());o.addNegotiatedMessage(a.message,a.sender)}}else e.deletePeer(a.sender)}));var r=!1;e.socket.resetProps=function(){r=!1},e.socket.on("connect",(function(){r||(r=!0,e.enableLogs,setTimeout((function(){e.socket.emit("extra-data-updated",e.extra)}),1e3),t&&t(e.socket))})),e.socket.on("disconnect",(function(t){e.onSocketDisconnect(t)})),e.socket.on("error",(function(t){e.onSocketError(t)})),e.socket.on("user-disconnected",(function(t){t!==e.userid&&(e.onUserStatusChanged({userid:t,status:"offline",extra:e.peers[t]&&e.peers[t].extra||{}}),e.deletePeer(t))})),e.socket.on("user-connected",(function(t){t!==e.userid&&e.onUserStatusChanged({userid:t,status:"online",extra:e.peers[t]&&e.peers[t].extra||{}})})),e.socket.on("closed-entire-session",(function(t,n){e.leave(),e.onEntireSessionClosed({sessionid:t,userid:t,extra:n})})),e.socket.on("userid-already-taken",(function(t,n){e.onUserIdAlreadyTaken(t,n)})),e.socket.on("logs",(function(t){e.enableLogs})),e.socket.on("number-of-broadcast-viewers-updated",(function(t){e.onNumberOfBroadcastViewersUpdated(t)})),e.socket.on("set-isInitiator-true",(function(t){t==e.sessionid&&(e.isInitiator=!0)}))}function o(e){var t=this,n=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];function a(){e.fbr=new FileBufferReader,e.fbr.onProgress=function(t){e.onFileProgress(t)},e.fbr.onBegin=function(t){e.onFileStart(t)},e.fbr.onEnd=function(t){e.onFileEnd(t)}}e.peers={getLength:function(){var e=0;for(var t in this)-1==n.indexOf(t)&&e++;return e},selectFirst:function(){var e;for(var t in this)-1==n.indexOf(t)&&(e=this[t]);return e},getAllParticipants:function(e){var t=[];for(var a in this)-1==n.indexOf(a)&&a!=e&&t.push(a);return t},forEach:function(t){this.getAllParticipants().forEach((function(n){t(e.peers[n])}))},send:function(n,a){var o=this;if(!p(n.size)&&!p(n.type)){if(e.enableFileSharing)return void t.shareFile(n,a);"string"!=typeof n&&(n=JSON.stringify(n))}if("text"===n.type||n instanceof ArrayBuffer||n instanceof DataView){if("text"===n.type&&(n=JSON.stringify(n)),a){var i=e.peers[a];if(i)return i.channels.length?void i.channels.forEach((function(e){e.send(n)})):(e.peers[a].createDataChannel(),e.renegotiate(a),void setTimeout((function(){o.send(n,a)}),3e3))}this.getAllParticipants().forEach((function(t){if(!o[t].channels.length)return e.peers[t].createDataChannel(),e.renegotiate(t),void setTimeout((function(){o[t].channels.forEach((function(e){e.send(n)}))}),3e3);o[t].channels.forEach((function(e){e.send(n)}))}))}else E.send({text:n,channel:this,connection:e,remoteUserId:a})}},this.uuid=e.userid,this.getLocalConfig=function(n,o,i){return i||(i={}),{streamsToShare:i.streamsToShare||{},rtcMultiConnection:e,connectionDescription:i.connectionDescription,userid:o,localPeerSdpConstraints:i.localPeerSdpConstraints,remotePeerSdpConstraints:i.remotePeerSdpConstraints,dontGetRemoteStream:!!i.dontGetRemoteStream,dontAttachLocalStream:!!i.dontAttachLocalStream,renegotiatingPeer:!!i.renegotiatingPeer,peerRef:i.peerRef,channels:i.channels||[],onLocalSdp:function(e){t.onNegotiationNeeded(e,o)},onLocalCandidate:function(n){(n=T.processCandidates(e,n))&&t.onNegotiationNeeded(n,o)},remoteSdp:n,onDataChannelMessage:function(n){if(!e.fbr&&e.enableFileSharing&&a(),"string"!=typeof n&&e.enableFileSharing){var i=this;n instanceof ArrayBuffer||n instanceof DataView?e.fbr.convertToObject(n,(function(e){i.onDataChannelMessage(e)})):n.readyForNextChunk?e.fbr.getNextChunk(n,(function(t,n){e.peers[o].channels.forEach((function(e){e.send(t)}))}),o):n.chunkMissing?e.fbr.chunkMissing(n):e.fbr.addChunk(n,(function(t){e.peers[o].peer.channel.send(t)}))}else t.onDataChannelMessage(n,o)},onDataChannelError:function(e){t.onDataChannelError(e,o)},onDataChannelOpened:function(e){t.onDataChannelOpened(e,o)},onDataChannelClosed:function(e){t.onDataChannelClosed(e,o)},onRemoteStream:function(n){e.peers[o]&&e.peers[o].streams.push(n),t.onGettingRemoteMedia(n,o)},onRemoteStreamRemoved:function(e){t.onRemovingRemoteMedia(e,o)},onPeerStateChanged:function(e){t.onPeerStateChanged(e),"new"===e.iceConnectionState&&t.onNegotiationStarted(o,e),"connected"===e.iceConnectionState&&t.onNegotiationCompleted(o,e),-1!==e.iceConnectionState.search(/closed|failed/gi)&&(t.onUserLeft(o),t.disconnectWith(o))}}},this.createNewPeer=function(t,n){if(!(e.maxParticipantsAllowed<=e.getAllParticipants().length)){if(n=n||{},e.isInitiator&&e.session.audio&&"two-way"===e.session.audio&&!n.streamsToShare&&(n.isOneWay=!1,n.isDataOnly=!1,n.session=e.session),!n.isOneWay&&!n.isDataOnly)return n.isOneWay=!0,void this.onNegotiationNeeded({enableMedia:!0,userPreferences:n},t);n=e.setUserPreferences(n,t);var a=this.getLocalConfig(null,t,n);e.peers[t]=new P(a)}},this.createAnsweringPeer=function(t,n,a){a=e.setUserPreferences(a||{},n);var o=this.getLocalConfig(t,n,a);e.peers[n]=new P(o)},this.renegotiatePeer=function(t,n,a){if(e.peers[t]){n||(n={}),n.renegotiatingPeer=!0,n.peerRef=e.peers[t].peer,n.channels=e.peers[t].channels;var o=this.getLocalConfig(a,t,n);e.peers[t]=new P(o)}else e.enableLogs},this.replaceTrack=function(t,n,a){if(!e.peers[n])throw"This peer ("+n+") does not exist.";var o=e.peers[n].peer;o.getSenders&&"function"==typeof o.getSenders&&o.getSenders().length?o.getSenders().forEach((function(o){a&&"video"===o.track.kind&&(e.peers[n].peer.lastVideoTrack=o.track,o.replaceTrack(t)),a||"audio"!==o.track.kind||(e.peers[n].peer.lastAudioTrack=o.track,o.replaceTrack(t))})):this.renegotiatePeer(n)},this.onNegotiationNeeded=function(e,t){},this.addNegotiatedMessage=function(n,a){if(n.type&&n.sdp)return"answer"==n.type&&e.peers[a]&&e.peers[a].addRemoteSdp(n),"offer"==n.type&&(n.renegotiatingPeer?this.renegotiatePeer(a,null,n):this.createAnsweringPeer(n,a)),void e.enableLogs;if(n.candidate)return e.peers[a]&&e.peers[a].addRemoteCandidate(n),void e.enableLogs;if(n.enableMedia){e.session=n.userPreferences.session||e.session,e.session.oneway&&e.attachStreams.length&&(e.attachStreams=[]),n.userPreferences.isDataOnly&&e.attachStreams.length&&(e.attachStreams.length=[]);var o={};e.attachStreams.forEach((function(e){o[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}})),n.userPreferences.streamsToShare=o,t.onNegotiationNeeded({readyForOffer:!0,userPreferences:n.userPreferences},a)}n.readyForOffer&&e.onReadyForOffer(a,n.userPreferences)},this.onGettingRemoteMedia=function(e,t){},this.onRemovingRemoteMedia=function(e,t){},this.onGettingLocalMedia=function(e){},this.onLocalMediaError=function(t,n){e.onMediaError(t,n)},this.shareFile=function(t,n){a(),e.fbr.readAsArrayBuffer(t,(function(t){var a=e.getAllParticipants();n&&(a=[n]),a.forEach((function(n){e.fbr.getNextChunk(t,(function(t){e.peers[n].channels.forEach((function(e){e.send(t)}))}),n)}))}),{userid:e.userid,chunkSize:"Firefox"===DetectRTC.browser.name?15e3:e.chunkSize||0})};var o=new O(e);this.onDataChannelMessage=function(t,n){o.receive(JSON.parse(t),n,e.peers[n]?e.peers[n].extra:{})},this.onDataChannelClosed=function(t,n){t.userid=n,t.extra=e.peers[n]?e.peers[n].extra:{},e.onclose(t)},this.onDataChannelError=function(t,n){t.userid=n,event.extra=e.peers[n]?e.peers[n].extra:{},e.onerror(t)},this.onDataChannelOpened=function(t,n){e.peers[n].channels.length?e.peers[n].channels=[t]:(e.peers[n].channels.push(t),e.onopen({userid:n,extra:e.peers[n]?e.peers[n].extra:{},channel:t}))},this.onPeerStateChanged=function(t){e.onPeerStateChanged(t)},this.onNegotiationStarted=function(e,t){},this.onNegotiationCompleted=function(e,t){},this.getRemoteStreams=function(t){return t=t||e.peers.getAllParticipants()[0],e.peers[t]?e.peers[t].streams:[]}}function i(e,t,n){if("undefined"!=typeof CustomEvent){var a=new CustomEvent(t,{arguments:n,__exposedProps__:n});e.dispatchEvent(a)}}function r(e,t){t.stream&&t.stream&&t.stream.addEventListener&&(t.stream.addEventListener("mute",(function(n){(n=e.streamEvents[t.streamid]).session={audio:"audio"===n.muteType,video:"video"===n.muteType},e.onmute(n)}),!1),t.stream.addEventListener("unmute",(function(n){(n=e.streamEvents[t.streamid]).session={audio:"audio"===n.unmuteType,video:"video"===n.unmuteType},e.onunmute(n)}),!1))}function s(){if(window.crypto&&window.crypto.getRandomValues&&-1===navigator.userAgent.indexOf("Safari")){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),t="",n=0,a=e.length;n<a;n++)t+=e[n].toString(36);return t}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function c(e,t,n){if(n.autoCreateMediaElement){var a=!1;f(e,"video").length||e.isVideo||e.isScreen||(a=!0),"Firefox"===DetectRTC.browser.name&&(n.session.video||n.session.screen)&&(a=!1);var o=document.createElement(a?"audio":"video");if(o.srcObject=e,o.setAttribute("autoplay",!0),o.setAttribute("playsinline",!0),o.setAttribute("controls",!0),o.setAttribute("muted",!1),o.setAttribute("volume",1),"Firefox"===DetectRTC.browser.name){var i="ended";"oninactive"in o&&(i="inactive"),o.addEventListener(i,(function(){if(currentUserMediaRequest.remove(e.idInstance),"local"===e.type){i="ended","oninactive"in e&&(i="inactive"),I.onSyncNeeded(e.streamid,i),n.attachStreams.forEach((function(t,a){e.streamid===t.streamid&&delete n.attachStreams[a]}));var t=[];n.attachStreams.forEach((function(e){e&&t.push(e)})),n.attachStreams=t;var a=n.streamEvents[e.streamid];if(a)return void n.onstreamended(a);this.parentNode&&this.parentNode.removeChild(this)}}),!1)}var r=o.play();if(void 0!==r){var s=!1;setTimeout((function(){s||(s=!0,t(o))}),1e3),r.then((function(){s||(s=!0,t(o))})).catch((function(e){s||(s=!0,t(o))}))}else t(o)}else t({})}function d(e,t){window.removeEventListener(e,t),window.addEventListener(e,t,!1)}function l(e){var t=[];return e.forEach((function(e){e&&t.push(e)})),t}function u(e){return!e.audio&&!e.video&&!e.screen&&e.data}function p(e){return void 0===e}(n="undefined"!=typeof global?global:null)&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},global.console||(global.console={}),void 0===global.console.debug&&(global.console.debug=global.console.info=global.console.error=global.console.log=global.console.log||function(){}),"undefined"==typeof document&&(n.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},document.addEventListener=document.removeEventListener=n.addEventListener=n.removeEventListener=function(){},n.HTMLVideoElement=n.HTMLMediaElement=function(){}),"undefined"==typeof io&&(n.io=function(){return{on:function(e,t){t=t||function(){},"connect"===e&&t()},emit:function(e,t,n){n=n||function(){},"open-room"!==e&&"join-room"!==e||n(!0,t.sessionid,null)}}}),"undefined"==typeof location&&(n.location={protocol:"file:",href:"",hash:"",origin:"self"}),"undefined"==typeof screen&&(n.screen={width:0,height:0}),"undefined"==typeof URL&&(n.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),n.window=global),function(){var e="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";if(y="object"==typeof process&&"object"==typeof process.versions&&process.versions.node&&!process.browser){var t=process.versions.node.toString().replace("v","");e="Nodejs/"+t+" (NodeOS) AppleWebKit/"+t+" (KHTML, like Gecko) Nodejs/"+t+" Nodejs/"+t}!function(t){"undefined"==typeof window&&("undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:e,getUserMedia:function(){}},t.window=global),"undefined"==typeof location&&(t.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(t.screen={width:0,height:0}))}("undefined"!=typeof global?global:window);var n=window.navigator;void 0!==n?(void 0!==n.webkitGetUserMedia&&(n.getUserMedia=n.webkitGetUserMedia),void 0!==n.mozGetUserMedia&&(n.getUserMedia=n.mozGetUserMedia)):n={getUserMedia:function(){},userAgent:e};var a=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(n.userAgent||""),o=!(-1===n.userAgent.indexOf("Edge")||!n.msSaveOrOpenBlob&&!n.msSaveBlob),i=!!window.opera||n.userAgent.indexOf(" OPR/")>=0,r=void 0!==window.InstallTrigger,s=/^((?!chrome|android).)*safari/i.test(n.userAgent),c=!!window.chrome&&!i,d="undefined"!=typeof document&&!!document.documentMode&&!o;function l(e,t){var n=0,a=!1,o=window.setInterval((function(){e()&&(window.clearInterval(o),t(a)),n++>50&&(window.clearInterval(o),t(a=!0))}),10)}var u={Android:function(){return n.userAgent.match(/Android/i)},BlackBerry:function(){return n.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return n.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return n.userAgent.match(/Opera Mini/i)},Windows:function(){return n.userAgent.match(/IEMobile/i)},any:function(){return u.Android()||u.BlackBerry()||u.iOS()||u.Opera()||u.Windows()},getOsName:function(){var e="Unknown OS";return u.Android()&&(e="Android"),u.BlackBerry()&&(e="BlackBerry"),u.iOS()&&(e="iOS"),u.Opera()&&(e="Opera Mini"),u.Windows()&&(e="Windows"),e}};var p="Unknown OS",h="Unknown OS Version";var m,f,v=function(){for(var e,t=n.appVersion,a=n.userAgent,o="-",i=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],r=0;e=i[r];r++)if(e.r.test(a)){o=e.s;break}var s="-";switch(/Windows/.test(o)&&(/Windows (.*)/.test(o)&&(s=/Windows (.*)/.exec(o)[1]),o="Windows"),o){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(a)&&(s=/Mac OS X (10[\.\_\d]+)/.exec(a)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(a)&&(s=/Android ([\.\_\d]+)/.exec(a)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(a)&&(s=(s=/OS (\d+)_(\d+)_?(\d+)?/.exec(t))[1]+"."+s[2]+"."+(0|s[3]))}return{osName:o,osVersion:s}}();v&&v.osName&&"-"!=v.osName?(p=v.osName,h=v.osVersion):u.any()&&"Android"==(p=u.getOsName())&&(h=!!(f=(m=(m||n.userAgent).toLowerCase()).match(/android\s([0-9\.]*)/))&&f[1]);var y="object"==typeof process&&"object"==typeof process.versions&&process.versions.node;"Unknown OS"===p&&y&&(p="Nodejs",h=process.versions.node.toString().replace("v",""));var g=!1,b=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach((function(e){"undefined"!=typeof document&&"function"==typeof document.createElement&&(!g&&e in document.createElement("canvas")&&(g=!0),!b&&e in document.createElement("video")&&(b=!0))}));var C=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,k=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,S=/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/;var P=[],M=[],T=[],x=[];n.mediaDevices&&n.mediaDevices.enumerateDevices&&(n.enumerateDevices=function(e){var t=n.mediaDevices.enumerateDevices();t&&t.then?n.mediaDevices.enumerateDevices().then(e).catch((function(){e([])})):e([])});var R=!1;(void 0!==w&&"getSources"in w||n.mediaDevices&&n.mediaDevices.enumerateDevices)&&(R=!0);var I=!1,O=!1,E=!1,_=!1,L=!1;var D=window.DetectRTC||{};D.browser=function(){n.appVersion;var e,t,a,l=n.userAgent,u=n.appName,p=""+parseFloat(n.appVersion),h=parseInt(n.appVersion,10);if(s&&!c&&-1!==l.indexOf("CriOS")&&(s=!1,c=!0),i){u="Opera";try{h=(p=n.userAgent.split("OPR/")[1].split(" ")[0]).split(".")[0]}catch(m){p="0.0.0.0",h=0}}else d?((t=l.indexOf("rv:"))>0?p=l.substring(t+3):(t=l.indexOf("MSIE"),p=l.substring(t+5)),u="IE"):c?(t=l.indexOf("Chrome"),u="Chrome",p=l.substring(t+7)):s?(t=l.indexOf("Safari"),u="Safari",p=l.substring(t+7),-1!==(t=l.indexOf("Version"))&&(p=l.substring(t+8)),-1!==n.userAgent.indexOf("Version/")&&(p=n.userAgent.split("Version/")[1].split(" ")[0])):r?(t=l.indexOf("Firefox"),u="Firefox",p=l.substring(t+8)):(e=l.lastIndexOf(" ")+1)<(t=l.lastIndexOf("/"))&&(u=l.substring(e,t),p=l.substring(t+1),u.toLowerCase()===u.toUpperCase()&&(u=n.appName));return o&&(u="Edge",p=n.userAgent.split("Edge/")[1]),-1!==(a=p.search(/[; \)]/))&&(p=p.substring(0,a)),h=parseInt(""+p,10),isNaN(h)&&(p=""+parseFloat(n.appVersion),h=parseInt(n.appVersion,10)),{fullVersion:p,version:h,name:u,isPrivateBrowsing:!1}}(),function(e){var t;try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,(function(){t=!1}),(function(e){t=!0}));else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var n;try{(n=window.indexedDB.open("test")).onerror=function(){return!0}}catch(a){t=!0}void 0===t&&l((function(){return"done"===n.readyState}),(function(e){e||(t=!n.result)}))}else if(function(e){var t=e.toLowerCase();if(0===t.indexOf("msie")&&0===t.indexOf("trident"))return!1;var n=/(?:msie|rv:)\s?([\d\.]+)/.exec(t);return!!(n&&parseInt(n[1],10)>=10)}(window.navigator.userAgent)){t=!1;try{window.indexedDB||(t=!0)}catch(a){t=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(a){t=!0}void 0===t&&(t=!1,window.localStorage.removeItem("test"))}}catch(a){t=!1}l((function(){return void 0!==t}),(function(n){e(t)}))}((function(e){D.browser.isPrivateBrowsing=!!e})),D.browser["is"+D.browser.name]=!0,D.osName=p,D.osVersion=h,"object"==typeof process&&"object"==typeof process.versions&&process.versions["node-webkit"];var A=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach((function(e){A||e in window&&(A=!0)})),D.isWebRTCSupported=A,D.isORTCSupported="undefined"!=typeof RTCIceGatherer;var B=!1;((D.browser.isChrome&&D.browser.version>=35||D.browser.isFirefox&&D.browser.version>=34||D.browser.isEdge&&D.browser.version>=17||"Android"===D.osName&&D.browser.isChrome)&&(B=!0),/^(https:|chrome-extension:)$/g.test(location.protocol||""))||("undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(D.browser.isChrome||D.browser.isEdge||D.browser.isOpera)||D.browser.isFirefox)&&(B=!1);D.isScreenCapturingSupported=B;var N={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach((function(e){N.isSupported||e in window&&(N.isSupported=!0,window[e]&&"createMediaStreamSource"in window[e].prototype&&(N.isCreateMediaStreamSourceSupported=!0))})),D.isAudioContextSupported=N.isSupported,D.isCreateMediaStreamSourceSupported=N.isCreateMediaStreamSourceSupported;var V=!1;D.browser.isChrome&&D.browser.version>31&&(V=!0),D.isRtpDataChannelsSupported=V;var j=!1;(D.browser.isFirefox&&D.browser.version>28||D.browser.isChrome&&D.browser.version>25||D.browser.isOpera&&D.browser.version>=11)&&(j=!0),D.isSctpDataChannelsSupported=j,D.isMobileDevice=a;var U=!1;(n.getUserMedia||n.mediaDevices&&n.mediaDevices.getUserMedia)&&(U=!0),D.browser.isChrome&&D.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(U="Requires HTTPs"),"Nodejs"===D.osName&&(U=!1),D.isGetUserMediaSupported=U;var z,F,W,G="";screen.width&&(G+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:""));D.displayResolution=G,D.displayAspectRatio=(z=screen.width,F=screen.height,W=function e(t,n){return 0==n?t:e(n,t%n)}(z,F),z/W/(F/W)).toFixed(2),D.isCanvasSupportsStreamCapturing=g,D.isVideoSupportsStreamCapturing=b,"Chrome"==D.browser.name&&D.browser.version>=53&&(D.isCanvasSupportsStreamCapturing||(D.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),D.isVideoSupportsStreamCapturing||(D.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),D.DetectLocalIPAddress=function(e,t){if(D.isWebRTCSupported){var n=!0,a=!0;!function(e,t){if("undefined"==typeof document||"function"!=typeof document.getElementById)return;var n={},a=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!a){var o=document.getElementById("iframe");if(!o)return;var i=o.contentWindow;a=i.RTCPeerConnection||i.mozRTCPeerConnection||i.webkitRTCPeerConnection}if(!a)return;var r=null;"Chrome"===D.browser&&D.browser.version<58&&(r={optional:[{RtpDataChannels:!0}]});var s=new a({iceServers:[{urls:"stun:stun.l.google.com:19302"}]},r);t&&(s.addStream?s.addStream(t):s.addTrack&&t.getTracks()[0]&&s.addTrack(t.getTracks()[0],t));function c(t){if(t){var a=k.exec(t);if(a){var o=a[1],i=t.match(C),r=!0;void 0===n[o]&&e(o,i,r),n[o]=!0}}else e()}if(s.onicecandidate=function(e){e.candidate&&e.candidate.candidate?c(e.candidate.candidate):c()},!t)try{s.createDataChannel("sctp",{})}catch(l){}D.isPromisesSupported?s.createOffer().then((function(e){s.setLocalDescription(e).then(d)})):s.createOffer((function(e){s.setLocalDescription(e,d,(function(){}))}),(function(){}));function d(){s.localDescription.sdp.split("\n").forEach((function(e){e&&0===e.indexOf("a=candidate:")&&c(e)}))}}((function(t){t?t.match(C)?e("Local: "+t,n=!1,a):t.match(S)?e("Public: "+t,n,a=!1):e("Public: "+t,n,a):e()}),t)}},D.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,D.isWebSocketsBlocked=!D.isWebSocketsSupported,"Nodejs"===D.osName&&(D.isWebSocketsSupported=!0,D.isWebSocketsBlocked=!1),D.checkWebSocketsSupport=function(e){e=e||function(){};try{var t,n=new WebSocket("wss://echo.websocket.org:443/");n.onopen=function(){D.isWebSocketsBlocked=!1,t=(new Date).getTime(),n.send("ping")},n.onmessage=function(){D.WebsocketLatency=(new Date).getTime()-t+"ms",e(),n.close(),n=null},n.onerror=function(){D.isWebSocketsBlocked=!0,e()}}catch(a){D.isWebSocketsBlocked=!0,e()}},D.load=function(e){!function(e){if(R)if(!n.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(n.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!n.enumerateDevices&&n.enumerateDevices&&(n.enumerateDevices=n.enumerateDevices.bind(n)),n.enumerateDevices){P=[],M=[],T=[],x=[],I=!1,O=!1,E=!1,_=!1,L=!1;var t={};n.enumerateDevices((function(n){n.forEach((function(e){var n={};for(var a in e)try{"function"!=typeof e[a]&&(n[a]=e[a])}catch(o){}t[n.deviceId+n.label+n.kind]||("audio"===n.kind&&(n.kind="audioinput"),"video"===n.kind&&(n.kind="videoinput"),n.deviceId||(n.deviceId=n.id),n.id||(n.id=n.deviceId),n.label?("videoinput"!==n.kind||L||(L=!0),"audioinput"!==n.kind||_||(_=!0)):(n.isCustomLabel=!0,"videoinput"===n.kind?n.label="Camera "+(x.length+1):"audioinput"===n.kind?n.label="Microphone "+(M.length+1):"audiooutput"===n.kind?n.label="Speaker "+(T.length+1):n.label="Please invoke getUserMedia once.",void 0!==D&&D.browser.isChrome&&D.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(n.label="HTTPs is required to get label of this "+n.kind+" device.")),"audioinput"===n.kind&&(I=!0,-1===M.indexOf(n)&&M.push(n)),"audiooutput"===n.kind&&(O=!0,-1===T.indexOf(n)&&T.push(n)),"videoinput"===n.kind&&(E=!0,-1===x.indexOf(n)&&x.push(n)),P.push(n),t[n.deviceId+n.label+n.kind]=n)})),void 0!==D&&(D.MediaDevices=P,D.hasMicrophone=I,D.hasSpeakers=O,D.hasWebcam=E,D.isWebsiteHasWebcamPermissions=L,D.isWebsiteHasMicrophonePermissions=_,D.audioInputDevices=M,D.audioOutputDevices=T,D.videoInputDevices=x),e&&e()}))}else e&&e();else e&&e()}(e=e||function(){})},D.MediaDevices=void 0!==P?P:[],D.hasMicrophone=I,D.hasSpeakers=O,D.hasWebcam=E,D.isWebsiteHasWebcamPermissions=L,D.isWebsiteHasMicrophonePermissions=_,D.audioInputDevices=M,D.audioOutputDevices=T,D.videoInputDevices=x;var q=!1;"undefined"!=typeof document&&"function"==typeof document.createElement&&"setSinkId"in document.createElement("video")&&(q=!0),D.isSetSinkIdSupported=q;var H=!1;D.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(H=!0):D.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(H=!0),D.isRTPSenderReplaceTracksSupported=H;var $=!1;D.browser.isFirefox&&D.browser.version>38&&($=!0),D.isRemoteStreamProcessingSupported=$;var J=!1;void 0!==w&&"applyConstraints"in w.prototype&&(J=!0),D.isApplyConstraintsSupported=J;var K=!1;D.browser.isFirefox&&D.browser.version>=43&&(K=!0),D.isMultiMonitorScreenCapturingSupported=K,D.isPromisesSupported=!!("Promise"in window),D.version="1.3.9",void 0===D&&(window.DetectRTC={});var Y=window.MediaStream;void 0===Y&&"undefined"!=typeof webkitMediaStream&&(Y=webkitMediaStream),D.MediaStream=void 0!==Y&&"function"==typeof Y&&Object.keys(Y.prototype),D.MediaStreamTrack=void 0!==w&&Object.keys(w.prototype);var X=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;D.RTCPeerConnection=void 0!==X&&Object.keys(X.prototype),window.DetectRTC=D,"undefined"!=typeof module&&(module.exports=D),"function"==typeof define&&define.amd&&define("DetectRTC",[],(function(){return D}))}(),"undefined"!=typeof cordova&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Crosswalk")&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),window.addEventListener||(window.addEventListener=function(e,t,n){e.attachEvent&&e.attachEvent("on"+t,n)}),window.attachEventListener=function(e,t,n,a){e.addEventListener(t,n,a)};var h=window.MediaStream;function m(e,t){return(!e.session.audio||"two-way"!==e.session.audio)&&("Firefox"===DetectRTC.browser.name&&!1!==t||!("Chrome"!==DetectRTC.browser.name||DetectRTC.browser.version<50)&&(!0===typeof t||!(void 0!==t||!e.session.audio||!e.session.screen||e.session.video)&&(t=!0,!0)))}function f(e,t){return e&&e.getTracks?e.getTracks().filter((function(e){return e.kind===(t||"audio")})):[]}function v(){var e=!1;try{if("undefined"==typeof RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var t=new g;try{t.addTransceiver("audio"),e=!0}catch(n){}t.close()}catch(n){e=!1}return e&&function(){var e=!1;try{var t=new g({sdpSemantics:"unified-plan"});try{var a=t.getConfiguration();e="unified-plan"==a.sdpSemantics||(a.sdpSemantics,!1)}catch(n){e=!1}}catch(n){e=!1}return e}()}function y(){if("undefined"!=typeof cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc){var e=cordova.plugins.iosrtc;window.webkitRTCPeerConnection=e.RTCPeerConnection,window.RTCSessionDescription=e.RTCSessionDescription,window.RTCIceCandidate=e.RTCIceCandidate,window.MediaStream=e.MediaStream,window.MediaStreamTrack=e.MediaStreamTrack,navigator.getUserMedia=navigator.webkitGetUserMedia=e.getUserMedia,e.debug.enable("iosrtc*"),"function"==typeof e.selectAudioOutput&&e.selectAudioOutput(window.iOSDefaultAudioOutputDevice||"speaker"),e.registerGlobals()}}void 0===h&&"undefined"!=typeof webkitMediaStream&&(h=webkitMediaStream),void 0!==h&&("stop"in h.prototype||(h.prototype.stop=function(){this.getTracks().forEach((function(e){e.stop()}))})),window.iOSDefaultAudioOutputDevice=window.iOSDefaultAudioOutputDevice||"speaker",document.addEventListener("deviceready",y,!1),y();var g,b={};function C(e){return{OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo}}void 0!==window.RTCPeerConnection?g=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?g=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(g=webkitRTCPeerConnection);var k=window.RTCSessionDescription||window.mozRTCSessionDescription,S=window.RTCIceCandidate||window.mozRTCIceCandidate,w=window.MediaStreamTrack;function P(e){if(void 0!==window.RTCPeerConnection?g=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?g=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(g=webkitRTCPeerConnection),k=window.RTCSessionDescription||window.mozRTCSessionDescription,S=window.RTCIceCandidate||window.mozRTCIceCandidate,w=window.MediaStreamTrack,!g)throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser.";var t=e.rtcMultiConnection;this.extra=e.remoteSdp?e.remoteSdp.extra:t.extra,this.userid=e.userid,this.streams=[],this.channels=e.channels||[],this.connectionDescription=e.connectionDescription,this.addStream=function(e){t.addStream(e,n.userid)},this.removeStream=function(e){t.removeStream(e,n.userid)};var n=this;e.remoteSdp&&(this.connectionDescription=e.remoteSdp.connectionDescription);var a,o={};b.sdpConstraints=C({OfferToReceiveAudio:!0,OfferToReceiveVideo:!0});var i=!!e.renegotiatingPeer;e.remoteSdp&&(i=!!e.remoteSdp.renegotiatingPeer);var r=[];if(t.attachStreams.forEach((function(e){e&&r.push(e)})),i)a=e.peerRef;else{var s="all";(t.candidates.turn||t.candidates.relay)&&(t.candidates.stun||t.candidates.reflexive||t.candidates.host||(s="relay"));try{var c={iceServers:t.iceServers,iceTransportPolicy:t.iceTransportPolicy||s};void 0!==t.iceCandidatePoolSize&&(c.iceCandidatePoolSize=t.iceCandidatePoolSize),void 0!==t.bundlePolicy&&(c.bundlePolicy=t.bundlePolicy),void 0!==t.rtcpMuxPolicy&&(c.rtcpMuxPolicy=t.rtcpMuxPolicy),t.sdpSemantics&&(c.sdpSemantics=t.sdpSemantics||"unified-plan"),t.iceServers&&t.iceServers.length||(c=null,t.optionalArgument=null),a=new g(c,t.optionalArgument)}catch(y){try{c={iceServers:t.iceServers};a=new g(c)}catch(P){a=new g}}}!a.getRemoteStreams&&a.getReceivers&&(a.getRemoteStreams=function(){var e=new h;return a.getReceivers().forEach((function(t){e.addTrack(t.track)})),[e]}),!a.getLocalStreams&&a.getSenders&&(a.getLocalStreams=function(){var e=new h;return a.getSenders().forEach((function(t){e.addTrack(t.track)})),[e]}),a.onicecandidate=function(o){if(o.candidate)t.trickleIce&&e.onLocalCandidate({candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex});else if(!t.trickleIce){var i=a.localDescription;e.onLocalSdp({type:i.type,sdp:i.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:n.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:t?t.extra:{},streamsToShare:m})}},r.forEach((function(o){e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream||e.dontAttachLocalStream||(o=t.beforeAddingStream(o,n))&&(a.getLocalStreams().forEach((function(e){o&&e.id==o.id&&(o=null)})),o&&o.getTracks&&o.getTracks().forEach((function(e){try{a.addTrack(e,o)}catch(y){}})))})),a.oniceconnectionstatechange=a.onsignalingstatechange=function(){var o=n.extra;t.peers[n.userid]&&(o=t.peers[n.userid].extra||o),a&&(e.onPeerStateChanged({iceConnectionState:a.iceConnectionState,iceGatheringState:a.iceGatheringState,signalingState:a.signalingState,extra:o,userid:n.userid}),a&&a.iceConnectionState&&-1!==a.iceConnectionState.search(/closed|failed/gi)&&n.streams instanceof Array&&n.streams.forEach((function(e){var n=t.streamEvents[e.id]||{streamid:e.id,stream:e,type:"remote"};t.onstreamended(n)})))};var d={OfferToReceiveAudio:!!r.length,OfferToReceiveVideo:!!r.length};e.localPeerSdpConstraints&&(d=e.localPeerSdpConstraints),b.sdpConstraints=C(d);var l={};a.ontrack=function(t){if(t&&"track"===t.type)if(t.stream=t.streams[t.streams.length-1],t.stream.id||(t.stream.id=t.track.id),l[t.stream.id]&&"Safari"!==DetectRTC.browser.name)t.track&&(t.track.onended=function(){a&&a.onremovestream(t)});else{l[t.stream.id]=t.stream.id;var n={};e.remoteSdp&&e.remoteSdp.streamsToShare?n=e.remoteSdp.streamsToShare:e.streamsToShare&&(n=e.streamsToShare);var i=n[t.stream.id];i?(t.stream.isAudio=i.isAudio,t.stream.isVideo=i.isVideo,t.stream.isScreen=i.isScreen):(t.stream.isVideo=!!f(t.stream,"video").length,t.stream.isAudio=!t.stream.isVideo,t.stream.isScreen=!1),t.stream.streamid=t.stream.id,o[t.stream.id]=t.stream,e.onRemoteStream(t.stream),t.stream.getTracks().forEach((function(e){e.onended=function(){a&&a.onremovestream(t)}})),t.stream.onremovetrack=function(){a&&a.onremovestream(t)}}},a.onremovestream=function(t){t.stream.streamid=t.stream.id,o[t.stream.id]&&delete o[t.stream.id],e.onRemoteStreamRemoved(t.stream)},"function"!=typeof a.removeStream&&(a.removeStream=function(e){e.getTracks().forEach((function(t){a.removeTrack(t,e)}))}),this.addRemoteCandidate=function(e){a.addIceCandidate(new S(e))},this.addRemoteSdp=function(e,n){n=n||function(){},"Safari"!==DetectRTC.browser.name&&(e.sdp=t.processSdp(e.sdp)),a.setRemoteDescription(new k(e)).then(n,(function(e){t.enableLogs,n()})).catch((function(e){t.enableLogs,n()}))};var u=!0;function p(t){t.binaryType="arraybuffer",t.onmessage=function(t){e.onDataChannelMessage(t.data)},t.onopen=function(){e.onDataChannelOpened(t)},t.onerror=function(t){e.onDataChannelError(t)},t.onclose=function(t){e.onDataChannelClosed(t)},t.internalSend=t.send,t.send=function(e){"open"===t.readyState&&t.internalSend(e)},a.channel=t}e.remoteSdp&&(u=!1),this.createDataChannel=function(){p(a.createDataChannel("sctp",{}))},!0!==t.session.data||i||(u?this.createDataChannel():a.ondatachannel=function(e){p(e.channel)}),this.enableDisableVideoEncoding=function(e){var t;if(a.getSenders().forEach((function(e){t||"video"!==e.track.kind||(t=e)})),t&&t.getParameters){var n=t.getParameters();n.encodings[1]&&(n.encodings[1].active=!!e),n.encodings[2]&&(n.encodings[2].active=!!e),t.setParameters(n)}},e.remoteSdp&&(e.remoteSdp.remotePeerSdpConstraints&&(d=e.remoteSdp.remotePeerSdpConstraints),b.sdpConstraints=C(d),this.addRemoteSdp(e.remoteSdp,(function(){v("createAnswer")}))),"two-way"!=t.session.audio&&"two-way"!=t.session.video&&"two-way"!=t.session.screen||(b.sdpConstraints=C({OfferToReceiveAudio:"two-way"==t.session.audio||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio,OfferToReceiveVideo:"two-way"==t.session.video||"two-way"==t.session.screen||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio}));var m={};function v(o){a[o](b.sdpConstraints).then((function(o){"Safari"!==DetectRTC.browser.name&&(o.sdp=t.processSdp(o.sdp)),a.setLocalDescription(o).then((function(){t.trickleIce&&(e.onLocalSdp({type:o.type,sdp:o.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:n.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:t?t.extra:{},streamsToShare:m}),t.onSettingLocalDescription(n))}),(function(e){t.enableLogs}))}),(function(e){t.enableLogs}))}a.getLocalStreams().forEach((function(e){m[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}})),u&&v("createOffer"),a.nativeClose=a.close,a.close=function(){if(a){try{a.nativeClose!==a.close&&a.nativeClose()}catch(y){}a=null,n.peer=null}},this.peer=a}var M=function(){function e(e,a){var o=n(e);return o.videoCodecNumbers?"vp8"===a&&o.vp8LineNumber===o.videoCodecNumbers[0]||"vp9"===a&&o.vp9LineNumber===o.videoCodecNumbers[0]||"h264"===a&&o.h264LineNumber===o.videoCodecNumbers[0]?e:e=t(e,a,o):e}function t(e,t,n,a){var o="";if("vp8"===t){if(!n.vp8LineNumber)return e;o=n.vp8LineNumber}if("vp9"===t){if(!n.vp9LineNumber)return e;o=n.vp9LineNumber}if("h264"===t){if(!n.h264LineNumber)return e;o=n.h264LineNumber}var i=n.videoCodecNumbersOriginal.split("SAVPF")[0]+"SAVPF ",r=[o];return a&&(r=[]),n.videoCodecNumbers.forEach((function(e){e!==o&&r.push(e)})),i+=r.join(" "),e=e.replace(n.videoCodecNumbersOriginal,i)}function n(e){var t={};return e.split("\n").forEach((function(e){0===e.indexOf("m=video")&&(t.videoCodecNumbers=[],e.split("SAVPF")[1].split(" ").forEach((function(n){(n=n.trim())&&n.length&&(t.videoCodecNumbers.push(n),t.videoCodecNumbersOriginal=e)}))),-1===e.indexOf("VP8/90000")||t.vp8LineNumber||(t.vp8LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("VP9/90000")||t.vp9LineNumber||(t.vp9LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("H264/90000")||t.h264LineNumber||(t.h264LineNumber=e.replace("a=rtpmap:","").split(" ")[0])})),t}function a(e,t,n){return function(e,t,n,a,o){for(var i=-1!==n?n:e.length,r=t;r<i;++r)if(0===e[r].indexOf(a)&&(!o||-1!==e[r].toLowerCase().indexOf(o.toLowerCase())))return r;return null}(e,0,-1,t,n)}function o(e){var t=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),n=e.match(t);return n&&2===n.length?n[1]:null}return{removeVPX:function(e){var a=n(e);return e=t(e,"vp9",a,!0),e=t(e,"vp8",a,!0)},disableNACK:function(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return e=(e=(e=(e=e.replace("a=rtcp-fb:126 nack\r\n","")).replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n")).replace("a=rtcp-fb:97 nack\r\n","")).replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n")},prioritize:function(e,t){if(t&&t.getSenders&&t.getSenders().length){if(!e||"string"!=typeof e)throw"Invalid arguments.";t.getSenders().forEach((function(t){for(var n=t.getParameters(),a=0;a<n.codecs.length;a++)if(n.codecs[a].mimeType==e){n.codecs.unshift(n.codecs.splice(a,1));break}t.setParameters(n)}))}},removeNonG722:function(e){return e.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")},setApplicationSpecificBandwidth:function(e,t,n){return function(e,t,n){return t?("undefined"!=typeof isFirefox&&isFirefox||(n&&t.screen&&t.screen,t.screen&&n&&(e=(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")).replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.screen+"\r\n")),(t.audio||t.video)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),t.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+t.audio+"\r\n")),t.screen?e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.screen+"\r\n"):t.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.video+"\r\n"))),e):e}(e,t,n)},setVideoBitrates:function(e,t){return function(e,t){var n,i=(t=t||{}).min,r=t.max,s=e.split("\r\n"),c=a(s,"a=rtpmap","VP8/90000");if(c&&(n=o(s[c])),!n)return e;var d,l=a(s,"a=rtpmap","rtx/90000");if(l&&(d=o(s[l])),!l)return e;var u=a(s,"a=fmtp:"+d.toString());if(null!==u){var p="\r\n";p+="a=fmtp:"+n+" x-google-min-bitrate="+(i||"228")+"; x-google-max-bitrate="+(r||"228"),s[u]=s[u].concat(p),e=s.join("\r\n")}return e}(e,t)},setOpusAttributes:function(e,t){return function(e,t){t=t||{};var n,i=e.split("\r\n"),r=a(i,"a=rtpmap","opus/48000");if(r&&(n=o(i[r])),!n)return e;var s=a(i,"a=fmtp:"+n.toString());if(null===s)return e;var c="";return c+="; stereo="+(void 0!==t.stereo?t.stereo:"1"),c+="; sprop-stereo="+(void 0!==t["sprop-stereo"]?t["sprop-stereo"]:"1"),void 0!==t.maxaveragebitrate&&(c+="; maxaveragebitrate="+(t.maxaveragebitrate||1048576)),void 0!==t.maxplaybackrate&&(c+="; maxplaybackrate="+(t.maxplaybackrate||1048576)),void 0!==t.cbr&&(c+="; cbr="+(void 0!==t.cbr?t.cbr:"1")),void 0!==t.useinbandfec&&(c+="; useinbandfec="+t.useinbandfec),void 0!==t.usedtx&&(c+="; usedtx="+t.usedtx),void 0!==t.maxptime&&(c+="\r\na=maxptime:"+t.maxptime),i[s]=i[s].concat(c),i.join("\r\n")}(e,t)},preferVP9:function(t){return e(t,"vp9")},preferCodec:e,forceStereoAudio:function(e){for(var t=e.split("\r\n"),n=null,a=0;a<t.length;a++)if(-1!==t[a].search("opus/48000")){var o=extractSdp(t[a],/:(\d+) opus\/48000/i);break}for(a=0;a<t.length;a++){if(-1!==t[a].search("a=fmtp"))if(extractSdp(t[a],/a=fmtp:(\d+)/)===o){n=a;break}}return null===n?e:(t[n]=t[n].concat("; stereo=1; sprop-stereo=1"),e=t.join("\r\n"))}}}();window.BandwidthHandler=M;var T={processCandidates:function(e,t){var n=t.candidate,a=e.candidates,o=a.stun,i=a.turn;if(p(a.reflexive)||(o=a.reflexive),p(a.relay)||(i=a.relay),(a.host||!n.match(/typ host/g))&&(i||!n.match(/typ relay/g))&&(o||!n.match(/typ srflx/g))){var r=e.iceProtocols;if((r.udp||!n.match(/ udp /g))&&(r.tcp||!n.match(/ tcp /g)))return e.enableLogs,{candidate:n,sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex}}}},x={getIceServers:function(e){return[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun.l.google.com:19302?transport=udp"]}]}};function R(e){if(!0!==currentUserMediaRequest.mutex){currentUserMediaRequest.mutex=!0;var t=JSON.stringify(e.localMediaConstraints);if(currentUserMediaRequest.streams[t])i(currentUserMediaRequest.streams[t].stream,!0);else{if(!!/BB10|BlackBerry/i.test(navigator.userAgent||"")||void 0===navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia)return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,void navigator.getUserMedia(e.localMediaConstraints,(function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=t,i(e)}),(function(t){e.onLocalMediaError(t,e.localMediaConstraints)}));if(void 0===navigator.mediaDevices){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var n,a,o=function(){};navigator.mediaDevices={getUserMedia:function(e){return navigator.getUserMedia(e,(function(e){e(stream),n=stream}),(function(e){o(e),a=e})),{then:function(e){if(!n)return{then:function(e){a?e(a):o=e}};e(n)}}}}}if(!0===e.localMediaConstraints.isScreen){if(navigator.mediaDevices.getDisplayMedia)navigator.mediaDevices.getDisplayMedia(e.localMediaConstraints).then((function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=t,i(e)})).catch((function(t){e.onLocalMediaError(t,e.localMediaConstraints)}));else{if(!navigator.getDisplayMedia)throw new Error("getDisplayMedia API is not availabe in this browser.");navigator.getDisplayMedia(e.localMediaConstraints).then((function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=t,i(e)})).catch((function(t){e.onLocalMediaError(t,e.localMediaConstraints)}))}return}navigator.mediaDevices.getUserMedia(e.localMediaConstraints).then((function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=t,i(e)})).catch((function(t){e.onLocalMediaError(t,e.localMediaConstraints)}))}}else currentUserMediaRequest.queueRequests.push(e);function i(n,a){!function(e,t){e.mandatory&&e.mandatory.chromeMediaSource||e.mozMediaSource||e.mediaSource?t.isScreen=!0:e.video?t.isVideo=!0:e.audio&&(t.isAudio=!0)}(e.localMediaConstraints,n);var o="ended";"oninactive"in n&&(o="inactive"),n.addEventListener(o,(function(){delete currentUserMediaRequest.streams[t],currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.indexOf(e)&&(delete currentUserMediaRequest.queueRequests[currentUserMediaRequest.queueRequests.indexOf(e)],currentUserMediaRequest.queueRequests=l(currentUserMediaRequest.queueRequests))}),!1),currentUserMediaRequest.streams[t]={stream:n},currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.length&&R(currentUserMediaRequest.queueRequests.shift()),e.onGettingLocalMedia(n,a)}}window.currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[],remove:function(e){this.mutex=!1;var t=this.streams[e];if(t){var n=(t=t.stream).currentUserMediaRequestOptions;this.queueRequests.indexOf(n)&&(delete this.queueRequests[this.queueRequests.indexOf(n)],this.queueRequests=l(this.queueRequests)),this.streams[e].stream=null,delete this.streams[e]}}};var I=function(){function e(e){if(e)return"string"==typeof e||void 0===e?e:e.audio&&e.video?null:e.audio?"audio":e.video?"video":void 0}function t(e,n,a,o){(o=(o||0)+1)>=n||setTimeout((function(){a(),t(e,n,a,o)}),e)}return{setHandlers:function(n,a,o){if(n&&n.addEventListener){if(void 0===a||1==a){var r="ended";"oninactive"in n&&(r="inactive"),n.addEventListener(r,(function(){I.onSyncNeeded(this.streamid,r)}),!1)}n.mute=function(t,r){t=e(t),void 0!==r&&(a=r),void 0!==t&&"audio"!=t||f(n,"audio").forEach((function(e){e.enabled=!1,o.streamEvents[n.streamid].isAudioMuted=!0})),void 0!==t&&"video"!=t||f(n,"video").forEach((function(e){e.enabled=!1})),void 0!==a&&1!=a||I.onSyncNeeded(n.streamid,"mute",t),o.streamEvents[n.streamid].muteType=t||"both",i(n,"mute",t)},n.unmute=function(r,s){r=e(r),void 0!==s&&(a=s),function(){if(!o.streamEvents[n.streamid].mediaElement)return;var e=o.streamEvents[n.streamid].mediaElement;e.volume=0,t(200,5,(function(){try{e.volume+=.2}catch(t){e.volume=1}}))}(),void 0!==r&&"audio"!=r||f(n,"audio").forEach((function(e){e.enabled=!0,o.streamEvents[n.streamid].isAudioMuted=!1})),void 0!==r&&"video"!=r||(f(n,"video").forEach((function(e){e.enabled=!0})),void 0!==r&&"video"==r&&o.streamEvents[n.streamid].isAudioMuted&&function e(t){t||(t=0),++t<100&&o.streamEvents[n.streamid].isAudioMuted&&(n.mute("audio"),setTimeout((function(){e(t)}),50))}()),void 0!==a&&1!=a||I.onSyncNeeded(n.streamid,"unmute",r),o.streamEvents[n.streamid].unmuteType=r||"both",i(n,"unmute",r)}}},onSyncNeeded:function(e,t,n){}}}();function O(e){var t={};return{receive:function(n,a,o){var i=n.uuid;if(t[i]||(t[i]=[]),t[i].push(n.message),n.last){var r=t[i].join("");n.isobject&&(r=JSON.parse(r));var s={data:r,userid:a,extra:o,latency:(new Date).getTime()-n.sendingTime};e.autoTranslateText?(s.original=s.data,e.Translator.TranslateText(s.data,(function(t){s.data=t,e.onmessage(s)}))):e.onmessage(s),delete t[i]}}}}var E={send:function(e){var t=e.connection,n=e.channel,a=e.remoteUserId,o=e.text,i=t.chunkSize||1e3,r="",c=!1;"string"!=typeof o&&(c=!0,o=JSON.stringify(o));var d=s(),l=(new Date).getTime();!function e(o,s){var u={type:"text",uuid:d,sendingTime:l};o&&(s=o,u.packets=parseInt(s.length/i));s.length>i?u.message=s.slice(0,i):(u.message=s,u.last=!0,u.isobject=c);n.send(u,a),(r=s.slice(u.message.length)).length&&setTimeout((function(){e(null,r)}),t.chunkInterval||100)}(o)}},_={handle:function(e){var t={};e.onFileStart=function(n){var a=document.createElement("div");if(a.title=n.name,a.innerHTML="<label>0%</label> <progress></progress>",n.remoteUserId&&(a.innerHTML+=" (Sharing with:"+n.remoteUserId+")"),e.filesContainer||(e.filesContainer=document.body||document.documentElement),e.filesContainer.insertBefore(a,e.filesContainer.firstChild),!n.remoteUserId)return t[n.uuid]={div:a,progress:a.querySelector("progress"),label:a.querySelector("label")},void(t[n.uuid].progress.max=n.maxChunks);t[n.uuid]||(t[n.uuid]={}),t[n.uuid][n.remoteUserId]={div:a,progress:a.querySelector("progress"),label:a.querySelector("label")},t[n.uuid][n.remoteUserId].progress.max=n.maxChunks},e.onFileProgress=function(e){var n=t[e.uuid];n&&(e.remoteUserId&&!(n=t[e.uuid][e.remoteUserId])||(n.progress.value=e.currentPosition||e.maxChunks||n.progress.max,function(e,t){if(-1!==e.position){var n=+e.position.toFixed(2).split(".")[1]||100;t.innerHTML=n+"%"}}(n.progress,n.label)))},e.onFileEnd=function(e){var n=t[e.uuid];if(n&&(!e.remoteUserId||(n=t[e.uuid][e.remoteUserId]))){var a=n.div;-1!=e.type.indexOf("image")?a.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><img src="'+e.url+'" title="'+e.name+'" style="max-width: 80%;">':a.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><iframe src="'+e.url+'" title="'+e.name+'" style="width: 80%;border: 0;height: inherit;margin-top:1em;"></iframe>'}}}},L={handle:function(e){e.autoTranslateText=!1,e.language="en",e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.Translator={TranslateText:function(t,n){var a=document.createElement("script");a.type="text/javascript";var o=encodeURIComponent(t),i="method"+e.token();window[i]=function(e){e.data&&e.data.translations[0]&&n?n(e.data.translations[0].translatedText):e.error&&"Daily Limit Exceeded"===e.error.message||e.error};var r="https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+i+"&q="+o;a.src=r,document.getElementsByTagName("head")[0].appendChild(a)},getListOfLanguages:function(t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE){var e=JSON.parse(n.responseText);if(e&&e.data&&e.data.languages)return void t(e.data.languages);if(e.error&&"Daily Limit Exceeded"===e.error.message)return;if(e.error)return}};var a="https://www.googleapis.com/language/translate/v2/languages?key="+e.googKey+"&target=en";n.open("GET",a,!0),n.send(null)}}}};!function(n){t=t||{useDefaultDevices:!0},n.channel=n.sessionid=(e||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""))+"";var i=new o(n),l={};function p(e){if(n.socketAutoReConnect=!0,n.socket)e&&e(n.socket);else{if(void 0===a)if("undefined"!=typeof FirebaseConnection)window.SocketConnection=FirebaseConnection;else{if("undefined"==typeof PubNubConnection)throw"SocketConnection.js seems missed.";window.SocketConnection=PubNubConnection}new a(n,(function(t){e&&e(n.socket)}))}}function y(e,t){n.socket.emit("join-room",{sessionid:n.sessionid,session:n.session,mediaConstraints:n.mediaConstraints,sdpConstraints:n.sdpConstraints,streams:C(),extra:n.extra,password:void 0!==n.password&&"object"!=typeof n.password?n.password:""},(function(a,o){if(!0===a){if(n.enableLogs,n.peers[n.sessionid])return;i.onNegotiationNeeded(e)}!1===a&&n.enableLogs,t(a,n.sessionid,o)}))}function b(e){n.enableLogs,n.waitingForLocalMedia=!1,n.socket.emit("open-room",{sessionid:n.sessionid,session:n.session,mediaConstraints:n.mediaConstraints,sdpConstraints:n.sdpConstraints,streams:C(),extra:n.extra,identifier:n.publicRoomIdentifier,password:void 0!==n.password&&"object"!=typeof n.password?n.password:""},(function(t,a){!0===t&&(n.enableLogs,e(t,n.sessionid)),!1===t&&(n.enableLogs,e(t,n.sessionid,a))}))}function C(){try{return n.streamEvents.selectAll("local").map((function(e){return{streamid:e.streamid,tracks:e.stream.getTracks().length}}))}catch(e){return[]}}function k(e,t){if(n.dontCaptureUserMedia||e.isDataOnly)t();else{e.localPeerSdpConstraints.OfferToReceiveAudio&&n.mediaConstraints.audio,e.localPeerSdpConstraints.OfferToReceiveVideo&&n.mediaConstraints.video;var a=e.session||n.session;a.oneway&&"two-way"!==a.audio&&"two-way"!==a.video&&"two-way"!==a.screen?t():(a.oneway&&a.audio&&"two-way"===a.audio&&(a={audio:!0}),(a.audio||a.video||a.screen)&&(a.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:m(n)}).then((function(e){e.isScreen=!0,i.onGettingLocalMedia(e),!a.audio&&!a.video||m(n)?t(e):n.invokeGetUserMedia(null,t)}),(function(e){})):n.invokeGetUserMedia({audio:m(n),video:!0,isScreen:!0},!a.audio&&!a.video||m(n)?t:n.invokeGetUserMedia(null,t)):(a.audio||a.video)&&n.invokeGetUserMedia(null,t,a)))}}function S(e,t){e?(t.audio&&f(e,"audio").forEach((function(e){e.applyConstraints(t.audio)})),t.video&&f(e,"video").forEach((function(e){e.applyConstraints(t.video)}))):n.enableLogs}function P(e,t,a){t?i.replaceTrack(e,t,a):n.peers.getAllParticipants().forEach((function(t){i.replaceTrack(e,t,a)}))}i.onGettingLocalMedia=function(e,t){if(t=t||function(){},l[e.streamid])t();else{l[e.streamid]=!0;try{e.type="local"}catch(a){}n.setStreamEndHandler(e),c(e,(function(o){o.id=e.streamid,o.muted=!0,o.volume=0,-1===n.attachStreams.indexOf(e)&&n.attachStreams.push(e),void 0!==I&&I.setHandlers(e,!0,n);var i=0===e.getAudioTracks().filter((function(e){return e.enabled})).length;n.streamEvents[e.streamid]={stream:e,type:"local",mediaElement:o,userid:n.userid,extra:n.extra,streamid:e.streamid,isAudioMuted:i};try{!function(e,t){if(t.stream&&f(t.stream,"audio").length){if(!e||!t)throw"Both arguments are required.";if(e.onspeaking&&e.onsilence){if("undefined"==typeof hark)throw"hark.js not found.";hark(t.stream,{onspeaking:function(){e.onspeaking(t)},onsilence:function(){e.onsilence(t)},onvolumechange:function(n,a){e.onvolumechange&&e.onvolumechange(merge({volume:n,threshold:a},t))}})}}}(n,n.streamEvents[e.streamid]),r(n,n.streamEvents[e.streamid]),n.onstream(n.streamEvents[e.streamid])}catch(a){}t()}),n)}},i.onGettingRemoteMedia=function(e,t){try{e.type="remote"}catch(a){}n.setStreamEndHandler(e,"remote-stream"),c(e,(function(a){a.id=e.streamid,void 0!==I&&I.setHandlers(e,!1,n),n.streamEvents[e.streamid]={stream:e,type:"remote",userid:t,extra:n.peers[t]?n.peers[t].extra:{},mediaElement:a,streamid:e.streamid},r(n,n.streamEvents[e.streamid]),n.onstream(n.streamEvents[e.streamid])}),n)},i.onRemovingRemoteMedia=function(e,t){var a=n.streamEvents[e.streamid];a||(a={stream:e,type:"remote",userid:t,extra:n.peers[t]?n.peers[t].extra:{},streamid:e.streamid,mediaElement:n.streamEvents[e.streamid]?n.streamEvents[e.streamid].mediaElement:null}),n.peersBackup[a.userid]&&(a.extra=n.peersBackup[a.userid].extra),n.onstreamended(a),delete n.streamEvents[e.streamid]},i.onNegotiationNeeded=function(e,t,a){a=a||function(){};var o={remoteUserId:t=t||e.remoteUserId,message:e=e||"",sender:n.userid};e.remoteUserId&&e.message&&e.sender&&(o=e),p((function(){n.socket.emit(n.socketMessageEvent,o,a)}))},i.onUserLeft=function(e){n.deletePeer(e)},i.disconnectWith=function(e,t){n.socket&&n.socket.emit("disconnect-with",e,t||function(){}),n.deletePeer(e)},n.socketOptions={transport:"polling"},n.openOrJoin=function(e,t){t=t||function(){},n.checkPresence(e,(function(e,a){if(e){n.sessionid=a;var o,i,r=!!n.session.oneway,s=u(n.session);i={OfferToReceiveAudio:n.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:n.sdpConstraints.mandatory.OfferToReceiveVideo},o={OfferToReceiveAudio:r?!!n.session.audio:n.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:r?!!n.session.video||!!n.session.screen:n.sdpConstraints.mandatory.OfferToReceiveVideo};var c={remoteUserId:n.sessionid,message:{newParticipationRequest:!0,isOneWay:r,isDataOnly:s,localPeerSdpConstraints:o,remotePeerSdpConstraints:i},sender:n.userid};k(c.message,(function(){y(c,t)}))}else n.waitingForLocalMedia=!0,n.isInitiator=!0,n.sessionid=a||n.sessionid,u(n.session)?b(t):n.captureUserMedia((function(){b(t)}))}))},n.waitingForLocalMedia=!1,n.open=function(e,t){t=t||function(){},n.waitingForLocalMedia=!0,n.isInitiator=!0,n.sessionid=e||n.sessionid,p((function(){u(n.session)?b(t):n.captureUserMedia((function(){b(t)}))}))},n.peersBackup={},n.deletePeer=function(e){if(e&&n.peers[e]){var t={userid:e,extra:n.peers[e]?n.peers[e].extra:{}};if(n.peersBackup[t.userid]&&(t.extra=n.peersBackup[t.userid].extra),n.onleave(t),n.peers[e]){n.peers[e].streams.forEach((function(e){e.stop()}));var a=n.peers[e].peer;if(a&&"closed"!==a.iceConnectionState)try{a.close()}catch(o){}n.peers[e]&&(n.peers[e].peer=null,delete n.peers[e])}}},n.rejoin=function(e){if(!n.isInitiator&&e&&Object.keys(e).length){var t={};n.peers[e.remoteUserId]&&(t=n.peers[e.remoteUserId].extra,n.deletePeer(e.remoteUserId)),e&&e.remoteUserId&&(n.join(e.remoteUserId),n.onReConnecting({userid:e.remoteUserId,extra:t}))}},n.join=function(e,t){n.sessionid=!!e&&(e.sessionid||e.remoteUserId||e)||n.sessionid,n.sessionid+="";var a=!1,o=!1,i=!1,r=!1;if(e&&e.session||!e||"string"==typeof e){var s=e&&e.session||n.session;i=!!s.oneway,r=u(s),o={OfferToReceiveAudio:n.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:n.sdpConstraints.mandatory.OfferToReceiveVideo},a={OfferToReceiveAudio:i?!!n.session.audio:n.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:i?!!n.session.video||!!n.session.screen:n.sdpConstraints.mandatory.OfferToReceiveVideo}}var c=function(){};"function"==typeof(t=t||{})&&(c=t,t={}),void 0!==t.localPeerSdpConstraints&&(a=t.localPeerSdpConstraints),void 0!==t.remotePeerSdpConstraints&&(o=t.remotePeerSdpConstraints),void 0!==t.isOneWay&&(i=t.isOneWay),void 0!==t.isDataOnly&&(r=t.isDataOnly);var d={remoteUserId:n.sessionid,message:{newParticipationRequest:!0,isOneWay:i,isDataOnly:r,localPeerSdpConstraints:a,remotePeerSdpConstraints:o},sender:n.userid};return k(d.message,(function(){p((function(){y(d,c)}))})),d},n.publicRoomIdentifier="",n.getUserMedia=n.captureUserMedia=function(e,t){e=e||function(){};var a=t||n.session;n.dontCaptureUserMedia||u(a)?e():(a.audio||a.video||a.screen)&&(a.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:m(n)}).then((function(o){if(o.isScreen=!0,i.onGettingLocalMedia(o),!a.audio&&!a.video||m(n))e(o);else{var r={};for(var s in a)"screen"!==s&&(r[s]=a[s]);n.invokeGetUserMedia(t,e,r)}}),(function(e){})):n.invokeGetUserMedia({audio:m(n),video:!0,isScreen:!0},(function(o){if(!a.audio&&!a.video||m(n))e(o);else{var i={};for(var r in a)"screen"!==r&&(i[r]=a[r]);n.invokeGetUserMedia(t,e,i)}})):(a.audio||a.video)&&n.invokeGetUserMedia(t,e,a))},n.onbeforeunload=function(e,t){n.closeBeforeUnload&&(n.peers.getAllParticipants().forEach((function(e){i.onNegotiationNeeded({userLeft:!0},e),n.peers[e]&&n.peers[e].peer&&n.peers[e].peer.close(),delete n.peers[e]})),t||n.closeSocket(),n.isInitiator=!1)},window.ignoreBeforeUnload?n.closeBeforeUnload=!1:(n.closeBeforeUnload=!0,window.addEventListener("beforeunload",n.onbeforeunload,!1)),n.userid=s(),n.changeUserId=function(e,t){t=t||function(){},n.userid=e||s(),n.socket.emit("changed-uuid",n.userid,t)},n.extra={},n.attachStreams=[],n.session={audio:!0,video:!0},n.enableFileSharing=!1,n.bandwidth={screen:!1,audio:!1,video:!1},n.codecs={audio:"opus",video:"VP9"},n.processSdp=function(e){return v()||"Safari"===DetectRTC.browser.name?e:("VP8"===n.codecs.video.toUpperCase()&&(e=M.preferCodec(e,"vp8")),"VP9"===n.codecs.video.toUpperCase()&&(e=M.preferCodec(e,"vp9")),"H264"===n.codecs.video.toUpperCase()&&(e=M.preferCodec(e,"h264")),"G722"===n.codecs.audio&&(e=M.removeNonG722(e)),"Firefox"===DetectRTC.browser.name||((n.bandwidth.video||n.bandwidth.screen)&&(e=M.setApplicationSpecificBandwidth(e,n.bandwidth,!!n.session.screen)),n.bandwidth.video&&(e=M.setVideoBitrates(e,{min:8*n.bandwidth.video*1024,max:8*n.bandwidth.video*1024})),n.bandwidth.audio&&(e=M.setOpusAttributes(e,{maxaveragebitrate:8*n.bandwidth.audio*1024,maxplaybackrate:8*n.bandwidth.audio*1024,stereo:1,maxptime:3}))),e)},void 0!==M&&(n.BandwidthHandler=n.CodecsHandler=M),n.mediaConstraints={audio:{mandatory:{},optional:n.bandwidth.audio?[{bandwidth:8*n.bandwidth.audio*1024||1048576}]:[]},video:{mandatory:{},optional:n.bandwidth.video?[{bandwidth:8*n.bandwidth.video*1024||1048576},{facingMode:"user"}]:[{facingMode:"user"}]}},"Firefox"===DetectRTC.browser.name&&(n.mediaConstraints={audio:!0,video:!0}),t.useDefaultDevices||DetectRTC.isMobileDevice||DetectRTC.load((function(){var e,t;if(DetectRTC.MediaDevices.forEach((function(a){"audioinput"===a.kind&&!1!==n.mediaConstraints.audio&&(e=a),"videoinput"===a.kind&&!1!==n.mediaConstraints.video&&(t=a)})),e){if("Firefox"===DetectRTC.browser.name)return void(!0!==n.mediaConstraints.audio?n.mediaConstraints.audio.deviceId=e.id:n.mediaConstraints.audio={deviceId:e.id});1==n.mediaConstraints.audio&&(n.mediaConstraints.audio={mandatory:{},optional:[]}),n.mediaConstraints.audio.optional||(n.mediaConstraints.audio.optional=[]);var a=[{sourceId:e.id}];n.mediaConstraints.audio.optional=a.concat(n.mediaConstraints.audio.optional)}if(t){if("Firefox"===DetectRTC.browser.name)return void(!0!==n.mediaConstraints.video?n.mediaConstraints.video.deviceId=t.id:n.mediaConstraints.video={deviceId:t.id});1==n.mediaConstraints.video&&(n.mediaConstraints.video={mandatory:{},optional:[]}),n.mediaConstraints.video.optional||(n.mediaConstraints.video.optional=[]);a=[{sourceId:t.id}];n.mediaConstraints.video.optional=a.concat(n.mediaConstraints.video.optional)}})),n.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{VoiceActivityDetection:!1}]},n.sdpSemantics=null,n.iceCandidatePoolSize=null,n.bundlePolicy=null,n.rtcpMuxPolicy=null,n.iceTransportPolicy=null,n.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},n.iceServers=x.getIceServers(n),n.candidates={host:!0,stun:!0,turn:!0},n.iceProtocols={tcp:!0,udp:!0},n.onopen=function(e){n.enableLogs},n.onclose=function(e){n.enableLogs},n.onerror=function(e){n.enableLogs},n.onmessage=function(e){n.enableLogs},n.send=function(e,t){n.peers.send(e,t)},n.close=n.disconnect=n.leave=function(){n.onbeforeunload(!1,!0)},n.closeEntireSession=function(e){e=e||function(){},n.socket.emit("close-entire-session",(function t(){n.getAllParticipants().length?setTimeout(t,100):(n.onEntireSessionClosed({sessionid:n.sessionid,userid:n.userid,extra:n.extra}),n.changeUserId(null,(function(){n.close(),e()})))}))},n.onEntireSessionClosed=function(e){n.enableLogs},n.onstream=function(e){var t=n.videosContainer;t.insertBefore(e.mediaElement,t.firstChild);var a=e.mediaElement.play();void 0===a?setTimeout((function(){e.mediaElement.play()}),2e3):a.catch((function(){})).then((function(){setTimeout((function(){e.mediaElement.play()}),2e3)}))},n.onstreamended=function(e){e.mediaElement||(e.mediaElement=document.getElementById(e.streamid)),e.mediaElement&&e.mediaElement.parentNode&&e.mediaElement.parentNode.removeChild(e.mediaElement)},n.direction="many-to-many",n.removeStream=function(e,t){var a;n.attachStreams.forEach((function(t){t.id===e&&(a=t)})),a&&(n.peers.getAllParticipants().forEach((function(e){if(!t||e===t){var o=n.peers[e];try{o.peer.removeStream(a)}catch(i){}}})),n.renegotiate())},n.addStream=function(e,t){if(e.getTracks)return-1===n.attachStreams.indexOf(e)&&(e.streamid||(e.streamid=e.id),n.attachStreams.push(e)),void n.renegotiate(t);function a(a){e.streamCallback&&e.streamCallback(a),n.renegotiate(t)}u(e)?n.renegotiate(t):(e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:m(n)}).then((function(t){t.isScreen=!0,i.onGettingLocalMedia(t),!e.audio&&!e.video||m(n)?a(t):n.invokeGetUserMedia(null,(function(e){a(e)}))}),(function(e){})):n.invokeGetUserMedia({audio:m(n),video:!0,isScreen:!0},(function(t){!e.audio&&!e.video||m(n)?a(t):n.invokeGetUserMedia(null,(function(e){a(e)}))})):(e.audio||e.video)&&n.invokeGetUserMedia(null,a))},n.invokeGetUserMedia=function(e,t,a){a||(a=n.session),e||(e=n.mediaConstraints),R({onGettingLocalMedia:function(n){var a=e.video;a&&(a.mediaSource||a.mozMediaSource||a.mandatory&&a.mandatory.chromeMediaSource)&&(n.isScreen=!0),n.isScreen||(n.isVideo=!!f(n,"video").length,n.isAudio=!n.isVideo&&f(n,"audio").length),i.onGettingLocalMedia(n,(function(){"function"==typeof t&&t(n)}))},onLocalMediaError:function(e,t){i.onLocalMediaError(e,t)},localMediaConstraints:e||{audio:!!a.audio&&e.audio,video:!!a.video&&e.video}})},n.applyConstraints=function(e,t){if(w&&w.prototype.applyConstraints){var a;if(t)return n.streamEvents[t]&&(a=n.streamEvents[t].stream),void S(a,e);n.attachStreams.forEach((function(t){S(t,e)}))}else alert("track.applyConstraints is NOT supported in your browser.")},n.replaceTrack=function(e,t,a){if(e=e||{},g.prototype.getSenders)if(e instanceof w)P(e,t,a);else{if(e instanceof h)return f(e,"video").length&&P(f(e,"video")[0],t,!0),void(f(e,"audio").length&&P(f(e,"audio")[0],t,!1));if(u(e))throw"connection.replaceTrack requires audio and/or video and/or screen.";(e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:m(n)}).then((function(t){t.isScreen=!0,i.onGettingLocalMedia(t),!e.audio&&!e.video||m(n)?o(t):n.invokeGetUserMedia(null,o)}),(function(e){})):n.invokeGetUserMedia({audio:m(n),video:!0,isScreen:!0},!e.audio&&!e.video||m(n)?o:n.invokeGetUserMedia(null,o)):(e.audio||e.video)&&n.invokeGetUserMedia(null,o))}else n.addStream(e);function o(o){n.replaceTrack(o,t,a||e.video||e.screen)}},n.resetTrack=function(e,t){e||(e=n.getAllParticipants()),"string"==typeof e&&(e=[e]),e.forEach((function(e){var a=n.peers[e].peer;void 0!==t&&!0!==t||!a.lastVideoTrack||n.replaceTrack(a.lastVideoTrack,e,!0),void 0!==t&&!1!==t||!a.lastAudioTrack||n.replaceTrack(a.lastAudioTrack,e,!1)}))},n.renegotiate=function(e){e?i.renegotiatePeer(e):n.peers.getAllParticipants().forEach((function(e){i.renegotiatePeer(e)}))},n.setStreamEndHandler=function(e,t){if(e&&e.addEventListener&&(t=!!t,!e.alreadySetEndHandler)){e.alreadySetEndHandler=!0;var a="ended";"oninactive"in e&&(a="inactive"),e.addEventListener(a,(function(){if(e.idInstance&&currentUserMediaRequest.remove(e.idInstance),!t){var a=[];n.attachStreams.forEach((function(t){t.id!=e.id&&a.push(t)})),n.attachStreams=a}var o=n.streamEvents[e.streamid];if(o||(o={stream:e,streamid:e.streamid,type:t?"remote":"local",userid:n.userid,extra:n.extra,mediaElement:n.streamEvents[e.streamid]?n.streamEvents[e.streamid].mediaElement:null}),t&&n.peers[o.userid]){var i=n.peers[o.userid].peer;a=[];i.getRemoteStreams().forEach((function(t){t.id!=e.id&&a.push(t)})),n.peers[o.userid].streams=a}o.userid===n.userid&&"remote"===o.type||(n.peersBackup[o.userid]&&(o.extra=n.peersBackup[o.userid].extra),n.onstreamended(o),delete n.streamEvents[e.streamid])}),!1)}},n.onMediaError=function(e,t){n.enableLogs},n.autoCloseEntireSession=!1,n.filesContainer=n.videosContainer=document.body||document.documentElement,n.isInitiator=!1,n.shareFile=i.shareFile,void 0!==_&&_.handle(n),void 0!==L&&L.handle(n),n.token=s,n.onNewParticipant=function(e,t){n.acceptParticipationRequest(e,t)},n.acceptParticipationRequest=function(e,t){t.successCallback&&(t.successCallback(),delete t.successCallback),i.createNewPeer(e,t)},void 0!==I&&(n.StreamsHandler=I),n.onleave=function(e){},n.invokeSelectFileDialog=function(e){var t=new FileSelector;t.accept="*.*",t.selectSingleFile(e)},n.onmute=function(e){if(e&&e.mediaElement)if("both"===e.muteType||"video"===e.muteType){e.mediaElement.src=null;var t=e.mediaElement.pause();void 0!==t?t.then((function(){e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"})):e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"}else"audio"===e.muteType&&(e.mediaElement.muted=!0)},n.onunmute=function(e){e&&e.mediaElement&&e.stream&&("both"===e.unmuteType||"video"===e.unmuteType?(e.mediaElement.poster=null,e.mediaElement.srcObject=e.stream,e.mediaElement.play()):"audio"===e.unmuteType&&(e.mediaElement.muted=!1))},n.onExtraDataUpdated=function(e){e.status="online",n.onUserStatusChanged(e,!0)},n.getAllParticipants=function(e){return n.peers.getAllParticipants(e)},void 0!==I&&(I.onSyncNeeded=function(e,t,a){n.peers.getAllParticipants().forEach((function(n){i.onNegotiationNeeded({streamid:e,action:t,streamSyncNeeded:!0,type:a||"both"},n)}))}),n.connectSocket=function(e){p(e)},n.closeSocket=function(){try{io.sockets={}}catch(e){}n.socket&&("function"==typeof n.socket.disconnect&&n.socket.disconnect(),"function"==typeof n.socket.resetProps&&n.socket.resetProps(),n.socket=null)},n.getSocket=function(e){return!e&&n.enableLogs,e=e||function(){},n.socket?e(n.socket):p((function(){e(n.socket)})),n.socket},n.getRemoteStreams=i.getRemoteStreams;var T=["selectFirst","selectAll","forEach"];if(n.streamEvents={selectFirst:function(e){return n.streamEvents.selectAll(e)[0]},selectAll:function(e){e||(e={local:!0,remote:!0,isScreen:!0,isAudio:!0,isVideo:!0}),"local"==e&&(e={local:!0}),"remote"==e&&(e={remote:!0}),"screen"==e&&(e={isScreen:!0}),"audio"==e&&(e={isAudio:!0}),"video"==e&&(e={isVideo:!0});var t=[];return Object.keys(n.streamEvents).forEach((function(a){var o=n.streamEvents[a];if(-1===T.indexOf(a)){var i=!0;e.local&&"local"===o.type&&(i=!1),e.remote&&"remote"===o.type&&(i=!1),e.isScreen&&o.stream.isScreen&&(i=!1),e.isVideo&&o.stream.isVideo&&(i=!1),e.isAudio&&o.stream.isAudio&&(i=!1),e.userid&&o.userid===e.userid&&(i=!1),!1===i&&t.push(o)}})),t}},n.socketURL="/",n.socketMessageEvent="RTCMultiConnection-Message",n.socketCustomEvent="RTCMultiConnection-Custom-Message",n.DetectRTC=DetectRTC,n.setCustomSocketEvent=function(e){e&&(n.socketCustomEvent=e),n.socket&&n.socket.emit("set-custom-socket-event-listener",n.socketCustomEvent)},n.getNumberOfBroadcastViewers=function(e,t){n.socket&&e&&t&&n.socket.emit("get-number-of-users-in-specific-broadcast",e,t)},n.onNumberOfBroadcastViewersUpdated=function(e){n.enableLogs&&n.isInitiator},n.onUserStatusChanged=function(e,t){n.enableLogs},n.getUserMediaHandler=R,n.multiPeersHandler=i,n.enableLogs=!0,n.setCustomSocketHandler=function(e){void 0!==a&&(a=e)},n.chunkSize=4e4,n.maxParticipantsAllowed=1e3,n.disconnectWith=i.disconnectWith,n.checkPresence=function(e,t){e=e||n.sessionid,"SSEConnection"!==a.name?n.socket?n.socket.emit("check-presence",e+"",(function(e,a,o){n.enableLogs,t(e,a,o)})):n.connectSocket((function(){n.checkPresence(e,t)})):SSEConnection.checkPresence(e,(function(e,a,o){if(!n.socket)return e||(n.userid=a),void n.connectSocket((function(){t(e,a,o)}));t(e,a)}))},n.onReadyForOffer=function(e,t){n.multiPeersHandler.createNewPeer(e,t)},n.setUserPreferences=function(e){return n.dontAttachStream&&(e.dontAttachLocalStream=!0),n.dontGetRemoteStream&&(e.dontGetRemoteStream=!0),e},n.updateExtraData=function(){n.socket.emit("extra-data-updated",n.extra)},n.enableScalableBroadcast=!1,n.maxRelayLimitPerUser=3,n.dontCaptureUserMedia=!1,n.dontAttachStream=!1,n.dontGetRemoteStream=!1,n.onReConnecting=function(e){n.enableLogs},n.beforeAddingStream=function(e){return e},n.beforeRemovingStream=function(e){return e},"undefined"!=typeof isChromeExtensionAvailable&&(n.checkIfChromeExtensionAvailable=isChromeExtensionAvailable),"undefined"!=typeof isFirefoxExtensionAvailable&&(n.checkIfChromeExtensionAvailable=isFirefoxExtensionAvailable),"undefined"!=typeof getChromeExtensionStatus&&(n.getChromeExtensionStatus=getChromeExtensionStatus),n.modifyScreenConstraints=function(e){return e},n.onPeerStateChanged=function(e){n.enableLogs&&e.iceConnectionState.search(/closed|failed/gi)},n.isOnline=!0,d("online",(function(){n.isOnline=!0})),d("offline",(function(){n.isOnline=!1})),n.isLowBandwidth=!1,navigator&&navigator.connection&&navigator.connection.type&&(n.isLowBandwidth=-1!==navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g),n.isLowBandwidth)){if(n.bandwidth={audio:!1,video:!1,screen:!1},n.mediaConstraints.audio&&n.mediaConstraints.audio.optional&&n.mediaConstraints.audio.optional.length){var O=[];n.mediaConstraints.audio.optional.forEach((function(e){void 0===e.bandwidth&&O.push(e)})),n.mediaConstraints.audio.optional=O}if(n.mediaConstraints.video&&n.mediaConstraints.video.optional&&n.mediaConstraints.video.optional.length){O=[];n.mediaConstraints.video.optional.forEach((function(e){void 0===e.bandwidth&&O.push(e)})),n.mediaConstraints.video.optional=O}}n.getExtraData=function(e,t){if(!e)throw"remoteUserId is required.";if("function"!=typeof t)return n.peers[e]?n.peers[e].extra:n.peersBackup[e]?n.peersBackup[e].extra:{};n.socket.emit("get-remote-user-extra-data",e,(function(e,n,a){t(e,n,a)}))},t.autoOpenOrJoin&&n.openOrJoin(n.sessionid),n.onUserIdAlreadyTaken=function(e,t){n.close(),n.closeSocket(),n.isInitiator=!1,n.userid=n.token(),n.join(n.sessionid),n.enableLogs},n.trickleIce=!0,n.version="3.7.0",n.onSettingLocalDescription=function(e){n.enableLogs},n.resetScreen=function(){sourceId=null,DetectRTC&&DetectRTC.screen&&delete DetectRTC.screen.sourceId,currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[]}},n.autoCreateMediaElement=!0,n.password=null,n.setPassword=function(e,t){t=t||function(){},n.socket?n.socket.emit("set-password",e,t):(n.password=e,t(!0,n.sessionid,null))},n.onSocketDisconnect=function(e){n.enableLogs},n.onSocketError=function(e){n.enableLogs},n.errors={ROOM_NOT_AVAILABLE:"Room not available",INVALID_PASSWORD:"Invalid password",USERID_NOT_AVAILABLE:"User ID does not exist",ROOM_PERMISSION_DENIED:"Room permission denied",ROOM_FULL:"Room full",DID_NOT_JOIN_ANY_ROOM:"Did not join any room yet",INVALID_SOCKET:"Invalid socket",PUBLIC_IDENTIFIER_MISSING:"publicRoomIdentifier is required",INVALID_ADMIN_CREDENTIAL:"Invalid username or password attempted"}}(this)};
/*!
 * Socket.IO v4.4.1
 * (c) 2014-2022 Guillermo Rauch
 * Released under the MIT License.
 */
function ii(){var e,t;e=this,t=function(){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function a(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o.apply(this,arguments)}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=r(e);if(t){var o=r(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return c(e)}(this,n)}}function l(e,t,n){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var a=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e}(e,t);if(a){var o=Object.getOwnPropertyDescriptor(a,t);return o.get?o.get.call(n):o.value}},l(e,t,n||e)}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function p(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return r=e.done,e},e:function(e){s=!0,i=e},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw i}}}}var h=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,m=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],f=function(e){var t,n,a,o=e,i=e.indexOf("["),r=e.indexOf("]");-1!=i&&-1!=r&&(e=e.substring(0,i)+e.substring(i,r).replace(/:/g,";")+e.substring(r,e.length));for(var s,c,d=h.exec(e||""),l={},u=14;u--;)l[m[u]]=d[u]||"";return-1!=i&&-1!=r&&(l.source=o,l.host=l.host.substring(1,l.host.length-1).replace(/;/g,":"),l.authority=l.authority.replace("[","").replace("]","").replace(/;/g,":"),l.ipv6uri=!0),l.pathNames=(t=l.path,n=/\/{2,9}/g,a=t.replace(n,"/").split("/"),"/"!=t.substr(0,1)&&0!==t.length||a.splice(0,1),"/"==t.substr(t.length-1,1)&&a.splice(a.length-1,1),a),l.queryKey=(s=l.query,c={},s.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(c[t]=n)})),c),l},v={exports:{}};try{v.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(De){v.exports=!1}var y=v.exports,g="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function b(e){var t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||y))return new XMLHttpRequest}catch(n){}if(!t)try{return new(g[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(n){}}function C(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return n.reduce((function(t,n){return e.hasOwnProperty(n)&&(t[n]=e[n]),t}),{})}var k=setTimeout,S=clearTimeout;function w(e,t){t.useNativeTimers?(e.setTimeoutFn=k.bind(g),e.clearTimeoutFn=S.bind(g)):(e.setTimeoutFn=setTimeout.bind(g),e.clearTimeoutFn=clearTimeout.bind(g))}var P=M;function M(e){if(e)return function(e){for(var t in M.prototype)e[t]=M.prototype[t];return e}(e)}M.prototype.on=M.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},M.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},M.prototype.off=M.prototype.removeListener=M.prototype.removeAllListeners=M.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,a=this._callbacks["$"+e];if(!a)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o=0;o<a.length;o++)if((n=a[o])===t||n.fn===t){a.splice(o,1);break}return 0===a.length&&delete this._callbacks["$"+e],this},M.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],a=1;a<arguments.length;a++)t[a-1]=arguments[a];if(n){a=0;for(var o=(n=n.slice(0)).length;a<o;++a)n[a].apply(this,t)}return this},M.prototype.emitReserved=M.prototype.emit,M.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},M.prototype.hasListeners=function(e){return!!this.listeners(e).length};var T=Object.create(null);T.open="0",T.close="1",T.ping="2",T.pong="3",T.message="4",T.upgrade="5",T.noop="6";var x=Object.create(null);Object.keys(T).forEach((function(e){x[T[e]]=e}));for(var R={type:"error",data:"parser error"},I="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),O="function"==typeof ArrayBuffer,E=function(e,t,n){var a,o=e.type,i=e.data;return I&&i instanceof Blob?t?n(i):_(i,n):O&&(i instanceof ArrayBuffer||(a=i,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(a):a&&a.buffer instanceof ArrayBuffer))?t?n(i):_(new Blob([i]),n):n(T[o]+(i||""))},_=function(e,t){var n=new FileReader;return n.onload=function(){var e=n.result.split(",")[1];t("b"+e)},n.readAsDataURL(e)},L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",D="undefined"==typeof Uint8Array?[]:new Uint8Array(256),A=0;A<64;A++)D[L.charCodeAt(A)]=A;var B,N="function"==typeof ArrayBuffer,V=function(e,t){if("string"!=typeof e)return{type:"message",data:U(e,t)};var n=e.charAt(0);return"b"===n?{type:"message",data:j(e.substring(1),t)}:x[n]?e.length>1?{type:x[n],data:e.substring(1)}:{type:x[n]}:R},j=function(e,t){if(N){var n=function(e){var t,n,a,o,i,r=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(r--,"="===e[e.length-2]&&r--);var d=new ArrayBuffer(r),l=new Uint8Array(d);for(t=0;t<s;t+=4)n=D[e.charCodeAt(t)],a=D[e.charCodeAt(t+1)],o=D[e.charCodeAt(t+2)],i=D[e.charCodeAt(t+3)],l[c++]=n<<2|a>>4,l[c++]=(15&a)<<4|o>>2,l[c++]=(3&o)<<6|63&i;return d}(e);return U(n,t)}return{base64:!0,data:e}},U=function(e,t){return"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e},z=String.fromCharCode(30),F=function(e){i(o,e);var n=d(o);function o(e){var a;return t(this,o),(a=n.call(this)).writable=!1,w(c(a),e),a.opts=e,a.query=e.query,a.readyState="",a.socket=e.socket,a}return a(o,[{key:"onError",value:function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,l(r(o.prototype),"emit",this).call(this,"error",n),this}},{key:"open",value:function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}},{key:"close",value:function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}},{key:"send",value:function(e){"open"===this.readyState&&this.write(e)}},{key:"onOpen",value:function(){this.readyState="open",this.writable=!0,l(r(o.prototype),"emit",this).call(this,"open")}},{key:"onData",value:function(e){var t=V(e,this.socket.binaryType);this.onPacket(t)}},{key:"onPacket",value:function(e){l(r(o.prototype),"emit",this).call(this,"packet",e)}},{key:"onClose",value:function(){this.readyState="closed",l(r(o.prototype),"emit",this).call(this,"close")}}]),o}(P),W="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),G=64,q={},H=0,$=0;function J(e){var t="";do{t=W[e%G]+t,e=Math.floor(e/G)}while(e>0);return t}function K(){var e=J(+new Date);return e!==B?(H=0,B=e):e+"."+J(H++)}for(;$<G;$++)q[W[$]]=$;K.encode=J,K.decode=function(e){var t=0;for($=0;$<e.length;$++)t=t*G+q[e.charAt($)];return t};var Y=K,X={encode:function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},decode:function(e){for(var t={},n=e.split("&"),a=0,o=n.length;a<o;a++){var i=n[a].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},Q=function(e){i(o,e);var n=d(o);function o(){var e;return t(this,o),(e=n.apply(this,arguments)).polling=!1,e}return a(o,[{key:"name",get:function(){return"polling"}},{key:"doOpen",value:function(){this.poll()}},{key:"pause",value:function(e){var t=this;this.readyState="pausing";var n=function(){t.readyState="paused",e()};if(this.polling||!this.writable){var a=0;this.polling&&(a++,this.once("pollComplete",(function(){--a||n()}))),this.writable||(a++,this.once("drain",(function(){--a||n()})))}else n()}},{key:"poll",value:function(){this.polling=!0,this.doPoll(),this.emit("poll")}},{key:"onData",value:function(e){var t=this;(function(e,t){for(var n=e.split(z),a=[],o=0;o<n.length;o++){var i=V(n[o],t);if(a.push(i),"error"===i.type)break}return a})(e,this.socket.binaryType).forEach((function(e){if("opening"===t.readyState&&"open"===e.type&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState&&this.poll())}},{key:"doClose",value:function(){var e=this,t=function(){e.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}},{key:"write",value:function(e){var t=this;this.writable=!1,function(e,t){var n=e.length,a=new Array(n),o=0;e.forEach((function(e,i){E(e,!1,(function(e){a[i]=e,++o===n&&t(a.join(z))}))}))}(e,(function(e){t.doWrite(e,(function(){t.writable=!0,t.emit("drain")}))}))}},{key:"uri",value:function(){var e=this.query||{},t=this.opts.secure?"https":"http",n="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=Y()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port);var a=X.encode(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(a.length?"?"+a:"")}}]),o}(F);function Z(){}var ee=null!=new b({xdomain:!1}).responseType,te=function(e){i(r,e);var n=d(r);function r(e){var a;if(t(this,r),a=n.call(this,e),"undefined"!=typeof location){var o="https:"===location.protocol,i=location.port;i||(i=o?"443":"80"),a.xd="undefined"!=typeof location&&e.hostname!==location.hostname||i!==e.port,a.xs=e.secure!==o}var s=e&&e.forceBase64;return a.supportsBinary=ee&&!s,a}return a(r,[{key:"request",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(e,{xd:this.xd,xs:this.xs},this.opts),new ne(this.uri(),e)}},{key:"doWrite",value:function(e,t){var n=this,a=this.request({method:"POST",data:e});a.on("success",t),a.on("error",(function(e){n.onError("xhr post error",e)}))}},{key:"doPoll",value:function(){var e=this,t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(function(t){e.onError("xhr poll error",t)})),this.pollXhr=t}}]),r}(Q),ne=function(e){i(o,e);var n=d(o);function o(e,a){var i;return t(this,o),w(c(i=n.call(this)),a),i.opts=a,i.method=a.method||"GET",i.uri=e,i.async=!1!==a.async,i.data=void 0!==a.data?a.data:null,i.create(),i}return a(o,[{key:"create",value:function(){var e=this,t=C(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;var n=this.xhr=new b(t);try{n.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders)for(var a in n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(a)&&n.setRequestHeader(a,this.opts.extraHeaders[a])}catch(i){}if("POST"===this.method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(i){}try{n.setRequestHeader("Accept","*/*")}catch(i){}"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=function(){4===n.readyState&&(200===n.status||1223===n.status?e.onLoad():e.setTimeoutFn((function(){e.onError("number"==typeof n.status?n.status:0)}),0))},n.send(this.data)}catch(i){return void this.setTimeoutFn((function(){e.onError(i)}),0)}"undefined"!=typeof document&&(this.index=o.requestsCount++,o.requests[this.index]=this)}},{key:"onSuccess",value:function(){this.emit("success"),this.cleanup()}},{key:"onData",value:function(e){this.emit("data",e),this.onSuccess()}},{key:"onError",value:function(e){this.emit("error",e),this.cleanup(!0)}},{key:"cleanup",value:function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=Z,e)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete o.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function(){var e=this.xhr.responseText;null!==e&&this.onData(e)}},{key:"abort",value:function(){this.cleanup()}}]),o}(P);function ae(){for(var e in ne.requests)ne.requests.hasOwnProperty(e)&&ne.requests[e].abort()}ne.requestsCount=0,ne.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",ae):"function"==typeof addEventListener&&addEventListener("onpagehide"in g?"pagehide":"unload",ae,!1));var oe="function"==typeof Promise&&"function"==typeof Promise.resolve?function(e){return Promise.resolve().then(e)}:function(e,t){return t(e,0)},ie=g.WebSocket||g.MozWebSocket,re="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),se={websocket:function(e){i(o,e);var n=d(o);function o(e){var a;return t(this,o),(a=n.call(this,e)).supportsBinary=!e.forceBase64,a}return a(o,[{key:"name",get:function(){return"websocket"}},{key:"doOpen",value:function(){if(this.check()){var e=this.uri(),t=this.opts.protocols,n=re?{}:C(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=re?new ie(e,t,n):t?new ie(e,t):new ie(e)}catch(De){return this.emit("error",De)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}}},{key:"addEventListeners",value:function(){var e=this;this.ws.onopen=function(){e.opts.autoUnref&&e.ws._socket.unref(),e.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=function(t){return e.onData(t.data)},this.ws.onerror=function(t){return e.onError("websocket error",t)}}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var n=function(n){var a=e[n],o=n===e.length-1;E(a,t.supportsBinary,(function(e){try{t.ws.send(e)}catch(n){}o&&oe((function(){t.writable=!0,t.emit("drain")}),t.setTimeoutFn)}))},a=0;a<e.length;a++)n(a)}},{key:"doClose",value:function(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function(){var e=this.query||{},t=this.opts.secure?"wss":"ws",n="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=Y()),this.supportsBinary||(e.b64=1);var a=X.encode(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(a.length?"?"+a:"")}},{key:"check",value:function(){return!(!ie||"__initialize"in ie&&this.name===o.prototype.name)}}]),o}(F),polling:te},ce=function(n){i(s,n);var r=d(s);function s(n){var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t(this,s),a=r.call(this),n&&"object"===e(n)&&(i=n,n=null),n?(n=f(n),i.hostname=n.host,i.secure="https"===n.protocol||"wss"===n.protocol,i.port=n.port,n.query&&(i.query=n.query)):i.host&&(i.hostname=f(i.host).host),w(c(a),i),a.secure=null!=i.secure?i.secure:"undefined"!=typeof location&&"https:"===location.protocol,i.hostname&&!i.port&&(i.port=a.secure?"443":"80"),a.hostname=i.hostname||("undefined"!=typeof location?location.hostname:"localhost"),a.port=i.port||("undefined"!=typeof location&&location.port?location.port:a.secure?"443":"80"),a.transports=i.transports||["polling","websocket"],a.readyState="",a.writeBuffer=[],a.prevBufferLen=0,a.opts=o({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},i),a.opts.path=a.opts.path.replace(/\/$/,"")+"/","string"==typeof a.opts.query&&(a.opts.query=X.decode(a.opts.query)),a.id=null,a.upgrades=null,a.pingInterval=null,a.pingTimeout=null,a.pingTimeoutTimer=null,"function"==typeof addEventListener&&(a.opts.closeOnBeforeunload&&addEventListener("beforeunload",(function(){a.transport&&(a.transport.removeAllListeners(),a.transport.close())}),!1),"localhost"!==a.hostname&&(a.offlineEventListener=function(){a.onClose("transport close")},addEventListener("offline",a.offlineEventListener,!1))),a.open(),a}return a(s,[{key:"createTransport",value:function(e){var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);var n=o({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new se[e](n)}},{key:"open",value:function(){var e,t=this;if(this.opts.rememberUpgrade&&s.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((function(){t.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(n){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}},{key:"setTransport",value:function(e){var t=this;this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(function(){t.onClose("transport close")}))}},{key:"probe",value:function(e){var t=this,n=this.createTransport(e),a=!1;s.priorWebsocketSuccess=!1;var o=function(){a||(n.send([{type:"ping",data:"probe"}]),n.once("packet",(function(e){if(!a)if("pong"===e.type&&"probe"===e.data){if(t.upgrading=!0,t.emitReserved("upgrading",n),!n)return;s.priorWebsocketSuccess="websocket"===n.name,t.transport.pause((function(){a||"closed"!==t.readyState&&(u(),t.setTransport(n),n.send([{type:"upgrade"}]),t.emitReserved("upgrade",n),n=null,t.upgrading=!1,t.flush())}))}else{var o=new Error("probe error");o.transport=n.name,t.emitReserved("upgradeError",o)}})))};function i(){a||(a=!0,u(),n.close(),n=null)}var r=function(e){var a=new Error("probe error: "+e);a.transport=n.name,i(),t.emitReserved("upgradeError",a)};function c(){r("transport closed")}function d(){r("socket closed")}function l(e){n&&e.name!==n.name&&i()}var u=function(){n.removeListener("open",o),n.removeListener("error",r),n.removeListener("close",c),t.off("close",d),t.off("upgrading",l)};n.once("open",o),n.once("error",r),n.once("close",c),this.once("close",d),this.once("upgrading",l),n.open()}},{key:"onOpen",value:function(){if(this.readyState="open",s.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause)for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},{key:"onPacket",value:function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}},{key:"onHandshake",value:function(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function(){var e=this;this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((function(){e.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}},{key:"onDrain",value:function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}},{key:"flush",value:function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emitReserved("flush"))}},{key:"write",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"send",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"sendPacket",value:function(e,t,n,a){if("function"==typeof t&&(a=t,t=void 0),"function"==typeof n&&(a=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var o={type:e,data:t,options:n};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),a&&this.once("flush",a),this.flush()}}},{key:"close",value:function(){var e=this,t=function(){e.onClose("forced close"),e.transport.close()},n=function n(){e.off("upgrade",n),e.off("upgradeError",n),t()},a=function(){e.once("upgrade",n),e.once("upgradeError",n)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(function(){e.upgrading?a():t()})):this.upgrading?a():t()),this}},{key:"onError",value:function(e){s.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}},{key:"onClose",value:function(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}},{key:"filterUpgrades",value:function(e){for(var t=[],n=0,a=e.length;n<a;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}]),s}(P);ce.protocol=4;var de,le,ue="function"==typeof ArrayBuffer,pe=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer},he=Object.prototype.toString,me="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===he.call(Blob),fe="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===he.call(File);function ve(e){return ue&&(e instanceof ArrayBuffer||pe(e))||me&&e instanceof Blob||fe&&e instanceof File}function ye(t,n){if(!t||"object"!==e(t))return!1;if(Array.isArray(t)){for(var a=0,o=t.length;a<o;a++)if(ye(t[a]))return!0;return!1}if(ve(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return ye(t.toJSON(),!0);for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&ye(t[i]))return!0;return!1}function ge(e){var t=[],n=e.data,a=e;return a.data=be(n,t),a.attachments=t.length,{packet:a,buffers:t}}function be(t,n){if(!t)return t;if(ve(t)){var a={_placeholder:!0,num:n.length};return n.push(t),a}if(Array.isArray(t)){for(var o=new Array(t.length),i=0;i<t.length;i++)o[i]=be(t[i],n);return o}if("object"===e(t)&&!(t instanceof Date)){var r={};for(var s in t)t.hasOwnProperty(s)&&(r[s]=be(t[s],n));return r}return t}function Ce(e,t){return e.data=ke(e.data,t),e.attachments=void 0,e}function ke(t,n){if(!t)return t;if(t&&t._placeholder)return n[t.num];if(Array.isArray(t))for(var a=0;a<t.length;a++)t[a]=ke(t[a],n);else if("object"===e(t))for(var o in t)t.hasOwnProperty(o)&&(t[o]=ke(t[o],n));return t}(le=de||(de={}))[le.CONNECT=0]="CONNECT",le[le.DISCONNECT=1]="DISCONNECT",le[le.EVENT=2]="EVENT",le[le.ACK=3]="ACK",le[le.CONNECT_ERROR=4]="CONNECT_ERROR",le[le.BINARY_EVENT=5]="BINARY_EVENT",le[le.BINARY_ACK=6]="BINARY_ACK";var Se=function(){function e(){t(this,e)}return a(e,[{key:"encode",value:function(e){return e.type!==de.EVENT&&e.type!==de.ACK||!ye(e)?[this.encodeAsString(e)]:(e.type=e.type===de.EVENT?de.BINARY_EVENT:de.BINARY_ACK,this.encodeAsBinary(e))}},{key:"encodeAsString",value:function(e){var t=""+e.type;return e.type!==de.BINARY_EVENT&&e.type!==de.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data)),t}},{key:"encodeAsBinary",value:function(e){var t=ge(e),n=this.encodeAsString(t.packet),a=t.buffers;return a.unshift(n),a}}]),e}(),we=function(n){i(s,n);var o=d(s);function s(){return t(this,s),o.call(this)}return a(s,[{key:"add",value:function(e){var t;if("string"==typeof e)(t=this.decodeString(e)).type===de.BINARY_EVENT||t.type===de.BINARY_ACK?(this.reconstructor=new Pe(t),0===t.attachments&&l(r(s.prototype),"emitReserved",this).call(this,"decoded",t)):l(r(s.prototype),"emitReserved",this).call(this,"decoded",t);else{if(!ve(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,l(r(s.prototype),"emitReserved",this).call(this,"decoded",t))}}},{key:"decodeString",value:function(e){var t=0,n={type:Number(e.charAt(0))};if(void 0===de[n.type])throw new Error("unknown packet type "+n.type);if(n.type===de.BINARY_EVENT||n.type===de.BINARY_ACK){for(var a=t+1;"-"!==e.charAt(++t)&&t!=e.length;);var o=e.substring(a,t);if(o!=Number(o)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(o)}if("/"===e.charAt(t+1)){for(var i=t+1;++t&&","!==e.charAt(t)&&t!==e.length;);n.nsp=e.substring(i,t)}else n.nsp="/";var r=e.charAt(t+1);if(""!==r&&Number(r)==r){for(var c=t+1;++t;){var d=e.charAt(t);if(null==d||Number(d)!=d){--t;break}if(t===e.length)break}n.id=Number(e.substring(c,t+1))}if(e.charAt(++t)){var l=function(e){try{return JSON.parse(e)}catch(t){return!1}}(e.substr(t));if(!s.isPayloadValid(n.type,l))throw new Error("invalid payload");n.data=l}return n}},{key:"destroy",value:function(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}],[{key:"isPayloadValid",value:function(t,n){switch(t){case de.CONNECT:return"object"===e(n);case de.DISCONNECT:return void 0===n;case de.CONNECT_ERROR:return"string"==typeof n||"object"===e(n);case de.EVENT:case de.BINARY_EVENT:return Array.isArray(n)&&n.length>0;case de.ACK:case de.BINARY_ACK:return Array.isArray(n)}}}]),s}(P),Pe=function(){function e(n){t(this,e),this.packet=n,this.buffers=[],this.reconPack=n}return a(e,[{key:"takeBinaryData",value:function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=Ce(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}},{key:"finishedReconstruction",value:function(){this.reconPack=null,this.buffers=[]}}]),e}(),Me=Object.freeze({__proto__:null,protocol:5,get PacketType(){return de},Encoder:Se,Decoder:we});function Te(e,t,n){return e.on(t,n),function(){e.off(t,n)}}var xe=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Re=function(e){i(o,e);var n=d(o);function o(e,a,i){var r;return t(this,o),(r=n.call(this)).connected=!1,r.disconnected=!0,r.receiveBuffer=[],r.sendBuffer=[],r.ids=0,r.acks={},r.flags={},r.io=e,r.nsp=a,i&&i.auth&&(r.auth=i.auth),r.io._autoConnect&&r.open(),r}return a(o,[{key:"subEvents",value:function(){if(!this.subs){var e=this.io;this.subs=[Te(e,"open",this.onopen.bind(this)),Te(e,"packet",this.onpacket.bind(this)),Te(e,"error",this.onerror.bind(this)),Te(e,"close",this.onclose.bind(this))]}}},{key:"active",get:function(){return!!this.subs}},{key:"connect",value:function(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}},{key:"open",value:function(){return this.connect()}},{key:"send",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift("message"),this.emit.apply(this,t),this}},{key:"emit",value:function(e){if(xe.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];n.unshift(e);var o={type:de.EVENT,data:n,options:{}};if(o.options.compress=!1!==this.flags.compress,"function"==typeof n[n.length-1]){var i=this.ids++,r=n.pop();this._registerAckCallback(i,r),o.id=i}var s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!s||!this.connected)||(this.connected?this.packet(o):this.sendBuffer.push(o)),this.flags={},this}},{key:"_registerAckCallback",value:function(e,t){var n=this,a=this.flags.timeout;if(void 0!==a){var o=this.io.setTimeoutFn((function(){delete n.acks[e];for(var a=0;a<n.sendBuffer.length;a++)n.sendBuffer[a].id===e&&n.sendBuffer.splice(a,1);t.call(n,new Error("operation has timed out"))}),a);this.acks[e]=function(){n.io.clearTimeoutFn(o);for(var e=arguments.length,a=new Array(e),i=0;i<e;i++)a[i]=arguments[i];t.apply(n,[null].concat(a))}}else this.acks[e]=t}},{key:"packet",value:function(e){e.nsp=this.nsp,this.io._packet(e)}},{key:"onopen",value:function(){var e=this;"function"==typeof this.auth?this.auth((function(t){e.packet({type:de.CONNECT,data:t})})):this.packet({type:de.CONNECT,data:this.auth})}},{key:"onerror",value:function(e){this.connected||this.emitReserved("connect_error",e)}},{key:"onclose",value:function(e){this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",e)}},{key:"onpacket",value:function(e){if(e.nsp===this.nsp)switch(e.type){case de.CONNECT:if(e.data&&e.data.sid){var t=e.data.sid;this.onconnect(t)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case de.EVENT:case de.BINARY_EVENT:this.onevent(e);break;case de.ACK:case de.BINARY_ACK:this.onack(e);break;case de.DISCONNECT:this.ondisconnect();break;case de.CONNECT_ERROR:this.destroy();var n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n)}}},{key:"onevent",value:function(e){var t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}},{key:"emitEvent",value:function(e){if(this._anyListeners&&this._anyListeners.length){var t,n=p(this._anyListeners.slice());try{for(n.s();!(t=n.n()).done;)t.value.apply(this,e)}catch(De){n.e(De)}finally{n.f()}}l(r(o.prototype),"emit",this).apply(this,e)}},{key:"ack",value:function(e){var t=this,n=!1;return function(){if(!n){n=!0;for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];t.packet({type:de.ACK,id:e,data:o})}}}},{key:"onack",value:function(e){var t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}},{key:"onconnect",value:function(e){this.id=e,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}},{key:"emitBuffered",value:function(){var e=this;this.receiveBuffer.forEach((function(t){return e.emitEvent(t)})),this.receiveBuffer=[],this.sendBuffer.forEach((function(t){return e.packet(t)})),this.sendBuffer=[]}},{key:"ondisconnect",value:function(){this.destroy(),this.onclose("io server disconnect")}},{key:"destroy",value:function(){this.subs&&(this.subs.forEach((function(e){return e()})),this.subs=void 0),this.io._destroy(this)}},{key:"disconnect",value:function(){return this.connected&&this.packet({type:de.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{key:"close",value:function(){return this.disconnect()}},{key:"compress",value:function(e){return this.flags.compress=e,this}},{key:"volatile",get:function(){return this.flags.volatile=!0,this}},{key:"timeout",value:function(e){return this.flags.timeout=e,this}},{key:"onAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}},{key:"prependAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}},{key:"offAny",value:function(e){if(!this._anyListeners)return this;if(e){for(var t=this._anyListeners,n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}},{key:"listenersAny",value:function(){return this._anyListeners||[]}}]),o}(P),Ie=Oe;function Oe(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Oe.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+n:e-n}return 0|Math.min(e,this.max)},Oe.prototype.reset=function(){this.attempts=0},Oe.prototype.setMin=function(e){this.ms=e},Oe.prototype.setMax=function(e){this.max=e},Oe.prototype.setJitter=function(e){this.jitter=e};var Ee=function(n){i(r,n);var o=d(r);function r(n,a){var i,s;t(this,r),(i=o.call(this)).nsps={},i.subs=[],n&&"object"===e(n)&&(a=n,n=void 0),(a=a||{}).path=a.path||"/socket.io",i.opts=a,w(c(i),a),i.reconnection(!1!==a.reconnection),i.reconnectionAttempts(a.reconnectionAttempts||1/0),i.reconnectionDelay(a.reconnectionDelay||1e3),i.reconnectionDelayMax(a.reconnectionDelayMax||5e3),i.randomizationFactor(null!==(s=a.randomizationFactor)&&void 0!==s?s:.5),i.backoff=new Ie({min:i.reconnectionDelay(),max:i.reconnectionDelayMax(),jitter:i.randomizationFactor()}),i.timeout(null==a.timeout?2e4:a.timeout),i._readyState="closed",i.uri=n;var d=a.parser||Me;return i.encoder=new d.Encoder,i.decoder=new d.Decoder,i._autoConnect=!1!==a.autoConnect,i._autoConnect&&i.open(),i}return a(r,[{key:"reconnection",value:function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}},{key:"reconnectionAttempts",value:function(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}},{key:"reconnectionDelay",value:function(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}},{key:"randomizationFactor",value:function(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}},{key:"reconnectionDelayMax",value:function(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}},{key:"timeout",value:function(e){return arguments.length?(this._timeout=e,this):this._timeout}},{key:"maybeReconnectOnOpen",value:function(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}},{key:"open",value:function(e){var t=this;if(~this._readyState.indexOf("open"))return this;this.engine=new ce(this.uri,this.opts);var n=this.engine,a=this;this._readyState="opening",this.skipReconnect=!1;var o=Te(n,"open",(function(){a.onopen(),e&&e()})),i=Te(n,"error",(function(n){a.cleanup(),a._readyState="closed",t.emitReserved("error",n),e?e(n):a.maybeReconnectOnOpen()}));if(!1!==this._timeout){var r=this._timeout;0===r&&o();var s=this.setTimeoutFn((function(){o(),n.close(),n.emit("error",new Error("timeout"))}),r);this.opts.autoUnref&&s.unref(),this.subs.push((function(){clearTimeout(s)}))}return this.subs.push(o),this.subs.push(i),this}},{key:"connect",value:function(e){return this.open(e)}},{key:"onopen",value:function(){this.cleanup(),this._readyState="open",this.emitReserved("open");var e=this.engine;this.subs.push(Te(e,"ping",this.onping.bind(this)),Te(e,"data",this.ondata.bind(this)),Te(e,"error",this.onerror.bind(this)),Te(e,"close",this.onclose.bind(this)),Te(this.decoder,"decoded",this.ondecoded.bind(this)))}},{key:"onping",value:function(){this.emitReserved("ping")}},{key:"ondata",value:function(e){this.decoder.add(e)}},{key:"ondecoded",value:function(e){this.emitReserved("packet",e)}},{key:"onerror",value:function(e){this.emitReserved("error",e)}},{key:"socket",value:function(e,t){var n=this.nsps[e];return n||(n=new Re(this,e,t),this.nsps[e]=n),n}},{key:"_destroy",value:function(e){for(var t=0,n=Object.keys(this.nsps);t<n.length;t++){var a=n[t];if(this.nsps[a].active)return}this._close()}},{key:"_packet",value:function(e){for(var t=this.encoder.encode(e),n=0;n<t.length;n++)this.engine.write(t[n],e.options)}},{key:"cleanup",value:function(){this.subs.forEach((function(e){return e()})),this.subs.length=0,this.decoder.destroy()}},{key:"_close",value:function(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}},{key:"disconnect",value:function(){return this._close()}},{key:"onclose",value:function(e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()}},{key:"reconnect",value:function(){var e=this;if(this._reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{var n=this.backoff.duration();this._reconnecting=!0;var a=this.setTimeoutFn((function(){t.skipReconnect||(e.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((function(n){n?(t._reconnecting=!1,t.reconnect(),e.emitReserved("reconnect_error",n)):t.onreconnect()})))}),n);this.opts.autoUnref&&a.unref(),this.subs.push((function(){clearTimeout(a)}))}}},{key:"onreconnect",value:function(){var e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}]),r}(P),_e={};function Le(t,n){"object"===e(t)&&(n=t,t=void 0);var a,o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,a=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==n?n.protocol+"//"+e:"https://"+e),a=f(e)),a.port||(/^(http|ws)$/.test(a.protocol)?a.port="80":/^(http|ws)s$/.test(a.protocol)&&(a.port="443")),a.path=a.path||"/";var o=-1!==a.host.indexOf(":")?"["+a.host+"]":a.host;return a.id=a.protocol+"://"+o+":"+a.port+t,a.href=a.protocol+"://"+o+(n&&n.port===a.port?"":":"+a.port),a}(t,(n=n||{}).path||"/socket.io"),i=o.source,r=o.id,s=o.path,c=_e[r]&&s in _e[r].nsps;return n.forceNew||n["force new connection"]||!1===n.multiplex||c?a=new Ee(i,n):(_e[r]||(_e[r]=new Ee(i,n)),a=_e[r]),o.query&&!n.query&&(n.query=o.queryKey),a.socket(o.path,n)}return o(Le,{Manager:Ee,Socket:Re,io:Le,connect:Le}),Le},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).io=t()}"undefined"!=typeof module&&(module.exports=oi),"function"==typeof define&&define.amd&&define("RTCMultiConnection",[],(function(){return oi}));class ri{constructor(e,n){t(this,"sceneManager"),t(this,"camera"),t(this,"_keys",[]),t(this,"keysUp",[38]),t(this,"keysDown",[40]),t(this,"keysLeft",[37]),t(this,"keysRight",[39]),t(this,"_onKeyDown"),t(this,"_onKeyUp"),this.camera=e,this.sceneManager=n}_onLostFocus(e){this._keys=[]}getClassName(){return"FreeCameraKeyboardWalkInput"}getSimpleName(){return"keyboard"}attachControl(e){var t=this.camera.getEngine().getInputElement();this._onKeyDown||(t.tabIndex=1,this._onKeyDown=t=>{-1===this.keysUp.indexOf(t.keyCode)&&-1===this.keysDown.indexOf(t.keyCode)&&-1===this.keysLeft.indexOf(t.keyCode)&&-1===this.keysRight.indexOf(t.keyCode)||(-1===this._keys.indexOf(t.keyCode)&&this._keys.push(t.keyCode),e||t.preventDefault())},this._onKeyUp=t=>{if(-1!==this.keysUp.indexOf(t.keyCode)||-1!==this.keysDown.indexOf(t.keyCode)||-1!==this.keysLeft.indexOf(t.keyCode)||-1!==this.keysRight.indexOf(t.keyCode)){var n=this._keys.indexOf(t.keyCode);n>=0&&this._keys.splice(n,1),e||t.preventDefault()}},t.addEventListener("keydown",this._onKeyDown,!1),t.addEventListener("keyup",this._onKeyUp,!1))}detachControl(){var e=this.camera.getEngine().getInputElement();this._onKeyDown&&(e.removeEventListener("keydown",this._onKeyDown),e.removeEventListener("keyup",this._onKeyUp),re.UnregisterTopRootEvents(canvas,[{name:"blur",handler:this._onLostFocus}]),this._keys=[],this._onKeyDown=null,this._onKeyUp=null)}checkInputs(){if(this._onKeyDown){var e=this.camera;const a=.3,o=.03,i=Math.PI/2,r=new se(Math.cos(i),0,Math.sin(i));for(var t=0;t<this._keys.length;t++){var n=this._keys[t];-1!==this.keysLeft.indexOf(n)?this.sceneManager.lookLeft(o):-1!==this.keysRight.indexOf(n)?this.sceneManager.lookRight(o):-1!==this.keysUp.indexOf(n)?this.sceneManager.moveForward(a):-1!==this.keysDown.indexOf(n)&&this.sceneManager.moveBackward(a),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),se.TransformNormalToRef(r,e._cameraTransformMatrix,e._transformedDirection),e.cameraDirection.addInPlace(e._transformedDirection)}}}}const si=class e{constructor(e,n){t(this,"vcReadyObj"),t(this,"base_point"),t(this,"base_point_up"),t(this,"engine"),t(this,"scene"),t(this,"root_node"),t(this,"canvas"),t(this,"camera"),t(this,"RTCMC"),t(this,"positionBroadcasterID"),t(this,"myPlayer"),t(this,"otherPlayers"),t(this,"defaultPosition",{LNG:120.07,LAT:30.27,ALT:60}),this.vcReadyObj=e,this.otherPlayers=new Map,this.canvas=n,navigator.geolocation?navigator.geolocation.getCurrentPosition((e=>{this.defaultPosition.LNG=e.coords.longitude,this.defaultPosition.LAT=e.coords.latitude,this.defaultPosition.ALT=e.coords.altitude,this.init(n)}),(()=>{alert("Unable to retrieve your position!"),this.init(n)}),{timeout:3e3}):alert("Geolocation is not supported by your browser!")}static sphericalToCartesian(e,t,n){const a=t*Math.PI/180,o=e*Math.PI/180,i=6378137+n,r=i*Math.cos(a)*Math.cos(o),s=i*Math.cos(a)*Math.sin(o),c=i*Math.sin(a);return new se(-r,s,-c)}static cart2vec(e){return new se(e.x,e.z,e.y)}prepareMaterial(e,t){var n,a,o;const i=512,r=new ce("defaultMat",t);r.emissiveColor=de.Gray(),r.reflectionTexture=new le("https://playground.babylonjs.com/textures/TropicalSunnyDay",t),r.reflectionFresnelParameters=new ue,r.reflectionFresnelParameters.leftColor=de.White(),r.reflectionFresnelParameters.rightColor=de.Black();const s=r.diffuseTexture=new pe("dynamicTexture",{width:i,height:i},t),c="bold 96px monospace",d=qi.system.useUserStore(),l=(null==(n=d.info)?void 0:n.username)||(null==(o=null==(a=d.info)?void 0:a.user_metadata)?void 0:o.name)||"Guest",u=s.getContext();u.font=c;const p=u.measureText(l).width;s.drawText(l,(i-p)/2,280,c,"#FF0000","#00FFFF",!1,!0);const h=new ce("playerMat-"+e.id,t),m=new he(e.id,e,t,!1,!0);h.diffuseTexture=m,h.roughness=1,h.emissiveColor=de.Gray();const f=new me("playerMultiMat",t);return f.subMaterials.push(h),f.subMaterials.push(r),f}addPlayer(e,t,n){const a=[];a[0]=new Oe(0,0,1,1),a[1]=new Oe(0,0,0,0),a[2]=new Oe(0,0,1,1);const o=fe.CreateCylinder("player-"+e.id,{height:9,diameter:58,diameterBottom:66,faceUV:a,tessellation:68},this.scene);o.id=t,o.rotation.z=Math.PI,o.rotation.y=5*Math.PI/6,o.rotation.x=1*Math.PI/6,o.material=this.prepareMaterial(e,this.scene);const i=o.getTotalVertices();new ve(1,0,i,0,613,o),n?(o.position=new se(this.defaultPosition.LNG-230*Math.random(),this.defaultPosition.LAT-180*Math.random(),this.defaultPosition.ALT),this.myPlayer=o,this.myPlayer.parent=this.camera,this.positionBroadcasterID=setInterval((()=>{this.RTCMC&&this.updatePosition()}),333)):(o.position=se.Zero(),this.otherPlayers[t]=o)}initRTC(){ii();const e=new oi;e.socketURL={}.VITE_SIGNALING||"https://muazkhan.com:9001/",e.session={audio:!0,video:!0,data:!0},e.sdpConstraints.mandatory={OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},e.iceServers=[],e.iceServers.push({urls:"stun:relay1.expressturn.com:3478"}),e.iceServers.push({urls:"turn:relay1.expressturn.com:3478",credential:"MzfF6EsaoFoedmtF",username:"efJMS09F9O5E77NPFE"}),e.onstream=t=>{e.setCustomSocketEvent("updatePosition"),e.socket.on("updatePosition",(e=>{this.otherPlayers[e.player]&&(this.otherPlayers[e.player].position.x=e.target._x,this.otherPlayers[e.player].position.y=e.target._y,this.otherPlayers[e.player].position.z=e.target._z)})),e.setCustomSocketEvent("updateRotation"),e.socket.on("updateRotation",(e=>{"left"==e.target?this.otherPlayers[e.player].rotation.z+=Math.PI/66:"right"==e.target&&(this.otherPlayers[e.player].rotation.z-=Math.PI/66)})),"local"===t.type?this.addPlayer(t.mediaElement,t.userid,!0):this.addPlayer(t.mediaElement,t.userid,!1)},e.onclose=e=>{let t;t="local"===e.type?this.myPlayer:this.otherPlayers[e.userid],t.dispose(),"local"===e.type?(this.myPlayer=null,clearInterval(this.positionBroadcasterID)):delete this.otherPlayers[e.userid]},e.onstreamended=e=>{let t;t="local"===e.type?this.myPlayer:this.otherPlayers[e.streamid],t.dispose(),"local"===e.type?(this.myPlayer=null,clearInterval(this.positionBroadcasterID)):delete this.otherPlayers[e.userid]},e.openOrJoin("GV-Globe"),this.RTCMC=e}moveBabylonCamera(){const t=this.vcReadyObj.Cesium.Math.toDegrees(this.vcReadyObj.viewer.camera.frustum.fovy);this.camera.fov=t/180*Math.PI;const n=this.vcReadyObj.viewer.camera.inverseViewMatrix,a=ye.FromValues(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]),o=se.Zero(),i=ge.Zero(),r=se.Zero();a.decompose(o,i,r);const s=e.cart2vec(r),c=e.cart2vec(this.vcReadyObj.viewer.camera.direction),d=e.cart2vec(this.vcReadyObj.viewer.camera.up);let l=Math.atan(c.z/c.x);c.x<0&&(l+=Math.PI),l=Math.PI/2-l;const u=Math.asin(-c.y),p=new se(-Math.cos(l),0,Math.sin(l));let h=Math.acos(d.x*p.x+d.y*p.y+d.z*p.z);h=Math.PI/2-h,d.y<0&&(h=Math.PI-h),this.camera.position.x=s.x-this.base_point.x,this.camera.position.y=s.y-this.base_point.y,this.camera.position.z=s.z-this.base_point.z,this.camera.rotation.x=u,this.camera.rotation.y=l,this.camera.rotation.z=h}initCesium(){this.base_point=e.cart2vec(this.vcReadyObj.Cesium.Cartesian3.fromDegrees(this.defaultPosition.LNG,this.defaultPosition.LAT,50)),this.base_point_up=e.cart2vec(this.vcReadyObj.Cesium.Cartesian3.fromDegrees(this.defaultPosition.LNG,this.defaultPosition.LAT,300)),this.vcReadyObj.viewer.camera.flyTo({destination:this.vcReadyObj.Cesium.Cartesian3.fromDegrees(this.defaultPosition.LNG,this.defaultPosition.LAT-.003,this.defaultPosition.ALT+60),orientation:{heading:this.vcReadyObj.Cesium.Math.toRadians(0),pitch:this.vcReadyObj.Cesium.Math.toRadians(-10)}})}async initBabylon(t){const n=new be(t),a=new Ce(n);a.clearColor=new ke(0,0,0,0);const o=new Se("camera",new se(0,0,-10),this.scene);a.activeCamera=o,a.activeCamera.attachControl(t,!0),this.root_node=new we("BaseNode",a),this.root_node.lookAt(this.base_point_up.subtract(this.base_point)),this.root_node.addRotation(Math.PI/2,0,0),o.inputs.removeByType("FreeCameraKeyboardMoveInput"),o.inputs.removeByType("FreeCameraMouseInput"),o.inputs.add(new ri(o,this)),this.engine=n,this.scene=a,this.camera=o;const i=document.createElement("button");i.style.top="60px",i.style.left="30px",i.textContent="@XiXiWetland",i.style.width="106px",i.style.height="33px",i.style.position="absolute",i.style.color="white",i.style.background="rgba(0, 68, 82, 0.6)",i.style["border-radius"]="30px",document.body.appendChild(i),i.addEventListener("click",(()=>{const t=this.RTCMC;t.getAllParticipants().forEach((function(e){t.disconnectWith(e)})),t.attachStreams.forEach((function(e){e.stop()})),t.closeSocket(),t.onstream=e=>{t.setCustomSocketEvent("updatePosition"),t.socket.on("updatePosition",(e=>{this.otherPlayers[e.player]&&(this.otherPlayers[e.player].position=e.target)})),t.setCustomSocketEvent("updateRotation"),t.socket.on("updateRotation",(e=>{"left"==e.target?this.otherPlayers[e.player].rotation.z+=Math.PI/66:"right"==e.target&&(this.otherPlayers[e.player].rotation.z-=Math.PI/66)})),t.setCustomSocketEvent("movePOV"),t.socket.on("movePOV",(e=>{this.otherPlayers[e.player].movePOV(0,e.target.y,0)})),"local"===e.type?this.addPlayer(e.mediaElement,e.userid,!0):this.addPlayer(e.mediaElement,e.userid,!1)},t.openOrJoin("GV-XiXiWetland"),this.base_point=e.cart2vec(this.vcReadyObj.Cesium.Cartesian3.fromDegrees(120.07,30.27,50)),this.base_point_up=e.cart2vec(this.vcReadyObj.Cesium.Cartesian3.fromDegrees(120.07,30.27,300)),this.root_node.lookAt(this.base_point_up.subtract(this.base_point)),this.root_node.addRotation(Math.PI/2,0,0),this.vcReadyObj.viewer.camera.flyTo({destination:this.vcReadyObj.Cesium.Cartesian3.fromDegrees(120.07,30.267,60),orientation:{heading:this.vcReadyObj.Cesium.Math.toRadians(0),pitch:this.vcReadyObj.Cesium.Math.toRadians(-10)}}),this.myPlayer.position=new se(120.07-230*Math.random(),30.27-180*Math.random(),60),n.runRenderLoop((()=>{this.vcReadyObj.viewer.render(),this.moveBabylonCamera(),this.scene.render()}))})),n.runRenderLoop((()=>{this.vcReadyObj.viewer.render(),this.moveBabylonCamera(),this.scene.render()}))}async initBabylon1(e){const t=new be(e),n=new Ce(t),a=await Pe(),o=new Me(!0,a);n.enablePhysics(new se(0,0,0),o),n.clearColor=new ke(0,0,0,0);const i=new Se("camera",new se(0,0,-10),this.scene);n.activeCamera=i,n.activeCamera.attachControl(e,!0),this.root_node=new we("BaseNode",n),this.root_node.lookAt(this.base_point_up.subtract(this.base_point)),this.root_node.addRotation(Math.PI/2,0,0);const r=fe.CreateCylinder("player-0",{height:9,diameter:58,diameterBottom:66},n);r.position.y=36,r.rotation.x=Math.PI/2,r.rotation.z=Math.PI/2;const s=fe.CreateCylinder("player-1",{height:9,diameter:58,diameterBottom:66},n);s.position.y=30,s.position.x=60,s.rotation.x=Math.PI/2,s.rotation.z=Math.PI/2;const c=new Te(r,xe.CYLINDER,{mass:1},n),d=new Te(s,c.shape,{mass:1},n);c.body.disablePreStep=!1,d.body.disablePreStep=!1,n.actionManager=new Re(n),n.actionManager.registerAction(new Ie({trigger:Re.OnKeyDownTrigger,parameter:"A"},(()=>{s.position.x-=10}))),n.actionManager.registerAction(new Ie({trigger:Re.OnKeyDownTrigger,parameter:"D"},(()=>{r.position.x+=10}))),this.engine=t,this.scene=n,this.camera=i,t.runRenderLoop((()=>{this.vcReadyObj.viewer.render(),this.moveBabylonCamera(),this.scene.render()}))}init(e){this.initCesium(),this.initBabylon(e),this.initRTC()}updatePosition(){this.RTCMC.socket.emit("updatePosition",{player:this.myPlayer.id,target:this.myPlayer.position})}static getInstance(t,n){return e.instance||(e.instance=new e(t,n)),e.instance}lookLeft(e){this.vcReadyObj.viewer.camera.lookLeft(e),this.RTCMC.socket.emit("updateRotation",{player:this.myPlayer.id,target:"left"})}lookRight(e){this.vcReadyObj.viewer.camera.lookRight(e),this.RTCMC.socket.emit("updateRotation",{player:this.myPlayer.id,target:"right"})}moveForward(e){this.vcReadyObj.viewer.camera.moveForward(e),this.myPlayer.movePOV(0,.3,0),this.updatePosition()}moveBackward(e){this.vcReadyObj.viewer.camera.moveBackward(e),this.myPlayer.movePOV(0,-.3,0),this.updatePosition()}};t(si,"instance");let ci=si;Ee();class di{constructor(e,n){t(this,"baseSceneManager"),t(this,"wCafeScene"),this.baseSceneManager=ci.getInstance(e,n);const a=document.createElement("button");a.style.top="60px",a.style.left="228px",a.textContent="@WCafe",a.style.width="86px",a.style.height="33px",a.style.position="absolute",a.style.color="white",a.style.background="rgba(0, 68, 82, 0.6)",a.style["border-radius"]="30px",document.body.appendChild(a),a.addEventListener("click",(()=>{this.load()}))}addWCafePlayer(e,t,n){var a=[];a[0]=new Oe(0,0,1,1),a[1]=new Oe(0,0,0,0),a[2]=new Oe(0,0,1,1);var o=fe.CreateCylinder("player-"+e.id,{height:.09,diameter:.68,diameterBottom:.73,faceUV:a,tessellation:68},this.wCafeScene);o.id=t,o.rotation.z=Math.PI,o.rotation.y=9*Math.PI/6,o.rotation.x=3*Math.PI/6,o.material=this.baseSceneManager.prepareMaterial(e,this.wCafeScene);const i=o.getTotalVertices();new ve(1,0,i,0,613,o),n?(o.position=new se(-61-3*Math.random(),1.693,.316-Math.random()),this.baseSceneManager.myPlayer=o,this.baseSceneManager.myPlayer.parent=this.wCafeScene.activeCamera,this.baseSceneManager.positionBroadcasterID=setInterval((()=>{this.baseSceneManager.RTCMC&&this.baseSceneManager.updatePosition()}),3e3)):(o.position=new se(-61,.327,.316),this.baseSceneManager.otherPlayers[t]=o);const r=new Te(o,xe.CYLINDER,{mass:1,restitution:.75},this.wCafeScene);r.body.disablePreStep=!1;let s=new _e(.8,this.wCafeScene);r.body.setMassProperties({inertia:new se(0,0,0)}),r.body.setCollisionCallbackEnabled(!0);r.body.getCollisionObservable().add((e=>{"COLLISION_STARTED"===e.type&&(e.collider.addConstraint(e.collidedAgainst,s),setTimeout((()=>s.dispose()),100))}))}enter(){const e=this.baseSceneManager.RTCMC;e.getAllParticipants().forEach((function(t){e.disconnectWith(t)})),e.attachStreams.forEach((function(e){e.stop()})),e.closeSocket(),e.onstream=t=>{const n=this.baseSceneManager.otherPlayers;e.setCustomSocketEvent("updatePosition"),e.socket.on("updatePosition",(e=>{n[e.player]&&(n[e.player].position.x=e.target._x,n[e.player].position.y=e.target._y,n[e.player].position.z=e.target._z)})),e.setCustomSocketEvent("updateRotation"),e.socket.on("updateRotation",(e=>{"left"==e.target?n[e.player].rotation.z+=Math.PI/66:"right"==e.target&&(n[e.player].rotation.z-=Math.PI/66)})),"local"===t.type?this.addWCafePlayer(t.mediaElement,t.userid,!0):this.addWCafePlayer(t.mediaElement,t.userid,!1)},e.openOrJoin("GV-WCafe")}async load(){const e=this.baseSceneManager.engine;let t=0;Le.Load("/datas/babylon/WCafe/","WCafe.babylon",e,(t=>{t.executeWhenReady((async()=>{const n=await Pe(),a=new Me(!0,n);t.enablePhysics(new se(0,0,0),a),t.activeCamera&&t.activeCamera.attachControl(this.baseSceneManager.canvas),this.wCafeScene=t,e.runRenderLoop((()=>{this.wCafeScene.render()})),this.enter()}))}),(n=>{n.lengthComputable?e.loadingUIText="Loading, please wait..."+(100*n.loaded/n.total).toFixed()+"%":(t=n.loaded/1048576,e.loadingUIText="Loading, please wait..."+Math.floor(100*t)/100+" MB already loaded.")}))}}Ee();class li{constructor(e,n){t(this,"baseSceneManager"),t(this,"islandScene"),this.baseSceneManager=ci.getInstance(e,n);const a=document.createElement("button");a.style.top="60px",a.style.left="139px",a.textContent="@Island",a.style.width="86px",a.style.height="33px",a.style.position="absolute",a.style.color="white",a.style.background="rgba(0, 68, 82, 0.6)",a.style["border-radius"]="30px",document.body.appendChild(a),a.addEventListener("click",(()=>{this.load()}))}addIslandPlayer(e,t,n){var a=[];a[0]=new Oe(0,0,1,1),a[1]=new Oe(0,0,0,0),a[2]=new Oe(0,0,1,1);var o=fe.CreateCylinder("player-"+e.id,{height:.09,diameter:.68,diameterBottom:.73,faceUV:a,tessellation:68},this.islandScene);o.id=t,o.rotation.z=Math.PI,o.rotation.y=9*Math.PI/6,o.rotation.x=3*Math.PI/6,o.material=this.baseSceneManager.prepareMaterial(e,this.islandScene);const i=o.getTotalVertices();new ve(1,0,i,0,613,o),n?(o.position=new se(1.08-3*Math.random(),3.33,1.27-3*Math.random()),this.baseSceneManager.myPlayer=o,this.baseSceneManager.myPlayer.parent=this.islandScene.activeCamera,this.baseSceneManager.positionBroadcasterID=setInterval((()=>{this.baseSceneManager.RTCMC&&this.baseSceneManager.updatePosition()}),3e3)):(o.position=new se(-61,.327,.316),this.baseSceneManager.otherPlayers[t]=o)}enter(){const e=this.baseSceneManager.RTCMC;e.getAllParticipants().forEach((function(t){e.disconnectWith(t)})),e.attachStreams.forEach((function(e){e.stop()})),e.closeSocket(),e.onstream=t=>{const n=this.baseSceneManager.otherPlayers;e.setCustomSocketEvent("updatePosition"),e.socket.on("updatePosition",(e=>{n[e.player]&&(n[e.player].position=e.target)})),e.setCustomSocketEvent("updateRotation"),e.socket.on("updateRotation",(e=>{"left"==e.target?n[e.player].rotation.z+=Math.PI/66:"right"==e.target&&(n[e.player].rotation.z-=Math.PI/66)})),"local"===t.type?this.addIslandPlayer(t.mediaElement,t.userid,!0):this.addIslandPlayer(t.mediaElement,t.userid,!1)},e.openOrJoin("GV-Island")}async load(){const e=this.baseSceneManager.engine;let t=0;Le.Load("/datas/gltf/Island/","island.glb",e,(t=>{t.executeWhenReady((()=>{t.createDefaultCamera(!0,!0,!0),t.createDefaultEnvironment({createGround:!1,createSkybox:!1}),t.activeCamera&&(t.activeCamera.attachControl(this.baseSceneManager.canvas),t.activeCamera.alpha=0,t.activeCamera.radius=31.168),this.islandScene=t,e.runRenderLoop((()=>{this.islandScene.render()})),this.enter()}))}),(n=>{n.lengthComputable?e.loadingUIText="Loading, please wait..."+(100*n.loaded/n.total).toFixed()+"%":(t=n.loaded/1048576,e.loadingUIText="Loading, please wait..."+Math.floor(100*t)/100+" MB already loaded.")}))}}Ee();class ui{constructor(e,n){t(this,"baseSceneManager"),t(this,"salaScene"),t(this,"rotationBroadcastID"),this.baseSceneManager=ci.getInstance(e,n);const a=document.createElement("button");a.style.top="60px",a.style.left="327px",a.textContent="@MR_Sala",a.style.width="86px",a.style.height="33px",a.style.position="absolute",a.style.color="white",a.style.background="rgba(0, 68, 82, 0.6)",a.style["border-radius"]="30px",document.body.appendChild(a),a.addEventListener("click",(()=>{this.load()}))}updateSeatRotation(e){this.baseSceneManager.RTCMC.socket.emit("updateSeatRotation",{player:this.baseSceneManager.myPlayer.id,target:e})}addSalaPlayer(e,t,n){var a=[];a[0]=new Oe(0,0,1,1),a[1]=new Oe(0,0,0,0),a[2]=new Oe(0,0,1,1);var o=fe.CreateCylinder("player-"+e.id,{height:.06,diameter:.39,diameterBottom:.43,faceUV:a,tessellation:68},this.salaScene);o.id=t,o.rotation.z=Math.PI,o.rotation.y=9*Math.PI/6,o.rotation.x=3*Math.PI/6,o.material=this.baseSceneManager.prepareMaterial(e,this.salaScene);const i=o.getTotalVertices();new ve(1,0,i,0,613,o),n?(o.position=new se(-1-Math.random(),1.693,.316-Math.random()),this.baseSceneManager.myPlayer=o,this.baseSceneManager.myPlayer.parent=this.salaScene.activeCamera,this.baseSceneManager.positionBroadcasterID=setInterval((()=>{this.baseSceneManager.RTCMC&&this.baseSceneManager.updatePosition()}),333)):(o.position=new se(-1,.327,.316),this.baseSceneManager.otherPlayers[t]=o),this.salaScene.onPointerObservable.add((e=>{e.pickInfo.pickedMesh&&(this.baseSceneManager.myPlayer.parent=null,e.pickInfo.pickedMesh.name.includes("cadeirajantar.007")?(this.baseSceneManager.myPlayer.position.x=e.pickInfo.pickedMesh.parent.position.x-.32,this.baseSceneManager.myPlayer.position.z=e.pickInfo.pickedMesh.parent.position.z-.1,this.baseSceneManager.myPlayer.rotation.y=Math.PI,this.rotationBroadcastID=setInterval((()=>{this.baseSceneManager.RTCMC&&this.updateSeatRotation("W")}),333),this.salaScene.activeCamera.target.x=.134,this.salaScene.activeCamera.target.z=.187,this.salaScene.activeCamera.alpha=-1.69,this.salaScene.activeCamera.radius=2.255):e.pickInfo.pickedMesh.name.includes("cadeirajantar.006")?(this.baseSceneManager.myPlayer.position.x=e.pickInfo.pickedMesh.parent.position.x+.95,this.baseSceneManager.myPlayer.position.z=e.pickInfo.pickedMesh.parent.position.z,this.baseSceneManager.myPlayer.rotation.y=Math.PI/2,this.rotationBroadcastID=setInterval((()=>{this.baseSceneManager.RTCMC&&this.updateSeatRotation("N")}),333),this.salaScene.activeCamera.target.x=.19,this.salaScene.activeCamera.target.z=.475,this.salaScene.activeCamera.alpha=3.07,this.salaScene.activeCamera.radius=1.656):e.pickInfo.pickedMesh.name.includes("cadeirajantar.005")?(this.baseSceneManager.myPlayer.position.x=e.pickInfo.pickedMesh.parent.position.x-.18+1.13,this.baseSceneManager.myPlayer.position.z=e.pickInfo.pickedMesh.parent.position.z+.1-.1,this.baseSceneManager.myPlayer.rotation.y=Math.PI/2,this.rotationBroadcastID=setInterval((()=>{this.baseSceneManager.RTCMC&&this.updateSeatRotation("N")}),333),this.salaScene.activeCamera.target.x=.071,this.salaScene.activeCamera.target.z=.157,this.salaScene.activeCamera.alpha=-.07,this.salaScene.activeCamera.radius=.975):e.pickInfo.pickedMesh.name.includes("cadeirajantar.004")?(this.baseSceneManager.myPlayer.position.x=e.pickInfo.pickedMesh.parent.position.x-.18+1.13,this.baseSceneManager.myPlayer.position.z=e.pickInfo.pickedMesh.parent.position.z+.1-.1,this.baseSceneManager.myPlayer.rotation.y=Math.PI/2,this.rotationBroadcastID=setInterval((()=>{this.baseSceneManager.RTCMC&&this.updateSeatRotation("N")}),333),this.salaScene.activeCamera.target.x=.013,this.salaScene.activeCamera.target.z=-.456,this.salaScene.activeCamera.alpha=-.06,this.salaScene.activeCamera.radius=1.281):e.pickInfo.pickedMesh.name.includes("cadeirajantar.003")?(this.baseSceneManager.myPlayer.position.x=e.pickInfo.pickedMesh.parent.position.x-.18-1.32,this.baseSceneManager.myPlayer.position.z=e.pickInfo.pickedMesh.parent.position.z+.1-.11,this.baseSceneManager.myPlayer.rotation.y=3*Math.PI/2,this.rotationBroadcastID=setInterval((()=>{this.baseSceneManager.RTCMC&&this.updateSeatRotation("S")}),333),this.salaScene.activeCamera.target.x=.123,this.salaScene.activeCamera.target.z=-.305,this.salaScene.activeCamera.alpha=3.15,this.salaScene.activeCamera.radius=1.94):e.pickInfo.pickedMesh.name.includes("cadeirajantar.002")?(this.baseSceneManager.myPlayer.position.x=e.pickInfo.pickedMesh.parent.position.x-.28-1.22,this.baseSceneManager.myPlayer.position.z=e.pickInfo.pickedMesh.parent.position.z+.1-.1,this.baseSceneManager.myPlayer.rotation.y=3*Math.PI/2,this.rotationBroadcastID=setInterval((()=>{this.baseSceneManager.RTCMC&&this.updateSeatRotation("S")}),333),this.salaScene.activeCamera.target.x=.183,this.salaScene.activeCamera.target.z=.332,this.salaScene.activeCamera.alpha=3.19,this.salaScene.activeCamera.radius=2.008):e.pickInfo.pickedMesh.name.includes("cadeirajantar.001")?(this.baseSceneManager.myPlayer.position.x=e.pickInfo.pickedMesh.parent.position.x-1.51,this.baseSceneManager.myPlayer.position.z=e.pickInfo.pickedMesh.parent.position.z,this.baseSceneManager.myPlayer.rotation.y=3*Math.PI/2,this.rotationBroadcastID=setInterval((()=>{this.baseSceneManager.RTCMC&&this.updateSeatRotation("S")}),333),this.salaScene.activeCamera.target.x=.189,this.salaScene.activeCamera.target.z=.432,this.salaScene.activeCamera.alpha=3.1,this.salaScene.activeCamera.radius=2.059):e.pickInfo.pickedMesh.name.includes("cadeirajantar")&&(this.baseSceneManager.myPlayer.position.x=e.pickInfo.pickedMesh.parent.position.x-.18,this.baseSceneManager.myPlayer.position.z=e.pickInfo.pickedMesh.parent.position.z+.1,this.baseSceneManager.myPlayer.rotation.y=0,this.rotationBroadcastID=setInterval((()=>{this.baseSceneManager.RTCMC&&this.updateSeatRotation("E")}),333),this.salaScene.activeCamera.target.x=.028,this.salaScene.activeCamera.target.z=-.159,this.salaScene.activeCamera.alpha=1.66,this.salaScene.activeCamera.radius=2.255),e.pickInfo.pickedMesh.name.includes("cadeirajantar")&&(this.baseSceneManager.myPlayer.position.y=e.pickInfo.pickedMesh.parent.position.y+.6,this.salaScene.activeCamera.target.y=1.08,this.salaScene.activeCamera.beta=1.13))}),De.POINTERDOUBLETAP)}enter(){const e=this.baseSceneManager.RTCMC;e.getAllParticipants().forEach((function(t){e.disconnectWith(t)})),e.attachStreams.forEach((function(e){e.stop()})),e.closeSocket(),e.onstream=t=>{const n=this.baseSceneManager.otherPlayers;e.setCustomSocketEvent("updatePosition"),e.socket.on("updatePosition",(e=>{n[e.player]&&(n[e.player].position.x=e.target._x,n[e.player].position.y=e.target._y,n[e.player].position.z=e.target._z)})),e.setCustomSocketEvent("updateRotation"),e.socket.on("updateRotation",(e=>{"left"==e.target?n[e.player].rotation.z+=Math.PI/66:"right"==e.target&&(n[e.player].rotation.z-=Math.PI/66)})),e.setCustomSocketEvent("updateSeatRotation"),e.socket.on("updateSeatRotation",(e=>{switch(e.target){case"E":n[e.player].rotation.y=0;break;case"W":n[e.player].rotation.y=Math.PI;break;case"N":n[e.player].rotation.y=Math.PI/2;break;case"S":n[e.player].rotation.y=3*Math.PI/2}})),"local"===t.type?this.addSalaPlayer(t.mediaElement,t.userid,!0):this.addSalaPlayer(t.mediaElement,t.userid,!1)},e.onclose=e=>{let t;const n=this.baseSceneManager.otherPlayers;"local"===e.type?t=this.baseSceneManager.myPlayer:(t=n[e.userid],t.dispose(),"local"===e.type?(this.baseSceneManager.myPlayer=null,clearInterval(this.baseSceneManager.positionBroadcasterID),clearInterval(this.rotationBroadcastID)):delete n[e.userid])},e.onstreamended=e=>{let t;const n=this.baseSceneManager.otherPlayers;"local"===e.type?t=this.baseSceneManager.myPlayer:(t=n[e.userid],t.dispose(),"local"===e.type?(this.baseSceneManager.myPlayer=null,clearInterval(this.baseSceneManager.positionBroadcasterID),clearInterval(this.rotationBroadcastID)):delete n[e.userid])},e.openOrJoin("GV-MR_Sala")}async load(){const e=this.baseSceneManager.engine;let t=0;Le.Load("/datas/gltf/MR/","Sala de jantar.glb",e,(t=>{t.executeWhenReady((async()=>{t.createDefaultCamera(!0,!0,!0),t.createDefaultEnvironment({createGround:!1,createSkybox:!1}),t.activeCamera&&(t.activeCamera.attachControl(this.baseSceneManager.canvas),t.activeCamera.alpha=0,t.activeCamera.radius=3.168),this.salaScene=t,e.runRenderLoop((()=>{this.salaScene.render()})),this.enter()}))}),(n=>{n.lengthComputable?e.loadingUIText="Loading, please wait..."+(100*n.loaded/n.total).toFixed()+"%":(t=n.loaded/1048576,e.loadingUIText="Loading, please wait..."+Math.floor(100*t)/100+" MB already loaded.")}))}}Ee();class pi{constructor(e,n){t(this,"baseSceneManager"),t(this,"oneOneScene"),t(this,"rotationBroadcastID"),this.baseSceneManager=ci.getInstance(e,n);const a=document.createElement("button");a.style.top="60px",a.style.left="416px",a.textContent="@MR_OneOne",a.style.width="106px",a.style.height="33px",a.style.position="absolute",a.style.color="white",a.style.background="rgba(0, 68, 82, 0.6)",a.style["border-radius"]="30px",document.body.appendChild(a),a.addEventListener("click",(()=>{this.load()}))}updateSeatRotation(e){this.baseSceneManager.RTCMC.socket.emit("updateSeatRotation",{player:this.baseSceneManager.myPlayer.id,target:e})}addOneOnePlayer(e,t,n){var a=[];a[0]=new Oe(0,0,1,1),a[1]=new Oe(0,0,0,0),a[2]=new Oe(0,0,1,1);var o=fe.CreateCylinder("player-"+e.id,{height:.06,diameter:.39,diameterBottom:.43,faceUV:a,tessellation:68},this.oneOneScene);o.id=t,o.rotation.z=Math.PI,o.rotation.y=9*Math.PI/6,o.rotation.x=3*Math.PI/6,o.material=this.baseSceneManager.prepareMaterial(e,this.oneOneScene);const i=o.getTotalVertices();new ve(1,0,i,0,613,o),n?(o.position=new se(-1-Math.random(),1.693,.316-Math.random()),this.baseSceneManager.myPlayer=o,this.baseSceneManager.myPlayer.parent=this.oneOneScene.activeCamera,this.baseSceneManager.positionBroadcasterID=setInterval((()=>{this.baseSceneManager.RTCMC&&this.baseSceneManager.updatePosition()}),3e3)):(o.position=new se(-1,.327,.316),this.baseSceneManager.otherPlayers[t]=o),this.oneOneScene.onPointerObservable.add((e=>{e.pickInfo.pickedMesh&&(this.baseSceneManager.myPlayer.parent=null,"Stool2"==e.pickInfo.pickedMesh.name?(this.baseSceneManager.myPlayer.position.x=e.pickInfo.pickedMesh.parent.position.x+.66,this.baseSceneManager.myPlayer.position.y=1.193,this.baseSceneManager.myPlayer.position.z=e.pickInfo.pickedMesh.parent.position.z,this.baseSceneManager.myPlayer.rotation.y=Math.PI/2,this.rotationBroadcastID=setInterval((()=>{this.baseSceneManager.RTCMC&&this.updateSeatRotation("W")}),333),this.oneOneScene.activeCamera.alpha=-.023,this.oneOneScene.activeCamera.beta=1.02,this.oneOneScene.activeCamera.radius=3.254):"Stool"==e.pickInfo.pickedMesh.name&&(this.baseSceneManager.myPlayer.position.x=e.pickInfo.pickedMesh.parent.position.x-.66,this.baseSceneManager.myPlayer.position.y=1.193,this.baseSceneManager.myPlayer.position.z=e.pickInfo.pickedMesh.parent.position.z,this.baseSceneManager.myPlayer.rotation.y=3*Math.PI/2,this.rotationBroadcastID=setInterval((()=>{this.baseSceneManager.RTCMC&&this.updateSeatRotation("E")}),333),this.oneOneScene.activeCamera.alpha=-3.145,this.oneOneScene.activeCamera.beta=1.02,this.oneOneScene.activeCamera.radius=3.254))}),De.POINTERDOUBLETAP)}enter(){const e=this.baseSceneManager.RTCMC;e.getAllParticipants().forEach((function(t){e.disconnectWith(t)})),e.attachStreams.forEach((function(e){e.stop()})),e.closeSocket(),e.onstream=t=>{const n=this.baseSceneManager.otherPlayers;e.setCustomSocketEvent("updatePosition"),e.socket.on("updatePosition",(e=>{n[e.player]&&(n[e.player].position.x=e.target._x,n[e.player].position.y=e.target._y,n[e.player].position.z=e.target._z)})),e.setCustomSocketEvent("updateRotation"),e.socket.on("updateRotation",(e=>{"left"==e.target?n[e.player].rotation.z+=Math.PI/66:"right"==e.target&&(n[e.player].rotation.z-=Math.PI/66)})),e.setCustomSocketEvent("updateSeatRotation"),e.socket.on("updateSeatRotation",(e=>{switch(e.target){case"E":n[e.player].rotation.y=3*Math.PI/2;break;case"W":n[e.player].rotation.y=Math.PI/2}})),"local"===t.type?this.addOneOnePlayer(t.mediaElement,t.userid,!0):this.addOneOnePlayer(t.mediaElement,t.userid,!1)},e.onclose=e=>{let t;const n=this.baseSceneManager.otherPlayers;"local"===e.type?t=this.baseSceneManager.myPlayer:(t=n[e.userid],t.dispose(),"local"===e.type?(this.baseSceneManager.myPlayer=null,clearInterval(this.baseSceneManager.positionBroadcasterID),clearInterval(this.rotationBroadcastID)):delete n[e.userid])},e.onstreamended=e=>{let t;const n=this.baseSceneManager.otherPlayers;"local"===e.type?t=this.baseSceneManager.myPlayer:(t=n[e.userid],t.dispose(),"local"===e.type?(this.baseSceneManager.myPlayer=null,clearInterval(this.baseSceneManager.positionBroadcasterID),clearInterval(this.rotationBroadcastID)):delete n[e.userid])},e.openOrJoin("GV-MR_OneOne")}async load(){const e=this.baseSceneManager.engine;let t=0;Le.Load("/datas/gltf/MR/","OneOne.glb",e,(t=>{t.executeWhenReady((async()=>{t.createDefaultCamera(!0,!0,!0),t.createDefaultEnvironment({createGround:!1,createSkybox:!1}),t.activeCamera&&(t.activeCamera.attachControl(this.baseSceneManager.canvas),t.activeCamera.alpha=0,t.activeCamera.radius=3.168),this.oneOneScene=t,e.runRenderLoop((()=>{this.oneOneScene.render()})),this.enter()}))}),(n=>{n.lengthComputable?e.loadingUIText="Loading, please wait..."+(100*n.loaded/n.total).toFixed()+"%":(t=n.loaded/1048576,e.loadingUIText="Loading, please wait..."+Math.floor(100*t)/100+" MB already loaded.")}))}}Ee();class hi{constructor(e,n){t(this,"baseSceneManager"),t(this,"zugdidiScene"),t(this,"rotationBroadcastID"),this.baseSceneManager=ci.getInstance(e,n);const a=document.createElement("button");a.style.top="60px",a.style.left="535px",a.textContent="@Con_Zugdidi",a.style.width="109px",a.style.height="33px",a.style.position="absolute",a.style.color="white",a.style.background="rgba(0, 68, 82, 0.6)",a.style["border-radius"]="30px",document.body.appendChild(a),a.addEventListener("click",(()=>{this.load()}))}updateSeatRotation(e){this.baseSceneManager.RTCMC.socket.emit("updateSeatRotation",{player:this.baseSceneManager.myPlayer.id,target:e})}addZugadidiPlayer(e,t,n){var a=[];a[0]=new Oe(0,0,1,1),a[1]=new Oe(0,0,0,0),a[2]=new Oe(0,0,1,1);var o=fe.CreateCylinder("player-"+e.id,{height:.06,diameter:.39,diameterBottom:.43,faceUV:a,tessellation:68},this.zugdidiScene);o.id=t,o.rotation.z=Math.PI,o.rotation.y=9*Math.PI/6,o.rotation.x=3*Math.PI/6,o.material=this.baseSceneManager.prepareMaterial(e,this.zugdidiScene);const i=o.getTotalVertices();new ve(1,0,i,0,613,o),n?(o.position=new se(-1-Math.random(),1.693,.316-Math.random()),this.baseSceneManager.myPlayer=o,this.baseSceneManager.myPlayer.parent=this.zugdidiScene.activeCamera,this.baseSceneManager.positionBroadcasterID=setInterval((()=>{this.baseSceneManager.RTCMC&&this.baseSceneManager.updatePosition()}),3e3)):(o.position=new se(-1,.327,.316),this.baseSceneManager.otherPlayers[t]=o),this.zugdidiScene.onPointerObservable.add((e=>{e.pickInfo.pickedMesh&&(this.baseSceneManager.myPlayer.parent=null,e.pickInfo.pickedMesh.name.includes("Woman")?(this.baseSceneManager.myPlayer.position.x=10.723,this.baseSceneManager.myPlayer.position.y=2.58,this.baseSceneManager.myPlayer.position.z=-8.72,this.baseSceneManager.myPlayer.rotation.y=Math.PI/2,this.rotationBroadcastID=setInterval((()=>{this.baseSceneManager.RTCMC&&this.updateSeatRotation("W")}),333),this.zugdidiScene.activeCamera.target.x=9.143,this.zugdidiScene.activeCamera.target.y=2.407,this.zugdidiScene.activeCamera.target.z=-8.576,this.zugdidiScene.activeCamera.alpha=-.023,this.zugdidiScene.activeCamera.beta=1.511,this.zugdidiScene.activeCamera.radius=2.139):e.pickInfo.pickedMesh.name.includes("Line001.020")?(this.baseSceneManager.myPlayer.position.x=1.611,this.baseSceneManager.myPlayer.position.z=-13.234):e.pickInfo.pickedMesh.name.includes("Line001")&&(this.baseSceneManager.myPlayer.position.x=e.pickInfo.pickedMesh.position.x-2.7,this.baseSceneManager.myPlayer.position.z=e.pickInfo.pickedMesh.position.z+.18),e.pickInfo.pickedMesh.name.includes("Line001")&&(this.baseSceneManager.myPlayer.position.y=1.372,this.baseSceneManager.myPlayer.rotation.y=3*Math.PI/2,this.rotationBroadcastID=setInterval((()=>{this.baseSceneManager.RTCMC&&this.updateSeatRotation("E")}),333),this.zugdidiScene.activeCamera.target.x=1.323,this.zugdidiScene.activeCamera.target.y=2.355,this.zugdidiScene.activeCamera.target.z=-11.608,this.zugdidiScene.activeCamera.alpha=-3.11,this.zugdidiScene.activeCamera.beta=1.55,this.zugdidiScene.activeCamera.radius=10.176))}),De.POINTERDOUBLETAP)}enter(){const e=this.baseSceneManager.RTCMC;e.getAllParticipants().forEach((function(t){e.disconnectWith(t)})),e.attachStreams.forEach((function(e){e.stop()})),e.closeSocket(),e.onstream=t=>{const n=this.baseSceneManager.otherPlayers;e.setCustomSocketEvent("updatePosition"),e.socket.on("updatePosition",(e=>{n[e.player]&&(n[e.player].position.x=e.target._x,n[e.player].position.y=e.target._y,n[e.player].position.z=e.target._z)})),e.setCustomSocketEvent("updateRotation"),e.socket.on("updateRotation",(e=>{"left"==e.target?n[e.player].rotation.z+=Math.PI/66:"right"==e.target&&(n[e.player].rotation.z-=Math.PI/66)})),e.setCustomSocketEvent("updateSeatRotation"),e.socket.on("updateSeatRotation",(e=>{switch(e.target){case"E":n[e.player].rotation.y=3*Math.PI/2;break;case"W":n[e.player].rotation.y=Math.PI/2}})),"local"===t.type?this.addZugadidiPlayer(t.mediaElement,t.userid,!0):this.addZugadidiPlayer(t.mediaElement,t.userid,!1)},e.onclose=e=>{let t;const n=this.baseSceneManager.otherPlayers;"local"===e.type?t=this.baseSceneManager.myPlayer:(t=n[e.userid],t.dispose(),"local"===e.type?(this.baseSceneManager.myPlayer=null,clearInterval(this.baseSceneManager.positionBroadcasterID),clearInterval(this.rotationBroadcastID)):delete n[e.userid])},e.onstreamended=e=>{let t;const n=this.baseSceneManager.otherPlayers;"local"===e.type?t=this.baseSceneManager.myPlayer:(t=n[e.userid],t.dispose(),"local"===e.type?(this.baseSceneManager.myPlayer=null,clearInterval(this.baseSceneManager.positionBroadcasterID),clearInterval(this.rotationBroadcastID)):delete n[e.userid])},e.openOrJoin("GV-Con_Zugdidi")}async load(){const e=this.baseSceneManager.engine;let t=0;Le.Load("/datas/gltf/Con/","zugdidi.glb",e,(t=>{t.executeWhenReady((async()=>{const n=await Pe(),a=new Me(!0,n);t.enablePhysics(new se(0,0,0),a),t.createDefaultCamera(!0,!0,!0),t.createDefaultEnvironment({createGround:!1,createSkybox:!1}),t.activeCamera&&(t.activeCamera.attachControl(this.baseSceneManager.canvas),t.activeCamera.alpha=0,t.activeCamera.radius=3.168),this.zugdidiScene=t,e.runRenderLoop((()=>{this.zugdidiScene.render()})),this.enter()}))}),(n=>{n.lengthComputable?e.loadingUIText="Loading, please wait..."+(100*n.loaded/n.total).toFixed()+"%":(t=n.loaded/1048576,e.loadingUIText="Loading, please wait..."+Math.floor(100*t)/100+" MB already loaded.")}))}}const mi={class:"vc-drawtip vc-tooltip--style"},fi=g({name:"VcDemoViewer",__name:"Index",emits:["viewerReady","cesiumReady","leftClick","destroyed"],setup(e,{emit:t}){const n={"en-US":Gt,"zh-CN":qt},{locale:a}=Z(),o=t,i=R((()=>n[a.value])),r=qi.system.useThemeStore(),s=R((()=>r.themeConfig[r.activeName])),{toggleGlobalLayout:c}=qi.system.useLayoutStore(),{registerTimeout:d}=Ot(),l=w(null),u=w([0,75]),p=R((()=>({outerOptions:{icon:s.value.navigation.themeVcCompassOuterIcon,color:s.value.navigation.themeVcCompassOuterColor},innerOptions:{icon:s.value.navigation.themeVcCompassInnerIcon,color:s.value.navigation.themeVcCompassInnerColor,background:s.value.navigation.themeVcCompassInnerBackgroundColor},markerOptions:{color:s.value.global.themeColorAlpha},duration:5}))),h=R((()=>({background:s.value.navigation.themeVcZoomControlBackgroundColor,color:s.value.global.themeColor,border:`solid 1px ${s.value.commonPanel.themeCommonPanelListBorderColor}`,zoomInOptions:{color:s.value.global.themeColor},zoomOutOptions:{color:s.value.global.themeColor},zoomResetOptions:{color:s.value.global.themeColor}}))),m=R((()=>({color:s.value.global.themeColor,background:s.value.navigation.themeVcPrintBackgroundColor,round:!0}))),f=R((()=>({color:s.value.global.themeColor,background:s.value.navigation.themeVcPrintBackgroundColor,round:!0}))),v=R((()=>({position:"bottom-right",offset:[0,10],statusBarOpts:{color:s.value.global.themeColor,background:s.value.navigation.themeVcStatusBarBackgroundColor},distancelegendOpts:{color:s.value.global.themeColor,background:s.value.navigation.themeVcDistanceLegendBackgroundColor}}))),y=qi.viewer.useOverlayStore().mouseOverNameOpts;qi.viewer.useRenderStore().selectedRenderData;const g=R((()=>[...qi.viewer.useLayerStore().baseLayers,...qi.viewer.useLayerStore().overlayLayers])),P=R((()=>qi.viewer.useLayerStore().terrainLayers)),M=document.getElementsByTagName("canvas")[0],T=e=>{o("viewerReady",e),c({header:!0}),d((()=>{c({content:!0})}),500),ci.getInstance(e,M),new li(e,M),new di(e,M),new ui(e,M),new pi(e,M),new hi(e,M)},x=e=>{o("cesiumReady",e)};return(e,t)=>{const n=b("vc-navigation"),a=b("vc-ajax-bar"),o=b("vc-overlay-html"),r=b("vc-viewer");return C(),k(z(Ut),{locale:i.value,"cesium-path":z("https://unpkg.com/cesium@latest/Build/Cesium/Cesium.js"),"access-token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI5Y2U0ZTk2Ni1jNzdkLTQ3OWYtYjVmYS0yMGM3YTk3NjgzMmUiLCJpZCI6Njk5Nywic2NvcGVzIjpbImFzciIsImdjIl0sImlhdCI6MTU0ODA1MTc0OH0.Csy6yyAnv6JSBppH0Ou3ahshqcHFEhP27iOz5gjQMEo"},{default:O((()=>[E(r,{ref_key:"viewerRef",ref:l,class:"main-viewer",onReady:T,onCesiumReady:x},{default:O((()=>[E(n,{offset:u.value,"compass-opts":p.value,"zoom-opts":h.value,"print-opts":m.value,"location-opts":f.value,"other-opts":v.value},null,8,["offset","compass-opts","zoom-opts","print-opts","location-opts","other-opts"]),E(a,{position:"bottom",color:"#21BA45",size:"3px",positioning:"fixed"}),(C(!0),S(W,null,G(g.value,((e,t)=>(C(),k(Ae(e.component),ae({key:"layer"+t,ref_for:!0},e.props),{default:O((()=>[(C(!0),S(W,null,G(null==e?void 0:e.children,((e,n)=>(C(),k(Ae(e.component),ae({key:t+"_"+n,ref_for:!0},e.props),null,16)))),128))])),_:2},1040)))),128)),(C(!0),S(W,null,G(P.value,((e,t)=>(C(),S(W,{key:"terrain"+t},[e.props.show?(C(),k(Ae(e.component),ae({key:0,ref_for:!0},e.props),null,16)):A("",!0)],64)))),128)),z(y).show?(C(),k(o,{key:0,position:z(y).position,"pixel-offset":z(y).pixelOffset},{default:O((()=>[D("div",mi,L(z(y).text),1)])),_:1},8,["position","pixel-offset"])):A("",!0),te(e.$slots,"default")])),_:3},512)])),_:3},8,["locale","cesium-path"])}}}),vi={key:0,elevated:"",class:"main-header-container text-h4 text-center text-white"},yi={key:1,class:"content"},gi=la(g({name:"VcDemoMainLayout",__name:"MainLayout",setup(e){j((e=>({"584dfd5c":d.value.header.themeHeaderContentBackgroundColor,"32b772ff":d.value.menu.themeMenuColor,"5ea75299":d.value.menu.themeMenuActiveColor})));const t=T(),n=Jt(qi.system.useLayoutStore()).global,{active:a}=Jt(qi.system.useGrayStore()),o=qi.system.useMenuStore(),i=w(!1),r=R((()=>{const e=o.header;return e.length?e[0].children:[]})),s=R((()=>o.aside)),c=R((()=>t.name)),d=R((()=>{const e=qi.system.useThemeStore();return e.themeConfig[e.activeName]}));return Q((()=>t.matched),(e=>{var t,n;if(e.length>1){const a=r.value.filter((t=>t.path===e[1].path));if(a.length){const e=null==(n=null==(t=a[0])?void 0:t.children)?void 0:n.filter((e=>10===e.type));(null==e?void 0:e.length)?o.asideSet(e):o.asideSet([])}else o.asideSet([])}}),{immediate:!0}),P((()=>{qi.system.useAccountStore().load(),window.onunhandledrejection=e=>{qi.system.useLogStore(Gi).push({message:Qt.get(e,"reason.message","Unknown error"),type:"danger",meta:{error:Qt.get(e,"reason"),trace:Qt.get(e,"reason.stack")}})},window.onerror=(e,t,n,a,o)=>{qi.system.useLogStore(Gi).push({message:Qt.get(o,"message","Unknown error"),type:"danger",meta:{error:o,trace:Qt.get(o,"stack"),source:`${t}@${n}:${a}`,event:e}})},window.addEventListener("keydown",(function(e){"F11"===e.code&&(e.preventDefault(),yt.toggle())}))})),(e,t)=>{const o=b("router-view");return C(),k(gt,{view:"hHh Lpr fFf",class:F(["main-layout",{"gray-mode":z(a)}])},{default:O((()=>{var a;return[(null==(a=s.value)?void 0:a.length)&&z(n).header?(C(),k(bt,{key:0,modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),"show-if-above":"",width:180,breakpoint:500,bordered:"",mini:z(n).leftDrawerMini},{default:O((()=>[E(We,{class:"drawer-menu-list"},{default:O((()=>[(C(!0),S(W,null,G(s.value,((t,a)=>(C(),S(W,{key:a},[V((C(),k(Ke,{clickable:"","active-class":"menu-active-item",active:t.name===c.value,onClick:n=>e.$router.push(t.path),href:t.href,target:t.target},{default:O((()=>[E(Ge,{avatar:""},{default:O((()=>[E(He,{name:t.icon},null,8,["name"])])),_:2},1024),E(Ge,null,{default:O((()=>[_(L(e.$t(t.title)||t.caption),1)])),_:2},1024),z(n).leftDrawerMini?(C(),k(Ue,{key:0,"transition-show":"scale","transition-hide":"scale",anchor:"center right",self:"center left"},{default:O((()=>[_(L(e.$t(t.title)||t.caption),1)])),_:2},1024)):A("",!0)])),_:2},1032,["active","onClick","href","target"])),[[Je]]),t.separator?(C(),k(ht,{key:"sep"+a})):A("",!0)],64)))),128))])),_:1})])),_:1},8,["modelValue","mini"])):A("",!0),E(kt,{class:"no-padding"},{default:O((()=>[E(Ct,{class:"interaction-root"},{default:O((()=>[E(fi,null,{default:O((()=>[z(n).header?(C(),S("header",vi,[E(Bo)])):A("",!0),z(n).content?(C(),S("div",yi,[E(ai),E(o)])):A("",!0)])),_:1})])),_:1})])),_:1})]})),_:1},8,["class"])}}}),[["__scopeId","data-v-79ce8a36"]]),bi=Object.freeze(Object.defineProperty({__proto__:null,default:gi},Symbol.toStringTag,{value:"Module"})),Ci=Dn([]);Dn([]);const ki={theme:{list:[{title:"经典",name:"classic",preview:"images/theme/classic/preview@2x.png"},{title:"Element",name:"element",preview:"images/theme/element/preview@2x.png"}]},menu:{asideCollapse:!1,asideTransition:!0},hotkey:{search:{open:"s",close:"esc"}},transition:{active:!0}},Si=$t("menu",{state:()=>({header:[],aside:[],asideCollapse:ki.menu.asideCollapse,asideTransition:ki.menu.asideTransition,moduleHeader:[]}),getters:{},actions:{async asideCollapseSet(e){this.asideCollapse=e;ra().set({dbName:"sys",path:"menu.asideCollapse",value:String(this.asideCollapse),user:!0})},async asideCollapseToggle(){this.asideCollapse=!this.asideCollapse;ra().set({dbName:"sys",path:"menu.asideCollapse",value:String(this.asideCollapse),user:!0})},async asideTransitionSet(e){this.asideTransition=e;ra().set({dbName:"sys",path:"menu.asideTransition",value:String(this.asideTransition),user:!0})},async asideTransitionToggle(){this.asideTransition=!this.asideTransition;ra().set({dbName:"sys",path:"menu.asideTransition",value:String(this.asideTransition),user:!0})},async asideLoad(){ra().get({dbName:"sys",path:"menu",defaultValue:String(ki.menu),user:!0})},headerSet(e){this.header=e},asideSet(e){this.aside=e},clear(){this.header=[],this.aside=[]},moduleHeaderSet(e){this.moduleHeader=e}}}),wi=$t("search",{state:()=>({active:!1,hotkey:{open:ki.hotkey.search.open,close:ki.hotkey.search.close},pool:[]}),actions:{toggle(){this.active=!this.active},set(e){this.active=e},init(e){const t=[],n=function(e,a=[]){e.forEach((e=>{e.children?n(e.children,[...a,e.title]):t.push({...e,fullTitle:[...a,e.title].join(" / ")})}))};n(e),this.pool=t}}}),Pi=[...Ci];const Mi=Object.assign({"../../pages/create/Index.vue":da,"../../pages/create/tbd/Index.vue":pa,"../../pages/dynamic-render/Index.vue":ma,"../../pages/dynamic-render/historical-track/Index.vue":ya,"../../pages/dynamic-render/recursive-list/Index.vue":La,"../../pages/dynamic-render/recursive-list/work-bench/Index.vue":Oa,"../../pages/dynamic-render/stack/Index.vue":Ua,"../../pages/expansion/Index.vue":Fa,"../../pages/expansion/typhoon/Index.vue":Ha,"../../pages/happiness/Index.vue":Ja,"../../pages/happiness/hsa/Index.vue":Ya,"../../pages/home/Index.vue":Za,"../../pages/system/AuthCallback.vue":oo,"../../pages/system/Error404.vue":po,"../../pages/system/Login.vue":Mo,"../../pages/test/on-demand/Index.vue":xo});function Ti(e,t){return null==e&&(e={path:"/",children:[]}),t.forEach((t=>{let n=e;if(20!==t.type&&(null!=(a=t.component)&&""!==a)){let a=null;a="MainLayout"===t.component?gi:(e=>{const t=Mi[`../../pages${e}/Index.vue`];if(t)return t.default;hn(`动态路由页面【${e}】加载失败。请检查页面文件是否存在。`)})(t.path);const o=e.children;n={path:t.path,name:t.name,component:a,meta:{title:t.title,auth:!0,cache:!0}},t.redirect&&(n.redirect=t.redirect),o.push(n)}var a;null!=t.children&&t.children.length>0&&(null==n.children&&(n.children=[]),Ti(n,t.children))})),e.children}function xi(e,t){return null==e&&(e=[]),e.forEach((e=>{null!=e.permission&&""!==e.permission&&t.push(e.permission),null!=e.children&&e.children.length>0&&xi(e.children,t)})),t}function Ri(e){null==e&&(e=[]);let t=[];return e.forEach((e=>{if(10!==e.type)return;let n,a;null!=e.children&&e.children.length>0&&(n=Ri(e.children)),null!=e.icon&&""!==e.icon&&(a=e.icon),t.push({icon:a,children:n,...e})})),0===t.length&&(t=void 0),t}const Ii=$t("permission",{state:()=>({routes:[],addRoutes:[],permissions:[],inited:!1}),getters:{},actions:{setRoutes({accessedRoutes:e,permissions:t}){this.addRoutes=e,this.routes=un.concat(e),this.inited=!0,this.permissions=t},clear(){this.addRoutes=[],this.routes=[],this.inited=!1,this.permissions=[]},generateRoutes({menuTree:e}){return new Promise((t=>{const n=Ti(null,e),a=xi(e,[]);this.setRoutes({accessedRoutes:n,permissions:a}),n.forEach((e=>{"layout"===e.name&&"/"===e.path&&(e.children=e.children.concat(ln[0].children)),ta.addRoute(e)}));const o=Dn(Ri(e));Ci.splice(0,Ci.length),Ci.push(...Pi),Ci.push(...o);Si().headerSet(Ci);wi().init(Ci),t(!0)}))},async getAccessibleMenus({state:e,dispatch:t}){}}}),Oi=$t("gray",{state:()=>({active:!1}),getters:{},actions:{toggle(){this.active=!this.active},set(e){this.active=e}}}),Ei={themeName:"classic",global:{themeBGColor:"#ebf1f6",themeBGMaskColor:"rgba(0, 0, 0, 0)",themeColor:"#cbe1e5",themeColorAlpha:"rgba(255, 255, 255, 0.6)",themeColorActive:"#fff",themeScrollTopBackgroundColor:"rgba(0, 0, 0, 0)",themeQInputColor:"#fff",themeQInputBorderColor:"#fff9",themeQCheckboxTruthyColor:"#1976d2",themeQMenuColor:"#fff",themeQMenuBackgroundColor:"rgba(0, 68, 82, 0.6)",themeQCardColor:"#fff",themeQCardHeaderBackgroundColor:"rgba(0, 101, 122, 0.5)",themeQCardBackgroundColor:"rgba(0, 68, 82, 0.6)",themeQScrollAreaColor:"#fff"},header:{themeHeaderColor:"#cbe1e5",themeHeaderTitleColor:"#fff",themeHeaderLogoBackgroundColor:"rgba(255, 255, 255, 0)",themeHeaderBackgroundColor:"rgba(29, 29, 29, 0)",themeHeaderContentBackgroundColor:"rgba(0, 68, 82, 0.6)"},commonPanel:{themeCommonPanelHeaderColor:"#fff",themeCommonPanelHeaderBackgroundColor:"rgba(0, 101, 122, 0.8)",themeCommonPanelContentColor:"#fff",themeCommonPanelContentBackgroundColor:"rgba(0, 68, 82, 0.6)",themeCommonPanelListColor:"#fff",themeCommonPanelListBorderColor:"rgba(255, 255, 255, 0.278)"},navigation:{themeVcCompassOuterIcon:"svguse:#vc-icons-compass-outer",themeVcCompassOuterColor:"rgba(0, 68, 82)",themeVcCompassInnerIcon:"fa fa-compass",themeVcCompassInnerColor:"rgba(255, 255, 255, 0.7)",themeVcCompassInnerBackgroundColor:"rgba(0, 68, 82, 0.6)",themeVcZoomControlBackgroundColor:"rgba(0, 68, 82, 0.6)",themeVcPrintBackgroundColor:"rgba(0, 68, 82, 0.6)",themeVcStatusBarBackgroundColor:"rgba(0, 68, 82, 0.8)",themeVcDistanceLegendBackgroundColor:"rgba(0, 68, 82, 0.8)"},pageLogin:{themePageLoginColor:"#fff",themePageLoginBackground:"rgba(29,29,29, 0.5)"},menu:{themeMenuColor:"#cbe1e5",themeMenuActiveColor:"#fff",themeMenuActiveBackgroundColor:"#F2C037"}},_i={themeName:"element",global:{themeBGColor:"#314255",themeBGMaskColor:"rgba(0, 0, 0, 0)",themeColor:"#bfcbd9",themeColorAlpha:"rgba(70, 160, 252, 0.6)",themeColorActive:"#46a0fc",themeScrollTopBackgroundColor:"rgba(0, 0, 0, 0)",themeQInputColor:"#bfcbd9",themeQInputBorderColor:"#fff9",themeQCheckboxTruthyColor:"#46a0fc",themeQMenuColor:"#bfcbd9",themeQMenuBackgroundColor:"rgba(29, 29, 29, 0.6)",themeQCardColor:"#bfcbd9",themeQCardHeaderBackgroundColor:"rgba(49, 66, 85, 0.5)",themeQCardBackgroundColor:"rgba(29, 29, 29, 0.6)",themeQScrollAreaColor:"#46a0fc"},header:{themeHeaderColor:"#bfcbd9",themeHeaderTitleColor:"#bfcbd9",themeHeaderLogoBackgroundColor:"#314255",themeHeaderBackgroundColor:"#202d3d",themeHeaderContentBackgroundColor:"#314255"},commonPanel:{themeCommonPanelHeaderColor:"#bfcbd9",themeCommonPanelHeaderBackgroundColor:"rgba(49, 66, 85, 0.8)",themeCommonPanelContentColor:"#bfcbd9",themeCommonPanelContentBackgroundColor:"rgba(32, 45, 61, 0.6)",themeCommonPanelListColor:"#bfcbd9",themeCommonPanelListBorderColor:"rgba(255, 255, 255, 0.278)"},navigation:{themeVcCompassOuterIcon:"fa fa-circle-o-notch",themeVcCompassOuterColor:"rgb(49, 66, 85)",themeVcCompassInnerIcon:"fa fa-circle",themeVcCompassInnerColor:"rgba(49, 66, 85, 0.7)",themeVcCompassInnerBackgroundColor:"rgba(49, 66, 85, 0.6)",themeVcZoomControlBackgroundColor:"rgba(49, 66, 85, 0.6)",themeVcPrintBackgroundColor:"rgba(49, 66, 85, 0.6)",themeVcStatusBarBackgroundColor:"rgba(49, 66, 85, 0.8)",themeVcDistanceLegendBackgroundColor:"rgba(49, 66, 85, 0.8)"},pageLogin:{themePageLoginColor:"#bfcbd9",themePageLoginBackground:"rgba(32, 45, 61, 0.5)"},menu:{themeMenuColor:"#bfcbd9",themeMenuActiveColor:"#bfcbd9",themeMenuActiveBackgroundColor:"#F2C037"}};let Li="";const Di=$t("theme",{state:()=>({list:Qt.get(ki,"theme.list",[]),activeName:Qt.get(ki,"theme.list[0].name","h2o"),themeConfig:{classic:Ei,element:_i}}),getters:{activeSetting:e=>e.list.find((t=>t.name===e.activeName))},actions:{dom(){const e=`theme-${Li}`,t=`theme-${this.activeName}`;document.body.className.includes(e)?document.body.className=document.body.className.replace(e,t):document.body.className+=" "+t;const n=this.themeConfig[this.activeName];Object.keys(n.global).forEach((e=>{document.body.style.setProperty(`--${e}`,n.global[e])}))},async set(e){Li=this.activeName,this.activeName=this.list.find((t=>t.name===e))?e:this.list[0].name,this.dom();ra().set({dbName:"sys",path:"theme.activeName",value:this.activeName,user:!0})},async load(){Li=this.activeName;const e=ra(),t=e.get({dbName:"sys",path:"theme.activeName",defaultValue:this.list[0].name,user:!0});this.list.find((e=>e.name===t))?this.activeName=t:(this.activeName=this.list[0].name,e.set({dbName:"sys",path:"theme.activeName",value:this.activeName,user:!0})),this.dom()}}}),Ai=$t("transition",{state:()=>({active:ki.transition.active}),actions:{async set(e){this.active=e;ra().set({dbName:"sys",path:"transition.active",value:String(this.active),user:!0})},async load(){const e=ra();this.active=e.get({dbName:"sys",path:"transition.active",defaultValue:String(ki.transition.active),user:!0})}}}),Bi=$t("account",{state:()=>({}),getters:{},actions:{async oAuthLogin(e){await eo.auth.signInWithOAuth({provider:e,options:{redirectTo:`${window.location.origin}/auth/callback`}})},async login(e){const t=(await Yn.login(e)).data;an("token",t.token),an("uuid",t.id);sa().set({...t}),this.load()},logout:({confirm:e=!1}={})=>new Promise(((t,n)=>{async function a(){const{error:e}=await eo.auth.signOut();e&&(alert("logout error: "+e),n(e)),rn("token"),rn("uuid");sa().set({});Ii().clear();Si().clear(),ta.push({name:"login"}),t(!0)}if(e){const e=Oi();e.set(!0),St.create({title:"Log Out",message:"Confirm Log Out？",cancel:!0}).onOk((()=>{e.set(!1),a()})).onCancel((()=>{e.set(!1),Ve.create({message:"Cancel Log Out"}),t(!1)}))}else a()})),async load(){sa().load();Di().load();Ai().load();Si().asideLoad()}}}),Ni=$t("layout",{state:()=>({global:{header:!1,leftDrawerMini:!0,content:!1,footer:!1,layerManager:!1,navigation:!1,featureInfo:!1,videoPlayer:!1},dynamicRender:{datasource:{workBench:!1}}}),getters:{},actions:{toggleGlobalLayout(e){Object.keys(e).forEach((t=>{Qt.isBoolean(e[t])&&(this.global[t]=e[t])}))},toggleDynamicRenderPageLayout(e){const t=(e,n)=>{Object.keys(e).forEach((a=>{l(e[a])?t(e[a],n[a]):Qt.isBoolean(e[a])&&(n[a]=e[a])}))};t(e,this.dynamicRender)}}}),Vi=$t("log",{state:()=>({log:[]}),getters:{length:e=>e.log.length,lengthError:e=>e.log.filter((e=>"danger"===e.type)).length},actions:{push({message:e,type:t="info",meta:n}){this.log.push({message:e,type:t,time:wt.formatDate(Date.now(),"YYYY-MM-DD HH:mm:ss"),meta:{uuid:on("uuid"),token:on("token"),url:Qt.get(window,"location.href",""),...n}})},clean(){this.log=[]}}}),ji={useAccountStore:e=>Bi(e),useDBStore:e=>ra(e),useGrayStore:e=>Oi(e),useLayoutStore:e=>Ni(e),useLogStore:e=>Vi(e),useMenuStore:e=>Si(e),usePermissionStore:e=>Ii(e),useSearchStore:e=>wi(e),useThemeStore:e=>Di(e),useTransitionStore:e=>Ai(e),useUserStore:e=>sa(e)},Ui=$t("layer",{state:()=>({baseLayers:[{name:"tianditu_img",text:"天地图影像",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderTianditu",props:{mapStyle:"img_c",token:"436ce7e50d27eede2f2929307e6b33c0",minimumLevel:0,maximumLevel:17}}]},{name:"tianditu_vec",text:"天地图街道",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderTianditu",props:{mapStyle:"vec_c",token:"436ce7e50d27eede2f2929307e6b33c0",minimumLevel:0,maximumLevel:17}}]},{name:"baidu_img",text:"百度影像",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderBaidu",props:{mapStyle:"img",projectionTransforms:{from:"BD09",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"baidu_vec",text:"百度街道",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderBaidu",props:{mapStyle:"vec",projectionTransforms:{from:"BD09",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"baidu_midnight",text:"百度街道_午夜蓝",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderBaidu",props:{mapStyle:"midnight",projectionTransforms:{from:"BD09",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"baidu_dark",text:"百度街道_黑夜",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderBaidu",props:{mapStyle:"dark",projectionTransforms:{from:"BD09",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"amap_img",text:"高德影像",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderAmap",props:{mapStyle:"6",projectionTransforms:{from:"GCJ02",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"amap_vec",text:"高德街道",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderAmap",props:{mapStyle:"7",projectionTransforms:{from:"GCJ02",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"tencent_img",text:"腾讯影像",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderTencent",props:{mapStyle:"img",projectionTransforms:{from:"GCJ02",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"tencent_vector",text:"腾讯街道",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderTencent",props:{mapStyle:"vector",projectionTransforms:{from:"GCJ02",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"tencent_vector_my",text:"腾讯街道_墨渊",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderTencent",props:{mapStyle:"vector",styleId:"4",projectionTransforms:{from:"GCJ02",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"osm",text:"OSM",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderOsm"}]},{name:"arcgis",text:"ArcGIS",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:20,show:!1},children:[{component:"VcImageryProviderArcgis"}]}],overlayLayers:[{name:"tianditu_cva",text:"天地图注记",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:30,show:!1},children:[{component:"VcImageryProviderTianditu",props:{mapStyle:"cva_c",token:"436ce7e50d27eede2f2929307e6b33c0",minimumLevel:0,maximumLevel:17}}]},{name:"amap_label",text:"高德注记",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:30,show:!1},children:[{component:"VcImageryProviderAmap",props:{mapStyle:"8",ltype:"4",minimumLevel:0,maximumLevel:17,projectionTransforms:{from:"GCJ02",to:"WGS84"}}}]},{name:"amap_traffictile",text:"高德路况",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:30,show:!1},children:[{component:"VcImageryProviderAmap",props:{url:"/traffictile?v=1.0&x={x}&y={y}&z={z}&t=1",minimumLevel:0,maximumLevel:17,projectionTransforms:{from:"GCJ02",to:"WGS84"}}}]},{name:"baidu_traffic",text:"百度路况",component:"VcLayerImagery",props:{alpha:1,brightness:1,contrast:1,sortOrder:30,show:!1},children:[{component:"VcImageryProviderBaidu",props:{mapStyle:"traffic",projectionTransforms:{from:"BD09",to:"WGS84"},minimumLevel:0,maximumLevel:17}}]},{name:"admin",text:"行政区划",component:"VcDatasourceGeojson",props:{strokeWidth:5,stroke:"#ffc107",fill:"transparent",show:!1,data:"./datas/china.json"},children:[]}],terrainLayers:[{name:"terrain",text:"全球地形",component:"VcTerrainProviderCesium",props:{show:!1}},{name:"null",text:"不显示地形",component:void 0,props:{show:!1}}]}),getters:{},actions:{toggle({names:e,show:t}){const n=[...this.baseLayers,...this.overlayLayers,...this.terrainLayers];(e=Array.isArray(e)?e:[e]).forEach((e=>{var a;const o=Qt.find(n,(t=>t.name===e));!Qt.isUndefined(null==o?void 0:o.show)&&(o.show=t),!Qt.isUndefined(null==(a=null==o?void 0:o.props)?void 0:a.show)&&(o.props.show=t)}))},loadDefaultLayers(e){const t=[...this.baseLayers,...this.overlayLayers,...this.terrainLayers].map((e=>e.name));this.toggle({names:t,show:!1});this.toggle({names:["tianditu_img","admin"],show:!0})}}}),zi=$t("overlay",{state:()=>({mouseOverNameOpts:{position:[117.186419,45.66446,20],show:!1,text:"",pixelOffset:[0,0]}}),getters:{},actions:{setMouseOverlayLabel({position:e,show:t,text:n,pixelOffset:a}){this.mouseOverNameOpts.position=e,this.mouseOverNameOpts.show=t,this.mouseOverNameOpts.text=n,this.mouseOverNameOpts.pixelOffset=a},clearMouseOverlayLabel(){this.mouseOverNameOpts.position=void 0,this.mouseOverNameOpts.show=!1,this.mouseOverNameOpts.text=void 0}}}),Fi=$t("render",{state:()=>({renderDatas:[],selectedRenderData:{model:void 0,renderingType:void 0,restoreHandlers:[],feature:void 0,featureInfoListItems:[]}}),getters:{},actions:{addRenderDatas(e){(e=Array.isArray(e)?e:[e]).forEach((e=>{-1===Qt.findIndex(this.renderDatas,(t=>t.id===e.id))?this.renderDatas.push(e):mn(`添加渲染数据集失败，原因：id 为【${e.id} 】的数据已经存在。`,"渲染数据模型：",e)}))},removeRenderDataById(e){Qt.remove(this.renderDatas,(t=>t.id===e))},removeRenderDataByType(e){Qt.remove(this.renderDatas,(t=>t.type===e))},removeRenderDataByPage(e){Qt.remove(this.renderDatas,(t=>t.page===e))},removeAllRenderData(){this.renderDatas.length=0},setSelectedRenderData(e,t){this.selectedRenderData.model=e.model,this.selectedRenderData.renderingType=e.renderingType,this.selectedRenderData.feature=e.feature,this.selectedRenderData.featureInfoListItems=e.featureInfoListItems,t?this.selectedRenderData.restoreHandlers=[]:this.selectedRenderData.restoreHandlers.push(...e.restoreHandlers)},getRenderDataByDatasetId(e){return Qt.find(this.renderDatas,(t=>t.id===e))}}}),Wi={useLayerStore:e=>Ui(e),useOverlayStore:e=>zi(e),useRenderStore:e=>Fi(e)},Gi=Kt(),qi={system:{...ji},viewer:{...Wi}};const Hi=Be(la({},[["render",function(e,t){const n=b("router-view");return C(),k(n)}]]));Hi.use(Pt,{plugins:{Notify:Ve,Dialog:St,LocalStorage:Ne,Loading:Mt,AppFullscreen:yt},lang:Tt}),Hi.use(ea),Hi.use(Ht),Hi.use(Gi),Hi.use(ta),Hi.mount("#app");
